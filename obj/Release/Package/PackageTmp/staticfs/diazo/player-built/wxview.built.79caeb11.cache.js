define("jquery",function(){}),function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){if(e instanceof x)return e;if(!(this instanceof x))return new x(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.4.4";var T=x.each=x.forEach=function(e,t,r){if(e==null)return;if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];return e==null?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},x.filter=x.select=function(e,t,n){var r=[];return e==null?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return e==null?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return e==null?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};x.contains=x.include=function(e,t){return e==null?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t,n){return x.isEmpty(t)?n?null:[]:x[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-Infinity;var r={computed:-Infinity,value:-Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return Infinity;var r={computed:Infinity,value:Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t||x.identity);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n,r){n=n==null?x.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return e==null?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,0,t):e[0]},x.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},x.last=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,Math.max(e.length-t,0)):e[e.length-1]},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return T(e,function(e){x.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){if(t?!r||o[o.length-1]!==n:!x.contains(o,n))o.push(n),s.push(e[r])}),s},x.union=function(){return x.uniq(a.apply(r,arguments))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){var e=u.call(arguments),t=x.max(x.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=x.pluck(e,""+r);return n},x.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s},x.bind=function(e,t){if(e.bind===S&&S)return S.apply(e,u.call(arguments,1));var n=u.call(arguments,2);return function(){return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);return t.length===0&&(t=x.functions(e)),T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t){var n,r,i,s,o=0,u=function(){o=new Date,i=null,s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);return n=this,r=arguments,f<=0?(clearTimeout(i),i=null,o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s}},x.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},x.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&(t[t.length]=n);return t},x.values=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push(e[n]);return t},x.pairs=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push([n,e[n]]);return t},x.invert=function(e){var t={};for(var n in e)x.has(e,n)&&(t[e[n]]=n);return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]==null&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var O=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if(i=="[object Array]"){o=e.length,u=o==t.length;if(u)while(o--)if(!(u=O(e[o],t[o],n,r)))break}else{var a=e.constructor,l=t.constructor;if(a!==l&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(l)&&l instanceof l))return!1;for(var c in e)if(x.has(e,c)){o++;if(!(u=x.has(t,c)&&O(e[c],t[c],n,r)))break}if(u){for(c in t)if(x.has(t,c)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};x.isEqual=function(e,t){return O(e,t,[],[])},x.isEmpty=function(e){if(e==null)return!0;if(x.isArray(e)||x.isString(e))return e.length===0;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&e.nodeType===1},x.isArray=w||function(e){return f.call(e)=="[object Array]"},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),typeof /./!="function"&&(x.isFunction=function(e){return typeof e=="function"}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||f.call(e)=="[object Boolean]"},x.isNull=function(e){return e===null},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){var r=Array(e);for(var i=0;i<e;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=x.invert(M.escape);var _={escape:new RegExp("["+x.keys(M.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(M.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return t==null?"":(""+t).replace(_[e],function(t){return M[e][t]})}}),x.result=function(e,t){if(e==null)return null;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),j.call(this,n.apply(x,e))}})};var D=0;x.uniqueId=function(e){var t=++D+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var P=/(.)^/,H={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){if(x.isFunction(e))return t?e(t):e;var r;n=x.defaults({},n,x.templateSettings);var i=new RegExp([(n.escape||P).source,(n.interpolate||P).source,(n.evaluate||P).source].join("|")+"|$","g"),s=0,o="__p+='",u=e;e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(B,function(e){return"\\"+H[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(a){throw a.source=o,a}if(t)return r(t,x);var f=function(e){return r.call(this,e,x)};return f.source="function("+(n.variable||"obj")+"){\n"+o+"}",f.textsource=u,f},x.chain=function(e){return x(e).chain()};var j=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],j.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return j.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),define("underscore",function(e){return function(){var t,n;return t||e._}}(this)),function(){var e=this,t=e.Backbone,n=[],r=n.push,i=n.slice,s=n.splice,o;o="undefined"!=typeof exports?exports:e.Backbone={},o.VERSION="0.9.10";var u=e._;!u&&"undefined"!=typeof require&&(u=require("underscore")),o.$=e.jQuery||e.Zepto||e.ender,o.noConflict=function(){return e.Backbone=t,this},o.emulateHTTP=!1,o.emulateJSON=!1;var a=/\s+/,f=function(e,t,n,r){if(!n)return!0;if("object"==typeof n)for(var i in n)e[t].apply(e,[i,n[i]].concat(r));else{if(!a.test(n))return!0;n=n.split(a),i=0;for(var s=n.length;i<s;i++)e[t].apply(e,[n[i]].concat(r))}},l=function(e,t){var n,r=-1,i=e.length;switch(t.length){case 0:for(;++r<i;)(n=e[r]).callback.call(n.ctx);break;case 1:for(;++r<i;)(n=e[r]).callback.call(n.ctx,t[0]);break;case 2:for(;++r<i;)(n=e[r]).callback.call(n.ctx,t[0],t[1]);break;case 3:for(;++r<i;)(n=e[r]).callback.call(n.ctx,t[0],t[1],t[2]);break;default:for(;++r<i;)(n=e[r]).callback.apply(n.ctx,t)}},n=o.Events={on:function(e,t,n){return!f(this,"on",e,[t,n])||!t?this:(this._events||(this._events={}),(this._events[e]||(this._events[e]=[])).push({callback:t,context:n,ctx:n||this}),this)},once:function(e,t,n){if(!f(this,"once",e,[t,n])||!t)return this;var r=this,i=u.once(function(){r.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n),this},off:function(e,t,n){var r,i,s,o,a,l,c,h;if(!this._events||!f(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;o=e?[e]:u.keys(this._events),a=0;for(l=o.length;a<l;a++)if(e=o[a],r=this._events[e]){s=[];if(t||n){c=0;for(h=r.length;c<h;c++)i=r[c],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&s.push(i)}this._events[e]=s}return this},trigger:function(e){if(!this._events)return this;var t=i.call(arguments,1);if(!f(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&l(n,t),r&&l(r,arguments),this},listenTo:function(e,t,n){var r=this._listeners||(this._listeners={}),i=e._listenerId||(e._listenerId=u.uniqueId("l"));return r[i]=e,e.on(t,"object"==typeof t?this:n,this),this},stopListening:function(e,t,n){var r=this._listeners;if(r){if(e)e.off(t,"object"==typeof t?this:n,this),!t&&!n&&delete r[e._listenerId];else{"object"==typeof t&&(n=this);for(var i in r)r[i].off(t,n,this);this._listeners={}}return this}}};n.bind=n.on,n.unbind=n.off,u.extend(o,n);var c=o.Model=function(e,t){var n,r=e||{};this.cid=u.uniqueId("c"),this.attributes={},t&&t.collection&&(this.collection=t.collection),t&&t.parse&&(r=this.parse(r,t)||{});if(n=u.result(this,"defaults"))r=u.defaults({},r,n);this.set(r,t),this.changed={},this.initialize.apply(this,arguments)};u.extend(c.prototype,n,{changed:null,idAttribute:"id",initialize:function(){},toJSON:function(){return u.clone(this.attributes)},sync:function(){return o.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return u.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,n){var r,i,s,o,a,f,l;if(null==e)return this;"object"==typeof e?(i=e,n=t):(i={})[e]=t,n||(n={});if(!this._validate(i,n))return!1;s=n.unset,o=n.silent,e=[],a=this._changing,this._changing=!0,a||(this._previousAttributes=u.clone(this.attributes),this.changed={}),l=this.attributes,f=this._previousAttributes,this.idAttribute in i&&(this.id=i[this.idAttribute]);for(r in i)t=i[r],u.isEqual(l[r],t)||e.push(r),u.isEqual(f[r],t)?delete this.changed[r]:this.changed[r]=t,s?delete l[r]:l[r]=t;if(!o){e.length&&(this._pending=!0),t=0;for(r=e.length;t<r;t++)this.trigger("change:"+e[t],this,l[e[t]],n)}if(a)return this;if(!o)for(;this._pending;)this._pending=!1,this.trigger("change",this,n);return this._changing=this._pending=!1,this},unset:function(e,t){return this.set(e,void 0,u.extend({},t,{unset:!0}))},clear:function(e){var t={},n;for(n in this.attributes)t[n]=void 0;return this.set(t,u.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!u.isEmpty(this.changed):u.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?u.clone(this.changed):!1;var t,n=!1,r=this._changing?this._previousAttributes:this.attributes,i;for(i in e)u.isEqual(r[i],t=e[i])||((n||(n={}))[i]=t);return n},previous:function(e){return null==e||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return u.clone(this._previousAttributes)},fetch:function(e){e=e?u.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success;return e.success=function(e,n,r){if(!e.set(e.parse(n,r),r))return!1;t&&t(e,n,r)},this.sync("read",this,e)},save:function(e,t,n){var r,i,s=this.attributes;return null==e||"object"==typeof e?(r=e,n=t):(r={})[e]=t,r&&(!n||!n.wait)&&!this.set(r,n)?!1:(n=u.extend({validate:!0},n),this._validate(r,n)?(r&&n.wait&&(this.attributes=u.extend({},s,r)),void 0===n.parse&&(n.parse=!0),i=n.success,n.success=function(e,t,n){e.attributes=s;var o=e.parse(t,n);n.wait&&(o=u.extend(r||{},o));if(u.isObject(o)&&!e.set(o,n))return!1;i&&i(e,t,n)},e=this.isNew()?"create":n.patch?"patch":"update","patch"===e&&(n.attrs=r),e=this.sync(e,this,n),r&&n.wait&&(this.attributes=s),e):!1)},destroy:function(e){e=e?u.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(e,t,i){(i.wait||e.isNew())&&r(),n&&n(e,t,i)};if(this.isNew())return e.success(this,null,e),!1;var i=this.sync("delete",this,e);return e.wait||r(),i},url:function(){var e=u.result(this,"urlRoot")||u.result(this.collection,"url")||k();return this.isNew()?e:e+("/"===e.charAt(e.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(e){return!this.validate||!this.validate(this.attributes,e)},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=u.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,t||{}),!1):!0}});var h=o.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this.models=[],this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,u.extend({silent:!0},t))};u.extend(h.prototype,n,{model:c,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return o.sync.apply(this,arguments)},add:function(e,t){e=u.isArray(e)?e.slice():[e],t||(t={});var n,i,o,a,f,l,c,h,p,d;c=[],h=t.at,p=this.comparator&&null==h&&0!=t.sort,d=u.isString(this.comparator)?this.comparator:null,n=0;for(i=e.length;n<i;n++)(o=this._prepareModel(a=e[n],t))?(f=this.get(o))?t.merge&&(f.set(a===o?o.attributes:a,t),p&&!l&&f.hasChanged(d)&&(l=!0)):(c.push(o),o.on("all",this._onModelEvent,this),this._byId[o.cid]=o,null!=o.id&&(this._byId[o.id]=o)):this.trigger("invalid",this,a,t);c.length&&(p&&(l=!0),this.length+=c.length,null!=h?s.apply(this.models,[h,0].concat(c)):r.apply(this.models,c)),l&&this.sort({silent:!0});if(t.silent)return this;n=0;for(i=c.length;n<i;n++)(o=c[n]).trigger("add",o,this,t);return l&&this.trigger("sort",this,t),this},remove:function(e,t){e=u.isArray(e)?e.slice():[e],t||(t={});var n,r,i,s;n=0;for(r=e.length;n<r;n++)if(s=this.get(e[n]))delete this._byId[s.id],delete this._byId[s.cid],i=this.indexOf(s),this.models.splice(i,1),this.length--,t.silent||(t.index=i,s.trigger("remove",s,this,t)),this._removeReference(s);return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){if(null!=e)return this._idAttr||(this._idAttr=this.model.prototype.idAttribute),this._byId[e.id||e.cid||e[this._idAttr]||e]},at:function(e){return this.models[e]},where:function(e){return u.isEmpty(e)?[]:this.filter(function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},sort:function(e){if(!this.comparator)throw Error("Cannot sort a set without a comparator");return e||(e={}),u.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(u.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return u.invoke(this.models,"get",e)},update:function(e,t){t=u.extend({add:!0,merge:!0,remove:!0},t),t.parse&&(e=this.parse(e,t));var n,r,i,s,o=[],a=[],f={};u.isArray(e)||(e=e?[e]:[]);if(t.add&&!t.remove)return this.add(e,t);r=0;for(i=e.length;r<i;r++)n=e[r],s=this.get(n),t.remove&&s&&(f[s.cid]=!0),(t.add&&!s||t.merge&&s)&&o.push(n);if(t.remove){r=0;for(i=this.models.length;r<i;r++)n=this.models[r],f[n.cid]||a.push(n)}return a.length&&this.remove(a,t),o.length&&this.add(o,t),this},reset:function(e,t){t||(t={}),t.parse&&(e=this.parse(e,t));for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return t.previousModels=this.models.slice(),this._reset(),e&&this.add(e,u.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e=e?u.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success;return e.success=function(e,n,r){e[r.update?"update":"reset"](n,r),t&&t(e,n,r)},this.sync("read",this,e)},create:function(e,t){t=t?u.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,r=t.success;return t.success=function(e,t,i){i.wait&&n.add(e,i),r&&r(e,t,i)},e.save(null,t),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models.length=0,this._byId={}},_prepareModel:function(e,t){if(e instanceof c)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:!1},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){("add"===e||"remove"===e)&&n!==this||("destroy"===e&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))},sortedIndex:function(e,t,n){t||(t=this.comparator);var r=u.isFunction(t)?t:function(e){return e.get(t)};return u.sortedIndex(this.models,e,r,n)}}),u.each("forEach each map collect reduce foldl inject reduceRight foldr find detect filter select reject every all some any include contains invoke max min toArray size first head take initial rest tail drop last without indexOf shuffle lastIndexOf isEmpty chain".split(" "),function(e){h.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.models),u[e].apply(u,t)}}),u.each(["groupBy","countBy","sortBy"],function(e){h.prototype[e]=function(t,n){var r=u.isFunction(t)?t:function(e){return e.get(t)};return u[e](this.models,r,n)}});var p=o.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},d=/\((.*?)\)/g,v=/(\(\?)?:\w+/g,m=/\*\w+/g,g=/[\-{}\[\]+?.,\\\^$|#\s]/g;u.extend(p.prototype,n,{initialize:function(){},route:function(e,t,n){return u.isRegExp(e)||(e=this._routeToRegExp(e)),n||(n=this[t]),o.history.route(e,u.bind(function(r){r=this._extractParameters(e,r),n&&n.apply(this,r),this.trigger.apply(this,["route:"+t].concat(r)),this.trigger("route",t,r),o.history.trigger("route",this,t,r)},this)),this},navigate:function(e,t){return o.history.navigate(e,t),this},_bindRoutes:function(){if(this.routes)for(var e,t=u.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(g,"\\$&").replace(d,"(?:$1)?").replace(v,function(e,t){return t?e:"([^/]+)"}).replace(m,"(.*?)"),RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var y=o.History=function(){this.handlers=[],u.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},b=/^[#\/]|\s+$/g,w=/^\/+|\/+$/g,E=/msie [\w.]+/,S=/\/$/;y.started=!1,u.extend(y.prototype,n,{interval:50,getHash:function(e){return(e=(e||this).location.href.match(/#(.*)$/))?e[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(S,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return e.replace(b,"")},start:function(e){if(y.started)throw Error("Backbone.history has already been started");y.started=!0,this.options=u.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.options.pushState||!this.history||!this.history.pushState),e=this.getFragment();var t=document.documentMode,t=E.exec(navigator.userAgent.toLowerCase())&&(!t||7>=t);this.root=("/"+this.root+"/").replace(w,"/"),t&&this._wantsHashChange&&(this.iframe=o.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(e)),this._hasPushState?o.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!t?o.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=e,e=this.location,t=e.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!t)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&t&&e.hash&&(this.fragment=this.getHash().replace(b,""),this.history.replaceState({},document.title,this.root+this.fragment+e.search));if(!this.options.silent)return this.loadUrl()},stop:function(){o.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),y.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe)));if(e===this.fragment)return!1;this.iframe&&this.navigate(e),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e);return u.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0})},navigate:function(e,t){if(!y.started)return!1;if(!t||!0===t)t={trigger:t};e=this.getFragment(e||"");if(this.fragment!==e){this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)}},_updateHash:function(e,t,n){n?(n=e.href.replace(/(javascript:|#).*$/,""),e.replace(n+"#"+t)):e.hash="#"+t}}),o.history=new y;var x=o.View=function(e){this.cid=u.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},T=/^(\S+)\s*(.*)$/,N="model collection el id attributes className tagName events".split(" ");u.extend(x.prototype,n,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof o.$?e:o.$(e),this.el=this.$el[0],!1!==t&&this.delegateEvents(),this},delegateEvents:function(e){if(e||(e=u.result(this,"events"))){this.undelegateEvents();for(var t in e){var n=e[t];u.isFunction(n)||(n=this[e[t]]);if(!n)throw Error('Method "'+e[t]+'" does not exist');var r=t.match(T),i=r[1],r=r[2],n=u.bind(n,this),i=i+(".delegateEvents"+this.cid);""===r?this.$el.on(i,n):this.$el.on(i,r,n)}}},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=u.extend({},u.result(this,"options"),e)),u.extend(this,u.pick(e,N)),this.options=e},_ensureElement:function(){if(this.el)this.setElement(u.result(this,"el"),!1);else{var e=u.extend({},u.result(this,"attributes"));this.id&&(e.id=u.result(this,"id")),this.className&&(e["class"]=u.result(this,"className")),e=o.$("<"+u.result(this,"tagName")+">").attr(e),this.setElement(e,!1)}}});var C={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};o.sync=function(e,t,n){var r=C[e];u.defaults(n||(n={}),{emulateHTTP:o.emulateHTTP,emulateJSON:o.emulateJSON});var i={type:r,dataType:"json"};n.url||(i.url=u.result(t,"url")||k()),null==n.data&&t&&("create"===e||"update"===e||"patch"===e)&&(i.contentType="application/json",i.data=JSON.stringify(n.attrs||t.toJSON(n))),n.emulateJSON&&(i.contentType="application/x-www-form-urlencoded",i.data=i.data?{model:i.data}:{});if(n.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){i.type="POST",n.emulateJSON&&(i.data._method=r);var s=n.beforeSend;n.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r);if(s)return s.apply(this,arguments)}}"GET"!==i.type&&!n.emulateJSON&&(i.processData=!1);var a=n.success;n.success=function(e){a&&a(t,e,n),t.trigger("sync",t,e,n)};var f=n.error;return n.error=function(e){f&&f(t,e,n),t.trigger("error",t,e,n)},e=n.xhr=o.ajax(u.extend(i,n)),t.trigger("request",t,e,n),e},o.ajax=function(){return o.$.ajax.apply(o.$,arguments)},c.extend=h.extend=p.extend=x.extend=y.extend=function(e,t){var n=this,r;r=e&&u.has(e,"constructor")?e.constructor:function(){return n.apply(this,arguments)},u.extend(r,n,t);var i=function(){this.constructor=r};return i.prototype=n.prototype,r.prototype=new i,e&&u.extend(r.prototype,e),r.__super__=n.prototype,r};var k=function(){throw Error('A "url" property or function must be specified')}}.call(this),define("backbone",["underscore","jquery"],function(e){return function(){var t,n;return t||e.Backbone}}(this)),define("text",["module"],function(e){var t,n,r,i,s=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,u=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,a=typeof location!="undefined"&&location.href,f=a&&location.protocol&&location.protocol.replace(/\:/,""),l=a&&location.hostname,c=a&&(location.port||undefined),h=[],p=e.config&&e.config()||{};t={version:"2.0.5+",strip:function(e){if(e){e=e.replace(o,"");var t=e.match(u);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:p.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=s[t];try{e=new ActiveXObject(n)}catch(r){}if(e){s=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,p.isBuild&&(h[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}p.isBuild=i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),h=p.useXhr||t.useXhr;!a||h(u,f,l,c)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(h.hasOwnProperty(n)){var s=t.jsEscape(h[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(p.env==="node"||!p.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node)n=require.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");r.indexOf("ï»¿")===0&&(r=r.substring(1)),t(r)};else if(p.env==="xhr"||!p.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);p.onXhr&&p.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText))},s.send(null)};else if(p.env==="rhino"||!p.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(p.env==="xpconnect"||!p.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),t.get=function(e,t){var n,s,o={},u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),s=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),s.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),s.readString(n.available(),o),s.close(),n.close(),t(o.value)}catch(a){throw new Error((u&&u.path||"")+": "+a)}};return t}),define("text!interaction_view/template/message.js",[],function(){return'<div class="status <%=type%>">\n<p><%=msg%></p>\n<a href="#" class="close">Close</a>\n</div>'}),define("text!interaction_view/template/slidenumber.js",[],function(){return'<%if(slidelength>1){%>\n<% if(iDetail.slideno_horizontal){%>\n<nav class="iView nav-horizen slidenumber" data-id="<%=id%>" style="left:<%=iDetail.slideno_horizontal_data.x%>px;top:<%=iDetail.slideno_horizontal_data.y%>px;">\n    <%for(i=0;i<slidelength;i++){%><li class="<%=0==i?"active":""%>"><a href="#" data-index="<%=i%>"></a></li><% } %>\n</nav>\n<% } %>\n<% if(iDetail.slideno_vertical){%>\n<nav class="iView nav-vertical slidenumber" data-id="<%=id%>" style="left:<%=iDetail.slideno_vertical_data.x%>px;top:<%=iDetail.slideno_vertical_data.y%>px;">\n    <%for(i=0;i<slidelength;i++){%><li class="<%=0==i?"active":""%>"><a href="#" data-index="<%=i%>"></a></li><% } %>\n</nav>\n<% } %>\n<% } %>\n'}),define("text!interaction_view/template/imgpreview.js",[],function(){return'<div class="btn-group action-control" style="position: absolute;left: 0;top: 0;z-index: 100001;background: transparent;width: 100%;height: 100%;">\n    <button class="btn preview-left enabled" href="#" rel="tooltip" data-original-title="PREV" style="color: #FFF;position: absolute;left: 0;top: 50%;background-color: transparent;background: none;">\n        <i class="icon-chevron-left icon-2x"></i>\n    </button>\n    <button class="btn preview-right enabled" href="#" rel="tooltip" data-original-title="NEXT" style="color: #FFF;background: transparent;position: absolute;right: 0px;top: 50%;">\n        <i class="icon-chevron-right icon-2x"></i>\n    </button>\n</div>'}),function(){var e={uuid:function(e){function t(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}if(!e)return t()+t()+t()+t()+t()+t()+t()+t();var n="";while(e--)n+=t();return n},changeURLPar:function(e,t,n){var r=e.split("#")[0],s;if(r.indexOf("?")!=-1){var o="";o=r.substr(r.indexOf("?")+1);var u="",a="",f,l="0";if(o.indexOf("&")!=-1){f=o.split("&");for(i in f){if(f[i].split("=")[0]==t){if(n=="")continue;a=n,l="1"}else a=f[i].split("=")[1];u=u+f[i].split("=")[0]+"="+a+"&"}u=u.substr(0,u.length-1),l=="0"&&n!=""&&u==o&&(u=u+"&"+t+"="+n)}else o.indexOf("=")!=-1?(f=o.split("="),f[0]==t?(a=n,l="1"):a=f[1],a!=""&&(u=f[0]+"="+a),l=="0"&&u==o&&n!=""&&(u=u+"&"+t+"="+n)):n!=""&&(u=t+"="+n);s=r.substr(0,r.indexOf("?")),u!=""&&(s=s+"?"+u)}else n!=""?s=r+"?"+t+"="+n:s=r;return e.indexOf("#")>0&&(s=s+"#"+e.split("#")[1]),s},getUrlParameterByName:function(e,t){var n=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),r=new RegExp("([\\?&]"+n+"=([^&#]*))+"),i=r.exec(typeof t!="undefined"&&t||location.search);return i==null?null:decodeURIComponent(i[i.length-1].replace(/\+/g," "))},replaceUrlParameterByName:function(e,t,n){var r=t.split("=")[1];return this.changeURLPar(n,e,r)},getHashParameterByName:function(e){var t=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),n=new RegExp("[\\#&]"+t+"=([^&#]*)"),r=n.exec(location.hash);return r==null?null:decodeURIComponent(r[1].replace(/\+/g," "))},replaceHashParameterByName:function(e,t){var n=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),r=new RegExp("[\\#&]"+n+"=([^&#]*)"),i=r.exec(location.hash);return location.hash.replace(i[0].substr(1),t)},parseTemplate:function(e){var t=null;return typeof e=="function"&&(t=e),typeof e=="string"&&(t=_.template(e)),t},renderT:function(e,t,n,r,i){if(!e)return!1;t||(t={});var s=r||null,o=$.extend(!0,{},t);s&&typeof _gDebug!="undefined"&&_gDebug&&_g.debug&&_g.debug.enabled&&_g.debug.query_user_template(s)&&!i&&(e=_g.debug.query_user_template(s));if(n){var u={};u[n]=o,o=u}var a=_g.parseTemplate(e);s&&_g.debug&&_g.debug.enabled&&(_g.debug.template[s]={data:o,template:typeof e=="string"?e:e.textsource,debug:!0});var f=$(a(o));return s&&_g.debug&&_g.debug.enabled&&(_g.debug.template[s].el=f),_g.generator&&(_g.generator.autoWidget(f),(f.hasClass("c-slimscroll")||f.find(".c-slimscroll").length)&&_g.generator.autoScroll(f)),f.find("[data-toggle=tooltip],.c-tooltip-btn").each(function(){var e=$(this),t=$(this).data().template;t?require(["text!"+t],function(){var n=require("text!"+t);e.tooltip({template:n})}):$(this).tooltip()}),f},domExist:function(e,t){return t||(t=document),typeof e=="string"&&(e=$(e)),$.contains(t.documentElement,e[0])},browserSupport:function(e){var t=!1,n={msie:1,chrome:1,mozilla:1,safari:1,opera:1,success:null,fail:null};e=e?$.extend(!0,{},n,e):$.extend(!0,{},n);var r=parseInt($.browser.version,10);return $.browser.msie&&e.msie==1||$.browser.chrome&&e.chrome==1||$.browser.mozilla&&e.mozilla==1||$.browser.safari&&e.safrai==1&&$.browser.opera&&e.opera==1?t=!0:$.browser.msie&&e.msie==0||$.browser.chrome&&e.chrome==0||$.browser.mozilla&&e.mozilla==0||$.browser.safari&&e.safrai==0&&$.browser.opera&&e.opera==0?t=!1:($.browser.msie&&(t=r>=e.msie),$.browser.chrome&&(t=r>=e.chrome),$.browser.mozilla&&(t=r>=e.mozilla),$.browser.opera&&(t=r>=e.opera),$.browser.safari&&(t=r>=e.safari)),t?e.success&&e.success():e.fail&&e.fail(),t},array:{moveup:function(e,t){var n=e.indexOf(t);return n>0&&(e=_g.array.swap(e,n,n-1)),e},movedown:function(e,t){var n=e.indexOf(t);return n<e.length&&(e=_g.array.swap(e,n,n+1)),e},swap:function(e,t,n){return e[t]=e.splice(n,1,e[t])[0],e},move2first:function(e,t){var n=[];n.push(t);for(i=0;i<e.length;i++)e[i]!=t&&n.push(e[i]);return n},move2last:function(e,t){var n=[];for(i=0;i<e.length;i++)e[i]!=t&&n.push(e[i]);return n.push(t),n},randomPick:function(e){return e[Math.floor(Math.random()*e.length)]},maptree:function(e){var t={treesource:null,mapdata:null,idAttribute:"id"};e=e?$.extend(!0,{},t,e):$.extend(!0,{},t);if(!e.treesource||!e.mapdata)return[];var n=[];return _.each(e.treesource,function(t){t.children&&(t.children=_g.array.maptree({treesource:t.children,mapdata:e.mapdata,idAttribute:e.idAttribute}));var r=_.find(e.mapdata,function(n){return n[e.idAttribute]==t[e.idAttribute]});r&&(t=$.extend(!0,t,r)),n.push(t)}),n},toDict:function(e,t){var n={},r;for(i=0;i<e.length;i++)r=e[i][t],n[r]=e[i];return n},treeToList:function(e,t,n){var r={childrenKey:"children",parentKey:"parent",idAttribute:"id"};t=t?$.extend(!0,{},r,t):$.extend(!0,{},r);if(!e)return[];var i=[];return _.each(e,function(r){if(r[t.childrenKey].length){var s=_g.array.toTreeList(r[t.childrenKey],t,n?n:e);for(j=0;j<s.length;j++)i.push(s[j]);r.children=_.pluck(r.children,"id")}else delete r.children;i.push(r)}),i},listToTree:function(e,t,n){var r={childrenKey:"children",parentKey:"parent",idAttribute:"id"};t=t?$.extend(!0,{},r,t):$.extend(!0,{},r);var i=[];return n&&(e=_.map(e,function(e){return typeof e=="string"&&(e=_.find(n,function(n){return n[t.idAttribute]==e})),e})),_.each(e,function(r){var s=$.extend(!0,{},r);n||s[t.parentKey],s[t.childrenKey]&&s[t.childrenKey].length?(s[t.childrenKey]=_g.array.listToTree(s[t.childrenKey],t,n?n:e),i.push(s)):i.push(s)}),i}},object:{jsonparse:function(e){if(!e)return null;try{return a=JSON.parse(e),a}catch(t){return e}},equal:function(e,t){},treeToArray:function(e){},getKeyByValue:function(e,t){try{var n=_.keys(e)[_.values(e).indexOf(t)];return n}catch(r){return undefined}}},string:{randomGenerate:function(e){e=e?e:10;var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890";for(var r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t},getUrlExt:function(e){return e.match(/(.[^.]+|)$/)[0]},getUrlNameWithOutExt:function(e){return e.substr(0,e.lastIndexOf("."))||e},getFileNameByPath:function(e){return e.replace(/^.*[\\\/]/,"")},string2boolean:function(e){return e=="true"?!0:!1},capitalize:function(e){return e=e.substring(0,1).toUpperCase()+e.substring(1),e},rmfirst:function(e){return e.replace(/^.(\s+)?/,"")},rmlast:function(e){return e.replace(/(\s+)?.$/,"")},isPureEng:function(e){var t=0,n=e;if(n=="")return!0;for(var r=0;r<n.length;r++)if(!(n.charCodeAt(r)>=48&&n.charCodeAt(r)<=57||n.charCodeAt(r)>=65&&n.charCodeAt(r)<=90||n.charCodeAt(r)>=97&&n.charCodeAt(r)<=122))return!1;return!0},isEng:function(e){var t=0,n=e;if(n=="")return!0;for(var r=0;r<n.length;r++)if(!(n.charCodeAt(r)==32||n.charCodeAt(r)>=48&&n.charCodeAt(r)<=57||n.charCodeAt(r)>=65&&n.charCodeAt(r)<=90||n.charCodeAt(r)>=97&&n.charCodeAt(r)<=122))return!1;return!0},isPureChi:function(e){var t=0,n=e;if(n=="")return!0;for(var r=0;r<n.length;r++)if(!(n.charCodeAt(r)>=19968&&n.charCodeAt(r)<=64041))return!1;return!0},isChi:function(e){var t=0,n=e;if(n=="")return!0;for(var r=0;r<n.length;r++)if(!(n.charCodeAt(r)==32||n.charCodeAt(r)>=19968&&n.charCodeAt(r)<=64041))return!1;return!0},autoName:function(e,t,n,r){e||(e=""),n||(n=""),r||(r=1);var i=e+r+n;return t.indexOf(i)!=-1?_g.string.autoName(e,t,n,r+1):i}},"boolean":{randomPick:function(){return!!Math.round(Math.random()*1)}},number:{random:function(e,t){return typeof e=="undefined"&&(e=0),typeof t=="undefined"&&(t=100),Math.random()*(t-e)+e},randomInt:function(e,t){return typeof e=="undefined"&&(e=0),typeof t=="undefined"&&(t=100),Math.floor(Math.random()*(t-e+1))+e},round:function(e,t){var n=e;typeof t==undefined&&(t=.5);var r=parseInt(e),i=e-r;i<t?n=r:n=r+1},rgbToHex:function(e,t,n){return"#"+((1<<24)+(e<<16)+(t<<8)+n).toString(16).slice(1)},hexToRgb:function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,n,r){return t+t+n+n+r+r});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null},decimal:function(e,t){return Number(e.toFixed(t))}},hasTouch:function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}}(),inIframe:function(){try{return window.self!==window.top}catch(e){return!0}},supportFlash:function(){return typeof swfobject!="undefined"&&swfobject.getFlashPlayerVersion().major!==0?!0:!1},isMSIE11:function(){return!!navigator.userAgent.match(/Trident\/7\./)},getRGBA:function(e,t){t=t!=undefined?Number(t):1;if(!e)return"transparent";if(e.indexOf("rgb(")!=-1)var n=e.replace(/rgb\((.*)\)/,"$1").split(","),r="rgba("+n[0]+","+n[1]+","+n[2]+","+t+")";else{var n=_g.number.hexToRgb(e);if(n)var r="rgba("+n.r+","+n.g+","+n.b+","+t+")";else r="rgba(255,255,255,1)"}return r},weixinShare:function(){if(typeof wx_permissions!="undefined"&&wx_permissions.onMenuShareTimeline){var e=message_link+(message_link.indexOf("disableHistoryStart=0")>=0?"#page/"+interaction_view.currentPage:""),t=shareTitle==bookTitle?descContent:shareTitle;wx.onMenuShareAppMessage({title:bookTitle,desc:t,link:e,imgUrl:imgUrl,trigger:function(e){_gaq.push(["_trackEvent","weixin","share","appmessage","click"])},success:function(e){_gaq.push(["_trackSocial","Wechat","appmessage",ga_opt_target,ga_opt_pagePath])},cancel:function(e){_gaq.push(["_trackEvent","weixin","share","appmessage","cancel"])},fail:function(e){_gaq.push(["_trackEvent","error","weixinjsapi","appmessage",JSON.stringify(e)])}}),wx.onMenuShareTimeline({title:shareTitle,link:e,imgUrl:imgUrl,trigger:function(e){_gaq.push(["_trackEvent","weixin","share","timeline","click"])},success:function(e){_gaq.push(["_trackSocial","Wechat","timeline",ga_opt_target,ga_opt_pagePath])},cancel:function(e){_gaq.push(["_trackEvent","weixin","share","timeline","cancel"])},fail:function(e){_gaq.push(["_trackEvent","error","weixinjsapi","timeline",JSON.stringify(e)])}}),wx.onMenuShareQQ({title:bookTitle,desc:t,link:e,imgUrl:imgUrl,trigger:function(e){_gaq.push(["_trackEvent","weixin","share","QQ","click"])},complete:function(e){_gaq.push(["_trackEvent","weixin","share","QQ","complete"])},success:function(e){_gaq.push(["_trackSocial","Wechat","QQ",ga_opt_target,ga_opt_pagePath])},cancel:function(e){_gaq.push(["_trackEvent","weixin","share","QQ","cancel"])},fail:function(e){_gaq.push(["_trackEvent","error","weixinjsapi","QQ",JSON.stringify(e)])}}),wx.onMenuShareWeibo({title:shareTitle,desc:descContent,link:message_link,imgUrl:imgUrl,trigger:function(e){_gaq.push(["_trackEvent","weixin","share","Weibo","click"])},complete:function(e){_gaq.push(["_trackEvent","weixin","share","Weibo","complete"])},success:function(e){_gaq.push(["_trackSocial","Wechat","Weibo",ga_opt_target,ga_opt_pagePath])},cancel:function(e){_gaq.push(["_trackEvent","weixin","share","Weibo","cancel"])},fail:function(e){_gaq.push(["_trackEvent","error","weixinjsapi","Weibo",JSON.stringify(e)])}})}}};typeof require=="undefined"?(window._g||(window._g={}),window._g=$.extend(!0,{},window._g,e),e=undefined):define("_g/base",["jquery","backbone"],function(){return window._g||(window._g={}),window._g=$.extend(!0,{},window._g,e),e=undefined,window._g})}(window),function(){var e={log:function(e){console.log(e)},serverError:function(e){$(document).trigger("serverError"),_g.error[e]&&_g.error[e]()}};typeof require=="undefined"?(window._g||(window._g={}),window._g.error=e):define("_g/error",["_g/base"],function(){return window._g.error=e,window._g.error})}(window),function(){var e={buttonGroupT:['<div class="_g_btn_group <%=opts.className||""%>">',"</div>"].join(""),buttonT:'   <button class="btn _g_btn _g_btn_confirm <%=opts.className||""%>" type="button" data-name="<%=opts.name%>"><%=opts.name%></button>',buttonGroupList:[],scale:function(e,t){$(e).css("zoom",t).css("-moz-transform","scale("+t+")").css("-o-transform","scale("+t+")")},center:function(e){var t={containment:null};typeof e=="string"?e={containments:null,Item:e}:e=e?$.extend({},t,e):t;if(!e.Item)return!1;$(e.Item).css({left:"50%",top:"50%","margin-top":function(){return-($(this).height()/2+50)},"margin-left":function(){return-($(this).width()/2)}})},centerImage:function(e){var t={containment:null,parentWidth:null,parentHeight:null,width:null,height:null,setParent:!0};e=e?$.extend({},t,e):t;if(!e.Item||!e.containment)return!1;var n=0,r=0;return e.setParent&&$(e.containment).css({"line-height":e.parentHeight+"px","text-align":"center"}),e.width/e.height>=e.parentWidth/e.parentHeight?($(e.Item).css({width:"100%",height:"auto","verticle-align":"middle"}),r=e.parentWidth,height=e.parentWidth/(e.width/e.height)):($(e.Item).css({width:"auto",height:"100%","verticle-align":"middle"}),height=e.parentHeight,r=e.parentHeight*(e.width/e.height)),{width:r,height:height}},fitImage:function(e){if(!e)return!1;e.fit||(e.fit=0);if(e.containment){$(e.containment).css({"background-repeat":"no-repeat","background-position":"50% 50%"});switch(e.fit){case 0:$(e.containment).css({"background-size":"100%"});break;case 1:$(e.containment).css({"background-size":"contain"});break;case 2:$(e.containment).css({"background-size":"cover"})}return}e.items&&$(e.items).each(function(){var t=$(this);e.width==undefined&&(e.width=$(this).width()),e.height==undefined&&(e.height=$(this).height());var n=e.width,r=e.height,i=$(this).parent();e.parentHeight=e.parentHeight||i.height(),e.parentWidth=e.parentWidth||i.width(),e.fit==0&&(t.css({width:"100%",height:"100%",top:"",left:""}),t.addClass("fullsize bk_full"),t.removeClass("bk_contain bk_cover"),n=e.parentWidth,r=e.parentHeight);if(e.fit==1){i.css({"line-height":e.parentHeight-(e.borderH||0)+"px"}),e.useMargin||(i.css("text-align","center"),i.removeClass("bk_cover bk_full"),i.addClass("aligncenter bk_contain"));if(e.width/e.height>=e.parentWidth/e.parentHeight){n=e.parentWidth,r=e.parentWidth/(e.width/e.height),t.css({width:"100%",height:"auto","vertical-align":"middle",left:"",top:"",display:"inline-block",position:"relative"});if(e.useMargin){var s=e.parentWidth/(e.width/e.height);t.css("margin-top",(e.parentHeight-s)/2+"px"),t.css("margin-bottom",(e.parentHeight-s)/2+"px"),t.css({"margin-left":0,"margin-right":0}),t.css("position","absolute")}}else{r=e.parentHeight,n=e.parentHeight*(e.width/e.height),t.css({width:"auto",height:"100%","vertical-align":"top",left:"",top:"",display:"inline-block",position:"relative"});if(e.useMargin){var o=e.parentHeight*(e.width/e.height);t.css("margin-left",(e.parentWidth-o)/2+"px"),t.css("margin-right",(e.parentWidth-o)/2+"px"),t.css({"margin-top":0,"margin-bottom":0}),t.css("position","absolute")}}}e.fit==2&&(i.css({"line-height":e.parentHeight+"px","text-align":"center",overflow:"hidden"}),i.removeClass("bK_full bk_contain"),i.addClass("aligncenter overflowhidden bk_cover"),e.width/e.height>=e.parentWidth/e.parentHeight?(t.css({width:e.parentHeight*e.width/e.height+"px",height:e.parentHeight+"px","verticle-align":"middle",position:"absolute",left:"-"+(e.parentHeight*e.width/e.height-e.parentWidth)/2+"px",top:0,"max-width":"none"}),e.useMargin&&(t.css("left",""),t.css("margin-left","-"+(e.parentHeight*e.width/e.height-e.parentWidth)/2+"px"))):(t.css({position:"absolute",width:e.parentWidth+"px",height:e.parentWidth/(e.width/e.height)+"px","verticle-align":"middle",top:"-"+(e.parentWidth/(e.width/e.height)-e.parentHeight)/2+"px",left:0,"max-height":"none"}),e.useMargin&&(t.css("top",""),t.css("margin-top","-"+(e.parentWidth/(e.width/e.height)-e.parentHeight)/2+"px")))),e.explicitSize&&t.css({width:n,height:r})})},opacity:function(e,t){},addShade:function(e){var t={name:"_g_shadow",zindex:99999,color:"#000000",opacity:.8,containment:"body"};e=e?$.extend({},t,e):t,$(containment).append('<div id="'+e.name+'" style="z-index:'+e.zindex+";background:"+e.color+";opacity:"+e.opacity+';"></div>')},addButtonGroup:function(e){var t={containment:null,position:0,name:"_g_button"+_g.uuid(),className:null,confirmButton:{name:"ç¡®è®¤",enable:!0,className:"btn-small btn-primary",onClick:null},cancelButton:{name:"åæ¶",enable:!0,className:"btn-small",onClick:null},remove:function(){e.$el&&e.$el.remove()},getButton:function(t){return e.$el.find('[data-name="'+t+'"]')},addButton:function(t){var n={name:null,className:null,onClick:null};t=t?$.extend(!0,{},n,t):n;if(!t.name)return!1;e.$el.append(_.template(_g.ui.buttonT,{opts:t})),t.onClick&&e.getButton(t.name).on("click",function(){t.onClick()})},removeButton:function(t){if(!t)return;e.$el.find('[data-name="'+t+'"]').remove()}};return e=e?$.extend(!0,{},t,e):$.extend(!0,{},t),e.containment?(e.position==0?($(e.containment).append(_.template(_g.ui.buttonGroupT,{opts:e})),e.$el=$(e.containment).children("._g_btn_group")):($(_.template(_g.ui.buttonGroupT,{opts:e})).insertAfter($(e.containment)),e.$el=$(e.containment).next("._g_btn_group")),e.confirmButton.enable&&e.addButton(e.confirmButton),e.cancelButton.enable&&e.addButton(e.cancelButton),e):!1},contenteditable:function(e){var t={eventType:0,mutiple:0,element:null,callback:null,type:0,enableControl:!1};e=e?$.extend(!0,{},t,e):$.extend(!0,{},t),e.onKeyDown=function(t,n){var r=t.keyCode?t.keyCode:t.which;r==13&&e.mutiple==0&&(e.enableClose=!0,e.$this.blur(),$(document).off("keydown",e.onKeyDown),e.result())},e.result=function(){if(e.$this.data("before")!==e.$this.html()){e.$this.data("before",e.$this.html());var t=e.type==0?e.$this.text():e.$this.html();e.callback&&e.callback(t)}},e.enableEdit=!1;if(!e.element)return!1;e.element&&(e.$this=$(e.element),e.$this.addClass("_g_contenteditable"),e.eventType==0&&$(e.element).attr("contenteditable","true"),e.eventType==1&&($(e.element).attr("contenteditable","false"),$(e.element).on("dblclick",function(){$(this).attr("contenteditable","true"),$(this).focus()})),$(e.element).on("focus",function(){return e.focus?!1:(e.focus=!0,e.$this.data("before",e.$this.html()),$(document).on("keydown",e.onKeyDown),e.enableControl&&(e.buttonGroup=_g.ui.addButtonGroup({containment:e.$this,position:1,confirmButton:{onClick:function(){e.enableClose=!0,e.$this.blur()}},cancelButton:{onClick:function(){e.enableClose=!0,e.$this.html(e.$this.data("before")),e.$this.blur()}}})),e.$this)}).on("blur",function(t){if(e.enableControl){if(!e.enableClose)return e.$this.focus(),!1;e.enableClose=!1,e.buttonGroup.remove()}return e.focus=!1,$(document).off("keydown",e.onKeyDown),e.eventType==1&&$(e.element).attr("contenteditable","false"),e.result(),!1}))},sortByIds:function(e){var t={containment:null,items:"li",ids:null};e=e?$.extend({},t,e):t;if(!e.containment||!e.ids)return;_.each(e.ids,function(t){if($(e.containment).children(e.items+'[id="'+t+'"]').length>0){var n=$(e.containment).children(e.items+'[id="'+t+'"]').detach();$(e.containment).append(n)}})},sortTreeByIds:function(e,t){var n={containment:null,items:"li",ids:null,childrenKey:"children",wrap:"ul",wrapClass:null};e=e?$.extend({},n,e):n;if(!e.containment||!e.ids)return;e.root=t||e.containment,_.each(e.ids,function(n){if($(e.root).find(e.items+'[id="'+n.id+'"]').length>0){var r=$(e.root).find(e.items+'[id="'+n.id+'"]').detach();!$(e.containment).is(e.wrap)&&!$(e.containment).children(e.wrap).length&&($(e.containment).append(document.createElement(e.wrap)),e.containment=$(e.containment).children(e.wrap)),e.wrapClass&&$(e.containment).addClass(e.wrapClass),$(e.containment).append(r)}n[e.childrenKey]&&_g.ui.sortTreeByIds({containment:$(e.containment).find(e.items+'[id="'+n.id+'"]'),items:e.items,ids:n[e.childrenKey],childrenKey:e.childrenKey,wrapClass:e.wrapClass},t?t:e.containment)})},findById:function(e){var t={containment:null,id:null};return e=e?$.extend({},t,e):t,!e.containment||!e.id?[]:$(e.containment).find('[id="'+e.id+'"],[data-id="'+e.id+'"]').first()},moveTo:function(e){var t={containment:null,sourceId:null,targetId:null,wrap:null,wrapClass:null,position:0};e=e?$.extend({},t,e):t;if(!e.containment)return!1;var n=_g.ui.findById({containment:e.containment,id:e.sourceId}),r=_g.ui.findById({containment:e.containment,id:e.targetId});e.wrap&&(r.has(e.wrap).length==0?(r.append(document.createElement(e.wrap)),r=r.children(e.wrap),e.wrapClass&&r.addClass(e.wrapClass)):r=r.children(e.wrap));var i=n.detach();e.position==0?r.prepend(i):r.append(i)},getTreeIds:function(e){var t={containment:null,items:null,idAttribute:"id",wrap:"ul"};e=e?$.extend({},t,e):t;var n=[];if(!e.containment||!e.items)return!1;if(e.wrap&&!$(e.containment).is(e.wrap)){if(!($(e.containment).children("ul").length>0))return[];e.containment=$(e.containment).children("ul")}return $(e.containment).children(e.items).each(function(){var t={};t.id=$(this).attr(e.idAttribute),t.children=_g.ui.getTreeIds({containment:$(this),items:e.items,idAttribute:e.idAttribute,wrap:e.wrap}),n.push(t)}),n},dialog:function(e){var t={className:null}},createDomMask:function(e){var t={containment:null,item:null,x:null,y:null,height:null,width:null,moveTo:function(t){e.offsetX=0-t.x,e.offsetY=0-t.y,$(e.item).css("left",e.offsetX),$(e.item).css("top",e.offsetY)},resize:function(t){$(e.containment).width(t.w),$(e.containment).height(t.h)}};return e=e?$.extend({},t,e):t,!e.containment||!e.item?!1:($(e.containment).css("overflow","hidden"),e.moveTo({x:e.x,y:e.y}),e.resize({w:e.width,h:e.height}),e)},clearSelection:function(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var e=window.getSelection();e.removeAllRanges()}},isOverflowed:function(e){var t={x:!1,y:!1},n=0;return $.zoom&&$.zoom!=1&&(n=2),$(e)[0].offsetHeight+n<$(e)[0].scrollHeight&&(t.y=$(e)[0].scrollHeight||1),$(e)[0].offsetWidth+n<$(e)[0].scrollWidth&&(t.x=$(e)[0].scrollWidth||1),t}};typeof require=="undefined"?(window._g||(window._g={}),window._g.ui=e):define("_g/ui",["jquery","_g/base","_g/error"],function(){return window._g.ui=e,window._g.ui})}(window),function(){var e={getValueByType:function(e,t){t=t?t.toLowerCase():t;switch(t){case"number":return Number(e);case"boolean":if(e=="false")return!1;if(e=="true")return!0;return Boolean(e);case"numberboolean":if(e=="false")return 0;if(e=="true")return 1;return Boolean(e)?1:0;case"string":return String(e);case"object":return _g.object.jsonparse(e);default:return e}},bindPopOver:function(e){var t={containment:null,trigger:"click",getData:null,callback:null,onChange:null};e=e?$.extend(!0,{},t,e):t;if(!e.containment)return!1;$(e.containment).find(".c-popover-btn").on(e.trigger,function(){var t=$(this).data();if(e.getData){var n=require("text!"+t.template),r=e.getData(this);t.content=_g.renderT(n,r,"data","text!"+t.template)}t.container=t.container?$(t.container):$(this).closest(".c-popover-containment")[0],t.container||(t.container="body"),t.viewport={selector:$(this).closest(".c-popover-viewport")[0],padding:t.padding||0},t.viewport.selector||(t.viewport.selector="body"),t.elm=$(this),t.callback=e.callback,t.beforeClose=e.beforeClose,t.onChange=e.onChange,t.onShow=e.onShow,t.onClose=e.onClose,t.getContent=function(){var t=e.getData(this);return _g.renderT(n,t,"data")};var i=_g.form.popover(t);return!1})},bindListAction:function(e){var t={containment:null,listClass:".c-list",callback:null};e=e?$.extend(!0,{},t,e):t;if(!e.containment)return!1;if(!e.containment.hasClass(e.listClass)&&!e.containment.find(e.listClass).length)return!1;var n=e.containment.hasClass(e.listClass)?e.containment.data():e.containment.find(e.listClass).first().data();e.containment.find(".c-list-add").on("click",function(t){if(e.callback){var r=_g.util.serializeValue({containment:e.containment});e.callback("add",n.target,r,t.currentTarget)}return!1}),e.containment.find(".c-list-remove").on("click",function(t){return e.callback&&callback("remove",n.target,t.currentTarget),!1})},bindFormChange:function(e){var t={containment:null,$item:null,callback:null,silentDisplay:!1};e=e?$.extend(!0,{},t,e):t;if(!e.containment)return!1;$(e.containment).find(".slider").each(function(){var t=$(this).find("input"),n=t.data();if(n.target){var r=$(e.containment).find('[name="'+n.target+'"]');r.on("change",function(){var e=t.slider("getValue");e!=Number($(this).val())&&t.slider("setValue",Number($(this).val()))}),t.on("slide",function(e){var t=Number(r.val());t!=e.value&&(r.closest(".spinner").spinner("value",e.value),r.trigger("change"))})}}),$(e.containment).find("[rel=form]").each(function(){var t=$(this).data();if(t.value!=undefined){$(this).find("[data-value]").removeClass("active");if(t.mutiple||t.multiple){var n=t.value.split(",");for(i=0;i<n.length;i++)$(this).find('[data-value="'+n[i]+'"]').addClass("active")}else $(this).find('[data-value="'+t.value+'"]').addClass("active")}var r=$(this);$(this).find("[data-value]").on("click",function(){var n=!1,i=$(this).data("value");t.silentdisplay||r.find("[data-show]").text($(this).text()||i);if(!t.multiple&&!t.mutiple)$(this).hasClass("active")||(i=_g.util.getValueByType(i,t.type),r.data("value",i),$(this).addClass("active"),$(this).siblings().length?$(this).siblings().removeClass("active"):$(this).parent().siblings().children().removeClass("active"),t.value=i,n=!0);else{$(this).hasClass("active")?$(this).removeClass("active"):t.silentdisplay||$(this).addClass("active");var s=[];r.find("[data-value]").each(function(){var e=$(this).data("value");$(this).hasClass("active")&&s.push(_g.util.getValueByType(e,t.type))}),s=s.join(","),console.log(s),r.data("value",s),t.value=s,n=!0}e.callback&&n&&e.callback(r,e,t)})});var n=e.$item?e.$item:"input,textarea,select";$(e.containment).find(n).on("change",function(){var t=$(this).data();t.name=$(this).attr("name")||$(this).attr("id"),e.callback&&e.callback($(this),e,t)}),e.createIndex&&_g.util.createFormIndex({containment:e.containment})},serializeValue:function(e){var t={containment:null,typeAttr:"data-type",attrAttr:"data-attr",allowEmpty:!0};e=e?$.extend({},t,e):t;if(!e.containment)return!1;var n=e.containment,r={},i=function(t,n){if(t.attr("disabled")=="disabled")return;var i=t.attr("name")||t.attr("id"),s=t.attr(e.typeAttr),o=t.attr(e.attrAttr);if(!i)return;o?(typeof r[o]!="object"&&(r[o]={}),r[o][i]=n):r[i]=n},s=function(e,t){if(e.attr("disabled")=="disabled")return;var n=e.data(),i=n.name,s=n.type,o=n.attr;if(!i)return;o?(typeof r[o]!="object"&&(r[o]={}),r[o][i]=t):r[i]=t};return $(n).find('input[type="text"],input[type="email"],input[type="tel"],input[type="hidden"],textarea').each(function(){var t=$(this).attr("name")||$(this).attr("id"),n=$(this).attr(e.typeAttr),r=$(this).attr(e.attrAttr),s=_g.util.getValueByType($(this).val(),n);i($(this),s)}),$(n).find('input[type="checkbox"]').each(function(){var t=$(this).attr("name")||$(this).attr("id"),n=$(this).attr(e.typeAttr),s=$(this).attr(e.attrAttr);s&&typeof r[s]!="object"&&(r[s]={});var o=s?r[s][t]?r[s][t]:[]:r[t]?r[t]:[];if($(this).attr("checked")=="checked")n=="boolean"||n=="numberboolean"?o=_g.util.getValueByType($(this).attr("data-reverse")?!1:!0,n):o.push(_g.util.getValueByType($(this).val(),n));else if(n=="boolean"||n=="numberboolean")o=_g.util.getValueByType($(this).attr("data-reverse")?!0:!1,n);i($(this),o)}),$(n).find('input[type="radio"]:checked').each(function(){var t=$(this).attr("name")||$(this).attr("id"),n=$(this).attr(e.typeAttr),r=$(this).attr(e.attrAttr),s=_g.util.getValueByType($(this).val(),n);i($(this),s)}),$(n).find("select").each(function(){var t=$(this).attr("name")||$(this).attr("id"),n=$(this).attr(e.typeAttr),s=$(this).attr(e.attrAttr),o=Boolean($(this).attr("data-mutiple")),u;o?(s&&typeof r[s]!="object"&&(r[s]={}),u=s?r[s][t]?r[s][t]:[]:r[t]?r[t]:[],u.push($(this).val())):u=_g.util.getValueByType($(this).val(),n),i($(this),u)}),$(n).find("[rel=form]").each(function(){var e=$(this).data();if(e.mutiple||e.multiple)if(e.value!=undefined)var t=e.value;else var t="";else var t=_g.util.getValueByType(e.value,e.type);s($(this),t)}),r},createFormIndex:function(e){var t={containment:null,typeAttr:"data-type",attrAttr:"data-attr"};e=e?$.extend({},t,e):t;if(!e.containment)return!1;var n=e.containment;if(!$(n).data().formindex&&!e.force){var r={},i=function(e,t,n,i,s){if(!t)return;e?(r[e]||(r[e]={}),r[e][t]?s=="radio"||s=="checkbox"&&i!="boolean"?r[e][t].els.push(n):r[e][t].el=n:r[e][t]={el:n,els:[n],type:i,tag:n[0].tagName,_type:n[0].type}):r[t]?s=="radio"||s=="checkbox"&&i!="boolean"?r[t].els.push(n):r[t].el=n:r[t]={el:n,els:[n],type:i,tag:n[0].tagName,_type:n[0].type}},s=function(e,t,n,i,s){if(!t)return;e?(r[e]||(r[e]={}),r[e][t]?r[e][t].el=n:r[e][t]={el:n,els:[n],type:i,tag:n[0].tagName,_type:n[0].type,rel:!0,multiple:s}):r[t]?r[t].el=n:r[t]={el:n,els:[n],type:i,tag:n[0].tagName,_type:n[0].type,rel:!0,multiple:s}},o=function(e,t,n){if(!t)return;e?(r[e]||(r[e]={}),r[e][t]?r[e][t].slider=n:r[e][t]={slider:n}):r[t]?r[t].slider=n:r[t]={slider:n}},u=function(e,t,n){if(!t)return;e?(r[e]||(r[e]={}),r[e][t]?r[e][t].colorpicker=n:r[e][t]={colorpicker:n}):r[t]?r[t].colorpicker=n:r[t]={colorpicker:n}},a=function(e,t,n){if(!t)return;e?(r[e]||(r[e]={}),r[e][t]?r[e][t].spinner=n:r[e][t]={spinner:n}):r[t]?r[t].spinner=n:r[t]={spinner:n}};$(n).find("input,textarea,select").each(function(){var t=$(this).attr("name")||$(this).attr("id"),n=$(this).attr(e.typeAttr),r=$(this).attr(e.attrAttr);i(r,t,$(this),n,this.type)}),$(n).find("[rel=form]").each(function(){var e=$(this).data();s(e.attr,e.name,$(this),e.type,e.multiple||e.mutiple)}),$(n).find(".slider").each(function(){var t=$(this).find("input"),n=t.data();if(n.target){var r=n.target,i=$(e.containment).find('[name="'+n.target+'"]');o(i.attr("data-attr"),r,$(this).find("input"))}}),$(n).find(".c_color_el").each(function(){var e=$(this).data();if(e.colorpicker){var t=$(this).find("input");u(t.attr("data-attr"),t.attr("name"),e.colorpicker)}}),$(n).find(".spinner").each(function(){var e=$(this).data();if(e.spinner){var t=$(this).find("input");a(t.attr("data-attr"),t.attr("name"),e.spinner)}}),$(n).data("formindex",r)}return r},renderFormInfo:function(e){if(!e.containment)return!1;var t=$(e.containment).data().formindex;if(!t)return;e.keys||(e.keys=["value"]);for(var n=0;n<e.keys.length;n++)_.each(e[e.keys[n]],function(r,s){e.keys[n]=="value"?_.isObject(r)?t[s]&&_.each(r,function(e,n){t[s][n]&&(_g.util.setFormItemValue(t[s][n],e),t[s][n].slider&&t[s][n].slider.slider("setValue",e))}):t[s]&&(_g.util.setFormItemValue(t[s],r),t[s].slider&&t[s].slider.slider("setValue",r)):e.keys[n]=="name"&&(_.isObject(r)?t[s]&&_.each(r,function(e,n){t[s][n]&&_g.util.setFormItemName(t[s][n],e)}):t[s]&&_g.util.setFormItemName(t[s],r))})},setFormItemValue:function(e,t){e||(e={});if(e.colorpicker){e.colorpicker.setValue(t,{silent:!0});return}if(e.spinner){e.spinner.value(t);return}if(e.rel){if(e.multiple){e.el.find("[data-value]").removeClass("active");for(var n=0;n<t.length;n++)e.el.find('[data-value="'+t[n]+'"]').addClass("active")}else e.el.find('[data-value="'+t+'"]').addClass("active").siblings().removeClass("active"),e.el.find("[data-show]").html(e.el.find('[data-value="'+t+'"]').html());e.el.data("value",t);return}e.type=="number"&&(t=Number(t));if(e.tag=="INPUT")if(e._type=="checkbox")if(e.type=="boolean")t?e.el.attr("checked","checked"):e.el.removeAttr("checked");else for(var n=0;n<e.els.length;n++)_.include(t,e.type=="number"?Number(e.els[n].val()):e.els[n].val())?e.els[n].attr("checked","checked"):e.els[n].removeAttr("checked");else if(e._type=="radio")if(e.type=="boolean")t?e.el.attr("checked","checked"):e.el.removeAttr("checked");else for(var n=0;n<e.els.length;n++)t==(e.type=="number"?Number(e.els[n].val()):e.els[n].val())?e.els[n].attr("checked","checked"):e.els[n].removeAttr("checked");else e.el.val(t);else e.tagName=="TEXTAREA"?e.el.html(t):e.el.val(t)},setFormItemName:function(e,t){e||(e={});if(e.els.length>1)for(var n=0;n<e.els.length;n++)e.els[n].attr("name",t);else{if(e.rel){e.el.attr("data-name",t),e.el.data("name",t);return}e.el.attr("name",t)}},disableLink:function(e){var t={containment:null,linkitem:"a",enabled:!0},n=e.linkitem||t.linkitem;return e=e?$.extend(!0,{},t,e):t,e.linkitem=n,e.containment?(e.func=function(){return!1},e.enable=function(){$(e.containment).find(e.linkitem).each(function(){$(this).on("click",e.func),e.enabled=!0})},e.disable=function(){$(e.containment).find(e.linkitem).each(function(){$(this).off("click",e.func),e.enabled=!1})},e.enable(),e):!1},domExist:function(e,t){return t||(t=document),typeof e=="string"&&(e=$(e)),$.contains(t.documentElement,e[0])},getImageSizeBySrc:function(e,t,n){var r=new Image;r.onload=function(){if(n&&(this.width>n||this.height>n)){var e=this.width/this.height;e>1?(this.width=n,this.height=this.width/e):(this.height=n,this.width=this.height*e)}t&&t(this.width,this.height)},r.src=e},htmlspecialchars:function(e){function t(e,t,n){var r=e.length;for(var i=0;i<r;i++)re=new RegExp(e[i],"ig"),n=n.replace(re,typeof t=="string"?t:t[i]?t[i]:t[0]);return n}return typeof e!="string"?e:t(["&","<",">",'"',"&lt;br&gt;"],["&amp;","&lt;","&gt;","&quot;","<br>"],e)},toggleActive:function(e){$(e).css("-moz-transition","all 0.5s").css("-webkit-transition","all 0.5s").css("-ms-transition","all 0.5s").css("-o-transition","all 0.5s").css("transition","all 0.5s"),$(e).css("opacity","0.5").css("background-color","#f80"),setTimeout(function(){$(e).css("opacity","1").css("background-color","#fff")},500);return}};typeof require=="undefined"?(window._g||(window._g={}),window._g.util=e,e=undefined):define("_g/util",["jquery","_g/base"],function(){return window._g.util=e,e=undefined,window._g.util})}(window),function(){var _g_mvc={saveHandle:function(e,t){e.code==200?t("success","æå"):t("error",e.msg)},_loadTemplate:function(e,t){},_CollectionforSaveAll:function(){var e=Backbone.Model.extend({initialize:function(){this.set("id","GlobalSave")},sync:function(e,t,n){var r=this.data;this.attributes=r;if(e=="create")return;e=="update"&&(n.url=this.url);if(e=="delete")return;if(e=="read")return;Backbone.emulateHTTP=!0,Backbone.emulateJSON=!0,Backbone.sync(e,t,n)}});return new e},createModel:function(opts){var defaults={defaults:{},autoIndex:!0,autoUpdate:!0,autoRemove:!0,enableSync:!0,createUrl:null,updateUrl:null,removeUrl:null,fetchUrl:null,staticFetchUrl:null,staticRemoveUrl:null,staticCreateUrl:null,staticUpdateUrl:null,fetchUrlName:null,removeUrlName:null,createUrlName:null,updateUrlName:null,restful:!1,debug:!1,bindChange:null,bindRemove:null,callback:null,initView:null,patchKeys:null,initialize:function(){this.iViewlist=[],this.iCollectionlist=[];if(!this.get("id")){this.set("isNew",!0);if(this.autoIndex){var prefix=this.get("type")||this.get("iType")||"M";this.set("id",prefix+"_"+_g.uuid(4)),this.preset()}else this.save({},{wait:!0,success:function(model,response){var returned=eval(response);(returned.Status=="Success"||returned.code==200)&&model.set("id",returned.ID.toString()),model.preset()}})}else this.preset()},patchSave:function(callback,opts){opts||(opts={});if(this.patchKeys&&this.patchKeys.length){var values=_.pick(this.toJSON(),this.patchKeys);this.save(values,{wait:!0,silent:opts.silent,patch:!0,success:function(model,response){if(callback){var returned=eval(response);callback(returned)}},error:function(e,t){_g.error.serverError("save_"+e.name),opts.onError&&opts.onError()}})}else this.save()},sync:function(e,t,n){var r,i=typeof _gDebug!="undefined"&&_gDebug||this.debug;if(!this.enableSync)return!1;if(e=="create"){var s=this.createUrlName||this.createUrl;_g.debug&&_g.debug.enabled&&(_g.debug.data[s]={}),r=i?_g.debug&&_g.debug.query_user_data(s)?_g.debug.query_user_data(s):this.staticCreateUrl||this.createUrl:this.createUrl;if(!r)return;n.url=r}if(e=="update"||e=="patch"){var s=this.updateUrlName||this.updateUrl;_g.debug&&_g.debug.enabled&&(_g.debug.data[s]={}),r=i?_g.debug&&_g.debug.query_user_data(s)?_g.debug.query_user_data(s):this.staticUpdateUrl||this.updateUrl:this.updateUrl;if(!r)return;n.url=r}if(e=="delete"){var s=this.removeUrlName||this.removeUrl;_g.debug&&_g.debug.enabled&&(_g.debug.data[s]={}),r=i?_g.debug&&_g.debug.query_user_data(s)?_g.debug.query_user_data(s):this.staticRemoveUrl||this.removeUrl:this.removeUrl;if(!r)return;n.url=r}if(e=="read"){var s=this.fetchUrlName||this.fetchUrl;r=i?this.staticFetchUrl:this.fetchUrl,_g.debug&&_g.debug.enabled&&(_g.debug.data[s]={}),r=i?_g.debug&&_g.debug.query_user_data(s)?_g.debug.query_user_data(s):this.staticFetchUrl||this.fetchUrl:this.fetchUrl;if(!r)return;n.url=r}n.url=typeof n.url=="string"?n.url:n.url(t.attributes),this.restful||(Backbone.emulateHTTP=!0,Backbone.emulateJSON=!0),Backbone.sync(e,t,n)},addView:function(e,t){typeof t=="function"&&(this[e]=new t({model:this}));if(typeof t=="object"){var n=_g.mvc.createView(t);this[e]=new n({model:this})}this[e]&&this.iViewlist.push(this[e])},addCollection:function(e,t){typeof t=="function"&&(this[e]=new t);if(typeof view=="object"){var n=_g.mvc.createCollection(t);this[e]=new n}this[e]&&this.iCollectionlist.push(this[e])},preset:function(){this.callback&&this.callback(this);var e=this;this.autoUpdate&&this.on("change",function(){e.updateAllViews()}),this.autoRemove&&this.on("destroy",function(e,t,n){e.removeAllViews(),e.bindRemove&&e.bindRemove(e,n)}),this.bindChange&&this.bindChange(),this.initView&&this.addView("iview",this.initView)},updateAllViews:function(){_.each(this.iViewlist,function(e){e.$el&&e.update()})},removeView:function(e){this[e]&&(this[e].remove(),this.iViewlist=_.reject(this.iViewlist,function(t){return t==this[e]}),this[e]=null)},removeAllViews:function(e){_.each(this.iViewlist,function(t){t.$el&&(e?t.undelegateEvents():t.remove())})}};opts=opts?$.extend(!0,{},defaults,opts):defaults;var Model=Backbone.Model.extend(opts);return Model},createView:function(e){var t={template:null,className:null,containment:null,wrap:null,wrapClassName:null,autoRender:!0,position:1,parseData:null,callback:null,bindChange:null,parseTemplate:null,templateKey:null,templateName:null,afterRender:null,afterUpdate:null,initialize:function(){_.bindAll(this),this.autoRender&&this.render(),this.callback&&this.callback(this)},createEl:function(){var e=this.model.toJSON(),t;return this.parseData&&(e=this.parseData()),this.parseTemplate?t=this.parseTemplate(this.template):t=this.template,_g.renderT(t,e,this.templateKey,this.templateName)},render:function(e,t){var n=this;if(!this.model||!this.template)return!1;if(!_g.util.domExist(this.$el)){if(!e&&!this.containment)return!1;e||(e=$(this.containment)),t||(t=this.position),this.wrap&&!$(this.containment).is(this.wrap)&&($(this.containment).children(this.wrap).length==0&&$(this.containment).append(document.createElement(this.wrap)),e=$(this.containment).children(this.wrap),this.containment&&this.wrapClassName&&e.addClass(this.wrapClassName));var r=this.createEl(),i=r;return this.setElement(i),t==1?e.append(i):e.prepend(i),this.className&&this.$el.addClass(this.className),this.afterRender&&this.afterRender(this),this}var r=this.createEl(),i=r;this.undelegateEvents(),this.$el.replaceWith(i),this.setElement(i),this.afterUpdate&&this.afterUpdate(this)},update:function(){this.render()},afterUpdate:function(){this.afterRender&&this.afterRender(this)},events:{}};e=e?$.extend(!0,{},t,e):t;var n=Backbone.View.extend(e);return n},createCollection:function(e){var t={enableSync:!1,fetchUrl:null,staticFetchUrl:null,saveUrl:null,staticSaveUrl:null,debug:!1,bindRemove:!1,bindReset:!0,bindAdd:null,callback:null,patchKeys:null,name:null,initialize:function(){var e=this;this.bindRemove&&this.on("remove",function(t){typeof e.bindRemove=="function"?e.bindRemove(t):t.removeAllViews()}),this.bindReset&&this.on("reset",function(t,n){typeof e.bindReset=="function"?e.bindReset(t,n):_.each(n.previousModels,function(e){e.removeAllViews()}),e.afterReset&&e.afterReset(t,n)}),this.bindAdd&&this.on("add",function(t){e.bindAdd()}),this.callback&&this.callback(this)},sortByIds:function(e){var t=this;this.reset(_.map(e,function(e){return t.get(e)}),{silent:!0})},sync:function(e,t,n){var r=typeof _gDebug!="undefined"&&_gDebug||this.debug;if(!this.enableSync)return!1;if(e=="read"){var i=r?this.staticFetchUrl?this.staticFetchUrl:this.fetchUrl:this.fetchUrl?this.fetchUrl:this.staticFetchUrl;if(!i)return;n.url=i}if(!n.url)return!1;n.url=typeof n.url=="string"?n.url:n.url(t.toJSON()),this.resetful||(Backbone.emulateHTTP=!0,Backbone.emulateJSON=!0),Backbone.sync(e,t,n)},getAll:function(e){var t=this;this.fetch({success:function(t,n){e&&e(n)},error:function(){_g.error.serverError("get_"+t.name)}})},saveAll:function(e){var t=this,n=typeof _gDebug!="undefined"&&_gDebug||this.debug,r=n?this.staticSaveUrl?this.staticSaveUrl:this.saveUrl:this.saveUrl?this.saveUrl:this.staticSaveUrl;if(!r)return!1;var i=_g.mvc._CollectionforSaveAll();this.patchKeys&&this.patchKeys.length?i.data=_.map(this.toJSON(),function(e){var n=$.extend(!0,{},e);return n=_.pick(n,t.patchKeys),n}):i.data=this.toJSON(),i.url=r,i.save({},{wait:!0,success:function(t,n){e&&e(n)},error:function(){_g.error.serverError("save_"+t.name)}})},refreshView:function(e){var t={containment:null,viewname:null};e=e?$.extend({},t,e):t,this.length>0&&(_.each(this.at(0).iViewlist,function(t){containment=e.containment||t.containment,containment&&(t.wrap&&!$(containment).is(t.wrap)?$(containment).children(t.wrap).empty():$(containment).empty())}),this.each(function(t){e.containment&&(t.iview.containment=e.containment),e.viewname?t[viewname].update():t.iview.update()}))},removeAllViews:function(e){this.each(function(t){t.removeAllViews(e)})}};e=e?$.extend(!0,{},t,e):t;var n=Backbone.Collection.extend(e);return n},createTreeByData:function(e){var t={collection:null,data:null,treeLevel:0,parent:null},n=e.parent,r;e=e?$.extend(!0,{},t,e):t,e.parent=n;if(!e.collection||!e.data)return null;var i=$.extend(!0,[],e.data);if(typeof e.collection=="function")r=new e.collection;else{var s=_g.mvc.createCollection(e.collection);r=new s}return r.parent=n,r.refreshTreeView=function(e){this.refreshView(e),this.each(function(t){t.icollection.refreshTreeView({containment:t.iview.$el,viewname:e?e.viewname:null})})},r.getModels=function(){var e=_g.mvc.getTreeModels(r);return e},r.getModelsJSON=function(){var e=r.getModels();return e=_.map(e,function(e){return e.toJSON()}),e},r.getModel=function(e){return _g.mvc.getTreeModel(r,e)},r.on("add",function(t){t.treeLevel=e.treeLevel,t.icollection=_g.mvc.createTreeByData({collection:e.collection,data:[],treeLevel:e.treeLevel+1}),r.parent&&(r.View=typeof r.View=="object"?$.extend(!0,{},r.View,{containment:r.parent.iview.$el}):r.View.extend({containment:r.parent.iview.$el})),t.addView("iview",r.View),_g.ui.sortByIds({containment:t.iview.wrap?t.iview.$el.parent(t.iview.wrap):t.iview.$el.parent(),ids:r.pluck("id")}),t.icollection.parent=t,t.icollection.View=r.View}),r.saveAll=function(e){var t=typeof _gDebug!="undefined"&&_gDebug||this.debug,n=t?this.staticSaveUrl?this.staticSaveUrl:this.saveUrl:this.saveUrl;if(!n)return!1;var r=_g.mvc._CollectionforSaveAll();r.data=_g.mvc.getTreeData(this),r.url=n,r.save({},{wait:!0,success:function(t,n){e&&e(n)},error:function(){}})},_.each(i,function(t){var n;t.children?n=$.extend(!0,[],t.children):n=[],delete t.children,r.add(t,{silent:!0});var i=r.at(r.length-1);i.treeLevel=e.treeLevel,console.log(n),i.icollection=_g.mvc.createTreeByData({collection:e.collection,data:n,treeLevel:e.treeLevel+1,parent:i})}),r},createTreeView:function(e){var t={collection:null,view:null,containment:null,wrap:null,wrapClassName:null,template:null,className:null,parseTemplate:null,templateKey:null,templateName:null,update:function(e){if(!this.model||!this.template||!this.containment)return!1;if(!_g.util.domExist(this.$el))this.render();else{var t=this.createEl(),n=null;this.wrap&&(n=this.$el.children(this.wrap).detach()),this.undelegateEvents(),this.$el.replaceWith(t),this.setElement(t)}this.afterUpdate&&this.afterUpdate(this)}},n=e.collection;e=e?$.extend(!0,{},t,e):t;var r={};e.collection=n;if(!e.collection||!e.view)return!1;e.containment&&(r.containment=e.containment),e.wrap&&(r.wrap=e.wrap),e.template&&(r.template=e.template),e.templateKey&&(r.templateKey=e.templateKey),e.templateName&&(r.templateName=e.templateName),e.parseTemplate&&(r.parseTemplate=e.parseTemplate),e.parseData&&(r.parseData=e.parseData),e.callback&&(r.callback=e.callback),e.wrapClassName&&(r.wrapClassName=e.wrapClassName),e.className&&(r.className=e.className),r.update=e.update;var i=typeof e.view=="function"?e.view.extend(r):$.extend(!0,e.view,r);e.collection.View=i,e.collection.each(function(t){t.addView("iview",i);if(t.icollection){if(!e.useJquerySel){typeof e.containment!="string"&&(e.containment=e.containment.selector);var n=e.containment+(e.wrap?" >"+e.wrap:"")+' >[id="'+t.id+'"]'}else{var n=e.containment.children('[id="'+t.id+'"]');if(e.wrap)if(!n.children(e.wrap+e.wrapClassName?"."+e.wrapClassName:"").length){var r=$(document.createElement(e.wrap));n.append(r),e.wrapClassName&&r.addClass(e.wrapClassName),n=r}else n=n.children(e.wrap+e.wrapClassName?"."+e.wrapClassName:"")}_g.mvc.createTreeView({collection:t.icollection,view:e.view,wrapClassName:e.wrapClassName,containment:n,wrap:e.wrap||null,template:e.template||null,useJquerySel:e.useJquerySel})}})},sortTreeByIds:function(e){var t=function(n,r,s){return n?(n.reset([],{silent:e.silent}),_.each(r,function(r){r.children=r.children||[];var o=i.get(r.id);o.treeLevel=s,o.icollection=t(o.icollection,r.children,s+1),n.add(o,{silent:e.silent}),o.collection=n}),n):null},n={collection:null,ids:null,treeLevel:0,silent:!0},r=e.collection;e=e?$.extend(!0,{},n,e):n,e.collection=r;if(!e.collection||!e.ids)return!1;var i=new Backbone.Collection;i.add(_g.mvc.getTreeModels(e.collection));var s=t(e.collection,e.ids,e.treeLevel);return s},getTreeModels:function(e){var t=[];return e.each(function(e){t.push(e);if(e.icollection){var n=_g.mvc.getTreeModels(e.icollection);for(var r=0;r<n.length;r++)t.push(n[r])}}),t},getTreeModel:function(e,t){if(!e||!t)return!1;var n=_g.mvc.getTreeModels(e);return _.find(n,function(e){return e.id==t})},getTreeData:function(e,t){var n=[];return e.each(function(e){var r=$.extend(!0,{},e.toJSON());t&&t.filter&&(r=_.pick(r,t.filter)),e.icollection&&(r.children=_g.mvc.getTreeData(e.icollection,t)),n.push(r)}),n},moveTo:function(e){e.silent==undefined&&(e.silent=!0);var t=null;if(e.fromIndex!=undefined&&e.toIndex!=undefined)t=e.collection.at(e.fromIndex),e.collection.remove(t,{silent:e.silent}),e.collection.add(t,{at:e.toIndex,silent:e.silent});else if(e.sourceId!=undefined&&e.targetId!=undefined&&e.position!=undefined){t=e.collection.get(e.sourceId),e.collection.remove(t,{silent:e.silent});var n=e.collection.get(e.targetId),r=e.collection.indexOf(n);if(e.position==-1)var i=r;else var i=r+1;e.collection.add(t,{at:i,silent:e.silent})}}};typeof require=="undefined"?(window._g||(window._g={}),window._g.mvc=_g_mvc,_g_mvc=undefined):define("_g/mvc",["jquery","backbone","_g/base","_g/ui","_g/util"],function(){return window._g.mvc=_g_mvc,_g_mvc=undefined,window._g.mvc})}(window),define("text!interaction_view/template/page.js",[],function(){return'<section class="Presentation" id="<%=id%>">\n    <div class="interaction-area typo">\n      <div class="interaction-view"></div>\n   </div>\n</section>'}),define("text!interaction_view/template/pagegroup.js",[],function(){return'<section class="group" id="<%=id%>"></section>'}),define("interaction_view/view/page",["_g/mvc","text!interaction_view/template/page.js","text!interaction_view/template/pagegroup.js"],function(){var e={template:require("text!interaction_view/template/page.js"),className:null,containment:"div.slides",wrap:null,wrapClassName:null,autoRender:!0,position:1,parseData:null,callback:function(){this.model.get("type")!="page_group"&&(this.overlays=this.model.get("overlays"),this.animations=this.model.get("animations"),this.actions=this.model.get("actions")),this.model.get("type")=="page"&&this.renderbg()},bindChange:null,parseTemplate:function(){var e=this.model.get("type");return e=="page_group"?_g.parseTemplate(require("text!interaction_view/template/pagegroup.js")):_g.parseTemplate(require("text!interaction_view/template/page.js"))},render:function(e,t){var n=this;if(!this.model||!this.template)return!1;if(!$.contains(document.documentElement,this.$el[0])){if(interaction_view.foredit){if(!e&&!this.containment)return!1;e||(e=$(this.containment)),t||(t=this.position),this.wrap&&!$(this.containment).is(this.wrap)&&($(this.containment).children(this.wrap).length==0&&$(this.containment).append(document.createElement(this.wrap)),e=$(this.containment).children(this.wrap),this.containment&&this.wrapClassName&&e.addClass(this.wrapClassName))}var r,i;return $("section#"+this.model.id).length>0?(r=$("section#"+this.model.id)[0],i=r,this.setElement(i)):interaction_view.foredit&&(r=this.createEl(),i=r,this.setElement(i),t==1?e.append(i):e.prepend(i)),this.afterRender&&this.afterRender(this),this}var r=this.createEl(),i=r;this.$el.replaceWith(i),this.setElement(i),this.afterUpdate&&this.afterUpdate(this)},renderbg:function(){var e=this.$el;interaction_view.screen_mode==2&&(e=this.$el.children()),this.model.get("picture")&&e.css({"background-image":"url("+this.model.get("picture")+")","background-size":"contain","background-position":"center center","background-repeat":"no-repeat"});var t=this.model.get("bg_color"),n=this.model.get("bg_opacity"),r=t.indexOf("rgba")==-1?_g.getRGBA(t,n):t;e.css({"background-color":r})},prepareLoad:function(){var e=this,t=[];for(var n=0;n<e.animations.length;n++){var r=$.extend(!0,{},e.animations[n]);r.pageid=e.model.id,e.isMaster&&(r.pagetype="master"),e.isBackground&&(r.pagetype="background"),t.push(r)}e.model.iAnimationlist.reset(t);var i=[];for(var n=0;n<e.overlays.length;n++){var r=$.extend(!0,{},e.overlays[n]);r.pageid=e.model.id,r.zIndex=n,e.isMaster&&(r.pagetype="master",r.iType=="Audio"&&r.iDetail.iAutoplay&&!interaction_view.hasbgsound&&(interaction_view.hasbgsound=!0,r.isBgsound=!0)),i.push(new interaction_view.model[r.iType](r))}e.model.iOverlaylist.reset(i),e.model.iOverlaylist.each(function(e){e.iview.setZindex()});var s=[];for(var n=0;n<e.actions.length;n++){var r=$.extend(!0,{},e.actions[n]);r.pageid=e.model.id,e.isMaster&&(r.pagetype="master"),s.push(r)}e.model.iActionlist.reset(s)},startLoad:function(){var e=this;this.model.ipreloadlist.length==0?interaction_view.finishPagePreload(this.model.id,this.model):this.model.ipreloadlist.preload()},afterpreload:function(){var e=this;e.model.iOverlaylist.each(function(e){e.iview.preloaded||e.iview.afterpreload()}),e.hasRenderActionlist?e.model.iActionlist.each(function(e){e.iview&&_.include([0,1,2,4,6,7,14,15,20,21],e.get("iType"))&&e.iview.render()}):(e.hasRenderActionlist={},e.model.iActionlist.each(function(e){e.iview&&e.iview.render()}))},clearPageLoad:function(){if(this.model.get("loaded")){var e=this.$el.find(".interaction-view");e.empty(),this.model.iAnimationlist&&this.model.iAnimationlist.timeline&&this.model.iAnimationlist.timeline.kill(),this.model.isStartLoad=!1,this.model.playFinished=!1,this.ipreloadlist=new interaction_view.collection.Preload,interaction_view.events.clearRelatedEvents(this.model.id),this.model.unset("loaded",{silent:!0})}presentation.pageClearCenter(this.model.id)}};return e}),define("interaction_view/view/subcontainer",["interaction_view/view/page"],function(){var e=require("interaction_view/view/page"),t=$.extend({},e,{template:null,className:null,containment:null,wrap:null,wrapClassName:null,autoRender:!1,position:1,parseData:null,afterload:function(){var e=this;overlays=_.filter(e.model.suboverlays,function(t){return t.path=e.model.iOverlaylist.path,t.isSubOverlay=!0,interaction_view.model[t.iType]}),overlays=_.map(overlays,function(e){return new interaction_view.model[e.iType](e)}),e.model.iOverlaylist.reset(overlays),e.startSubLoad()},startSubLoad:function(){var e=this;e.model.ipreloadlist.length==0?e.model.iview.afterSubOverlayPreload():e.model.ipreloadlist.preload()}});return t});var _eT={RichText:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iText nanoscrollbar Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;overflow-y:hidden;padding:0;margin:0;">',"<% if(iDetail.iStaticImage&&iDetail.iImg&&iDetail.iImg[0]){%>",'<img class="el_wrap" src="<%=iDetail.iImg[0].picture%>" style="width:100%;height:auto;"/>',"<% }else{%>",'<div class="el_wrap" style="position:absolute;width:100%;height:100%;<%=iDetail.iStyle%>"><%=iDetail.iText%></div>',"<% } %>","</div>","</div>"].join(""),Paragraph:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iParagraph Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;padding:0;margin:0;line-height:1.5;">',"<% if(iDetail.iStaticImage&&iDetail.iImg&&iDetail.iImg[0]){%>",'<div class="paragraph nanoscrollbar el_wrap" style="position:absolute;left:0; top: 0 ;background-color:transparent;width:100%;height:100%;padding:0;margin:0;overflow:hidden;">','<img src="<%=iDetail.iImg[0].picture%>" style="width:100%;height:auto;"/>',"</div>","<% }else{%>",'<div class="paragraph nanoscrollbar el_wrap" style="position:absolute;left:0; top: 0 ;background-color:transparent;width:100%;height:100%;padding:0;margin:0;overflow:hidden;<%=iDetail.iStyle||""%>">','<div style="text-align:inherit;width:100%;height:100%;font-size: inherit;color: inherit;font-family: inherit;font-weight:inherit;" class="iText"><%=iDetail.iText%></div>',"</div>","<% } %>","</div>","</div>"].join(""),TextLabel:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iTextLabel nanoscrollbar Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;overflow-y:hidden;<%=iDetail.iStyle%>">',"<% if(iDetail.iStaticImage&&iDetail.iImg&&iDetail.iImg[0]){%>",'<img src="<%=iDetail.iImg[0].picture%>" style="width:100%;height:auto;"/>',"<% }else{%>",'<div style="position:absolute;width:100%;height:100%;<%=iDetail.iStyle%>"><%=iDetail.iText%></div>',"<% } %>","</div>","</div>"].join(""),Image:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iImage Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iMask?"overflow:hidden;":""%>">',"<%if(iDetail.iImg&&iDetail.iImg[0]){%>","<% if(iDetail.iMask){%>",'<div class="image_wrap el_wrap" style="position:absolute;left:0;top:0;width:100%;height:100%;overflow:hidden;position:absolute;<%=iDetail.iStyle%>">','<img draggable="false" class="Context" style="width:<%=iDetail.iMask_data.width%>px;height:<%=iDetail.iMask_data.height%>px;position:absolute;max-width:none;" src="<%=iDetail.iImg&&iDetail.iImg[0]&&iDetail.iImg[0].picture%>">',"</div>","<%}else if(iDetail.iEraser||iDetail.iEditable||iDetail.iQrcode){%>",'<div class="image_wrap el_wrap" style="position:absolute;left:0;top:0;width:100%;height:100%;overflow:hidden;position:absolute;<%=iDetail.iStyle%>">','<img draggable="false" class="Context" style="width:100%;height:100%;position:absolute;max-width:none;" src="<%=iDetail.iImg&&iDetail.iImg[0]&&iDetail.iImg[0].picture%>">',"</div>","<%}else{%>",'<div class="image_wrap el_wrap bk_full" style="position:absolute;left:0;top:0;width:100%;height:100%;position:absolute;background-image:url(<%=iDetail.iImg&&iDetail.iImg[0]&&iDetail.iImg[0].picture%>);<%=iDetail.iStyle%>">',"<% } %>","<%}%>","</div>","</div>"].join(""),ImageBlock:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iImageBlock Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">',"<%if(iDetail.iImg&&iDetail.iImg[0]){%>","<% if(iDetail.iMask){%>",'<div class="image_wrap el_wrap" style="position:absolute;left:0;top:0;width:100%;height:100%;overflow:hidden;position:absolute;<%=iDetail.iStyle%>">','<img draggable="false" class="Context" style="width:<%=iDetail.iMask_data.width%>px;height:<%=iDetail.iMask_data.height%>px;position:absolute;max-width:none;" src="<%=iDetail.iImg&&iDetail.iImg[0]&&iDetail.iImg[0].picture%>">',"</div>","<%}else if(iDetail.iEraser||iDetail.iEditable||iDetail.iQrcode){%>",'<div class="image_wrap el_wrap" style="position:absolute;left:0;top:0;width:100%;height:100%;overflow:hidden;position:absolute;<%=iDetail.iStyle%>">','<img draggable="false" class="Context" style="width:100%;height:100%;position:absolute;max-width:none;" src="<%=iDetail.iImg&&iDetail.iImg[0]&&iDetail.iImg[0].picture%>">',"</div>","<%}else{%>",'<div class="image_wrap el_wrap bk_full" style="position:absolute;left:0;top:0;width:100%;height:100%;position:absolute;background-image:url(<%=iDetail.iImg&&iDetail.iImg[0]&&iDetail.iImg[0].picture%>);<%=iDetail.iStyle%>">',"<% } %>","<%}%>","</div>","</div>"].join(""),Link:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iLink Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>"></div>',"</div>"].join(""),SearchInput:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iSearchInput Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">','<form class="search" style="position:relative; cursor:default;">','<input type="text" autofocus placeholder="è¾å¥å³é®å­" class="input-medium search-query" style="cursor:default; width:<%=iCommon[iPageDirection].iWidth-14%>px; height:<%=iCommon[iPageDirection].iHeight-2%>px; line-height:<%=iCommon[iPageDirection].iHeight-2%>px; border-radius:8px; border-color:<%=iDetail.border_color%>; color:<%=iDetail.text_color%>; background-color:transparent;">','<button class="btn" type="submit" style="cursor:default; position:absolute; top:0; right:0; display:block; width:30px; height:<%=iCommon[iPageDirection].iHeight-2%>px; line-height:30px; background:none; border:none; margin:0 0 0 -30px; padding:0; text-shadow:none; color:#ccc;">','<i class="icon-search"></i>',"</button>","</form>","</div>","</div>"].join(""),Input:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iInput Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<input type="text" placeholder="<%=iDetail.placeholder%>" class="input-medium search-query c-input" style=" width:<%=iCommon[iPageDirection].iWidth%>px; height:<%=iCommon[iPageDirection].iHeight%>px; line-height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>"> ',"</div>","</div>"].join(""),Textarea:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iTextarea Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<textarea placeholder="<%=iDetail.placeholder%>" style="cursor:default; width:<%=iCommon[iPageDirection].iWidth%>px; height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>"></textarea>	 ',"</div>","</div>"].join(""),Select:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iInput Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<select class="input-medium search-query c-select" style="cursor:default; width:<%=iCommon[iPageDirection].iWidth%>px; height:<%=iCommon[iPageDirection].iHeight%>px; line-height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">			',"<option></option>","</select>","</div>","</div>"].join(""),SelectBox:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iSelectBox Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<input type="<%=iDetail.type%>" class="input-medium search-query" style="','vertical-align:"middle";','padding:0px;margin:0;" id="<%=id+"box"%>"> <label for="<%=id+"box"%>" ><span style="display:inline;<%=iDetail.iStyle%>"><%=iDetail.label%></span></label>',"</div>","</div>"].join(""),Tree:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iTree Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">		 ',"</div>","</div>"].join(""),Grid:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iGrid Element" style="overflow:hidden;position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">',"</div>","</div>"].join(""),Gallery:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iGallery Element nanoscrollbar" style="overflow:hidden;position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;overflow:hidden;<%=iDetail.iStyle%>">',"</div>","</div>"].join(""),PageIndex:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iPageIndex Element nanoscrollbar" style="overflow:hidden;position:absolute;left: -<%=parseInt(iCommon[iPageDirection].iWidth/2,10)-0.5%>px; top: -<%=parseInt(iCommon[iPageDirection].iHeight/2,10)-0.5%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">',"</div>","</div>"].join(""),Cell:['<div class="iView static hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="position:absolute; left: <%=iCommon[iPageDirection].iStartx%>px; top: <%=iCommon[iPageDirection].iStarty%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iCell Element" style="overflow:hidden;position:absolute;left: 0px; top:0px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;overflow:hidden;<%=iDetail.iStyle%>">',"		</div>","</div>"].join(""),TabBar:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iTabBar Element" style="overflow:hidden;position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;overflow:hidden;<%=iDetail.iStyle%>">',"</div>","</div>"].join(""),WebContent:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="i<%=iType%> nanoscrollbar Element iMouseWheel disableMouseWheelY disableMouseWheelX disableDragX disableDragY" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;-webkit-overflow-scrolling:touch;overflow:auto;<%=iDetail.iStyle%>">','<iframe style="position:absolute;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;min-height:<%=iCommon[iPageDirection].iHeight%>px;height:100%;border:none;overflow:visible;"></iframe>',"</div>","</div>"].join(""),Slide:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iSlide Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<div class="slidecontent overflowhidden" style="position:absolute;width:100%;height:100%;line-height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">',"<%if(iDetail.iImg){%>","<%_.each(iDetail.iImg,function(i,index){%>",'<%if(_g.getUrlParameterByName("-playmode")=="1"){%>','<img data-index="<%=index%>" id="<%=preload_id[index]%>" class="Context" style="width:100%;height:100%;position:absolute;margin:auto;display:inline;verticle-align:middle;">',"<%}else{ %>",'<img data-index="<%=index%>" id="<%=preload_id[index]%>" class="Context" style="width:100%;height:100%;position:absolute;margin:auto;display:inline;verticle-align:middle;">',"<%}%>","<%})%>","<%}%>","</div>","</div>","</div>"].join(""),CycleImage:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iCycleImage Element" style="overflow:hidden;position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<div class="slidecontent overflowhidden" style="position:absolute;width:100%;height:100%;line-height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">',"</div>","</div>","</div>"].join(""),Video:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iVideo Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">',"</div>","</div>"].join(""),Audio:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iAudio Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">',"</div>","</div>"].join(""),Button:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iButton Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<div class="image_wrap el_wrap" style="position:abosolute;left:0;top:0;width:100%;height:100%;overflow:hidden;position:absolute;<%=iDetail.iStyle%>">',"<%if(iDetail.iconNormal&&iDetail.iconNormal[0]){%>",'<img class="Context iconNormal" id="<%=preload_id[0]%>" style="width:100%;height:100%;position:absolute;">',"<%}%>","<%if(iDetail.iconActive&&iDetail.iconActive[0]){%>",'<img class="Context iconActive" id="<%=preload_id[1]%>" style="width:100%;height:100%;position:absolute;display:none;">',"<%}%>","</div>","</div>","</div>"].join(""),Map:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iMap nanoscrollbar Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">','<iframe style="width: 100%; height: 100%;" src="<%=iDetail.iText + "&view=view"%>" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"></iframe>',"</div>","</div>"].join(""),LayerRef:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iLayerRef Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<div class="layer-mask" style="position:absolute;width:100%;height:100%;overflow:hidden;<%=iDetail.iStyle%>">',"<%if(iDetail.layer_ids&&iDetail.layer_ids.length>0){%>",'<div class="layer-content" style="position:absolute;width:100%;height:100%;">',"<% _.each(iDetail.layer_ids,function(layerid){ %>","<% if(interaction_view.ilayerlist.get(layerid)){ %>",'<div class="layer-item" data-index="<%=iDetail.layer_ids.indexOf(layerid)%>" data-id="<%=layerid%>" style="position:absolute;opacity:0;width:<%=interaction_view.ilayerlist.get(layerid).toJSON().layer_width%>px;height:<%=interaction_view.ilayerlist.get(layerid).toJSON().layer_height%>px;left:0px;right:0px;">','<div href="" class="layer-bg" style="position:absolute;width:100%;height:100%;text-align:center;line-height:<%=interaction_view.ilayerlist.get(layerid).toJSON().layer_height%>px;background-color:<%=interaction_view.ilayerlist.get(layerid).toJSON().bg_color%>;opacity:<%=interaction_view.ilayerlist.get(layerid).toJSON().bg_opacity%>">','<% if(interaction_view.ilayerlist.get(layerid).get("picture")){ %>','<img src="<%=interaction_view.ilayerlist.get(layerid).get("picture")%>" style="<%=(interaction_view.ilayerlist.get(layerid).toJSON().layer_width>=interaction_view.ilayerlist.get(layerid).toJSON().layer_height)?"width:auto;height:100%;":"width:100%;height:auto;"%>margin:auto">',"<% } %>","</div>","</div>","<% } %>","<% }) %>","</div>","<% } %>","</div>  ","</div>	","</div>"].join(""),ComponentRef:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iLayerRef Element" style="position:absolute;left: 0px; top: 0px;background-color:transparent;width:100%;height:100%;">',"<%if(iDetail.layer_ids&&iDetail.layer_ids.length>0){%>",'<div class="layer-content" style="position:absolute;width:100%;height:100%;">',"<% _.each(iDetail.layer_ids,function(layerid){ %>","<% if(interaction_view.iComponentlist.get(layerid)){ %>","<% var _layer=interaction_view.iComponentlist.get(layerid).toJSON(); %>",'<div class="layer-item" data-index="<%=iDetail.layer_ids.indexOf(layerid)%>" data-id="<%=layerid%>" style="position:absolute;opacity:0;width:100%;height:100%;left:0px;right:0px;">',"</div>","<% } %>","<% }) %>","</div>","<% } %>","</div>","</div>"].join(""),Shape:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<% if (_g.device.svg()){%><div class="iShape nanoscrollbar Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<div class="image_wrap el_wrap" style="position:abosolute;left:0;top:0;width:100%;height:100%;position:absolute;<%=iDetail.iStyle%>">',"<%=iDetail.iSvg%>","</div>","</div><% }else{ %>",'<div class="iImage Element" style="position:absolute;left: <%=-iCommon[iPageDirection].iWidth/2%>px; top: <%=-iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">','<img draggable="false" class="Context" style="width:100%;height:100%;position:absolute;" src="<%=iDetail.iImg[0].picture%>">  ',"</div><% } %>","</div>"].join(""),DragDrop:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iDragDrop Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<div class="image_wrap el_wrap" style="position:abosolute;left:0;top:0;width:100%;height:100%;overflow:hidden;position:absolute;<%=iDetail.iStyle%>">',"<%if(iDetail.iconNormal&&iDetail.iconNormal[0]){%>",'<img class="Context iconNormal" id="<%=preload_id[0]%>" style="width:100%;height:100%;position:absolute;">',"<%}%>","<%if(iDetail.iconActive&&iDetail.iconActive[0]){%>",'<img class="Context iconActive" id="<%=preload_id[1]%>" style="width:100%;height:100%;position:absolute;display:none;">',"<%}%>","</div>","</div>","</div>"].join(""),Variable:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iVariable nanoscrollbar Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">',"<%=iDetail.initial%>","</div>","</div>"].join(""),Timer:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iTimer nanoscrollbar Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">',"<%=iDetail.formatTime%>","</div>","</div>"].join(""),InfoList:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iInfoList Element" style="overflow:hidden;position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<div class="info-content iMouseWheel disableMouseWheelY disableDragY" style="min-width:100%;<%=iDetail.iStyle%>">','<div style="margin-top: -38px;height: 38px;color:#999;">','<div style="text-align: center; font-size: 12px;height:19px;">E<% if (typeof epub360!="undefined"&&epub360.settings&& ["USER_FREE","USER_BASIC"].indexOf(epub360.settings.billing_type) >=0 ){ %>Epub360ææ¯æ¯æ<% } %></div>','<div class="pullDown" style="text-align: center;font-size: 12px;">ä¸æå·æ°</div>',"</div>",'<div class="lists"></div>','<div class="pullUp" style="display:none;text-align: center;font-size: 12px; color:#999;">ä¸æå è½½æ´å¤</div>',"</div>","</div>","</div>"].join(""),ChartList:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iChartList Element" style="overflow:hidden;position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<div class="info-content iMouseWheel disableMouseWheelY disableDragY" style="min-width:100%;<%=iDetail.iStyle%>">','<div style="margin-top: -38px;height: 38px;color:#999;">','<div style="text-align: center; font-size: 12px;height:19px;"><% if (typeof epub360!="undefined"&&epub360.settings&& ["USER_FREE","USER_BASIC"].indexOf(epub360.settings.billing_type) >=0 ){ %>Epub360ææ¯æ¯æ<% } %></div>','<div class="pullDown" style="text-align: center;font-size: 12px;">ä¸æå·æ°</div>',"</div>",'<div class="lists"></div>',"</div>","</div>","</div>"].join(""),UserSVG:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iUserSVG Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">',"<%=iDetail.iSvg%>","</div>","</div>"].join(""),FormView:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="i<%=iType%> nanoscrollbar Element iMouseWheel disableMouseWheelY disableMouseWheelX disableDragX disableDragY" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;-webkit-overflow-scrolling:touch;overflow:auto;<%=iDetail.iStyle%>">',"<% if(interaction_view.getWebContentSrc(iDetail)&&interaction_view.getWebContentSrc(iDetail).src){%>",'<iframe src="<%=interaction_view.getWebContentSrc(iDetail).src||""%>" style="position:absolute;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;min-height:<%=iCommon[iPageDirection].iHeight%>px;height:100%;border:none;overflow:visible;"></iframe>',"<% } %>","<% if(interaction_view.getWebContentSrc(iDetail)&&interaction_view.getWebContentSrc(iDetail).content){%>",'<iframe style="position:absolute;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;min-height:<%=iCommon[iPageDirection].iHeight%>px;height:100%;border:none;overflow:visible;"></iframe>',"<% } %>","</div>","</div>"].join(""),Avatar:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iAvatar Element" style="visibility: hidden; position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">',"<%if(iDetail.iconNormal&&iDetail.iconNormal[0]){%>",'	<div class="thumb" style="width:<%=(iCommon[iPageDirection].iWidth-iDetail.borderW)%>px;height:<%=(iCommon[iPageDirection].iHeight-iDetail.borderH)%>px;overflow:hidden;position:absolute;<%=iDetail.iStyle%> background-image:url(<%=iDetail.iconNormal[0].picture%>);"></div>',"<%}%>","</div>","</div>"].join(""),AvatarList:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iAvatarList Element nanoscrollbar" style="visibility: hidden; position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;overflow:hidden;<%=iDetail.iStyle%>">','<div class="info-content iMouseWheel disableMouseWheelY disableDragY">','<div style="margin-top: -38px;height: 38px;color:#999;">','<div style="text-align: center; font-size: 12px;height:19px;">E<% if (typeof epub360!="undefined"&&epub360.settings&& ["USER_FREE","USER_BASIC"].indexOf(epub360.settings.billing_type) >=0 ){ %>Epub360ææ¯æ¯æ<% } %></div>','<div class="pullDown" style="text-align: center;font-size: 12px;">ä¸æå·æ°</div>',"</div>",'<div class="lists">',"<% for(i=0;i<18;i++){ %>",'	<div class="avatar" style="text-align:center; padding:5px; float:left;">','		<div class="thumb" style="width: 36px; height: 36px; border-radius: 18px; background: #999 url(http://qty83k.creatby.com/materials/origin/9691dee74ea33a01f494c7e085956c8c_origin.jpg) no-repeat 50% 50%;background-size: cover;"></div>','		<div class="title" style="font-size: 12px;width: 100%; overflow: hidden; word-wrap: normal;">Jason</div>',"	</div>","<% } %>","</div>",'<div class="pullUp" style="display:none;text-align: center;font-size: 12px; color:#999;">ä¸æå è½½æ´å¤</div>',"</div>",'<% if(!interaction_view.forpreview){ %><div class="info-template" style="opacity: 0;">','	<div class="avatar" style="text-align:center; padding:5px; float:left;">','		<div class="thumb" style="width: 36px; height: 36px; border-radius: 18px; background: #999 url(http://qty83k.creatby.com/materials/origin/9691dee74ea33a01f494c7e085956c8c_origin.jpg) no-repeat 50% 50%;background-size: cover;"></div>','		<div class="title" style="font-size: 12px;width: 100%; overflow: hidden; word-wrap: normal;">Jason</div>',"	</div>","</div><% } %>","</div>","</div>"].join(""),Plugin:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="i<%=iType%> nanoscrollbar Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;-webkit-overflow-scrolling:touch;overflow:auto;">',"</div>","</div>"].join("")};_eT.TextButton=_eT.Paragraph,_eT.BookButton=_eT.TextLabel,_eT.Vote=_eT.SelectButton=_eT.SubmitButton=_eT.WeixinCamera=_eT.WeixinVoice=_eT.Button,_eT.LayerSlide=_eT.LayerRef,_eT.InitButton=_eT.Button,_eT.QQVideo=_eT.Video,_eT.others=['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">',"</div>"].join(""),define("interaction_view/template/t_for_v2",function(){}),define("interaction_view/model/base",["jquery","backbone","text!interaction_view/template/message.js","text!interaction_view/template/slidenumber.js","text!interaction_view/template/imgpreview.js","interaction_view/view/subcontainer","interaction_view/template/t_for_v2"],function(){var e=require("text!interaction_view/template/message.js"),t=require("text!interaction_view/template/slidenumber.js"),n=require("text!interaction_view/template/imgpreview.js"),r={};_.each(_eT,function(e,t){r["_"+t]=_.template(e)}),window.interaction_view={model:{Base:Backbone.Model.extend({defaults:{iType:"iBasetype",iCommon:null,iDetail:null,iPage:null,iParentModel:null,template:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,callback:null},options:{createwait:!0},initialize:function(){this.options=this.get("iOptions");if(!this.id){this.beforecreate();var e=this;this.set("id",this.get("iType")+"_"+this.cid),this.setcollection(),this.setmodel()}else this.setcollection(),this.setmodel()},beforecreate:function(){},savemodel:function(e){},setmodel:function(){this.page=interaction_view.ipagelist.getPage(this.get("pageid"))||interaction_view.imasterlist.get(this.get("pageid"))||interaction_view.ibackgroundlist.get(this.get("pageid")),this.setlist(),this.setview(),this.setsyncmodel()},createPath:function(){var e=interaction_view.createPath({path:this.get("path"),isSubOverlay:this.get("isSubOverlay"),page_id:this.get("pageid"),model:this});return e},setSubOverlays:function(){var e=this;e.suboverlays=this.getSubOverlays(),e.iOverlaylist=new interaction_view.collection.list,e.iAnimationlist=new interaction_view.collection.Animation,e.iActionlist=new interaction_view.collection.Action,e.ipreloadlist=new interaction_view.collection.Preload,e.subcontainer=e.ipreloadlist.subcontainer=e.iOverlaylist.subcontainer=e.iAnimationlist.subcontainer=e.iActionlist.subcontainer=!0,e.ipreloadlist.path=e.iOverlaylist.path=e.iAnimationlist.path=e.iActionlist.path=this.createPath(),e.ipreloadlist.pagetype=e.iOverlaylist.pagetype=e.iAnimationlist.pagetype=e.iActionlist.pagetype="sub"},getSubOverlays:function(){return this.get("suboverlays")},setlist:function(){},setresourcesmodel:function(){},validate:function(e){},setsyncmodel:function(){},setcollection:function(){},setview:function(){},url:function(){},sync:function(e,t,n){}})},collection:{Base:Backbone.Collection.extend({iSync:!1,initialize:function(){this.setonadd(),this.setonremove()},setonadd:function(){},setonremove:function(){},url:"",sync:function(e,t,n){},parse:function(e){},resetViewStatus:function(){this.each(function(e){e.iview.resetStatus()})}}),list:Backbone.Collection.extend({iSync:!0,url:"",setonadd:function(){this.on("add",function(e){})},setonremove:function(){},sync:function(e,t,n){e=="read"&&(n.url=context_url+"/overlayinit.json"),Backbone.emulateHTTP=!0,Backbone.emulateJSON=!0,Backbone.sync(e,t,n)},parse:function(e){},resetViewStatus:function(){this.each(function(e){e.iview.resetStatus()})},resetBindings:function(){this.each(function(e){e.get("iType")=="Binding"&&e.iview.resetBindingStatus()})}})},view:{Base:Backbone.View.extend({initialize:function(e){_.bindAll(this),this.initstart()},initstart:function(){this.preload(),this.renderDynamicElement(),this.render()},events:{},options:{},change:function(e){},bindImageSwitch:function(e,t){$("body > #imagepreview").find("button.preview-left").on("click",function(){return e.iview.preview_left(t),!1}),$("body > #imagepreview").find("button.preview-right").on("click",function(){return e.iview.preview_right(t),!1});if(interaction_view.ismobile){var n=this;$("body > #imagepreview").hammer().on("dragleft",function(e){return n.dragimage="left",e.gesture.preventDefault(),!1}),$("body > #imagepreview").hammer().on("dragright",function(e){return n.dragimage="right",e.gesture.preventDefault(),!1}),$("body > #imagepreview").hammer().on("dragend",function(r){return n.dragimage=="right"&&e.iview.preview_left(t),n.dragimage=="left"&&e.iview.preview_right(t),n.dragimage=null,r.gesture.preventDefault(),!1})}},initPage:function(){var e=this.model.get("pageid");this.model.iPageId=e,this.model.set("isMasterOverlay",!1),this.model.set("isBackgroundOverlay",!1),this.pagetype=this.model.get("pagetype"),this.iType=this.model.get("iType");if(this.pagetype=="LayerRef"){var t=this.model.get("parentpageid"),n=this.model.get("layerid"),r=interaction_view.getParentpage(t);this.model.page=r.iOverlaylist.get(e).layer[n];var i=r.iOverlaylist.get(e);this.container=i.iview.$el.find(".layer-content").children(".layer-item[data-id="+n+"]"),this.model.iPageId=t}else if(this.pagetype=="master")interaction_view.touchview?this.container=$(".reveal"):this.container=$('.Presentation[id="'+interaction_view.currentPage+'"]').find(".interaction-view"),this.model.set("isMasterOverlay",!0),this.model.isMasterOverlay=!0;else if(this.pagetype=="background")interaction_view.touchview?this.container=$(".reveal"):this.container=$('.Presentation[id="'+interaction_view.currentPage+'"]').find(".interaction-view"),this.model.set("isBackgroundOverlay",!0),this.model.isBackgroundOverlay=!0;else if(this.model.get("isSubOverlay")){this.path=this.model.get("path");var s=interaction_view.getContainerModelByPath(this.path);this.container=s.iview.$el.children(".Element"),this.model.page=interaction_view.getContainerModelByPath(this.path)}else e?this.container=$('.Presentation[id="'+this.model.get("pageid")+'"]').find(".interaction-view"):this.container=$(".interaction-view")},renderStaticElement:function(){},renderDynamicElement:function(){this.initPage();var e=this.iType,t=this.model.toJSON();this.detail=t.iDetail,this.zIndex=t.zIndex,this.iSlideNumber=t.iSlideNumber,this.isStatic=t.isStatic;var n=r["_"+e]?r["_"+e](this.model.toJSON()):r._others(t);this.container.append(n),this.setElement(this.container.find('div.iView[id="'+this.model.id+'"]').first());var i=this.common=this.getcommon();this.x=i.iStartx+i.iWidth/2,this.y=i.iStarty+i.iHeight/2,this.staticX=i.iStartx,this.staticY=i.iStarty,this.originWidth=i.iWidth,this.originHeight=i.iHeight,this.setSizeAdapt(),this.setScreenAdapt(),this.isStatic||interaction_view.setPos(this.$el[0],{x:this.x,y:this.y}),this.pagetype=="master"&&this.$el.addClass("master masterhide"),this.pagetype=="background"&&this.$el.addClass("background"),(e=="CycleImage"||e=="Slide"||e=="Button")&&this.setRatiofixxed(),this.iSlideNumber&&this.renderSlideNumber()},setSizeAdapt:function(){if(typeof Reveal=="undefined"||!Reveal.adapt)return!1;var e=this.detail;if(!e.iSizeAdapt||!_.isObject(e.iSizeAdapt_data)||!_.keys(e.iSizeAdapt_data).length)return;var t=!1,n=null;e.iScreenAdapt&&(t=!0),e.iSizeAdapt&&(e.iScreenAdapt=!0,this.model.set("iDetail",e,{silent:!0}));if(t)switch(e.iScreenAdapt_data){case 1:e.iSizeAdapt_data.left=!0,e.iSizeAdapt_data.top=!0;break;case 2:e.iSizeAdapt_data.top=!0;break;case 3:e.iSizeAdapt_data.top=!0,e.iSizeAdapt_data.right=!0;break;case 4:e.iSizeAdapt_data.left=!0;break;case 5:break;case 6:e.iSizeAdapt_data.right=!0;break;case 7:e.iSizeAdapt_data.left=!0,e.iSizeAdapt_data.bottom=!0;break;case 8:e.iSizeAdapt_data.bottom=!0;break;case 9:e.iSizeAdapt_data.bottom=!0,e.iSizeAdapt_data.right=!0}e.iSizeAdapt_data.left&&e.iSizeAdapt_data.right&&e.iSizeAdapt_data.top&&e.iSizeAdapt_data.bottom?n=12:e.iSizeAdapt_data.top&&e.iSizeAdapt_data.bottom&&e.iSizeAdapt_data.left?n=15:e.iSizeAdapt_data.top&&e.iSizeAdapt_data.bottom&&e.iSizeAdapt_data.right?n=16:e.iSizeAdapt_data.bottom&&e.iSizeAdapt_data.right&&e.iSizeAdapt_data.left?n=13:e.iSizeAdapt_data.top&&e.iSizeAdapt_data.right&&e.iSizeAdapt_data.left?n=14:e.iSizeAdapt_data.left&&e.iSizeAdapt_data.right?n=10:e.iSizeAdapt_data.top&&e.iSizeAdapt_data.bottom?n=11:(e.iSizeAdapt_data.top&&(n=17),e.iSizeAdapt_data.left&&(n=20),e.iSizeAdapt_data.right&&(n=18),e.iSizeAdapt_data.bottom&&(n=19)),n&&(e.iScreenAdapt_data=n,this.model.set("iDetail",e,{silent:!0}))},setScreenAdapt:function(){if(typeof Reveal=="undefined"||!Reveal.adapt)return!1;var e=this.detail;if(!this.model.isMasterOverlay&&!this.model.isBackgroundOverlay&&!e.iScreenAdapt)return!1;if(!this.model.isMasterOverlay||!this.model.isBackgroundOverlay)this.$el.addClass("fixed"),this.model.get("isStatic")||this.$el.css({left:0,top:0});if(e.iScreenAdapt){var t=e.iScreenAdapt_data;t!=1&&interaction_view.adapt.elements.push({model:this.model,view:this,type:interaction_view.getPageType2(this.model),adapt:t}),interaction_view.adapt.adjustElement({model:this.model,view:this,type:interaction_view.getPageType2(this.model),adapt:t})}else t=e.iScreenAdapt?e.iScreenAdapt_data:null,interaction_view.adapt.elements.push({model:this.model,view:this,type:interaction_view.getPageType2(this.model),adapt:t}),interaction_view.adapt.adjustElement({model:this.model,view:this,type:interaction_view.getPageType2(this.model),adapt:t});interaction_view.adapt.excute({view:this,adapt:t,type:interaction_view.getPageType2(this.model),model:this.model})},renderSlideNumber:function(){if(!this.model.get("iSlideNumber"))return;var e=this.getdetail(),n=this;this.$el.parent().find('nav.slidenumber[data-id="'+this.model.id+'"]').remove();if(this.getSlideLength()>1){var r=this.model.toJSON();r.slidelength=this.getSlideLength(),this.$el.parent().append(_.template(t,r)),this.setSlideNumberPosition()}},renderBackGroud:function(){var e=this.getdetail(),t=e.bg_color,n=e.bg_opacity!=undefined?Number(e.bg_opacity):1;if(!t)t="transparent";else{var r=_g.number.hexToRgb(t);t="rgba("+r.r+","+r.g+","+r.b+","+n+")"}this.$el.children(".Element").css({background:t})},setSlideNumberPosition:function(){this.$el.parent().find('nav.slidenumber[data-id="'+this.model.id+'"]').each(function(){var e=$(this).actual?$(this).actual("outerWidth",{includeMargin:!0}):$(this).width(),t=$(this).actual?$(this).actual("outerHeight",{includeMargin:!0}):$(this).height();$(this).css({left:parseInt($(this).css("left"),10)-e/2,top:parseInt($(this).css("top"),10)-t/2})})},setSlideNumberDisplay:function(){this.getSlideLength()>1&&(this.$el.children(".Element").is(":hidden")?this.$el.parent().find('nav.slidenumber[data-id="'+this.model.id+'"]').hide():this.$el.parent().find('nav.slidenumber[data-id="'+this.model.id+'"]').show())},setFullView:function(e){var t=this;$("body").children("#imagepreview").remove(),$("body").append('<div id="imagepreview" style="z-index:10000;width:100%;height:100%;position:absolute;left:0;top:0;background:#000;"><button type="button" class="close" style="display:block;position: absolute; top: 10px; right: 10px; z-index: 9999; width: 32px; height: 32px; line-height: 32px; margin: 0; padding: 0; font-size: 32px; color: #ddd; box-shadow: 0; text-shadow: 0 1px 0 white; text-align: center; filter: alpha(opacity=100); -khtml-opacity: 1; opacity: 1;">Ã</button><img src="'+e.picture+'"</div>'),t.isFullSwitch()&&($("body > #imagepreview").append(n),t.bindImageSwitch(e.model,e.index)),_g.ui.fitImage({fit:1,items:"#imagepreview > img",width:e.width,height:e.height}),$("#imagepreview").on("click",function(){$(this).remove()}).css("line-height","initial"),$("#imagepreview button.close").on("click",function(){$(this).remove()})},fullviewIndex:function(e){var t=this,n=this.getdetail();if(typeof wx_permissions!="undefined"&&wx_permissions.previewImage)wx.previewImage({current:n.iImg[e].picture,urls:_.map(n.iImg,function(e){return e.picture})});else{var r={picture:n.iImg[e].picture,width:n.iImg[e].width,height:n.iImg[e].height,model:t.model,index:e};t.setFullView(r)}},preload:function(){},afterpreload:function(){this.setZindex(),this.setElementDisplay(),this.model.get("iSlideNumber")&&this.setSlideNumberDisplay(),this.setOtherDisplay(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".Element").attr("style"),this.preloaded=!0},setSlideImageDisplay:function(){var e=this,t=this.getdetail();this.imageDisplay=t.iDisplay;if(!t.iImg||t.iImg.length==0)return;if(!this.imageDisplay)return!1;var n=this.getcommon();_.each(t.iImg,function(r){var i=_g.ui.fitImage({items:e.$el.find(".slidecontent").children()[t.iImg.indexOf(r)],parentWidth:n.iWidth,parentHeight:n.iHeight,width:r.width,height:r.height,fit:e.imageDisplay,useMargin:!0})})},setRatiofixxed:function(){var e=this,t=this.getdetail();if(!t.ratiofixxed||!t.iImg||t.iImg.length==0)return;var n=this.getcommon();_.each(t.iImg,function(r){var i=_g.ui.centerImage({containment:e.$el.find(".slidecontent"),Item:e.$el.find(".slidecontent").children()[t.iImg.indexOf(r)],parentWidth:n.iWidth,parentHeight:n.iHeight,width:r.width,height:r.height,setParent:!1});i.width<n.iWidth&&(e.$el.find(".slidecontent").children("[data-index="+t.iImg.indexOf(r)+"]").css("margin-left",(n.iWidth-i.width)/2+"px"),e.$el.find(".slidecontent").children("[data-index="+t.iImg.indexOf(r)+"]").css("margin-right",(n.iWidth-i.width)/2+"px")),i.height<n.iHeight&&(e.$el.find(".slidecontent").children("[data-index="+t.iImg.indexOf(r)+"]").css("margin-top",(n.iHeight-i.height)/2+"px"),e.$el.find(".slidecontent").children("[data-index="+t.iImg.indexOf(r)+"]").css("margin-bottom",(n.iHeight-i.height)/2+"px"))})},setElementDisplay:function(){this.$el.children(".Element").length>0&&interaction_view.setPos(this.$el.children(".Element")[0],{scale:1});var e=this.model.toJSON().iDetail,t=e.iHidden||!1;this.model.attributes.iType!="LayerRef"&&this.$el.children(".Element").find(".el_wrap").length&&(this.wrap_el=this.$el.children(".Element").find(".el_wrap").first());if(!_.isNaN(Number(e.init_opacity))){var n=Number(e.init_opacity);n<=1&&n>=0&&(this.$el[0].style.opacity=Number(e.init_opacity))}if(!_.isNaN(Number(e.init_rotation))){var r=Number(e.init_rotation);if(r<=360&&r>=-360&&r!=0){var i=this.wrap_el?this.wrap_el[0]:this.$el.children(".Element")[0];i&&typeof TweenMax!="undefined"&&TweenMax.set(i,{rotation:Number(e.init_rotation)})}}var s=this.model.page.iAnimationlist.where({overlay_id:this.model.id}),o=!1;if(s&&s[0]&&s[0].toJSON().iType>=20&&s[0].toJSON().iType<=60)this.$el.addClass("hide");else if(s&&s[0]&&_.include([101,102,103,104,601,701],s[0].toJSON().iType)||o){var u=s&&s[0]&&_.include([101,102,103,104,601,701],s[0].toJSON().iType)?s[0]:o[0],a=-9999,f=-9999;u._animation&&u._animation.css&&(a=u._animation.css.x,f=u._animation.css.y);if(u.toJSON().iType==101){t&&this.$el.addClass("hide");var l=this.getcommon().iWidth,c=this.getcommon().iHeight;interaction_view.ismobile||_g.browserSupport({msie:9})?interaction_view.setPos(this.$el[0],{x:a,y:f}):$(this.$el[0]).css("margin",a+"px 0px 0px "+f+"px").removeClass("hide").show()}u.toJSON().iType==102&&(interaction_view.ismobile||_g.browserSupport({msie:9}))&&(t&&this.$el.addClass("hide"),interaction_view.setPos(this.$el.children(".Element")[0],{scale:0})),u.toJSON().iType==103&&(t&&this.$el.addClass("hide"),this.$el[0].style.opacity=0),u.toJSON().iType==104&&(this.$el.addClass("hide"),(interaction_view.ismobile||_g.browserSupport({msie:9}))&&t&&this.$el.addClass("hide")),u.toJSON().iType==601&&(this.$el.addClass("hide"),(interaction_view.ismobile||_g.browserSupport({msie:9}))&&t&&this.$el.addClass("hide")),s[0].toJSON().iType==701&&(t&&this.$el.addClass("hide"),typeof TweenMax!="undefined"&&TweenMax.set(this.$el.find("svg").find("rect, circle, ellipse, polyline, path, line, polygon"),{drawSVG:"0%",force3D:interaction_view.force3D}))}else t?this.$el.addClass("hide"):this.model.get("iType")!="Video"&&this.$el.removeClass("hide");this.Clone=this.$el.clone(),e.init_classname&&this.$el.children(".Element").addClass(e.init_classname)},setOtherDisplay:function(){},setZindex:function(){if(this.iType=="Binding"||this.iType=="DragDropGroup")return!1;if(this.iType=="Audio"&&!this.detail.iControl)return!1;var e=this.zIndex;this.pagetype=="master"?e+=2e3:this.pagetype!="background"&&(e+=1e3),this.$el&&this.$el.css("z-index",e),this.iSlideNumber&&this.$el.parent().children('nav.slidenumber[data-id="'+this.model.id+'"]').css("z-index",e)},setMaskSlipable:function(e){var t=this,n=this.getMoveRange();n.x&&e.containment.addClass("iMouseWheel disableMouseWheelX disableDragX"),n.y&&e.containment.addClass("iMouseWheel disableMouseWheelY disableDragY");if(!n.x&&!n.y)return;var r=0,i=0,s,o;this.scrollview=new _g.scrollview({containment:e.containment,contentel:e.contentel,mask_width:this.$el.children(".Element").width(),mask_height:this.$el.children(".Element").height(),content_width:this.getLayerContentSize().width,content_height:this.getLayerContentSize().height,content_x:e.content_x,content_y:e.content_y,scrollX:n.x>0?!0:!1,scrollY:n.y>0?!0:!1,onScrollStart:function(){r=t.scrollview._getCurrentPosition().x,i=t.scrollview._getCurrentPosition().y,$("section#"+interaction_view.currentPage).children().data("is_scrollPage")&&interaction_view.ipagelist.getPage(interaction_view.currentPage).iview.scrollview.iScroll.disable()},onScrolling:function(s){if(n.x>0){s.controller?t.scrollstart=!0:t.scrollstart=!1;var o=s.deltaX-r;(Math.abs(s.deltaX)>n.x+30||s.deltaX>30)&&e.containment.addClass("is_exceededX");var u=Math.abs(s.deltaX)/n.x;t.onBindingChangeTo({type:0,delta:o,deltarate:u,cdirection:0})}if(n.y>0){var a=s.deltaY-i;(Math.abs(s.deltaY)>n.y+30||s.deltaY>30)&&e.containment.addClass("is_exceededY");var u=Math.abs(s.deltaY)/n.y;t.onBindingChangeTo({type:0,delta:a,deltarate:u,cdirection:1})}},onScrollend:function(){t.scrollstart=!1,e.containment.removeClass("is_exceededY"),e.containment.removeClass("is_exceededX"),$("section#"+interaction_view.currentPage).children().data("is_scrollPage")&&interaction_view.ipagelist.getPage(interaction_view.currentPage).iview.scrollview.iScroll.enable()}}),this.getdetail().iGravity&&_g.orientation.orientationEvents.push({scrollX:n.x>0?!0:!1,scrollY:n.y>0?!0:!1,speed:n.y?n.y/1200:n.x/1200,func:function(e,r){if(interaction_view.currentPage==t.model.iPageId||t.model.get("pagetype")=="background"){if(t.scrollstart)return;e&&(t.scrollview.iScroll.x+e>0&&(e=-t.scrollview.iScroll.x),t.scrollview.iScroll.x+e<-n.x&&(e=-t.scrollview.iScroll.x-n.x)),r&&(t.scrollview.iScroll.y+r>0&&(r=-t.scrollview.iScroll.y),t.scrollview.iScroll.y+r<-n.y&&(r=-t.scrollview.iScroll.y-n.y));if(n.x>0){var i=e,s=Math.abs(t.scrollview.iScroll.x+e)/n.x;t.onBindingChangeTo({type:0,delta:e,deltarate:s,cdirection:0})}if(n.y>0){var o=r,s=Math.abs(t.scrollview.iScroll.y+r)/n.y;t.onBindingChangeTo({type:0,delta:r,deltarate:s,cdirection:1})}t.scrollview.iScroll.scrollBy(e,r)}}}),this.$el.addClass("hascontrols")},getMoveRange:function(){var e=this.getLayerContentSize(),t=e.width,n=e.height,r=this.getcommon();return{x:t-r.iWidth,y:n-r.iHeight}},checkMaskPos:function(e,t){var n=this.getdetail(),r=!0,i=this.getLayerContentSize(),s=i.width,o=i.height;return e.left>0&&(e.left=0,r=!1),e.top>0&&(e.top=0,r=!1),Math.abs(e.left)+t.width>s&&(e.left=-(s-t.width),r=!1),Math.abs(e.top)+t.height>o&&(e.top=-(o-t.height),r=!1),r?null:{left:e.left,top:e.top}},render:function(){},renderCentrolPos:function(e){document.getElementById(this.model.id).style.left=e.x-100+"px",document.getElementById(this.model.id).style.top=e.x-100+"px"},destroy:function(e,t){},updateposition:function(){var e=this.getcommon();e&&(this.$el.css("left",e.iStartx+"px"),this.$el.css("top",e.iStarty+"px"),this.$el.width(e.iWidth),this.$el.height(e.iHeight))},updateel:function(){this.model.get("iTemplate")&&this.$el.html(this.model.get("iTemplate")(this.model.toJSON()))},getAnimations:function(){var e=this.model.page.iAnimationlist.where({overlay_id:this.model.id});return e.length?e:null},getcommon:function(){var e=null;return e=this.model.get("iCommon")[iPageDirection],e},getdetail:function(){return this.model.get("iDetail")},resetStatus:function(){this.$el.attr("style",this.copyelstyle),this.$el.children(".Element").attr("style",this.copyelementstyle),this.setElementDisplay(),this.model.get("iSlideNumber")&&this.setSlideNumberDisplay(),this.resetOtherStatus&&this.resetOtherStatus()},sendToPreload:function(e){var t=$.extend({},{parentpageid:this.model.get("parentpageid"),overlay_id:this.model.id,elementtype:this.model.get("iType"),pageid:this.model.get("pageid"),pagetype:this.model.get("pagetype"),layerid:this.model.get("layerid")},e),n=new interaction_view.model.Preload(t);return this.preloadmodel=n,n},playTimeline:function(){if(this.autoplay){if(this.timeline){if(this.$el.children(".Element").is(":hidden"))return;!this.repeat&&this.timeline.time()==this.timeline.duration()?this.timeline.play(0,!1):this.timeline.play(null,!1)}}else{this.autoplay=!0;if(this.useIndex)this._setCanvasLoopSwitch(),this.timeline.play();else{this.timeline&&this.timeline.kill(),this.timeline=new TimelineMax({paused:!0,repeat:this.repeat,onComplete:this.setRewind}),this.setTimeline(),this.setSlideDisplayAll();if(this.$el.children(".Element").is(":hidden"))return;this.timeline&&this.timeline.play(null,!1)}}},pauseTimeline:function(){this.timeline&&this.timeline.pause()},stopTimeline:function(){this.autoplay=!1,this.useIndex?(this.timeline.pause(),this.currentIndex=this._start,this.ctx.clearRect(0,0,this.canvas_width,this.canvas_height),this.drawCanvas(this.img_src[this._start],this._start)):(this.timeline.kill(),this.timeline=new TimelineMax({paused:!0,repeat:this.repeat}),this.setTimeline(),this.timeline.pause(1e-5),this.setSlideElementsDisplay&&this.setSlideElementsDisplay())},setRewind:function(){if(!this.timeline)return!1;var e=this,t=this.getdetail(),n=this.delay,r=function(){setTimeout(function(){e.useIndex?(e.timeline.pause(),e.currentIndex=e._start,e.drawCanvas(e.img_src[e.currentIndex],e.currentIndex)):(e.timeline.pause(1e-5),e.currentIndex=0)},n*1e3)},i=t.iRepeat?-1:0,s=t.iRewind;this.model.onAnimationStart&&(interaction_view.events.onAnimationEnd(this.model.onAnimationStart),this.model.onAnimationStart=null);if(!!i||!s)return null;r()},_setCanvasLoopSwitch:function(e){var t=this,n=this.delay,r=this.getdetail(),i=0,s=0;this.autoplay||(n=2);var o=this._start;return this.currentIndex>this._start&&this.currentIndex<this._end&&(o=this.currentIndex),e&&this.timeline&&(this.timeline.kill(),this.timeline=null),this.timeline=interaction_view.createLoop({delay:n,paused:!0,repeat:this.repeat,onComplete:this.setRewind,duration:this.repeat?this.slidelength*n:(this.slidelength+1)*n,callback:function(){var e=r.iImg[o].picture;t.drawCanvas(e,o),t.onTimelineUpdate(o),t.onChangeSlideTo(o);if(o==t._end&&!t.repeat){t.timeline.pause(),t.setRewind();return}o=t.direction?o-1>=t._end?o-1:t._start:o+1<=t._end?o+1:t._start},time:function(){}}),o},setNone:function(){var e=this,t=0,n=this.delay;this.autoplay||(n=.5);for(i=0;i<this.slidelength;i++){if(i==this.slidelength-1&&!this.repeat)return;var r=this.slideel.children('[data-index="'+i+'"]');this.timeline.add(TweenMax.to(r,1e-5,{css:{opacity:1}}),t),this.timeline.add(TweenMax.to(r,1e-5,{css:{opacity:0},onUpdateParams:[i+1<this.slidelength?i+1:0],onUpdate:this.onTimelineUpdate}),t+1e-5+n);var s=this.slideel.children('[data-index="'+(i+1<this.slidelength?i+1:0)+'"]');this.timeline.add(TweenMax.to(s,1e-5,{css:{opacity:0}}),t),this.timeline.add(TweenMax.to(s,1e-5,{css:{opacity:1},onCompleteParams:[i+1<this.slidelength?i+1:0],onComplete:e.onChangeSlideTo}),t+1e-5+n),i==this.slidelength-1&&this.timeline.add(TweenMax.to(r,1e-5,{css:{opacity:0}}),t+1e-5+n),t+=n+2e-5}},setFade:function(){var e=this,t=0,n=this.delay,r,s;this.autoplay||(n=0);for(i=0;i<this.slidelength;i++){i==0&&(r=this.slideel.children('[data-index="'+i+'"]'),this.timeline.add(TweenMax.to(r,0,{css:{opacity:1},onCompleteParams:[0],onComplete:e.onChangeSlideTo}),t),t+=n);if(i==this.slidelength-1){if(!this.repeat)break;r=this.slideel.children('[data-index="'+i+'"]'),this.timeline.add(TweenMax.to(r,1e-5,{css:{opacity:1}}),t),this.timeline.add(TweenMax.fromTo(r,.5,{opacity:1},{opacity:0,onUpdateParams:[i+1<this.slidelength?i+1:0],onUpdate:this.onTimelineUpdate,ease:"Linear.easeNone",immediateRender:!1}),t+1e-5),this.timeline.add(TweenMax.to(r,1e-5,{css:{opacity:0}}),t+.50001),s=this.slideel.children('[data-index="'+(i+1<this.slidelength?i+1:0)+'"]'),this.timeline.add(TweenMax.to(s,1e-5,{css:{opacity:1}}),t),this.timeline.add(TweenMax.fromTo(s,.5,{opacity:1},{opacity:1,ease:"Linear.easeNone",immediateRender:!1}),t+1e-5),this.timeline.add(TweenMax.to(s,1e-5,{css:{opacity:1},onCompleteParams:[i+1<this.slidelength?i+1:0],onComplete:e.onChangeSlideTo}),t+.50001),t+=n+.50002}else r=this.slideel.children('[data-index="'+i+'"]'),this.timeline.add(TweenMax.to(r,1e-5,{css:{opacity:1}}),t),this.timeline.add(TweenMax.fromTo(r,.5,{opacity:1},{opacity:1,onUpdateParams:[i+1<this.slidelength?i+1:0],onUpdate:this.onTimelineUpdate,ease:"Linear.easeNone",immediateRender:!1}),t+1e-5),this.timeline.add(TweenMax.to(r,1e-5,{css:{opacity:0}}),t+.50001),s=this.slideel.children('[data-index="'+(i+1<this.slidelength?i+1:0)+'"]'),this.timeline.add(TweenMax.to(s,1e-5,{css:{opacity:0}}),t),this.timeline.add(TweenMax.fromTo(s,.5,{opacity:0},{opacity:1,ease:"Linear.easeNone",immediateRender:!1}),t+1e-5),this.timeline.add(TweenMax.to(s,1e-5,{css:{opacity:1},onCompleteParams:[i+1<this.slidelength?i+1:0],onComplete:e.onChangeSlideTo}),t+.50001),t+=n+.50002}},setSlip:function(){var e=this,t=0,n=this.delay,r,s;this.autoplay||(n=0);for(i=0;i<this.slidelength;i++){if(i==this.slidelength-1&&!this.repeat)break;var o=this.getParamsForSlide(i).param,u=this.getParamsForSlide(i+1<this.slidelength?i+1:0).param1;o.onUpdateParams=[i+1<this.slidelength?i+1:0],o.onUpdate=this.onTimelineUpdate,o.immediateRender=!1,u.immediateRender=!1;var a=_g.number.decimal(t,5);i==0&&(r=this.slideel.children('[data-index="'+i+'"]'),this.timeline.add(TweenMax.to(r,0,{css:{opacity:1},immediateRender:!1,onCompleteParams:[0],onComplete:e.onChangeSlideTo}),a),t+=n);var a=_g.number.decimal(t,5),f=_g.number.decimal(t+1e-5,5),l=_g.number.decimal(t+.50001,5);r=this.slideel.children('[data-index="'+i+'"]'),this.timeline.add(TweenMax.to(r,1e-5,{css:{opacity:1}}),a),this.timeline.add(TweenMax.fromTo(r,.5,{css:{left:"0%",top:"0%",ease:"Linear.easeNone"},immediateRender:!1},_.clone(o)),f),this.timeline.add(TweenMax.to(r,1e-5,{css:{opacity:0}}),l),s=this.slideel.children('[data-index="'+(i+1<this.slidelength?i+1:0)+'"]'),this.timeline.add(TweenMax.to(s,1e-5,{css:{opacity:1}}),a),this.timeline.add(TweenMax.fromTo(s,.5,_.clone(u),{top:"0%",left:"0%",ease:"Linear.easeNone",immediateRender:!1}),f),this.timeline.add(TweenMax.to(s,1e-5,{css:{opacity:1},onCompleteParams:[i+1<this.slidelength?i+1:0,i],onComplete:e.onChangeSlideTo}),l),i==this.slidelength-1&&this.timeline.add(TweenMax.to(r,1e-5,{css:{opacity:0}}),l),t+=n+.50002}},setFlip:function(){var e=this,t=0,n=this.delay,r,s,o,u=this.getdetail(),a=u.iSlidetype?u.iSlidetype:0,f=180;a=="æ¨ªå"||Number(a)==0?(a=0,o={rotationY:0},TweenLite.set(this.slideel,{rotationY:0})):(a=1,o={rotationX:0},TweenLite.set(this.slideel,{rotationX:0})),this.autoplay||(n=0),TweenLite.set(this.$el.children(".Element"),{perspective:800}),TweenLite.set(this.slideel,{transformStyle:"preserve-3d"}),TweenLite.set(this.slideel.children(),{backfaceVisibility:"hidden"});for(i=0;i<this.slidelength;i++){if(i==this.slidelength-1&&!this.repeat)break;o.onUpdateParams=[i+1<this.slidelength?i+1:0],o.onUpdate=this.onTimelineUpdate,a?o.rotationX="+=180cw":o.rotationY="-=180cw",i==0&&(r=this.slideel.children('[data-index="'+i+'"]'),a?this.timeline.add(TweenMax.to(r,0,{rotationX:f==180?0:180,opacity:1,onCompleteParams:[0],onComplete:e.onChangeSlideTo}),t):this.timeline.add(TweenMax.to(r,0,{rotationY:f==180?0:180,opacity:1,onCompleteParams:[0],onComplete:e.onChangeSlideTo}),t),t+=n);var l=_g.number.decimal(t,5),c=_g.number.decimal(t+1e-5,5),h=_g.number.decimal(t+.50001,5);r=this.slideel.children('[data-index="'+i+'"]'),s=this.slideel.children('[data-index="'+(i+1<this.slidelength?i+1:0)+'"]'),a?this.timeline.add(TweenMax.to(r,1e-5,{rotationX:f==180?0:180,opacity:1}),l):this.timeline.add(TweenMax.to(r,1e-5,{rotationY:f==180?0:180,opacity:1}),l),this.timeline.add(TweenMax.to(this.slideel,.5,_.clone(o)),c),this.timeline.add(TweenMax.to(r,1e-5,{css:{opacity:0}}),h),a?this.timeline.add(TweenMax.to(s,1e-5,{css:{rotationX:f,opacity:1}}),l):this.timeline.add(TweenMax.to(s,1e-5,{css:{rotationY:f,opacity:1}}),l),this.timeline.add(TweenMax.to(s,1e-5,{onCompleteParams:[i+1<this.slidelength?i+1:0],onComplete:e.onChangeSlideTo}),h),i==this.slidelength-1&&this.timeline.add(TweenMax.to(r,1e-5,{css:{opacity:0}}),h),t+=n+.50002,f=f==180?0:180}},setFlow:function(){function r(t){e.onTimelineUpdate(t),e.setElementTo(t),!e.getdetail().iRepeat&&e.getdetail().iRewind&&t>=e.slidelength-1&&TweenMax.to(e.slideel.find('[data-index="'+t+'"]'),.3,{opacity:1,onComplete:function(){e.CoverFlow.coverflow("select",0)}})}var e=this,t=0,n=this.delay;this.autoplay||(n=0);for(i=0;i<this.slidelength;i++){if(i==this.slidelength-1&&!this.repeat)break;i==0&&(t+=n);var s=this.slideel.find('[data-index="'+i+'"]');this.timeline.add(TweenMax.to(s,.3,{opacity:1,onUpdateParams:[i+1<e.slidelength?i+1:0],onUpdate:r}),t),t+=n+.3}},onBindingChangeTo:function(e){interaction_view.events.onBingChangeTo({type:e.type,page_id:this.model.page.id?this.model.page.id:this.model.get("layerid"),id:this.model.id,delta:e.delta,deltarate:e.deltarate,cdirection:e.cdirection})},onTimelineUpdate:function(e){var t=this.timeline.time();interaction_view.events.onBingChangeTo({type:0,page_id:this.model.page.id?this.model.page.id:this.model.get("layerid"),id:this.model.id,delta:-1,deltarate:t/this.timeline.duration(),cdirection:null})},onChangeSlideTo:function(e,t){this.currentIndex=e,this.model.trigger("slideTo",e),this.model.get("iSlideNumber")&&this.changeSlideNumber()},changeSlideNumber:function(){var e=this.$el.parent().children('nav.slidenumber[data-id="'+this.model.id+'"]').children(":nth-child("+(this.currentIndex+1)+")");e.each(function(){$(this).addClass("active").siblings().removeClass("active")})},onExecuteBinding:function(e){if(this.model.get("iType")=="LayerRef"){this.onExecuteBindingForLayerRef(e);return}var t=this;if(this.slideel&&this.slidelength>1&&this.timeline){var n=this.timeline.duration();this.repeat?singletime=n/this.slidelength:singletime=n/(this.slidelength-1);if(e.type==0){t.useIndex||t.setSlideDisplayAll(),i=e.deltarate*n;var r=parseInt(i/singletime,10);t.slideChangePatch(e.delta,r),t.onChangeSlideTo(r),t.useIndex?(t.indexTime=i,t.drawCanvas(t.img_src[r],r),t.autoplay&&(t.autoplay=!1,t.timeline.pause(i))):t.timeline.seek(i)}else{if(t.useIndex)var i=t.indexTime;else var i=t.timeline.time();console.log("stop at delta"+e.delta),t.model.get("iType")!="CycleImage"&&(i/singletime-parseInt(i/singletime,10)<.2?(i=parseInt(i/singletime,10)*singletime,r=parseInt(i/singletime,10)):i/singletime-parseInt(i/singletime,10)>.8?(i=(parseInt(i/singletime,10)+1)*singletime,r=parseInt(i/singletime,10)):(i=parseInt(i/singletime,10)*singletime,r=parseInt(i/singletime,10),e.delta<0&&i<n&&(i+=singletime,r=parseInt(i/singletime,10)))),console.log(i);if(i==0||i==1e-5)i=1e-5,e.reset&&e.revert&&(t.repeat?i=1e-5:i=t.timeline.duration(),r=parseInt(i/singletime,10));r>t.slidelength-1&&(r=0),t.useIndex?(t.indexTime=i,r!=undefined&&t.drawCanvas(t.img_src[r],r)):t.timeline.seek(i),t.useIndex||t.setSlideDisplay(r),t.onChangeSlideTo(r)}}},setSlideDisplay:function(e,t){this.autoplay||(this.slideel.children('[data-index="'+e+'"]').css({display:"block",opacity:1}),t&&this.slideel.children('[data-index="'+e+'"]').css("opacity",1),this.model.get("iType")=="LayerSlide"&&(this.onShow(e),this.onBeforeHide(e)),this.slideel.children('[data-index="'+e+'"]').siblings().hide(),t&&this.slideel.children('[data-index="'+e+'"]').siblings().css("opacity",0),this.model.get("iType")=="LayerSlide"&&this.onHide(e))},setSlideDisplayAll:function(){this.slideel.children().css("display","block")},setElementTo:function(e){var t=this,n=this.getdetail();if(n.iFade=="Flow"){var r=t.CoverFlow.children(".ui-state-active").index(),i=n.iImg.length-1;e=="prev"?e=r<=0?i:r-1:e=="next"?e=r>=i?0:r+1:e=="first"?e=0:e=="last"&&(e=i),e<0&&(e=0),e>i&&(e=i),t.CoverFlow.coverflow("select",e);return}if(!_.include(["first","last","prev","next"],e)){if(Number(e)==NaN||this.currentIndex==Number(e))return;e=Number(e)}var s=n.iRepeat,o=!1,u=null,a;if(!this.slidelength||e>=this.slidelength)return;var f=_g.number.decimal(this.timeline.duration(),5);s?a=_g.number.decimal(f/this.slidelength,5):a=_g.number.decimal(f/(this.slidelength-1),5);if(e=="first")u=1e-5;else if(e=="last")u=(this.slidelength-1)*a;else if(e=="prev"){o=!0;var l=!0;if(!s&&this.currentIndex==0)return!1;var c=this.currentIndex==0?this.slidelength-1:this.currentIndex-1;u=c*a,u==1e-5&&(u=0)}else if(e=="next"){o=!0;var h=!0;if(!s&&this.currentIndex==this.slidelength-1)return!1;var c=this.currentIndex==this.slidelength-1?0:this.currentIndex+1;u=c*a,u==1e-5&&(u=0)}else{if(!(Number(e)>=0&&Number(e)<this.slidelength))return!1;u=a*parseInt(e,10)+1e-5}console.log(u),u==0&&(u=1e-5),e=parseInt(u/a,10),e>this.slidelength-1&&(e=0);if(this.iFade!="None"&&this.iFade!="LoopSwitch"&&o){t.setSlideDisplayAll();if(h)var p=u==1e-5?f:u;if(l){var d=_g.number.decimal(t.timeline.time(),5);(d==0||d==1e-5)&&t.timeline.seek(f);var p=u}this.timeline.tweenTo(p,{onComplete:function(){h&&u==1e-5&&t.timeline.seek(1e-5),console.log("stop at "+t.timeline.time()),t.setSlideDisplay(e),t.onChangeSlideTo(e),t.onBindingChangeTo({type:1,delta:0})}})}else{t.useIndex?(t.indexTime=u,t.drawCanvas(t.img_src[e],e),t.autoplay&&(t.autoplay=!1,t.timeline.pause(u))):t.timeline.seek(u,!1);var v=Math.abs(this.timeline.time()/this.timeline.duration());t.useIndex||this.setSlideDisplay(e),this.onChangeSlideTo(e),this.onBindingChangeTo({type:1,delta:0})}},slideChangePatch:function(e,t){var n=this;if(e>0)for(i=n.currentIndex;i>t;i--)i<0&&(i=n.slidelength-1),i!=n.currentIndex&&n.onChangeSlideTo(i);if(e<0)for(i=n.currentIndex;i<t;i++)i>n.slidelength-1&&(i=0),i!=n.currentIndex&&n.onChangeSlideTo(i)},addControlClass:function(){var e=this.getdetail(),t=e.iSlidetype?e.iSlidetype:0;this.$el.children(".Element").addClass("iMouseWheel"),t=="æ¨ªå"||Number(t)==0?this.$el.children(".Element").addClass("enableMouseWheelX disableDragX"):this.$el.children(".Element").addClass("enableMouseWheelY disableDragY")},removeControlClass:function(){this.$el.children(".Element").removeClass("iMouseWheel").removeClass("enableMouseWheelX disableDragX").removeClass("enableMouseWheelY disableDragY")},control:function(){if(this.controled){this.canSlip?this.addControlClass():this.removeControlClass();return}var e=_g.touch.support,t="touchstart",n="touchmove",r="touchend";eCancel="touchcancel";var i=this,s=this.getdetail(),o=0,u=0,a;this.indexTime=0;var f=0,l=0,c=0,h,p=0,d=!1,v=!1,m=null,g=null,y=null,b=this.$el.children(".Element").width(),w=s.iSlidetype?s.iSlidetype:0,E=this.timeline.duration(),S=w=="æ¨ªå"||Number(w)==0?0:1;this.repeat?a=this.singletime=E/this.slidelength:a=this.singletime=E/(this.slidelength-1);var x=this.repeat,T=function(e){if(i.model.get("iType")=="Slide"&&!i.canSlip)return;h=0,p=0,i.autoplay&&(i.indexTime=i.timeline.time()),i.useIndex?o=i.indexTime:o=i.timeline.time(),d=!0,y=i.slideel.children(":visible").first().index(),console.log("control start")},N=function(e,t,n){if(i.model.get("iType")=="Slide"&&!i.canSlip)return;i.useIndex||i.setSlideDisplayAll(),e>E&&(x?e-=E:(p+=1,p>5&&i.model.get("iSlideNumber")&&(S==0?i.$el.children(".Element").addClass("is_exceededX"):i.$el.children(".Element").addClass("is_exceededY")),e=E)),e<0&&(x?e=E+e:(p+=1,console.log(E-e),p>5&&i.model.get("iSlideNumber")&&(S==0?i.$el.children(".Element").addClass("is_exceededX"):i.$el.children(".Element").addClass("is_exceededY")),e=1e-5));var r=e/E;i.onBindingChangeTo({type:0,delta:t,deltarate:r,cdirection:S});if(i.model.get("iType")=="CycleImage"){var s=parseInt(e/a);s>i.slidelength-1&&(s=0);if(s==i.currentIndex)return e;n||i.slideChangePatch(t,s),i.onChangeSlideTo(s)}return console.log(e),i.useIndex?(i.indexTime=e,i.drawCanvas(i.img_src[s],s),i.autoplay&&(i.autoplay=!1,i.timeline.pause(o))):i.timeline.seek(e),e},C=function(e){if(i.model.get("iType")=="Slide"&&!i.canSlip)return;if(i.model.get("iType")=="CycleImage")return;var t;i.useIndex?o=i.indexTime:o=i.timeline.time(),i.model.get("iType")!="CycleImage"?(o==1e-5&&(o=0),o/a-parseInt(o/a,10)<.2?(o=parseInt(o/a,10)*a,t=parseInt(o/a,10)):o/a-parseInt(o/a,10)>.8?(o=(parseInt(o/a,10)+1)*a,t=parseInt(o/a,10)):(o=parseInt(o/a,10)*a,t=parseInt(o/a,10),e<0&&o<E&&(o+=a,t+=1)),o=Math.round(o/a)*a+1e-5):t=parseInt(o/a,10),console.log("final time is"+o),o==0&&(o=1e-5),t>i.slidelength-1&&(t=0),i.useIndex?(i.drawCanvas(i.img_src[t],t),i.onChangeSlideTo(t),i.onBindingChangeTo({type:1,delta:e})):i.timeline.tweenTo(o,{onComplete:function(){i.useIndex||i.setSlideDisplay(t),i.onChangeSlideTo(t),i.onBindingChangeTo({type:1,delta:e})}})};if(_g.touch.support){var k,L,A;this.$el.children(".Element").on(t,function(e){e=e.originalEvent.touches[0];if(!i.testControl(e.target))return!1;if($(this).hasClass("is_exceededX")||$(this).hasClass("is_exceededY"))return;m=f=e.pageX,g=l=e.pageY,k=e.pageX,L=e.pageY,A=!0;var t=e.target;u=0,T(),setTimeout(function(){k===f&&!A&&L===l&&$(t).trigger("click")},200)}),this.$el.children(".Element").on(n,function(e){e=e.originalEvent.touches[0];if($(this).hasClass("is_exceededX")||$(this).hasClass("is_exceededY")){d=!1;return}if(d&&m!=null){h=w=="æ¨ªå"||Number(w)==0?e.pageX-m:e.pageY-g,c=w=="æ¨ªå"||Number(w)==0?e.pageX-f:e.pageY-l,moveOppositeDirection=w=="æ¨ªå"||Number(w)==0?e.pageY-l:e.pageX-f,console.log("direction"+c),console.log("oppsite"+moveOppositeDirection);if(Math.abs(c)<=2&&Math.abs(moveOppositeDirection)>12){var t=w=="æ¨ªå"||Number(w)==0?"is_exceededX":"is_exceededY";$(this).addClass(t);return}f=e.pageX,l=e.pageY;if(h==0)return;return i.model.get("iType")=="CycleImage"?u=o-h/b*E:u=o-h/b*a,N(u,c),!1}}),this.$el.children(".Element").on(r,function(e){e=e.originalEvent.touches[0],A=!1;if(d)return h!=0?(C(h),$(Reveal.options.containment).hammer("reset")):(i.setSlideDisplay(y),interaction_view.ismobile&&i.$el.children(".Element").trigger("click")),d=!1,console.log("control stop"),$(Reveal.options.containment).hammer().trigger("dragend"),!1;$(this).removeClass("is_exceededX"),$(this).removeClass("is_exceededY"),p=0}),this.$el.children(".Element").on(eCancel,function(e){e=e.originalEvent.touches[0];if(d)return h!=0?(C(h),$(Reveal.options.containment).hammer("reset")):i.setSlideDisplay(y),d=!1,console.log("control cancel"),!1;$(this).removeClass("is_exceededX"),$(this).removeClass("is_exceededY"),p=0})}this.$el.children(".Element").on("mousedown",function(e){if(!i.testControl(e.target))return!1;if($(this).hasClass("is_exceededX")||$(this).hasClass("is_exceededY"))return;u=0,m=f=e.pageX,g=l=e.pageY,T()}),this.$el.children(".Element").on("mousemove",function(e){if($(this).hasClass("is_exceededX")||$(this).hasClass("is_exceededY")){d=!1;return}if(d&&m!=null){h=w=="æ¨ªå"||Number(w)==0?e.pageX-m:e.pageY-g,c=w=="æ¨ªå"||Number(w)==0?e.pageX-f:e.pageY-l,f=e.pageX,l=e.pageY;if(h==0)return;return i.model.get("iType")=="CycleImage"?u=o-h/b*E:u=o-h/b*a,N(u,c),e.preventDefault(),!1}}),this.$el.children(".Element").on("mouseup",function(e){if(d)return h!=0?(C(h),e.preventDefault(),e.stopPropagation(),$(Reveal.options.containment).hammer("reset")):(i.setSlideDisplay(y),$(e.currentTarget).trigger("click")),d=!1,console.log("control stop"),!1;$(this).removeClass("is_exceededX"),$(this).removeClass("is_exceededY"),p=0}),this.$el.children(".Element").on("mouseleave",function(e){if(d)return h!=0?(C(h),e.preventDefault(),$(Reveal.options.containment).hammer("reset")):i.setSlideDisplay(y),d=!1,console.log("control cancel"),!1;$(this).removeClass("is_exceededX"),$(this).removeClass("is_exceededY"),p=0}),this.$el.children(".Element").on("wheelstart",function(e,t){if(!$(e.target).is(this))return;u=0,m=f=0,g=l=0,h=0,i.useIndex?o=i.indexTime:o=i.timeline.time(),y=i.slideel.children(":visible").first().index(),v=!0,console.log("control start")}),this.$el.children(".Element").on("wheelmove",function(e,t){if(!$(e.target).is(this))return;if(!v)return!1;var n=_g.mousewheel.getMouseWheel(t),r=n.x,s=n.y;if(r==undefined&&s==undefined)return;var p=Math.max(-1,Math.min(1,r)),d=Math.max(-1,Math.min(1,s)),m=30;console.log("before currentX is "+f),f+=p*m,l+=d*m,console.log("after currentX is "+f),console.log("wheelX is"+p),h=w=="æ¨ªå"||Number(w)==0?p:d,console.log("control moving");var g=1;if(h){c=w=="æ¨ªå"||Number(w)==0?p:d;var y=w=="æ¨ªå"||Number(w)==0?f:l;if(y){i.model.get("iType")=="CycleImage"&&(g=i.slidelength>50?i.slidelength/50:1);var b=w=="æ¨ªå"||Number(w)==0?g*$(this).width():g*$(this).height();y>b&&(y=b),y<-b&&(y=-b),w=="æ¨ªå"||Number(w)==0?f=y:l=y,i.model.get("iType")=="CycleImage"?u=o-y/b*E:u=o-y/$(this).width()*a,N(u,c)}}}),this.$el.children(".Element").on("wheelend",function(e,t){if(!v)return!1;var n=w=="æ¨ªå"||Number(w)==0?f:l;C(n),console.log("control end"),f=l=0,v=!1});if(i.model.get("iType")=="CycleImage"&&s.iGravity){var O=i.slidelength>50?i.slidelength/50:1;_g.orientation.orientationEvents.push({scrollX:w=="æ¨ªå"||Number(w)==0,scrollY:w!="æ¨ªå"&&Number(w)!=0,page_id:i.model.iPageId,speed:1,func:function(e,t,n,r){if(interaction_view.currentPage==i.model.iPageId){var s=i.$el.children(".Element"),a=w=="æ¨ªå"||Number(w)==0?e:t;if(!a)return;a=parseInt(a),deltaend=-a;var f=w=="æ¨ªå"||Number(w)==0?O*s.width():O*s.height();u=o-deltaend/f*E,console.log(u),i.indexTime=o=N(u,a,!0)}}})}this.controled=!0},getParamsForFade:function(e){param.opacity=1,param1.opacity=0},getParamsForSlide:function(e){var t=this.getdetail(),n=t.iSlidetype?t.iSlidetype:0,r=this.slideel.children('[data-index="'+e+'"]');_.include(["Slide","Gallery","CycleImage"],this.model.get("iType"))&&(r=this.slideel);var i={ease:"Linear.easeNone"},s={ease:"Linear.easeNone"};return n=="æ¨ªå"||Number(n)==0?(i.opacity=1,i.left="-100%",s.left="100%",s.opacity=1):(i.opacity=1,i.top="-"+r.css("height"),s.top=r.css("height"),s.opacity=1),{param:i,param1:s}},getParamsForSlip:function(e){return param},getSlideDuration:function(){var e=this.getdetail(),t;return this.slidelength==0?0:(this.model.get("iType")!="CycleImage"?t=(this.delay+.50002)*this.slidelength:t=(this.delay+2e-5)*this.slidelength,t)},onShow:function(){this.model.get("iSlideNumber")&&this.setSlideNumberDisplay(),_.include(["Slide","LayerSlide"],this.model.get("iType"))&&this.autoplay&&this.playTimeline(),_.include(["PageIndex","Gallery","Grid"],this.model.get("iType"))&&this.resetOtherStatus(),this.otherOnShow&&this.otherOnShow()},onBeforeHide:function(){_.include(["Slide","LayerSlide"],this.model.get("iType"))&&this.timeline&&(this.timeline.paused()||this.timeline.pause())},onHide:function(){this.model.get("iSlideNumber")&&this.setSlideNumberDisplay()},loadSubOverlay:function(e){var t=require("interaction_view/view/subcontainer");t=_g.mvc.createView(t),this.subview=new t({model:this.model}),this.preloadmodel=e,this.subview.afterload()},clearPreload:function(){this.$el.children(".Element").length&&this.$el.children(".Element").find("img").each(function(){$(this).attr("src","")})}})}},window.iOverlaylist=new interaction_view.collection.Base,interaction_view.iOverlaylist=new interaction_view.collection.list,interaction_view.currentPage=null}),define("interaction_view/model/action",["interaction_view/model/base"],function(){interaction_view.model.Action=interaction_view.model.Base.extend({defaults:{page_id:null,ref_id:null,index:null,layer_id:null,overlay_id:null},setcollection:function(){},setview:function(e){this.pageid=this.get("pageid"),this.parentpageid=this.get("parentpageid"),this.iPage_id=this.pageid,this.app_id=this.get("app_id");if(this.get("pagetype")=="LayerRef"){var t=this.get("parentpageid"),n=this.get("layerid"),r=interaction_view.getParentpage(t);this.parentpage=r,this.page=r.iOverlaylist.get(this.pageid).layer[n],this.iPage_id=t}else this.get("path")?(this.path=this.get("path"),this.page=interaction_view.getContainerModelByPath(this.path)):this.page=interaction_view.getParentpage(this.pageid);this.iview=new interaction_view.view.Action({model:this})},setsyncmodel:function(){},actionpatch:function(){var e=this,t=this.get("iDetail");this.get("pagetype")=="LayerRef"&&(this.get("layer_id")||this.set("layer_id",this.get("layerid"))),t.results[0].iAction!=5&&t.results[0].iAction<7&&(t.results[0].iAction==6&&typeof t.results[0].values=="string"&&(t.results[0].values=[{id:t.results[0].values,page_id:e.pageid}]),t.results[0].values=_.map(t.results[0].values,function(t){return typeof t!="object"?{id:t,page_id:e.pageid}:t})),this.set("iDetail",t)}}),interaction_view.collection.Action=interaction_view.collection.Base.extend({initialize:function(){this.setonadd(),this.setonremove()},model:interaction_view.model.Action,setonadd:function(){this.on("add",function(e){})},onSingleComplete:function(){},onUpdate:function(){},onTotalComplete:function(){},resetStatus:function(){this.each(function(e){e.iview.resetStatus()})}}),interaction_view.view.Action=interaction_view.view.Base.extend({initstart:function(){},renderanimations:function(){this.timeline&&this.timeline.kill()&&this.timeline.clear(!0);var e=this,t=this.model.toJSON(),n=this.values;n&&n.length&&(e.timeline=animate.generateTimeline({onStart:null,ids:n,iPage_id:this.model.iPage_id,page:this.model.page,paused:!0,foraction:!0}),e.timeline&&e.timeline.play(0))},onComplete:function(){},events:{},renderDynamicElement:function(){},getClassification:function(){if(!this.ref_id){if(_.isNumber(this.index)&&this.overlaymodel)return 4;if(this.animation_id)return 5;if(!_.isNumber(this.index)&&this.overlaymodel)return 1;if(!this.overlaymodel){if(this.overlay_id==this.model.page.id)return 2;if(interaction_view.ilayerlist.get(this.overlay_id)||interaction_view.iComponentlist.get(this.overlay_id))return 3}}if(this.ref_id&&this.model.get("pagetype")=="LayerRef"&&this.model.pageid==this.ref_id&&this.model.parentpageid==this.page_id){if(_.isNumber(this.index)&&this.overlaymodel)return 4;if(this.animation_id)return 5;if(!_.isNumber(this.index)&&this.overlaymodel)return 1;if(!this.overlaymodel){if(this.overlay_id==this.model.page.id)return 2;if(interaction_view.ilayerlist.get(this.overlay_id)||interaction_view.iComponentlist.get(this.overlay_id))return 3}}return 0},render:function(){this.app_id=this.model.toJSON().app_id,this.iType=this.model.toJSON().iType,this.overlay_id=this.model.toJSON().overlay_id,this.page_id=this.model.toJSON().page_id,this.ref_id=this.model.toJSON().ref_id,this.index=this.model.toJSON().index,this.animation_id=this.model.toJSON().animation_id,this.layer_id=this.model.toJSON().layer_id;var e=this.model.toJSON().iDetail;if(!e||!e.results)return;var t=this;this.actiontype=e.results[0].iAction,this.values=e.results[0].values;if(this.app_id){this.renderforapplication();return}if(this.iType==120)return;this.overlaymodel=this.model.page.iOverlaylist.get(this.overlay_id);var n=this.getClassification();if(!n)return;switch(n){case 1:this.renderforoverlay();break;case 2:this.renderforpage();break;case 3:this.renderforlayer();break;case 4:this.renderforslideindex();break;case 5:this.renderforanimationaction()}this.preloadactions=[],this.actiontype==101&&(this.preloadactions=e.results[0].iActionDetail?e.results[0].iActionDetail.actions||[]:[],this.preloadactions.length&&(this.preload_hash="pre_"+_g.uuid(3),_e.preloadpage.renderActions(this.preloadactions,this.preload_hash)))},renderforoverlay:function(){var e=this,t={type:this.iType,page_id:this.page_id,overlay_id:this.overlay_id,layer_id:this.layer_id,func:function(){e.executeAction(e)}};switch(this.iType){case 8:case 9:case 10:case 11:case 12:t.drop_type=this.iType,t.path=this.path,_.include([11,12],this.iType)?(t.type="dragdropgroup",interaction_view.events.dragDropGroupEvents.push(t)):(t.type="dragdrop",interaction_view.events.dragDropEvents.push(t));break;case 18:case 19:case 16:case 17:t.condition=String(this.model.attributes.condition),interaction_view.events.timerEvents.push(t);break;case 22:t.condition=String(this.model.attributes.condition),interaction_view.events.variableEvents.push(t);break;case 23:interaction_view.events.voteEvents.push(t);break;case 54:interaction_view.events.paragraphEvents.push(t);break;case 41:interaction_view.events.eraserEvents.push(t);break;case 71:case 72:interaction_view.events.WeixinCameraEvents.push(t);break;case 73:interaction_view.events.collisionEvents.push(t);break;case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:interaction_view.events.userListEvents.push(t);break;case 82:case 83:interaction_view.events.contactFormEvents.push(t);break;case 100:case 101:case 102:case 103:case 104:case 105:case 110:case 111:interaction_view.events.systemVariableEvents.push(t);break;default:var n="tap",r=this.overlaymodel.iview.$el;if(this.iType==20)n="mouseenter";else if(this.iType==21)n="mouseleave";else if(this.iType==14||this.iType==15)n="hold";this.overlaymodel.iview.$el.css("cursor","pointer"),this.overlaymodel.iview.$el.addClass("hasaction"),_.include(["Slide","LayerSlide","CycleImage","Vote"],this.overlaymodel.iview.iType)&&(r=r.children(".Element")),_.include(["Button"],this.overlaymodel.iview.iType)&&console.log("button"),this.iType==1&&(r=this.overlaymodel.iview.$el.find("img.iconNormal")),this.iType==2&&(r=this.overlaymodel.iview.$el.find("img.iconActive"));if(!r)return;if(!r.hammer)return;r.hammer().on(n,function(t){if(e.iType==0&&_.include(["Paragraph"],e.overlaymodel.iview.iType)&&interaction_view.environment.Paragraph.state()&&!e.overlaymodel.attributes.iDetail.iStaticImage)return!1;if(_.include(["Slide","LayerSlide","CycleImage","Button","Vote"],e.overlaymodel.iview.iType)&&e.overlaymodel.iview.slipable&&!$(t.target).is(t.currentTarget))return!1;if(e.iType==15){var r=!1;$(document).one("mouseup touchend touchcancel",function(){!r&&e.executeAction(e)&&(r=!0)})}else e.executeAction(e);if(n=="hold")return t.gesture.preventDefault(),!1})}},renderforanimationaction:function(){var e=this,t=this.model.page.iAnimationlist.get(this.animation_id);if(t){var n={type:"animation",page_id:this.page_id,overlay_id:this.overlay_id,animation_id:this.animation_id,path:this.path,layer_id:this.layer_id,func:function(){e.executeAction(e)}};this.iType==6&&interaction_view.events.animationStartEvents.push(n),this.iType==7&&interaction_view.events.animationEndEvents.push(n)}},renderforlayer:function(){var e=this,t=this.model.get("layerid"),n=this.model.parentpage.iOverlaylist.get(this.model.get("pageid")).toJSON().iDetail.layer_ids.indexOf(t);if(n==-1)return!1;this.iType==0&&this.model.parentpage&&this.model.parentpage.iOverlaylist.get(this.model.get("pageid")).iview.$el.children(".Element").on("click",function(t){if(!$(t.target).is(t.currentTarget)&&$(t.currentTarget).find(".layer-content").first().children().length>1)return!1;e.model.parentpage.iOverlaylist.get(e.model.get("pageid")).iview.currentIndex==n&&e.testControlforLayer(t)&&e.executeAction(e)}),this.iType==3&&interaction_view.events.pageStartEvents.push({type:"page",page_id:e.model.pageid,layer_id:this.model.get("layerid"),func:function(){e.executeAction(e)}}),this.iType==4&&this.model.parentpage&&(this.model.parentpage.iOverlaylist.get(this.model.get("pageid")).iview.$el.addClass("hasDblClick"),this.model.parentpage.iOverlaylist.get(this.model.get("pageid")).iview.$el.children(".Element").on("dblclick",function(t){if($(t.target).closest(".layer-item").index()!=e.model.parentpage.iOverlaylist.get(e.model.get("pageid")).iview.currentIndex)return;e.model.parentpage.iOverlaylist.get(e.model.get("pageid")).iview.currentIndex==n&&e.testControlforLayer(t)&&e.executeAction(e)}),interaction_view.touchview&&this.model.parentpage.iOverlaylist.get(this.model.get("pageid")).iview.$el.children(".Element").hammer().on("doubletap",function(t){if($(t.target).closest(".layer-item").index()!=e.model.parentpage.iOverlaylist.get(e.model.get("pageid")).iview.currentIndex)return;e.model.parentpage.iOverlaylist.get(e.model.get("pageid")).iview.currentIndex==n&&e.testControlforLayer(t)&&e.executeAction(e)}))},renderforpage:function(){var e=this;this.iType==0&&interaction_view.events.pageClickEvents.push({type:interaction_view.getPageType(e),page_id:e.model.page.id,func:function(){e.executeAction(e)}}),this.iType==3&&interaction_view.events.pageStartEvents.push({type:"page",page_id:e.model.page.id,func:function(){e.executeAction(e)}}),this.iType==4&&interaction_view.events.pageDblClickEvents.push({type:interaction_view.getPageType(e),page_id:e.model.page.id,func:function(){e.executeAction(e)}}),this.iType==51&&interaction_view.events.pageWXShareSuccessEvents.push({type:interaction_view.getPageType(e),page_id:e.model.page.id,func:function(){e.executeAction(e)}}),_.include([36,37,38,39],this.iType)&&interaction_view.events.pageSwipeEvents.push({type:interaction_view.imasterlist.length&&e.model.page.id==interaction_view.imasterlist.at(0).id?"master":"page",page_id:e.model.page.id,func:function(){e.executeAction(e)},swipeType:this.iType}),_.include([40],this.iType)&&interaction_view.events.pageShakeEvents.push({type:interaction_view.imasterlist.length&&e.model.page.id==interaction_view.imasterlist.at(0).id?"master":"page",page_id:e.model.page.id,func:function(){e.executeAction(e)}})},renderforslideindex:function(){this.overlaymodel.iview.iType!="CycleImage"&&this.overlaymodel.iview.iType!="Slide";if(!(this.overlaymodel.iview.slideel&&this.overlaymodel.iview.slidelength>0&&this.overlaymodel.iview.slidelength>this.index))return!1;var e=this;this.iType==0&&(this.overlaymodel.iview.slideel.find('[data-index="'+this.index+'"]').addClass("hasaction"),this.overlaymodel.iview.useIndex&&this.overlaymodel.iview.$el.children(".Element").addClass("hasaction"),this.overlaymodel.iview.detail.iFade=="Flow"?this.overlaymodel.iview.slideel.find('[data-index="'+this.index+'"]').hammer().on("tap",function(t){e.overlaymodel.iview.currentIndex==e.index&&!e.overlaymodel.iview.CoverFlow.data("CoverFlowDisableClick")&&setTimeout(function(){e.executeAction(e)},300)}):this.overlaymodel.iview.$el.children(".Element").on("click",function(t){if(e.overlaymodel.iview.slipable&&!$(t.target).is(t.currentTarget))return!1;e.overlaymodel.iview.currentIndex==e.index&&setTimeout(function(){e.executeAction(e)},300)})),this.iType==5&&interaction_view.events.elementChangeToEvents.push({type:"slide",page_id:e.model.pageid,overlay_id:this.overlaymodel.id,index:this.index,func:function(){e.executeAction(e)}}),this.iType==4&&(this.overlaymodel.iview.$el.addClass("hasDblClick"),this.overlaymodel.iview.useIndex?(this.overlaymodel.iview.$el.children(".Element").on("dblclick",function(t){e.overlaymodel.iview.currentIndex==e.index&&e.executeAction(e)}),interaction_view.ismobile&&this.overlaymodel.iview.$el.children(".Element").hammer().on("doubletap",function(t){e.overlaymodel.iview.currentIndex==e.index&&e.executeAction(e)})):(this.overlaymodel.iview.slideel.find('[data-index="'+this.index+'"]').on("dblclick",function(t){e.executeAction(e)}),interaction_view.ismobile&&this.overlaymodel.iview.slideel.find('[data-index="'+this.index+'"]').hammer().on("doubletap",function(t){e.executeAction(e)})))},renderforapplication:function(){var e=this;this.iType==70&&interaction_view.events.formSubmitEvents.push({type:70,id:this.app_id,func:function(){e.executeAction(e)}})},executeAction:function(e){if(typeof Reveal!="undefined"&&Reveal&&Reveal.isOverview()&&e.iType!=3)return!1;e.actiontype==0&&e.renderanimations(),e.actiontype==1&&e.rendershow(),e.actiontype==2&&e.renderhide(),e.actiontype==6&&e.setElementTo(),e.actiontype==5&&(interaction_view.foredit?global.message("warning","è¯·ä½¿ç¨é¢è§å¨é¨æ¨¡å¼é¢è§è¯¥åè½"):e.renderpage()),e.actiontype==7&&(interaction_view.foredit?global.message("warning","è¯·ä½¿ç¨é¢è§å¨é¨æ¨¡å¼é¢è§è¯¥åè½"):e.renderoverview()),e.actiontype==8&&(interaction_view.foredit?global.message("warning","è¯·ä½¿ç¨é¢è§å¨é¨æ¨¡å¼é¢è§è¯¥åè½"):e.rendershare()),e.actiontype==10&&(interaction_view.foredit?global.message("warning","è¯·ä½¿ç¨é¢è§å¨é¨æ¨¡å¼é¢è§è¯¥åè½"):e.renderurl()),e.actiontype==16&&(interaction_view.foredit?global.message("warning","è¯·ä½¿ç¨é¢è§å¨é¨æ¨¡å¼é¢è§è¯¥åè½"):e.rendertel());if(e.actiontype==15&&_g.device.android()&&window.collecting&&window.collecting.startFunction){var t=interaction_view.currentPage,n=interaction_view.ipagelist.getPage(t);if(!n)return;var r=n.toJSON().nav&&n.toJSON().nav.thumbnail?n.toJSON().nav.thumbnail:null,i=interaction_view.doc.toJSON().title;window.collecting.startFunction(i,r,t)}this.overlaymodel&&this.overlaymodel.toJSON().iType=="Button"&&this.overlaymodel.get("isTabBarButton")&&this.syncTabButtons(),_.include([17,18,19,20,21,52,53,60,72,73,100],e.actiontype)&&e.renderNormal(e.actiontype),_.include([50],e.actiontype)&&e.renderWXShareImg(),_.include([51],e.actiontype)&&e.renderWXShare(e.actiontype),_.include([56,57],e.actiontype)&&e.renderParagraph(e.actiontype),_.include([58],e.actiontype)&&e.setButtonToActive(e.actiontype),e.actiontype==70&&window.setTimeout(function(){e.submitForm(e.actiontype)},500),e.actiontype==71&&e.setFormValue(e.actiontype),_.include([59],e.actiontype)&&e.renderreplaceresource(),e.actiontype==61&&e.playElementTo(),e.actiontype==80&&(interaction_view.foredit?interaction.message("warning","è¯·ä½¿ç¨é¢è§å¨é¨æ¨¡å¼é¢è§è¯¥åè½"):e.renderSharePage()),e.actiontype==90&&(interaction_view.foredit?interaction.message("warning","è¯·ä½¿ç¨é¢è§å¨é¨æ¨¡å¼é¢è§è¯¥åè½"):e.renderEvents()),e.actiontype==110&&(interaction_view.foredit?interaction.message("warning","è¯·ä½¿ç¨é¢è§å¨é¨æ¨¡å¼é¢è§è¯¥åè½"):e.renderJS()),e.actiontype==101&&(interaction_view.foredit?interaction.message("warning","è¯·ä½¿ç¨é¢è§å¨é¨æ¨¡å¼é¢è§è¯¥åè½"):e.renderPreloadPages())},rendershare:function(){interaction_view.ismobile||share(interaction_view.doc.toJSON().title,context_url+"/player")},renderoverview:function(){Reveal.toggleOverview(!0)},renderclick:function(){},rendershow:function(){var e=this,t=this.values;t&&_.each(t,function(t){var n=t.page_id,r=interaction_view.getAnimationPage(n,e.model.page),i=r.iOverlaylist.get(t.id);i&&i.iview&&i.iview.$el&&(i.iview.onBeforeShow&&i.iview.onBeforeShow(),i.iview.$el.removeClass("hide"),i.iview.onShow&&i.iview.onShow())})},renderhide:function(){var e=this,t=this.values;t&&_.each(t,function(t){var n=t.page_id,r=interaction_view.getAnimationPage(n,e.model.page),i=r.iOverlaylist.get(t.id);i&&i.iview&&i.iview.$el&&(i.iview.onBeforeHide&&i.iview.onBeforeHide(),i.iview.$el.addClass("hide"),i.iview.onHide&&i.iview.onHide())})},renderpage:function(){var e=this.model.toJSON().iDetail,t=this.values,n=e.results[0].iActionDetail?e.results[0].iActionDetail.transition:0,r=null,i=null,n=e.results[0].iActionDetail?e.results[0].iActionDetail.transition?e.results[0].iActionDetail.transition:0:0,s=interaction_view.getVarsOp(interaction_view.currentPage,[0,2]);if(s.beginWithAT(t)){var o=interaction_view.ipagelist.length;t=Math.round(s.var2val(t)),t<0&&(t=0),t>o-1&&(t=o-1),t=interaction_view.ipagelist.getPages()[t]?interaction_view.ipagelist.getPages()[t].id:null}if(n==0||n)if(!_.include(["first","last","prev","next"],t)){var u=interaction_view.ipagelist.getPage(t);u&&(n<4?interaction_view.ipagelist.getPage(t).iview.$el.attr("data-transition","linear"):n<8?interaction_view.ipagelist.getPage(t).iview.$el.attr("data-transition","page"):n==8?interaction_view.ipagelist.getPage(t).iview.$el.attr("data-transition","fade"):interaction_view.ipagelist.getPage(t).iview.$el.removeAttr("data-transition"))}var a=interaction_view.ipagelist.length;switch(t){case"first":t=Reveal.getFirst();break;case"last":t=Reveal.getLast();break;case"prev":t=Reveal.getPrev();break;case"next":t=Reveal.getNext();break;default:}t&&presentation.gotopage(t,n)},renderSharePage:function(){var e=this.model.toJSON().iDetail,t=this.values,n=t||"first";if(n=="current"||interaction_view.share_page_id!=n)interaction_view.share_page_id=n,interaction_view.weixin.share()},renderurl:function(){if(this.values.length==0||_.isEmpty(this.values[0].url))return;var e=this.values[0].url,t;t=e.match(/(http:\/\/|https:\/\/)([\w.:]+)/);if(e.indexOf("@")==0){window.open(e,"_blank");return}if(["/","."].indexOf(e[0])>-1){window.location.href=e;return}if(t&&t.length>2&&t[2]==window.location.host){window.location.href=e;return}e.indexOf("://")==-1&&(e="http://"+e),window.location.href.indexOf("query_string")>0&&(e+=e.indexOf("?")>=0&&"&"+window.location.search.replace("?","")||window.location.search),t=e.match(/\w+:\/\//);if(t&&["https://","http://"].indexOf(e.match(/\w+:\/\//)[0])==-1){window.location.href=e;return}if(interaction_view.ismobile){var n=window.location.href;n=_g.changeURLPar(n,"return","1"),window.history.pushState({},"",n),window.location.href=e}else window.open(e,"_blank");return},rendertel:function(){if(!interaction_view.ismobile)return;if(this.values.length==0||_.isEmpty(this.values[0].url))return;var e=this.values[0].url,t=interaction_view.getVarsOp(interaction_view.currentPage,[0,1,2],interaction_view.environment.Votes.get()),n=t.var2val(e,!0);window.location="tel:"+n},renderNormal:function(e){var t=this,n=this.values;n&&_.each(n,function(n){var r=n.page_id,i=interaction_view.getAnimationPage(r,t.model.page),s=i.iOverlaylist.get(n.id);if(s&&s.iview)switch(e){case 17:s.iview.startTimer();break;case 18:s.iview.stopTimerSimple();break;case 19:s.iview.resetTimer();break;case 20:if(s.iview.setVariable)s.iview.setVariable(n.oper,n.value);else if(s.iview.updateText){var o=interaction_view.getVarsOp(r,[0,1,2],interaction_view.environment.Votes.get());s.iview.updateText(o.var2val(n.value,!0),addtourl=1)}break;case 21:interaction_view.events.onVariableChanged(s.iview);break;case 52:interaction_view.media.play(s);break;case 53:interaction_view.media.pause(s);break;case 60:s.iview.activeEdit&&setTimeout(function(){s.iview.activeEdit(!0)},500);break;case 72:s.iview.getInfo();break;case 73:s.iview.postInfo();break;case 100:interaction_view.events.onSystemVariableChanged(s.iview)}})},renderWXShare:function(e){var t=this,n=this.values;if(n){var r=n.page_id,i=n.value;console.log("set sharing: "+i);if(_g.device.mobile()||_g.device.tablet()){var s=interaction_view.getVarsOp(r,[0,1,2],interaction_view.environment.Votes.get());i=s.var2val(i,!0)}i=i.replace(/<br>+/g,"\n").replace(/"+/g,"'").replace(/<\/div><div>/g,"\n").replace(/<div>/g,"").replace(/<\/div>/g,""),shareTitle=i,document.title=shareTitle,interaction_view.weixin.share()}},renderParagraph:function(e){switch(e){case 56:interaction_view.environment.Paragraph.enable();break;case 57:interaction_view.environment.Paragraph.disable()}},renderJS:function(){if(this.values.length==0||_.isEmpty(this.values[0].code))return;var code=_.unescape(this.values[0].code);eval(code)},setButtonToActive:function(){if(!this.values||this.values.length==0)return;var e=this,t=this.model.toJSON().iDetail,n=this.values[0].id,r=this.values[0].page_id,i=interaction_view.getAnimationPage(r,e.model.page);if(n){var s=i.iOverlaylist.get(n);s&&!s.iview.active&&s.iview.$el.find("img.iconNormal").length&&s.iview.$el.find("img.iconNormal").trigger("click")}},renderreplaceresource:function(){if(!this.values||this.values.length==0)return;var e=this,t,n=this.model.toJSON().iDetail;overlay_id=this.values[0]?this.values[0].id:"",pageid=this.values[0]?this.values[0].page_id:"",page=interaction_view.getAnimationPage(pageid,e.model.page);if(!overlay_id)return;t=page.iOverlaylist.get(overlay_id);if(!t)return;var r=t.get("iType"),i=n.results[0].iActionDetail?n.results[0].iActionDetail.replace:null,s=n.results[0].iActionDetail?n.results[0].iActionDetail.url:null;if(!i)return;i==1&&r=="ImageBlock"&&(typeof wx_permissions!="undefined"&&wx_permissions.chooseImage?interaction_view.localIds?setTimeout(function(){t.iview.setweixinimage(interaction_view.localIds[0])},100):interaction_view.weixin.chooseimage(function(e){e&&(interaction_view.localIds=e,t.iview.setweixinimage(e[0]))}):_g.device.isWeixin()?interaction_view.errorAlert("å¼å¯å¾®ä¿¡åè½å¤±è´¥"):interaction_view.errorAlert("è¯·å¨å¾®ä¿¡ä¸­æä½"));if(i==2&&r=="Audio")if(typeof wx_permissions!="undefined"&&wx_permissions.startRecord){var o=function(){if(!interaction_view.voicelocalId)return;var e=t.iview.getdetail();if(t.voicelocalId==interaction_view.voicelocalId)return;interaction_view.voiceUploader(interaction_view.voicelocalId,function(n){t.media&&(interaction_view.media.changeSrc(t,n),interaction_view.media.play(t)),t.voicelocalId=interaction_view.voicelocalId,t.voiceUrl=n,e.iFile[0].file=n,t.iview.addToUrl(n)})};interaction_view.voicelocalId?o(interaction_view.voicelocalId):interaction_view.voiceEditor(function(){o()})}else _g.device.isWeixin()?interaction_view.errorAlert("å¼å¯å¾®ä¿¡åè½å¤±è´¥"):interaction_view.errorAlert("è¯·å¨å¾®ä¿¡ä¸­æä½");if(i==3||i==4){if(!s)return;if(r=="ImageBlock"){var u=t.iview.$el.children(".Element").find("img"),a=t.iview.getdetail();s=="reset"?(typeof a.iImg[0].origin!="undefined"?(u.attr("src",a.iImg[0].origin),a.iImg[0].picture=a.iImg[0].origin):(u.attr("src",""),a.iImg[0].picture=""),typeof t.iview.removeFromUrl!="undefined"&&t.iview.removeFromUrl()):(u.attr("src",s),a.iImg[0].picture=s,t.iview.addToUrl(s,0,0,1,0))}else if(r=="Audio"){var a=t.iview.getdetail();t.media&&(interaction_view.media.changeSrc(t,s),interaction_view.media.play(t)),a.iFile[0].file=s,t.iview.addToUrl(s)}}if(i==5&&r=="ImageBlock"&&typeof epub360_userinfo!="undefined"){var u=t.iview.$el.children(".Element").find("img"),a=t.iview.getdetail(),s=epub360_userinfo.portrait;u.attr("src",s),a.iImg[0].picture=s,t.iview.addToUrl(s,0,0,1,0)}},renderWXShareImg:function(){var e=this,t=this.values;if(t){if(t[0].id=="å¾®ä¿¡å¤´å")typeof epub360_userinfo!="undefined"&&epub360_userinfo.portrait!=undefined&&(imgUrl=epub360_userinfo.portrait);else{var n=t[0].page_id,r=interaction_view.getAnimationPage(n,e.model.page),i=r.iOverlaylist.get(t[0].id);if(i&&i.iview&&i.iview.$el){var s=i.iview.$el.find("img");if(s.length>0){var o=s.attr("src");if(o.indexOf("http://")==0)imgUrl=o;else{var u=i.iview.getdetail();imgUrl=u.iImg[0].picture}}else{s=i.iview.$el.find(".bk_full");if(s.length>0){var a=s.css("background-image"),f=/\url\((\S+)\)/.exec(a);f!=null&&(imgUrl=f[1])}}}}interaction_view.weixin.share()}},renderEvents:function(){var e=this.values,t=this,n="www.epub360.com";current_host=window.location.host,current_host.indexOf("tu960")!=-1&&(n=current_host);if(e.length&&e[0].opt_label&&interaction_view.book_id){var r=e[0].opt_label,i=e[0].opt_action,s="http://"+n+"/manage/book/"+interaction_view.book_id+"/event.gif?opt_category=custom&opt_action="+i+"&opt_label="+r+"&t="+_g.uuid(),o=document.createElement("img");o.src=s,o.onload=function(){}}},setElementTo:function(){if(!this.values||this.values.length==0)return;var e=this,t=this.model.toJSON().iDetail,n=this.values[0].id,r=this.values[0].page_id,i=interaction_view.getAnimationPage(r,e.model.page),s=t.results[0].iActionDetail?t.results[0].iActionDetail.index:null,o=interaction_view.getVarsOp(r,[0,2]);o.beginWithAT(s)&&(s=o.var2val(s));if(n){var u=i.iOverlaylist.get(n);u&&u.iview&&u.iview.setElementTo(s)}if(this.overlaymodel&&this.overlaymodel.toJSON().iType=="Button"){var a=this.syncbuttons(i,this.model.toJSON().overlay_id,this.values[0]);a>0&&(this.overlaymodel.iview.groupcontrol=!0)}},playElementTo:function(){if(!this.values||this.values.length==0)return;var e=this,t=this.model.toJSON().iDetail,n=this.values[0].id,r=this.values[0].page_id,i=interaction_view.getAnimationPage(r,e.model.page),s=t.results[0].iActionDetail?t.results[0].iActionDetail.mode:0,o=t.results[0].iActionDetail?t.results[0].iActionDetail.repeat?-1:0:0,u=t.results[0].iActionDetail?t.results[0].iActionDetail.p_from:0,a=t.results[0].iActionDetail?t.results[0].iActionDetail.p_to:0;if(n){var f=i.iOverlaylist.get(n);if(f&&f.iview){s==4&&f.iview.timeline&&f.iview.timeline.pause();if(s==0||s==1){var l=f.toJSON().iDetail.iImg.length;if(!l)return;s==0?(f.iview._start=0,f.iview._end=l-1,f.iview.direction=0):(f.iview.direction=1,f.iview._start=l-1,f.iview._end=0),f.iview.autoplay=!0,f.iview.repeat=o;var c=f.iview._setCanvasLoopSwitch(!0);f.iview.timeline.play(c)}if(s==2){f.iview._start=u,f.iview._end=a,f.iview.direction=u-a>0?1:0,f.iview.autoplay=!0,f.iview.repeat=o;var c=f.iview._setCanvasLoopSwitch(!0);f.iview.timeline.play(c)}if(s==3){f.iview.currentIndex||(f.iview.currentIndex=0),f.iview._start=f.iview.currentIndex,f.iview._end=a,f.iview.direction=f.iview.currentIndex-a>0?1:0,f.iview.autoplay=!0,f.iview.repeat=o;var c=f.iview._setCanvasLoopSwitch(!0);f.iview.timeline.play(c)}}}},syncbuttons:function(e,t,n){var r=this,i=0,s=_.filter(this.model.page.iActionlist.toJSON(),function(e){return r.model.page.iOverlaylist.get(e.overlay_id)&&r.model.page.iOverlaylist.get(e.overlay_id).get("iType")=="Button"&&e.iDetail.results[0].iAction==6});return _.each(s,function(e){if(e.overlay_id!=t){var s=r.model.page.iOverlaylist.get(e.overlay_id);s&&s.toJSON().iDetail.isSwitch&&e.iDetail.results&&e.iDetail.results[0].values[0].id==n.id&&e.iDetail.results[0].values[0].page_id==n.page_id&&(i+=1,s.iview.resetButtonStatus())}}),i},syncTabButtons:function(){var e=this,t=this.overlaymodel.get("path"),n=interaction_view.getContainerModelByPath(t);n.iOverlaylist.each(function(t){t.id!=e.overlaymodel.id&&t.iview.resetButtonStatus()})},resetStatus:function(){this.overlaymodel.iview.$el.off("click")},testControlforLayer:function(e){var t=$(e.target).closest(".iView");if($(e.target).closest(".iView").hasClass("hasaction"))return!1;if(t){var n=t.attr("data-type");if(n=="Slide"||n=="CycleImage")if(t.attr("data-iSlipable"))return!1}return!0},submitForm:function(){var e=this;if(!this.values)return!1;interaction_view.application.submitForm(this.values)},setFormValue:function(){var e=this,t=this.model.toJSON().iDetail;VarOPobj=interaction_view.getVarsOp(this.page_id,[0,1,2]);if(!this.values)return!1;var n=t.results[0].cid,r=t.results[0].vT,i=t.results[0].vV;i=VarOPobj.var2val(i,!0),interaction_view.application.setFormData(this.values,n,Number(r),i)},renderPreloadPages:function(){var e=this;if(!this.values&&!this.values.length)return;var t=this.model.toJSON().iDetail;_e.preloadpage.preload(this.values,this.preload_hash)}}),interaction_view.iActionlist=new interaction_view.collection.Action}),define("interaction_view/model/animation_view",["interaction_view/model/base"],function(){interaction_view.model.Animation=interaction_view.model.Base.extend({defaults:{},setcollection:function(){},setmodel:function(){}}),interaction_view.collection.Animation=interaction_view.collection.Base.extend({initialize:function(){},model:interaction_view.model.Animation,setonadd:function(){this.on("add",function(e){})},setParams:function(e){this.repeatTweens=[];if(this.where({iKind:0}).length==0)return;var t=this;this.cssAnimations=[],this.Animations=[],this.each(function(e){e.tween=null;var n=e.toJSON();if(n.iType>0&&n.iType<100){t.cssAnimations.push(n);return}if(n.iKind==0&&!t.page.iOverlaylist.get(n.overlay_id))return;t.Animations.push(e),e._animation=new animation({collection:t,animation:e.toJSON()})});if(this.cssAnimations.length&&typeof Animate!="undefined"){this.cssitems=[];for(var n=0;n<this.cssAnimations.length;n++){var r=t.page.iOverlaylist.get(this.cssAnimations[n].overlay_id);if(r){var i={el:r.iview.$el.children(".Element"),type:this.cssAnimations[n].iType,delay:this.cssAnimations[n].iTiming.delay,duration:this.cssAnimations[n].iTiming.duration,repeat:this.cssAnimations[n].iTiming.repeat,onShow:r.iview.onShow};this.cssitems.push(i)}}this.css_timeline=new Animate({items:this.cssitems})}},setPlay:function(e){if(!this.Animations||this.Animations.length==0)return;var t=this,n=function(){};this.timeline=animate.generateTimeline({onStart:n,animations:this.Animations,iPage_id:this.iPage_id,page:this.page,paused:!0})},play:function(){if(this.length==0)return;this.setPlay(),this.timeline&&this.timeline.play(0)},playMain:function(){if(this.length==0)return;this.setParams(),this.setPlay(),this.timeline&&this.timeline.play(0,!1),this.afterTimeLineCreated&&this.afterTimeLineCreated()},AddClickTween:function(e,t,n,r){if(interaction_view.SinglePreview)return;e.pause(r),console.log(r),$('section[id="'+t+'"]').children(".interaction-view").css("cursor","pointer"),interaction_view.events.pageClickEvents.push({type:"waitaction",page_id:t,func:function(){console.log(n),_.include([101,102,103,104],n.attributes.iType)&&(n.attributes.iTiming.delay?_g.device.android()&&n.attributes.iType==101&&window.setTimeout(function(){n._animation.showelement()},n.attributes.iTiming.delay):n._animation.showelement()),$('section[id="'+t+'"]').children(".interaction-view").css("cursor","auto"),e.resume()}})},AddPageSwipeTween:function(e,t,n,r,i){if(interaction_view.SinglePreview)return;console.log(i),e.pause(i),$('section[id="'+t+'"]').children(".interaction-view").css("cursor","pointer"),interaction_view.events.pageSwipeEvents.push({type:"waitaction",page_id:t,func:function(){_.include([101,102,103,104],r.attributes.iType)&&(r.attributes.iTiming.delay?_g.device.android()&&r.attributes.iType==101&&window.setTimeout(function(){r._animation.showelement()},r.attributes.iTiming.delay):r._animation.showelement()),$('section[id="'+t+'"]').children(".interaction-view").css("cursor","auto"),e.resume()},swipeType:n+33})},AddPageShakeTween:function(e,t,n,r,i){if(interaction_view.SinglePreview)return;console.log(i),e.pause(i),interaction_view.events.pageShakeEvents.push({type:"waitaction",page_id:t,func:function(){_.include([101,102,103,104],r.attributes.iType)&&(r.attributes.iTiming.delay?_g.device.android()&&r.attributes.iType==101&&window.setTimeout(function(){r._animation.showelement()},r.attributes.iTiming.delay):r._animation.showelement()),$('section[id="'+t+'"]').children(".interaction-view").css("cursor","auto"),e.resume()}})},AddRepeatClickTween:function(e,t,n,r){if(interaction_view.SinglePreview)return;$('section[id="'+t+'"]').children(".interaction-view").css("cursor","pointer"),interaction_view.events.pageClickEvents.push({type:"waitaction",page_id:t,func:function(){$('section[id="'+t+'"]').children(".interaction-view").css("cursor","auto"),n.pause(),r._animation.stop(n)}})},AddMediaTween:function(e){var t=e.collection.page;if(interaction_view.SinglePreview){var n=t.iAnimationlist.timeline.getLabelTime(interaction_view.PreviewItemId+"_start"),r=t.iAnimationlist.timeline.getLabelTime(e.id+"_start");if(n>r)return}var i=t.iOverlaylist.get(e.get("overlay_id")),s=e.get("iType");i.onAnimationStart={overlay_id:e.get("overlay_id"),animation_id:e.id,page_id:t.id,layer_id:e.collection.layerid},interaction_view.events.onAnimationStart(i.onAnimationStart),s==501&&(i.get("iType")=="Audio"||i.get("iType")=="Video"?interaction_view.media.play(i):i.iview.playTimeline()),s==502&&(i.get("iType")=="Audio"||i.get("iType")=="Video"?i.loaded&&(interaction_view.media.pause(i),i.iview.slider&&i.iview.sliderstop()):i.iview.pauseTimeline()),s==503&&(i.get("iType")=="Audio"||i.get("iType")=="Video"?i.loaded&&i.media&&(i.iview.resetOtherStatus(),i.iview.slider&&(i.iview.sliderstop(),i.iview.onSliderChange(0))):i.iview.stopTimeline()),(s==502||s==503)&&i.onAnimationStart&&(interaction_view.events.onAnimationEnd(i.onAnimationStart),i.onAnimationStart=null),t.iAnimationlist.onComplete(e.id)},getMediaTime:function(e){var t=0,n=e.collection.page.iOverlaylist.get(e.toJSON().overlay_id);if(n.media){if(n.get("iType")=="Audio"||n.get("iType")=="Video")t=n.hls?n.media.getDuration():n.media.duration}else _.include(["CycleImage","Slide","LayerSlide"],n.get("iType"))&&(t=n.iview.getSlideDuration());return t},onSingleComplete:function(){},onUpdate:function(){},onTotalComplete:function(){},onComplete:function(e){},resetAnimationStatus:function(){_.each(this.repeatTweens,function(e){e.kill()}),this.repeatTweens=[],this.timeline&&this.timeline.pause(0)}}),interaction_view.view.Animation=interaction_view.view.Base.extend({initstart:function(){}})}),define("text!interaction_view/template/audiocontrol.js",[],function(){return'<div class="audiobar disableDragX disableDragY" style="height: 31px;width: 100%;position: absolute;">\n  <span class="audio-control status-play"></span>\n  <% if((iCommon[iPageDirection].iWidth-45)>0){%>\n  <span class="ui-slider-green ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all" aria-disabled="false" style="width:<%=(iCommon[iPageDirection].iWidth-45)>0?(iCommon[iPageDirection].iWidth-45):0%>px;left: 45px;">\n    <div class="ui-slider-range ui-widget-header ui-corner-all ui-slider-range-min g-slider-range" style="width: 0%;background-color: #444444;">\n    </div>\n    <a class="ui-slider-handle ui-state-default ui-corner-all g-slider-handle" href="#" style="left: 0%;">\n    </a>\n  </span>\n  <% } %>\n</div>'}),define("interaction_view/model/audio",["interaction_view/model/base","text!interaction_view/template/audiocontrol.js"],function(){var e=require("text!interaction_view/template/audiocontrol.js");interaction_view.model.Audio=interaction_view.model.Base.extend({defaults:{iType:"Audio",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.Audio({model:this})},setsyncmodel:function(){}}),interaction_view.view.Audio=interaction_view.view.Base.extend({events:{},bindSliderControl:function(){var e=this;this.$el.find(".audio-control").css("cursor","pointer"),this.$el.find(".audio-control").on("click",function(){return $(this).hasClass("status-play")?e.model.media&&interaction_view.media.play(e.model):$(this).hasClass("status-pause")&&(e.model.media&&interaction_view.media.pause(e.model),e.sliderstop()),!1})},render:function(t){var n=this.getdetail();n.iControl&&this.file&&(this.$el.children(".Element").append(_.template(e,this.model.toJSON())),this.$el.removeClass("hide"))},preload:function(){var e=this.getdetail();this.model.played=!1,this.model.time=0;var t;e.iFile&&e.iFile[0]&&(audio_url_src=this.getFromUrl(),audio_url_src!=""?t=audio_url_src:typeof epub360!="undefined"&&epub360.settings&&epub360.settings.disable_stream_media?t=e.iFile[0].file:typeof cbt_data=="undefined"||interaction_view.forpreview?_g.getUrlParameterByName("-playmode")=="1"?t=(e.iFile[0].file||e.iFile[0].content)+"_audio.m3u8":_g.getUrlParameterByName("-playmode")=="2"?t=e.iFile[0].file||e.iFile[0].content+"?avthumb/mp3/ab/32k":t=e.iFile[0].file||e.iFile[0].content+"?avthumb/mp3/ab/32k":t=e.iFile[0].file||e.iFile[0].content,this.sendToPreload({file:t}),this.file=t)},setOtherDisplay:function(){var e=this.getdetail(),t=this;e.iControl&&this.file&&_g.slider&&(this.slider=new _g.slider({containment:this.$el,onChange:function(e){t.model.media&&interaction_view.media.seek(t.model,null,e)}}),this.bindSliderControl())},resetStatus:function(){this.resetOtherStatus()},resetOtherStatus:function(){if(this.model.isBgsound){this.$el.find(".status-play").addClass("status-pause").removeClass("status-play");return}this.model.media&&(this.model.hls?interaction_view.media.audio.resetH(this.model):interaction_view.media.audio.reset(this.model),this.slider&&(this.sliderstop(),this.onSliderChange(0)))},sliderplay:function(){this.$el.find(".audio-control").addClass("status-pause").removeClass("status-play")},sliderstop:function(){this.$el.find(".audio-control").removeClass("status-pause").addClass("status-play")},onSliderChange:function(e){console.log("time change "+e),this.slider.change(e)},getFromUrl:function(){var e=_g.getUrlParameterByName(this.model.id,message_link);return e||(e=_g.getHashParameterByName(this.model.id)),decodeURI(e||"")},addToUrl:function(e){var t=this,n=this.getdetail();if(e==n.iFile[0].origin)return!1;var r=this.model.id+"="+encodeURI(e),i=_g.getUrlParameterByName(this.model.id,message_link),s=0;if(!i){var o="?";message_link.indexOf("?")>=0&&(o="&"),message_link+=o+r,interaction_view.weixin.share()}else encodeURI(i)!=encodeURI(e)?(message_link=_g.replaceUrlParameterByName(this.model.id,r,message_link),interaction_view.weixin.share()):s=1;if(!interaction_view.forpreview){var u=_g.getHashParameterByName(this.model.id);u?encodeURI(u)!=encodeURI(e)?window.history.replaceState({},"",_g.replaceHashParameterByName(this.model.id,r)):s=1:window.history&&(document.location.hash?window.history.replaceState({},"",document.location.hash+="&"+r):window.history.replaceState({},"","#"+r))}return s?!1:!0}})}),define("interaction_view/model/cycleimage",["interaction_view/model/base","_g/base"],function(){interaction_view.model.CycleImage=interaction_view.model.Base.extend({defaults:{iType:"CycleImage",iLock:!0,iVisibility:!0,iCommon:{},iDetail:{},iSync:!1,isSlide:!0,iZindex:"-1",iUrl:null,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.loaded=[],this.loaded_index=0,this.iImgs=[],this.iview=new interaction_view.view.CycleImage({model:this})},setsyncmodel:function(){}}),interaction_view.view.CycleImage=interaction_view.view.Base.extend({events:{},render:function(e){var t=this,n=this.getdetail();this.currentSlideIndex=null,this.model.on("slideTo",function(e){if(t.currentSlideIndex!=null&&t.currentSlideIndex==e)return!1;t.preloaded&&(interaction_view.events.onChangeTo(t.model.iPageId,t.model.id,e),t.currentSlideIndex=e)})},preload:function(){var e=this;this.preloaded=!1;var t,n=this.getdetail();this.img_src=[],this.img_loaded=[];var r=[];if(n.iImg&&n.iImg.length){this.model._img_preload=!0;for(var i=0;i<n.iImg.length;i++)t=n.iImg[i].picture,e.img_src.push(t),e.img_loaded.push(!1);e.useIndex=!0}},afterpreload:function(e){this.slideel=this.$el.children(".Element").find(".slidecontent").first(),this.setZindex(),this.setElementDisplay(),this.renderCanvas(),this.playAnimation(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".iElement").attr("style"),this.preloaded=!0},playAnimation:function(){var e=this,t=0,n=this.detail,r=n.iSlidetype;r==null&&(r=0),this.delay=Number(n.iInterval)||.01,this.autoplay=n.iAutoplay;var i=n.iRepeat?-1:0;this.slidelength=n.iImg&&n.iImg.length||0,this.repeat=this.init_repeat=i,this.iRewind=n.iRewind,this.slipable=n.iSlipable,this.p_mode=n.p_mode||0,this.p_from=Number(n.p_from)||0,this.p_to=Number(n.p_to)||0,this.direction=this.init_direction=0,this.slidelength&&(this.p_to<0&&(this.p_to=0),this.p_from<0&&(this.p_from=0),this.p_to>this.slidelength-1&&(this.p_to=this.slidelength-1),this.p_from>this.slidelength-1&&(this.p_from=this.slidelength-1),this.p_mode||(this.p_from=0,this.p_to=this.slidelength-1),this.p_mode==1&&(this.direction=this.init_direction=1,this.p_from=this.slidelength-1,this.p_to=0),this.p_mode==2&&(this.direction=this.init_direction=this.p_from-this.p_to>0?1:0),this._start=this.p_from,this._end=this.p_to,this.setTimeline(),this.autoplay&&(this.model._autoplay=!0),this.img_preload(20,null,function(){e.drawCanvas(e.img_src[e.p_from],e.p_from),e.img_preload()}),this.onChangeSlideTo(this.p_from),this.slipable&&(this.control(),this.autoplay||this.$el.attr("data-iSlipable",!0)),this.model._reset=!0)},_autoplay:function(){this.timeline&&(this.$el.children(".Element").is(":hidden")||this.timeline.play())},exeutePlay:function(){},setTimeline:function(){this.iFade="LoopSwitch",this._setCanvasLoopSwitch()},testControl:function(){return!0},resetOtherStatus:function(){if(!this.slideel)return;var e=this.getdetail();this.autoplay=e.iAutoplay,this.repeat=this.init_repeat,this.direction=this.init_direction,this._start=this.p_from,this._end=this.p_to,this.currentIndex=this.p_from,this.useIndex&&(this.indexTime=this.p_from),this.timeline&&(this._setCanvasLoopSwitch(!0),this.ctx.clearRect(0,0,this.canvas_width,this.canvas_height),this.drawCanvas(this.img_src[this.p_from],this.p_from))},renderCanvas:function(){var e=this.getcommon();this.canvasId="canvas_"+_g.uuid(),this.slideel.append('<canvas id="'+this.canvasId+'" width="'+e.iWidth+'" height="'+e.iHeight+'" style="pointer-events:none"></canvas>'),this.canvas=document.getElementById(this.canvasId),this.canvas_width=e.iWidth,this.canvas_height=e.iHeight,this.canvas&&(this.ctx=this.canvas.getContext("2d")),this.useIndex&&this.slideel.children("img").hide()},drawCanvas:function(e,t){if(!e||e=="")return;var n=this;this.ctx||(this.ctx=this.canvas.getContext("2d"));if(!this.ctx)return!1;ctx=this.ctx,interaction_view.drawImg(n,e,t,ctx)},otherOnShow:function(){this.img_src.length&&(this._setCanvasLoopSwitch(),this.drawCanvas(this.img_src[this.currentIndex],this.currentIndex),this.autoplay&&this.timeline.play())},img_preload:function(e,t,n){var r=this;if(!r.slidelength)return;var i=r.model.loaded_index,s=1;r.slidelength==1&&(s=0);var o=i;if(i>r.slidelength-1){r.model.loaded_all=!0;return}var u=r.slidelength-i>=20?i+20-1:r.slidelength-1;r.model.loaded_index=u+1;var a=0,f=u-i+1;for(;i<=u;i++){if(interaction_view.iImgs[r.img_src[i]]){r.model.iImgs[i]=interaction_view.iImgs[r.img_src[i]],r.model.loaded[i]=!0,n&&a==s&&n(),++a>=f&&(t&&t(),e||r.img_preload());continue}r.model.iImgs[i]=new Image,r.model.iImgs[i].onload=function(){r.model.loaded[i]=!0,interaction_view.iImgs[this.src]=this,n&&a==s&&n(),++a>=f&&(e||r.img_preload())},r.model.iImgs[i].src=r.img_src[i]}}})}),define("text!interaction_view/template/imageitem.js",[],function(){return'<%if(iDetail.iImg&&iDetail.iImg[0]){%>\n    <%if(typeof isSubOverlay!="undefined"&&isSubOverlay&&(typeof isLayerOverlay=="undefined"||!isLayerOverlay)){%>\n        <% if(iDetail.iMask){%>\n            <img draggable="false" class="Context" src="<%=iDetail.iImg[0].thumbnail%>" style="width:<%=iDetail.iMask_data.width%>px;height:<%=iDetail.iMask_data.height%>px;position:absolute;max-width:none;">\n        <%}else{%>\n            <img draggable="false" class="Context" src="<%=iDetail.iImg[0].thumbnail%>" style="width:100%;height:100%;position:absolute;">\n        <% } %>\n    <%}else{ %>\n        <% if(iDetail.iMask){%>\n            <img draggable="false" class="Context" src="<%=iDetail.iImg[0].picture%>" style="width:<%=iDetail.iMask_data.width%>px;height:<%=iDetail.iMask_data.height%>px;position:absolute;max-width:none;">\n        <%}else{%>\n            <img draggable="false" class="Context" src="<%=iDetail.iImg[0].picture%>" style="width:100%;height:100%;position:absolute;">\n        <% } %>\n    <%}%>\n<%}%>'}),define("interaction_view/model/image",["interaction_view/model/base","text!interaction_view/template/imageitem.js"],function(){var e=require("text!interaction_view/template/imageitem.js");interaction_view.model.Image=interaction_view.model.Base.extend({defaults:{iType:"Image",iLock:!0,iVisibility:!0,iCommon:null,iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParentModel:null,iTemplate:null,iParentdiv:".interaction-view",iSync:!1,iZindex:"-1",callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.Image({model:this})},setsyncmodel:function(){}}),interaction_view.view.Image=interaction_view.view.Base.extend({events:{},render:function(e){this.renderMask(),this.renderDraggable(),this.firstRender=!0,this.isEraserSet=!1},renderMask:function(){var e=this.getdetail();e.iMask&&(this.$el.children(".Element").find("img").first().css({translate:[e.iMask_data.x,e.iMask_data.y]}),this.iScrollview&&this.iScrollview.scrollTo(e.iMask_data.x,e.iMask_data.y))},preload:function(){},getLayerContentSize:function(){var e=this.getdetail(),t={};return e.iImg&&e.iImg.length>0?(t.width=e.iMask_data.width,t.height=e.iMask_data.height,t):null},setOtherDisplay:function(){var e=this.getdetail();e.iImg&&e.iImg.length>0&&e.iMask&&e.iMask_data.iSlipable&&(this.renderMask(),this.setMaskSlipable({items:this.$el.children(".Element").find("img").first(),containment:this.$el.children(".Element"),contentel:this.$el.children(".Element").children(),content_x:e.iMask_data.x,content_y:e.iMask_data.y})),e.iDisplay&&e.iImg&&e.iImg.length>0&&(this.$el.children(".Element").find("img").length?_g.ui.fitImage({fit:Number(e.iDisplay),width:e.iImg[0].width,height:e.iImg[0].height,items:this.$el.children(".Element").find("img"),parentHeight:parseInt(this.$el.children(".Element").css("height")),parentWidth:parseInt(this.$el.children(".Element").css("width"))}):_g.ui.fitImage({fit:Number(e.iDisplay),containment:this.$el.children(".Element").find(".image_wrap").first()})),e.iFullview&&this.fullview(),e.iEraser&&(this.model._reset=!0,this.el_str=this.$el.children(".Element").html(),this.setEraser())},resetOtherStatus:function(){this.$el.removeClass("invisible noevents"),this.resetEraser(),this.resetDragDrop()},fullview:function(){if(typeof wx_permissions!="undefined"&&wx_permissions.previewImage)return;var e=this,t=this.getdetail();t.iImg&&t.iImg.length>0&&(this.$el.addClass("hasaction"),this.$el.children(".Element").on("click",function(n){opts={picture:t.iImg[0].picture,width:t.iImg[0].width,height:t.iImg[0].height,model:e.getGalleryModel(),index:e.model.get("GalleryIndex")},e.setFullView(opts)}))},setEraser:function(){var e=this.getdetail();if(!e.iEraser)return;var t=this.getcommon();this.$el.children(".Element").css("cursor","pointer"),this.$el.children(".Element").addClass("disableDragX disableDragY"),this.$el.find("img").first().is(":hidden")?this.isEraserSet=!1:(_e.eraser&&_e.eraser.set(this.$el.find("img").first(),t.iWidth,t.iHeight,this),this.isEraserSet=!0)},resetEraser:function(){this.firstRender||this.onShow(),this.isEraserSet||this.setEraser(),this.firstRender=!1},isFullSwitch:function(){if(this.model.get("GalleryIndex")!=null)return!0},getGalleryModel:function(){var e=[];for(i=0;i<this.path.length;i++){if(this.path[i].type=="Gallery"){e.push(this.path[i]);break}e.push(this.path[i])}var t=interaction_view.getContainerModelByPath(e);return t},repaint:function(){this.$el.children(".Element").html(this.el_str)},onShow:function(){var e=this.getdetail();e.iEraser&&(this.repaint(),this.setEraser())},getDragCopy:function(){var e=$("<div></div>").addClass("DragCopy").attr({id:this.model.id+"_drag_copy"}).css({position:"absolute",opacity:this.$el.css("opacity")});return e.html($("<div/>").attr({style:this.$el.children(".Element").attr("style")})),e.children().html(this.$el.children(".Element").children().clone()),e},getClientXY:function(e){return"ontouchend"in document?{x:e.clientX,y:e.clientY}:{x:e.gesture.center.pageX,y:e.gesture.center.pageY}},resetDragDrop:function(){if(!this.getdetail().draggable)return;var e=this;typeof e.DragDrops=="undefined"&&(e.DragDrops=e.model.page.iOverlaylist.where({iType:"DragDrop"}),!e.DragDrops.length&&(e.DragDrops=!1)),e.DragDrops&&(typeof e.MaxZindex=="undefined"&&(e.MaxZindex=e.model.page.iOverlaylist.models.length+1e3),e.Status=0,this.getdetail().dragend==1&&(e.Status=2)),e.Pos={left:e.x,top:e.y},e.Drag_opacity=.8999,e.$el.siblings(".DragCopy").remove()},setDraggable:function(e,t,n,r){function c(){o&&(a=e.css("z-index"),o=!1),interaction_view.events.onDragStart(l),u=e.position(),f=e.css("opacity"),e.css({"z-index":i.MaxZindex+100,opacity:e.css("opacity")>=1?i.Drag_opacity:e.css("opacity")}),n(e),e.stop(!0,!0),i.resetDragDropStatus()}function h(t,n,r){if(!u||!u.left)return;var o=$.zoom?$.zoom:1,a=u.left+t/o,f=u.top+n/o,c,h=e.css("transform").split(",");s.limit=="vertical"?c={y:f}:s.limit=="horizontal"?c={x:a}:c={x:a,y:f},interaction_view.setPos(e,_.extend(c,{force3D:interaction_view.force3D})),interaction_view.events.onDragging(l),i.activeDragDrop(e,r)}function p(){interaction_view.events.onDragEnd(l),e.css({"z-index":a,opacity:e.css("opacity")-i.Drag_opacity<1e-5?f:e.css("opacity")}),r(e)}var i=this,s=this.getdetail(),o=!0,u,a=e.css("z-index"),f;e.data({Drop:t}).addClass("disableDragX disableDragY");var l={page_id:i.model.page.id,overlay_id:i.model.id,layer_id:i.model.get("layer_id")};if("ontouchend"in document){var d=!1,v=0,m=0;e.on("touchstart",function(e){e=e.originalEvent.touches[0],d=!0,v=e.clientX,m=e.clientY,c()}).on("touchmove",function(e){return e=e.originalEvent.touches[0],h(e.clientX-v,e.clientY-m,e),!1}).on("touchend touchcancel",function(e){e=e.originalEvent.touches[0],d&&p(),d=!1})}else e.hammer().on("dragstart",c).on("drag",function(e){h(e.gesture.deltaX,e.gesture.deltaY,e)}).on("dragend",p)},activeDragDrop:function(e,t){if(!this.DragDrops)return;var n=this,r=$.zoom?$.zoom:1,i=this.getClientXY(t);$.each(n.DragDrops,function(e,t){var s=t.iview.$el.children(".Element"),o={x:s.offset().left*r,y:s.offset().top*r},u={x:o.x+s.width()*r,y:o.y+s.height()*r};i.x>=o.x&&i.x<=u.x&&i.y>=o.y&&i.y<=u.y?(n.$el.parent().children("#"+n.model.id+t.id).length==0&&!t.iview.active&&n.trigger_dragin_event(t),t.iview.changeStatus(!1)):t.iview.changeStatus(!0)})},getDropXY:function(e){var t=e.iview.getcommon(),n=e.iview.$el.children(".Element").offset(),r=e.iview.$el.parents(".interaction-area:first").offset();return{x:n.left-r.left+t.iWidth/2,y:n.top-r.top+t.iHeight/2}},resetDragDropStatus:function(){var e=this;$.each(e.DragDrops,function(t,n){n.iview.Status=0;var r=e.$el.parent().children("[data-drop="+n.id+"]");if(r.length){n.iview.Status=2;var i=r.attr("data-drag");_.include(n.iview.getdetail().element_ids,i)&&(n.iview.Status=1)}})},renderDraggable:function(){function n(n){if(t.dragstart==1){var r=e.getDragCopy();n.before(r),TweenMax.to(r,0,{x:n.position().left,y:n.position().top,force3D:interaction_view.force3D})}e.Status==0&&(e.Pos=n.position())}function r(n){var r=0;$.each(e.DragDrops,function(i,s){if(s.iview.active){s.iview.changeStatus();var o=s.iview.getdetail(),u=e.$el.parent().children("#"+e.model.id+s.id);if(o.onlyright&&!_.include(o.element_ids,e.model.id)||u.length!=0)return r=1,u.length!=0&&t.dragin==0&&(r=3,n.css({"z-index":parseInt(s.iview.$el.css("z-index"))+1}),TweenMax.to(n,.4,e.getDropXY(s))),!1;r=2,s.iview.Status!=0&&e.old_transit_back(s),e.drag_dragin(s)}}),r<2&&e.drag_dragend(r==1?1:null)}var e=this,t=this.getdetail();if(!t.draggable)return;this.model._reset=!0,e.setDraggable(e.$el,null,n,r)},drag_dragend:function(e){var t=this.$el,n=t.position(),r=t.parent().children("#"+this.model.id+"_drag_copy");this.Status==1&&(this.Status=0),this.lastCopy&&this.lastCopy.remove()&&(this.lastCopy=null),(e||parseInt(this.getdetail().dragend))==1?(n=this.Pos,TweenMax.to(t,.4,{x:n.left,y:n.top})):this.Status==0&&(this.Pos=t.position()),TweenMax.to(r,.4,{x:n.left,y:n.top,opacity:0,force3D:interaction_view.force3D,onComplete:function(){r.remove()}})},drag_dragin:function(e){var t=this,n=this.getdetail(),r=t.$el.parent().children("#"+t.model.id+"_drag_copy");switch(parseInt(n.dragin)){case 0:t.Status==0&&(t.Status=1);if(t.$el.parent().children("#"+t.model.id+e.id).length==0){t.lastCopy&&t.lastCopy.remove()&&t.resetDragDropStatus();var i=t.getDragCopy().attr({id:t.model.id+e.id,"data-drop":e.id,"data-drag":t.model.id}).hide();t.$el.before(i),t.lastCopy=i}t.$el.css("z-index",parseInt(e.iview.$el.css("z-index"))+1),TweenMax.to(t.$el,.4,_.extend(t.getDropXY(e),{force3D:interaction_view.force3D,onComplete:function(){t.trigger_drop_event(e)}})),n.dragstart==1&&TweenMax.to(r,.4,_.extend(t.getDropXY(e),{opacity:0,force3D:interaction_view.force3D,onComplete:function(){r.remove()}}));break;case 1:n.dragstart!=1&&(r=t.getDragCopy(),t.$el.before(r)),r.attr({id:t.model.id+e.id,"data-drop":e.id,"data-drag":t.model.id}).css({"z-index":parseInt(e.iview.$el.css("z-index"))+1,opacity:r.css("opacity")-t.Drag_opacity<1e-5?1:r.css("opacity")}),TweenMax.to(r,0,{x:t.$el.position().left,force3D:interaction_view.force3D,y:t.$el.position().top}),TweenMax.to(t.$el,.4,{x:t.Pos.left,y:t.Pos.top,force3D:interaction_view.force3D}),TweenMax.to(r,.4,_.extend(t.getDropXY(e),{force3D:interaction_view.force3D,onComplete:function(){t.trigger_drop_event(e),t.renderCopyDraggable(e,r)}}));break;case 2:r.remove(),r=t.getDragCopy().attr({id:t.model.id+e.id,"data-drop":e.id,"data-drag":t.model.id}).hide(),t.$el.before(r),TweenMax.to(t.$el,0,{x:t.Pos.left,y:t.Pos.top,force3D:interaction_view.force3D,onComplete:function(){t.trigger_drop_event(e)}})}},renderCopyDraggable:function(e,t){function r(){n.getdetail().dragstart==0&&n.$el.hide()}var n=this;this.setDraggable(t,e,r,n.copy_dragend)},copy_dragend:function(e){var t=this,n=this.getdetail(),r=e.data("Drop"),i=0;$.each(t.DragDrops,function(n,s){if(s.id==r.id)s.iview.active&&(TweenMax.to(e,.4,t.getDropXY(r)),s.iview.changeStatus(),i=1);else if(s.iview.active){r.iview.Status=0,s.iview.changeStatus();var o=s.iview.getdetail();if(o.onlyright&&!_.include(o.element_ids,t.model.id))return i=1,t.old_transit_back(r,t.model.id),!1;s.iview.Status!=0&&t.old_transit_back(s),TweenMax.to(e,.4,t.getDropXY(s)),t.$el.siblings("#"+t.model.id+s.id).remove(),e.attr({id:t.model.id+s.id,"data-drop":s.id,"data-drag":t.model.id}).css("z-index",parseInt(s.iview.$el.css("z-index"))+1),e.data("Drop",s),i=1,t.trigger_drop_event(s)}}),n.dragstart==0&&t.$el.show();if(i==0){var s=e.position();n.dragend==0&&n.dragstart==1?(TweenMax.to(e,.4,{opacity:0,force3D:interaction_view.force3D,onComplete:function(){e.remove()}}),TweenMax.to(t.$el,.4,{x:s.left,y:s.top,force3D:interaction_view.force3D})):(TweenMax.to(t.$el,0,{x:e.position().left,y:e.position().top,force3D:interaction_view.force3D}),n.dragend==1&&n.dragstart==1?TweenMax.to(e,0,{x:t.Pos.left,y:t.Pos.top,force3D:interaction_view.force3D,onComplete:function(){TweenMax.to(e,.4,{opacity:0,force3D:interaction_view.force3D,onComplete:function(){e.remove()}})}}):e.remove()),t.drag_dragend()}},old_transit_back:function(e,t){var n=e.iview.$el.parent().children("[data-drop="+e.id+"]"),t=t||n.attr("data-drag");n.attr("id",t+"_drag_copy"),this.model.page.iOverlaylist.where({id:t})[0].iview.drag_dragend(1)},trigger_dragin_event:function(e){interaction_view.events.onDragDrop(e,this.model,0)},trigger_drop_event:function(e){interaction_view.events.onDragDrop(e,this.model),interaction_view.events.onDragDropGroup(e)}})}),define("interaction_view/model/page",["_g/mvc","interaction_view/view/page"],function(){var e={defaults:{iType:"Page",position:0,description:"",title:"untitled",picture:null,preview:'<img src="/staticfs/admin-epub360/img/thumb.png">',thumbnail:null,width:null,height:null,bg_color:"#FFFFFF",bg_opacity:1,show_master:!0},autoIndex:!0,callback:function(){this.get("type")!="page_group"&&(this.iOverlaylist=new interaction_view.collection.list,this.iAnimationlist=new interaction_view.collection.Animation,this.iActionlist=new interaction_view.collection.Action,this.ipreloadlist=new interaction_view.collection.Preload,this.ipreloadlist.pageid=this.iOverlaylist.pageid=this.iAnimationlist.pageid=this.iActionlist.pageid=this.id,this.iAnimationlist.iPage_id=this.id,this.iAnimationlist.page=this)},overlays:[],actions:[],animations:[]};return _g.mvc.createModel(e)}),define("interaction_view/collection/page",["_g/mvc","interaction_view/model/page"],function(){var e={enableSync:!1,model:require("interaction_view/model/page"),getPages:function(){var e=_g.mvc.getTreeModels(interaction_view.ipagelist);return e=_.reject(e,function(e){return e.toJSON().type=="page_group"}),e},getPagesJSON:function(){var e=_g.mvc.getTreeModels(interaction_view.ipagelist);return e=_.reject(e,function(e){return e.toJSON().type=="page_group"}),e=_.map(e,function(e){return e.toJSON()}),e},getPage:function(e){return _g.mvc.getTreeModel(interaction_view.ipagelist,e)},getIndexPages:function(){var e=this.getPages();return _.filter(e,function(e){return e.get("is_index")})},getElement:function(e,t,n){if(interaction_view.ipagelist.getPage(t)||interaction_view.imasterlist.get(t)){var r=interaction_view.ipagelist.getPage(t)||interaction_view.imasterlist.get(t);return r.iOverlaylist.get(n)}return e.iOverlaylist.get(n)}};return _g.mvc.createCollection(e)}),define("interaction_view/model/layer",["interaction_view/model/page"],function(){var e=require("interaction_view/model/page"),t=e.extend({defaults:{iType:"Layer",position:0,description:"",title:"untitled",picture:null,preview:'<img src="/staticfs/admin-epub360/img/thumb.png">',thumbnail:null,width:null,height:null,layer_width:1024,layer_height:768,bg_color:"#FFFFFF",bg_opacity:1},callback:function(){this.actions=this.get("actions"),this.animations=this.get("animations"),this.overlays=this.get("overlays")}});return t}),define("interaction_view/collection/layer",["interaction_view/collection/page","interaction_view/model/layer"],function(){var e=require("interaction_view/collection/page"),t=e.extend({model:require("interaction_view/model/layer")});return t}),define("interaction_view/model/master",["interaction_view/model/page"],function(){var e=require("interaction_view/model/page"),t=e.extend({defaults:{iType:"Master",position:0,description:"",title:"untitled",picture:null,preview:'<img src="/staticfs/admin-epub360/img/thumb.png">',thumbnail:null,width:null,height:null,bg_color:"#FFFFFF",bg_opacity:1,pageno_horizontal:{show:!1,x:500,y:20},pageno_vertical:{show:!1,x:20,y:300}}});return t}),define("interaction_view/view/master",["interaction_view/view/page"],function(){var e=require("interaction_view/view/page"),t=$.extend({},e,{template:null,className:null,containment:null,wrap:null,wrapClassName:null,autoRender:!1,position:1,parseData:null,isMaster:!0});return t}),define("interaction_view/collection/master",["interaction_view/collection/page","interaction_view/model/master","interaction_view/view/master"],function(){var e=require("interaction_view/collection/page"),t=e.extend({model:require("interaction_view/model/master")});return t}),define("interaction_view/model/background",["interaction_view/model/page"],function(){var e=require("interaction_view/model/page"),t=e.extend({defaults:{iType:"Background",position:0,description:"",title:"untitled",picture:null,preview:'<img src="/staticfs/admin-epub360/img/thumb.png">',thumbnail:null,width:null,height:null,bg_color:"#FFFFFF",bg_opacity:1,pageno_horizontal:{show:!1,x:500,y:20},pageno_vertical:{show:!1,x:20,y:300}}});return t}),define("interaction_view/view/background",["interaction_view/view/page"],function(){var e=require("interaction_view/view/page"),t=$.extend({},e,{template:null,className:null,containment:null,wrap:null,wrapClassName:null,autoRender:!1,position:1,parseData:null,isBackground:!0,prepareLoad:function(){var e=this,t=this.model;if(!t)return;e.animations=_.map(e.animations,function(t){return t.pageid=e.model.id,t.pagetype="background",t}),e.model.iAnimationlist.reset(e.animations),overlays=_.filter(e.overlays,function(t){return t.pageid=e.model.id,t.pagetype="background",interaction_view.model[t.iType]}),overlays=_.map(overlays,function(e){return new interaction_view.model[e.iType](e)}),e.model.iOverlaylist.reset(overlays),e.model.iOverlaylist.each(function(e){e.iview.setZindex()}),e.actions=_.map(e.actions,function(t){return t.pageid=e.model.id,t.pagetype="background",t}),e.model.iActionlist.reset(e.actions)}});return t}),define("interaction_view/collection/background",["interaction_view/collection/page","interaction_view/model/background","interaction_view/view/background"],function(){var e=require("interaction_view/collection/page"),t=e.extend({model:require("interaction_view/model/background")});return t}),define("interaction_view/model/component",["interaction_view/model/page"],function(){var e=require("interaction_view/model/page"),t=e.extend({defaults:{iType:"Component",bg_color:"#FFFFFF",bg_opacity:1},callback:function(){this.actions=this.get("actions"),this.animations=this.get("animations"),this.overlays=this.get("overlays")}});return t}),define("interaction_view/collection/component",["interaction_view/collection/page","interaction_view/model/component"],function(){var e=require("interaction_view/collection/page"),t=e.extend({model:require("interaction_view/model/component")});return t}),define("interaction_view/model/doc",["_g/mvc","interaction_view/collection/page","interaction_view/view/page","interaction_view/collection/layer","interaction_view/collection/master","interaction_view/collection/background","interaction_view/collection/component"],function(){var e={defaults:{id:"doc",play_mode:0},autoUpdate:!1,fetchUrl:context_url+"index.json",staticFetchUrl:"/staticfs/common/js/interaction_view/data/index.json",parse:function(e){var t=this;console.log("fetch data:"+e);if(e.code==200)return e.data?(interaction_view.size={x:e.data.width||1024,y:e.data.height||768},interaction_view.screen_mode=e.data.screen_mode,e.data.force_3d&&interaction_view.ismobile?interaction_view.force3D="auto":interaction_view.force3D=!1,this.initShareApp(e),this.initMasters(e),workEnd("-------- 1.1.1 touchinit 1 initMasters --------"),this.initBackgrounds(e),workEnd("-------- 1.1.2 touchinit 1 initBackgrounds --------"),this.initLayers(e),workEnd("-------- 1.1.3 touchinit 1 initLayers --------"),this.initPages(e),workEnd("-------- 1.1.4 touchinit 1 initPages --------"),this.initComponents(e),this.initApplications(e),workEnd("-------- 1.1.5 touchinit 1 initApplications --------"),!interaction_view.ismobile&&!interaction_view.forpreview&&(e.data.bg_color=e.data.desktop_bg_color!=undefined?e.data.desktop_bg_color:e.data.bg_color,e.data.bg_opacity=e.data.desktop_bg_opacity!=undefined?e.data.desktop_bg_opacity:e.data.bg_opacity,e.data.screen_mode=e.data.desktop_screen_mode!=undefined?e.data.desktop_screen_mode:e.data.screen_mode,e.data.show_excontent=e.data.desktop_show_excontent!=undefined?e.data.desktop_show_excontent:e.data.show_excontent,e.data.adapt=e.data.desktop_adapt!=undefined?e.data.desktop_adapt:e.data.adapt),_.omit(e.data,"layers","masters","chapter","organization","applications")):{}},initMasters:function(e){var t=require("interaction_view/collection/master");e.data.masters||(e.data.masters=[]),interaction_view.imasterlist=_g.mvc.createTreeByData({collection:t,data:e.data.masters})},initBackgrounds:function(e){var t=require("interaction_view/collection/master");e.data.backgrounds||(e.data.backgrounds=[]),interaction_view.ibackgroundlist=_g.mvc.createTreeByData({collection:t,data:e.data.backgrounds})},initLayers:function(e){var t=require("interaction_view/collection/layer");e.data.layers||(e.data.layers=[]),interaction_view.ilayerlist=_g.mvc.createTreeByData({collection:t,data:e.data.layers})},initComponents:function(e){var t=require("interaction_view/collection/component");e.data.components||(e.data.components=[]),interaction_view.iComponentlist=_g.mvc.createTreeByData({collection:t,data:e.data.components})},initPages:function(e){var t=this,n,r=require("interaction_view/collection/page");n=e.data.chapter,workEnd("-------- 1.1.4.2 touchinit pagedata parseOrgnization--------"),interaction_view.ipagelist=_g.mvc.createTreeByData({collection:r,data:n}),workEnd("-------- 1.1.4.3 touchinit interaction_view ipagelist--------"),_g.mvc.createTreeView({collection:interaction_view.ipagelist,view:require("interaction_view/view/page"),containment:"div.slides",wrap:null}),workEnd("-------- 1.1.4.4 touchinit interaction_view createTreeView--------")},initApplications:function(e){interaction_view.applications=e.data.applications,interaction_view.actionforapp={},interaction_view.application.buttons=[],interaction_view.application.buttonGroups=[],_.each(interaction_view.applications,function(e){e.type=="form"&&interaction_view.application.initForm(e),e.actions&&e.actions.length&&(interaction_view.actionforapp[e.id]=new interaction_view.collection.Action,interaction_view.actionforapp[e.id].add(e.actions),interaction_view.actionforapp[e.id].each(function(e){e.iview.render()}))})},initShareApp:function(e){interaction_view.shareapp={id:""},e.data.shareapp&&e.data.shareapp["id"]!=""&&(interaction_view.shareapp=e.data.shareapp,interaction_view.environment.Shareapp.init())},callback:function(){}};return _g.mvc.createModel(e)}),define("text!interaction_view/template/preload.js",[],function(){return'<img src="<%=file%>" width="1" height="1" id="<%=id%>"/>'}),define("interaction_view/model/preload",["interaction_view/model/base","text!interaction_view/template/preload.js"],function(){var e=require("text!interaction_view/template/preload.js");interaction_view.model.Preload=interaction_view.model.Base.extend({defaults:{iType:"Preload",iCommon:null,iDetail:null,iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!0,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null,loaded:!1},setcollection:function(){this.pageid=this.get("pageid");if(this.get("pagetype")=="LayerRef"){var e=this.get("parentpageid"),t=this.get("layerid"),n=interaction_view.getParentpage(e);this.page=n.iOverlaylist.get(this.pageid).layer[t]}else this.get("isSubOverlay")?(this.path=this.get("path"),this.page=interaction_view.getContainerModelByPath(this.path)):this.page=interaction_view.getParentpage(this.pageid);this.page.ipreloadlist.get(this.id)||this.page.ipreloadlist.add(this)},setview:function(e){this.pageid=this.get("pageid");if(this.get("pagetype")=="LayerRef"){var t=this.get("parentpageid"),n=this.get("layerid"),r=interaction_view.getParentpage(t);this.page=r.iOverlaylist.get(this.pageid).layer[n]}else this.get("isSubOverlay")?(this.path=this.get("path"),this.page=interaction_view.getContainerModelByPath(this.path)):this.page=interaction_view.getParentpage(this.pageid);this.get("pagetype")=="master"&&(this.isMasterOverlay=!0),this.iview=new interaction_view.view.Preload({model:this})},setsyncmodel:function(){}}),interaction_view.collection.Preload=interaction_view.collection.Base.extend({preloadcheck:function(e,t,n){var r=this.where({loaded:!0});!interaction_view.ismobile&&t==0&&interaction_view.message("alert","å¾åæåªä½èµæºå è½½å¤±è´¥ï¼å¯è½ä¼å½±åå¨ç»ææ"),n.iview.afterpreload(e);if(this.where({loaded:false}).length==0)if(this.pagetype=="LayerRef"){var i=this.parentpageid,s=this.layerid,o=interaction_view.getParentpage(i);refmodel=o.iOverlaylist.get(this.pageid),refmodel.iview.afterlayerload(s)}else if(this.subcontainer){var u=interaction_view.getContainerModelByPath(this.path);u.iview.afterSubOverlayPreload()}else interaction_view.finishPagePreload(this.pageid)},preload:function(){this.each(function(e){e.get("loaded")||e.iview.render()})}}),interaction_view.view.Preload=interaction_view.view.Base.extend({events:{},initstart:function(){},renderDynamicElement:function(){},render:function(){var e=this,t=this.elementmodel=e.model.page.iOverlaylist.get(this.model.get("overlay_id")),n=this.model.get("elementtype");if(n=="Audio")console.info("Audio"),this.audioPreload();else if(n=="Video")this.videoPreload();else if(n=="QQVideo")this.qqVideoPreload();else if(n=="LayerRef"||n=="LayerSlide"||n=="ComponentRef")this.layerPreload(this.model);else if(this.model.get("subcontainer"))this.subcontainerPreload(this.model);else{var r=e.model.toJSON().file;$('img[id="'+this.model.id+'"]').length>0&&($('img[id="'+this.model.id+'"]')[0].onload=function(){interaction_view.iImgs[r]=this},$('img[id="'+this.model.id+'"]')[0].src=r),e.model.set("loaded",!0),workEnd("-------- 4 "+this.model.id+" = "+r),e.model.page.ipreloadlist.preloadcheck(e.model.toJSON().file,!0,t)}},audioPreload:function(){interaction_view.media.audio.init(this.model,this.elementmodel,this.model.isMasterOverlay)},videoPreload:function(){var e=this;interaction_view.media.video.init(this.model,this.elementmodel,this.model.toJSON().file)},qqVideoPreload:function(){var e=this,t=this.model.toJSON().vid,n="http://vv.video.qq.com/geturl?otype=json&platform=1&ran=0%2E9652906153351068&callback=tvp_request_getinfo_callback_605089&vid="+t;$.ajax({url:n,dataType:"jsonp",data:"",jsonp:"callback",timeout:3e3,success:function(t){var n=t.vd.vi[0].url;interaction_view.media.video.init(e.model,e.elementmodel,n)}})},layerPreload:function(){this.elementmodel.iview.loadLayer(this.model)},subcontainerPreload:function(){this.elementmodel.iview.loadSubOverlay(this.model)}}),interaction_view.ipreloadlist=new interaction_view.collection.Preload}),define("interaction_view/model/richtext",["interaction_view/model/base"],function(){interaction_view.model.RichText=interaction_view.model.Base.extend({defaults:{iType:"RichText",iLock:!0,iVisibility:!0,iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.RichText({model:this})},setsyncmodel:function(){}}),interaction_view.view.RichText=interaction_view.view.Base.extend({events:{},render:function(e){interaction_view.ismobile,this.scrollEl=this.$el.children(".Element"),this.model._reset=!0},resetOtherStatus:function(){var e=this;if(_g.ui.isOverflowed(this.$el.children(".Element")).y){if(!this.$el.children(".Element").hasClass("disableDragY")){var t=this.$el.children(".Element").height();this.$el.children(".Element").wrapInner('<div class="iContent"></div>');var n=_g.ui.isOverflowed(this.$el.children(".Element")).y-t;this.scrollView=new IScroll(this.$el.children(".Element")[0],{mouseWheel:!0,click:!0,probeType:3}),this.scrollView.on("scroll",function(){console.log(this.y),n&&n>0&&(this.y>0?this.y>30&&e.scrollEl.addClass("is_exceededY"):Math.abs(this.y)-n>30&&e.scrollEl.addClass("is_exceededY"))}),this.scrollEl=this.$el.children(".Element"),this.$el.children(".Element").addClass("disableDragY iMouseWheel disableMouseWheelY")}this.$el.children(".Element").removeClass("is_exceededX"),this.$el.children(".Element").removeClass("is_exceededY")}},otherOnShow:function(){this.resetOtherStatus()}})}),define("interaction_view/model/slide",["interaction_view/model/base"],function(){interaction_view.model.Slide=interaction_view.model.Base.extend({defaults:{iType:"Slide",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSlideNumber:!0,isSlide:!0,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){var t=this.get("iDetail");t.show_title&&this.setSubOverlays(),this.iview=new interaction_view.view.Slide({model:this})},setsyncmodel:function(){}}),interaction_view.view.Slide=interaction_view.view.Base.extend({events:{},render:function(e){var t=this,n=this.getdetail();this.renderBackGroud(),this.currentSlideIndex=null,this.model.on("slideTo",function(e){if(t.currentSlideIndex!=null&&t.currentSlideIndex==e)return!1;t.preloaded&&(interaction_view.events.onChangeTo(t.model.get("pageid"),t.model.id,e),t.currentSlideIndex=e,t.setTitle(e)),t.rmbLast=e,n.iRememberLast&&interaction_view.environment.Paragraph.state()&&t.addToUrl(e)}),this.model._reset=!0},getSlideLength:function(){var e=this.getdetail();return e.iImg?e.iImg.length:0},preload:function(){var e=this,t=this.getdetail(),n;this.checkImglist=_.pluck(t.iImg,_g.getUrlParameterByName("-playmode")=="1"?"thumbnail":"picture"),this.preloaded=!1;var r=[];t.iImg&&t.iImg.length&&(_.each(t.iImg,function(t){_g.getUrlParameterByName("-playmode")=="1"?n=t.thumbnail:n=t.picture;var i=e.sendToPreload({file:n});r.push(i.id)}),t.show_title&&this.sendToPreload({file:null,subcontainer:!0,path:this.model.get("path"),isSubOverlay:this.model.get("isSubOverlay")})),this.model.set("preload_id",r)},checkImgload:function(e){return this.checkImglist=_.reject(this.checkImglist,function(t){return t==e}),this.checkImglist.length==0?!0:!1},afterpreload:function(e){if(e&&this.preloaded)return;e&&(this.preloaded=this.checkImgload(e));if(this.preloaded){var t=this,n=this.getdetail();if(n.show_title&&this.preloadmodel.get("loaded"))return;this.setZindex(),this.setElementDisplay(),this.setSlideImageDisplay(),this.slideel=this.$el.children(".Element").find(".slidecontent").first(),this.slidelength=this.getdetail().iImg.length,this.fullview(),this.playAnimation(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".iElement").attr("style");if(n.iRememberLast&&n.iFade!="Flow"){t.rmbLast=t.getFromUrl(),t.setElementTo(t.rmbLast);return}}},afterSubOverlayPreload:function(){this.preloadmodel&&(this.model.iOverlaylist.each(function(e){e.iview.preloaded||e.iview.afterpreload()}),this.model.iActionlist.each(function(e){e.iview.render()}),this.setTitle(0),this.preloadmodel.set("loaded",!0),this.preloadmodel.page.ipreloadlist.preloadcheck(null,!0,this.model))},playAnimation:function(){this.timeline&&this.timeline.clear();var e=this,t=0,n=this.getdetail(),r=n.iSlidetype,i=!1;this.$el.children(".Element").is(":hidden")&&(i=!0),this.delay=Number(n.iInterval)||2,this.autoplay=n.iAutoplay;var s=n.iRepeat?-1:0;this.iFade=n.iFade||0,this.timeline=new TimelineMax({paused:!0,repeat:s,onComplete:this.setRewind}),this.repeat=s,this.iRewind=n.iRewind,this.slipable=n.iSlipable,this.canSlip=!0,this.iDisplay=n.iDisplay,this.setTimeline();if(n.iFade=="Flow")return;this.autoplay?this.model._autoplay=!0:this.setSlideDisplay(0),this.onChangeSlideTo(0),this.slipable&&(this.control(),this.autoplay||this.$el.attr("data-iSlipable",!0))},_autoplay:function(){var e=!1;this.$el.children(".Element").is(":hidden")&&(e=!0),this.timeline&&(!e||interaction_view.ismobile)&&this.timeline.play(0)},setTimeline:function(){if(this.iFade=="Fade"||0)this.setFade();else if(this.iFade=="Slip")this.slideel.css("overflow","hidden"),this.setSlip();else if(this.iFade=="None")this.setNone();else{if(this.iFade!="Flip"){if(this.iFade=="Flow"){this.setFlowAll();return}return}this.iDisplay==2&&(this.slideel.wrapInner('<div class="slidewrap" style="width:100%;height:100%;position:absolute;"></div>'),this.slideel=this.slideel.children(".slidewrap")),this.slideel.hasClass("overflowhidden")&&(this.slideel.removeClass("overflowhidden"),this.slideel.parent().addClass("overflowhidden").css("border",this.slideel.css("border")).css("border-radius",this.slideel.css("border-radius")),this.slideel.css("border","none").css("border-radius","0")),this.setFlip()}this.slideel.children().first().css({opacity:1,left:0,top:0}).nextAll().css("opacity",0)},setFlowAll:function(){function o(e){var t=$(e).height()||r/e.width*e.height,n=$("<canvas></canvas>").attr({width:r,height:t}).css({"float":"left"});$(e).after(n),TweenMax.to(n,0,{transform:"matrix(1, 0, 0, -1, 0, 0)"});var i=n[0].getContext("2d");i.drawImage(e,0,0,r,t);var s=i.createLinearGradient(0,0,0,t);i.globalCompositeOperation="destination-in",s.addColorStop(1,"rgba(0,0,0,0.4)"),s.addColorStop(.6,"rgba(0,0,0,0)"),s.addColorStop(0,"rgba(0,0,0,0)"),i.fillStyle=s,i.fillRect(0,0,r,t)}function a(){u++;if(e.slidelength<=u){e.slideel.children().find("img").css({width:r}).each(function(e,t){o(t)}),e.slideel.children().animate({opacity:1});var n=e.slideel.parents("section.Presentation:first").attr("style");e.slideel.parents("section.Presentation:first").css({display:"block",visibility:"hidden"}),e.CoverFlow=e.slideel.children().coverflow({active:Math.floor((e.slidelength-1)/2),overlap:.3,perspectiveY:22,duration:300,beforeselect:function(t,n){e.model.trigger("slideTo",n.index)},select:function(t,n){e.currentIndex=n.index}}).width("+=100").height("100%"),e.slideel.children().children().each(function(e,n){var i=$(n).find("img").height();$(n).width(r),$(n).children().css({position:"absolute"}),$(n).find("img").css({bottom:t*.3+"px"}),$(n).find("canvas").css({bottom:t*.3-i+"px"})}),e.slideel.parents("section.Presentation:first").attr("style",n),e.setFlow(),f(),i.iRememberLast&&(e.rmbLast=e.getFromUrl(),e.setElementTo(e.rmbLast))}}function f(){if(e.slipable){var t=["mousedown","mousemove","mouseup"];e.isTouch()&&(t=["touchstart","touchmove","touchend touchcancel"]);var n=e.CoverFlow.parent().width();e.CoverFlow.on(t[0],function(r){function u(t){e.isTouch()&&(t=t.originalEvent.touches[0]);var r=(t.clientX-i)/n;return e.isTouch()&&(r*=2),r=Math.round(r*e.slidelength),r=o-r,r<0&&(r=0),r>=e.slidelength&&(r=e.slidelength-1),e.CoverFlow.coverflow("select",r),s=!0,!1}e.isTouch()&&(r=r.originalEvent.touches[0]);var i=r.clientX,s=!1,o=e.CoverFlow.children(".ui-state-active").index();$(document).on(t[1],u),$(document).one(t[2],function(){function n(){e.CoverFlow.data("CoverFlowDisableClick",!1)}return $(document).off(t[1],u),s&&e.CoverFlow.data("CoverFlowDisableClick",!0)&&setTimeout(n,10),!1}),e.isTouch()&&!s&&e.CoverFlow.coverflow("select",$(r.target).parent().index());if(!e.isTouch())return!1});var r=e.getdetail().iSlidetype?e.getdetail().iSlidetype:0;r=="æ¨ªå"||Number(r)==0?e.$el.children(".Element").addClass("enableMouseWheelX disableDragX"):e.$el.children(".Element").addClass("enableMouseWheelY disableDragY")}}var e=this,t=this.getcommon().iHeight,n=this.getcommon().iWidth,r=n*.7,i=this.getdetail();e.slideel.children().removeAttr("style").wrap("<div></div>"),e.slideel.wrapInner("<div></div>"),e.slideel.children().css({opacity:0});var s=_.pluck(i.iImg,_g.getUrlParameterByName("-playmode")=="1"?"thumbnail":"picture");_.each(s,function(e,n){var i=new Image;i.src=e,i.onload=function(){i.height/i.width*r>t*.7&&(r=t*.7/i.height*i.width),a()}});var u=0},isTouch:function(){return"ontouchstart"in document},testControl:function(){return!0},resetOtherStatus:function(){if(!this.slideel)return;var e=this,t=this.getdetail();t.iFade!="Flow"&&this.slideel.children().first().css({opacity:1,left:0,top:0}),this.autoplay=t.iAutoplay,this.currentIndex=0,this.currentSlideIndex=null,this.changeSlideNumber(),this.$el.children(".Element").removeClass("is_exceededX"),this.$el.children(".Element").removeClass("is_exceededY");if(this.timeline){var n=Math.floor((this.slidelength-1)/2);this.timeline.pause(1e-5);if(t.iRememberLast){e.rmbLast=e.getFromUrl(),e.setElementTo(e.rmbLast);return}if(t.iFade=="Flow"&&this.CoverFlow){this.currentIndex=n;try{this.CoverFlow.coverflow("select",n),this.currentIndex=n}catch(r){}}if(this.autoplay&&(!this.$el.children(".Element").is(":hidden")||interaction_view.ismobile)){if(t.iFade=="Flow"){this.timeline.play((n-1)*.3+n*this.delay);return}this.timeline.play(0)}else this.setSlideDisplay(0)}},fullview:function(){var e=this,t=this.getdetail();if(t.iFullview&&t.iImg&&t.iImg.length){this.$el.addClass("hasaction");if(t.iFade=="Flow"){e.isTouch()?e.slideel.hammer().on("tap",".ui-state-active",function(){e.fullviewIndex($(this).index())}):e.slideel.on("click",".ui-state-active",function(){e.fullviewIndex($(this).index())});return}this.$el.children(".Element").on("click",function(t){return e.stopFullviewByFlow?(e.stopFullviewByFlow=!1,!1):e.slipable&&!$(t.target).is(t.currentTarget)?!1:(e.currentIndex!=null&&e.currentIndex!="undefined"&&e.fullviewIndex(e.currentIndex),!1)})}},isFullSwitch:function(){var e=this.getdetail();return e.iSlipable},preview_left:function(e){e>0&&this.fullviewIndex(e-1)},preview_right:function(e){var t=this.getdetail();e<t.iImg.length-1&&this.fullviewIndex(e+1)},setTitle:function(e){var t=this.getdetail();if(!t.show_title)return;if(t.iImg&&t.iImg.length&&t.iImg[e]){var n=this.model.get("suboverlays"),r=interaction_view.formatLabel({text:t.iImg[e].title,font_size:n[0].iDetail.font_size,text_color:n[0].iDetail.text_color,iPosition:n[0].iDetail.iPosition});this.$el.find(".iTextLabel.Element").html(r)}},getFromUrl:function(e){var t=_g.getUrlParameterByName(this.model.id,e);return t||(t=_g.getHashParameterByName(this.model.id)),t},addToUrl:function(e){var t=this.getdetail();if(!t.iRememberLast)return!1;typeof message_link=="undefined"&&(message_link=document.location.href,interaction_view.weixin.share()),typeof e=="undefined"&&(e=this.currentIndex);var n=0,r=this.model.id+"="+encodeURI(e),i=_g.getUrlParameterByName(this.model.id,message_link);if(!i){var s="?";message_link.indexOf("?")>=0&&(s="&"),message_link+=s+r,interaction_view.weixin.share()}else encodeURI(i)!=encodeURI(e)?(message_link=_g.replaceUrlParameterByName(this.model.id,r,message_link),interaction_view.weixin.share()):n=1;if(!interaction_view.forpreview){var o=_g.getHashParameterByName(this.model.id);o?encodeURI(o)!=encodeURI(e)?window.history.replaceState({},"",_g.replaceHashParameterByName(this.model.id,r)):n=1:window.history&&(document.location.hash?window.history.replaceState({},"",document.location.hash+="&"+r):window.history.replaceState({},"","#"+r))}return n?!1:!0},setControl:function(e){var t=this.getdetail();this.addToUrl(),this.control(),this.canSlip=!0,!e&&!this.slipable&&(this.canSlip=!1)}})}),define("interaction_view/model/video",["interaction_view/model/base"],function(){interaction_view.model.Video=interaction_view.model.Base.extend({defaults:{iType:"Video",iLock:!0,iVisibility:!0,iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null,iBackground:"rgba(62,189,255,0.5)",iResourcesProperties:[{id:"iImg",type:"single"}],iAnimationProperties:[{id:"iAnimation",type:"object"}]},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.Video({model:this})},setsyncmodel:function(){},getFile:function(){var e=this.get("iDetail");return e.iFile&&e.iFile[0]?e.iFile[0].file:null}}),interaction_view.view.Video=interaction_view.view.Base.extend({events:{},render:function(e){this.file,this.model._reset=!0},setOtherDisplay:function(){this.model.media&&interaction_view.media.pause(this.model)},preload:function(){var e,t=this.getdetail();t.iFile&&t.iFile[0]&&(typeof epub360!="undefined"&&epub360.settings&&epub360.settings.disable_stream_media?e=t.iFile[0].file:typeof cbt_data=="undefined"||interaction_view.forpreview?_g.getUrlParameterByName("-playmode")=="1"?e=(t.iFile[0].file||t.iFile[0].content)+"_video.m3u8":_g.getUrlParameterByName("-playmode")=="2"?e=(t.iFile[0].file||t.iFile[0].content)+"_origin.mp4":interaction_view.ismobile?e=(t.iFile[0].file||t.iFile[0].content)+"_origin.mp4":e=(t.iFile[0].file||t.iFile[0].content)+"_videohd.m3u8":e=t.iFile[0].file||t.iFile[0].content,this.file=e),this.file&&(this.preloadmodel=this.sendToPreload({file:this.file}))},resetOtherStatus:function(){if(!this.model.hided&&this.model.media){this.model.hls?interaction_view.media.video.resetH(this.model,this):interaction_view.media.video.reset(this.model);var e=this.model.get("iDetail").iAutohide;e==null&&(e=!0),e?this.$el.addClass("hide"):this.model.get("iDetail").iControl&&this.$el.find(".jwdisplayIcon").css({opacity:1})}}})}),define("interaction_view/model/button",["interaction_view/model/base"],function(){interaction_view.model.Button=interaction_view.model.Base.extend({defaults:{iType:"Button",iVisibility:!0,iCommon:null,iDetail:null,iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){var t=this.get("iDetail");t.isSwitch&&(this.isSwitch=!0),this.iview=new interaction_view.view.Button({model:this})},setsyncmodel:function(){}}),interaction_view.view.Button=interaction_view.view.Base.extend({events:{},render:function(e){this.model._reset=!0},preload:function(){this.preloaded=!1,this.checkImglist=[];var e=this.getdetail(),t=[null,null];if(e.iconNormal&&e.iconNormal[0]){this.checkImglist.push(e.iconNormal[0].picture);var n=this.sendToPreload({file:e.iconNormal[0].picture,path:this.model.get("path"),isSubOverlay:this.model.get("isSubOverlay")});t[0]=n.id}if(e.iconActive&&e.iconActive[0]){this.checkImglist.push(e.iconActive[0].picture);var n=this.sendToPreload({file:e.iconActive[0].picture,path:this.model.get("path"),isSubOverlay:this.model.get("isSubOverlay")});t[1]=n.id}this.model.set("preload_id",t)},checkImgload:function(e){return this.checkImglist=_.reject(this.checkImglist,function(t){return t==e}),this.checkImglist.length==0?!0:!1},afterpreload:function(e){if(e&&this.preloaded)return;e&&!this.preloaded&&(this.preloaded=this.checkImgload(e)),this.preloaded&&(this.setZindex(),this.setElementDisplay(),this.setOtherDisplay(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".iElement").attr("style"))},setOtherDisplay:function(){this.active=!1,this.buttonon=!1;var e=this;this.$el.css("cursor","pointer");var t=this.getdetail();if(t.isSwitch)t.isMasterAudio&&this.$el.find(".iconNormal").addClass("animated infinite rotate c-time-20"),this.$el.on("click",function(n){e.changeStatus(),t.linktype!=undefined&&interaction_view.renderLink(t.linktype,t)});else{if(interaction_view.ismobile)var n="touchstart",r="touchend";else var n="mousedown",r="mouseup";this.$el.on(n,function(n){e.buttonon=!0,e.changeStatus(),t.linktype!=undefined&&interaction_view.renderLink(t.linktype,t)}),this.$el.on(r,function(t){e.buttonon&&(e.buttonon=!1,e.changeStatus())})}},changeStatus:function(){var e=this.getdetail(),t=this;if(!t.active){t.$el.find("img.iconActive").show(),t.$el.find("img.iconNormal").hide(),t.active=!0;if(e.isMasterAudio)try{var n=interaction_view.bgsound||interaction_view.imasterlist.at(0).iOverlaylist.where({iType:"Audio"})[0];interaction_view.media.pause(n)}catch(r){console.log(r)}}else{if(t.groupcontrol&&e.isSwitch)return;if(t.model.get("isTabBarButton"))return;t.$el.find("img.iconActive").hide(),t.$el.find("img.iconNormal").show(),t.active=!1;if(e.isMasterAudio)try{var n=interaction_view.bgsound||interaction_view.imasterlist.at(0).iOverlaylist.where({iType:"Audio"})[0];interaction_view.media.play(n)}catch(r){console.log(r)}}},setActiveStatus:function(){var e=this;e.$el.find("img.iconActive").show(),e.$el.find("img.iconNormal").hide(),e.active=!0},resetOtherStatus:function(){this.resetButtonStatus()},resetButtonStatus:function(){this.$el.find("img.iconActive").hide(),this.$el.find("img.iconNormal").show(),this.active=!1}})}),define("interaction_view/model/map",["interaction_view/model/base"],function(){interaction_view.model.Map=interaction_view.model.Base.extend({defaults:{iType:"Map",iLock:!0,iVisibility:!0,iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.Map({model:this})},setsyncmodel:function(){}}),interaction_view.view.Map=interaction_view.view.Base.extend({events:{},render:function(e){}})}),define("interaction_view/model/link",["interaction_view/model/base"],function(){interaction_view.model.Link=interaction_view.model.Base.extend({defaults:{iType:"Link",iLock:!0,iVisibility:!0,iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.Link({model:this})},setsyncmodel:function(){}}),interaction_view.view.Link=interaction_view.view.Base.extend({events:{},render:function(e){var t=this.getdetail();this.$el.on("click",function(e){t.linktype!=undefined&&interaction_view.renderLink(t.linktype,t)})}})}),define("interaction_view/model/SubContainer",["interaction_view/model/base","interaction_view/view/subcontainer"],function(){interaction_view.model.SubContainer=interaction_view.model.Base.extend({defaults:{iType:"SubContainer",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.setSubOverlays(),this.patchGridSize(),this.setiview()},createPath:function(){var e=interaction_view.createPath({path:this.get("path"),isSubOverlay:this.get("isSubOverlay"),page_id:this.get("pageid"),model:this});return e},setiview:function(){this.iview=new interaction_view.view.SubContainer({model:this})},setsyncmodel:function(){},GridPatch:!0,patchGridSize:function(){if(!this.GridPatch)return;var e=this.get("iCommon"),t=this.get("iDetail"),n=this.get("suboverlays");e[iPageDirection].iWidth=(t.iCols+1)*t.iColspace+n[0].iCommon[iPageDirection].iWidth*t.iCols,e[iPageDirection].iHeight=(t.iRows+1)*t.iRowspace+n[0].iCommon[iPageDirection].iHeight*t.iRows,this.set("iCommon",e)},getSubOverlays:function(){var e=this.get("iCommon"),t=this.get("iDetail"),n=[],r=this.get("suboverlays"),s=r[0],o=t.iRows,u=t.iCols;for(i=0;i<o;i++)for(j=0;j<u;j++)overlay=$.extend(!0,{},s),overlay.id=overlay.id+i+j,overlay.iCommon[iPageDirection].iStartx=t.iColspace*(j+1)+j*overlay.iCommon[iPageDirection].iWidth,overlay.iCommon[iPageDirection].iStarty=t.iRowspace*(i+1)+i*overlay.iCommon[iPageDirection].iHeight,n.push(overlay);return n},createImageSubOverlay:function(e){var t=e.iFullview,n={iType:"Image",iDetail:{iMask:!1,iFullview:e.iFullview,title:e.iImg[0].title,ratiofixxed:!1,iHidden:!1,iImg:e.iImg,iAdapt:!1,iDisplay:e.iDisplay||0},iCommon:{portait:{iWidth:e.iWidth,iHeight:e.iHeight,iStartx:e.iStartx,iStarty:e.iStarty},landscape:{iWidth:e.iWidth,iHeight:e.iHeight,iStartx:e.iStartx,iStarty:e.iStarty}},id:"Img"+_g.uuid(),iHidden:e.iHidden||!1,GalleryIndex:e.index};return n},GridReverse:function(){var e=this.get("iDetail");return e.iSlidetype?!1:!0},getOverlayPositionX:function(e,t,n,r){return this.GridReverse()?t*(n+1)+n*e.iCommon[iPageDirection].iWidth:t*(r+1)+r*e.iCommon[iPageDirection].iWidth},getOverlayPositionY:function(e,t,n,r){return this.GridReverse()?t*(r+1)+r*e.iCommon[iPageDirection].iHeight:t*(n+1)+n*e.iCommon[iPageDirection].iHeight}}),interaction_view.view.SubContainer=interaction_view.view.Base.extend({events:{},render:function(){this.renderBackGroud()},subPreLoadCheck:function(e){},preload:function(){var e=this.model.get("iDetail");this.sendToPreload({file:null,subcontainer:!0,path:this.model.get("path"),isSubOverlay:this.model.get("isSubOverlay")})},afterSubOverlayPreload:function(){console.log("preloadok"),this.preloadmodel&&(this.model.iOverlaylist.each(function(e){e.iview.preloaded||e.iview.afterpreload()}),this.model.iActionlist.each(function(e){e.iview.render()}),this.preloadmodel.set("loaded",!0),this.preloadmodel.page.ipreloadlist.preloadcheck(null,!0,this.model)),interaction_view.ismobile&&_g.ui.isOverflowed(this.$el.children(".Element")).y&&this.$el.children(".Element").addClass("iMouseWheel disableMouseWheelY disableDragY"),this.otherAfterSubOverlayPreload&&this.otherAfterSubOverlayPreload()},allowScroll:!0,resetOtherStatus:function(){if(!this.allowScroll)return!1}})}),define("interaction_view/model/Cell",["interaction_view/model/SubContainer"],function(){interaction_view.model.Cell=interaction_view.model.SubContainer.extend({defaults:{iType:"Cell",iLock:!0,iVisibility:!0,iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null,isStatic:!0},setiview:function(){this.iview=new interaction_view.view.Cell({model:this})},GridPatch:!1,getSubOverlays:function(){var e=this.get("iDetail"),t=[],n=this.get("suboverlays");return n}}),interaction_view.view.Cell=interaction_view.view.SubContainer.extend({allowScroll:!1})}),define("interaction_view/model/TextLabel",["interaction_view/model/base"],function(){interaction_view.model.TextLabel=interaction_view.model.Base.extend({defaults:{iType:"TextLabel",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.TextLabel({model:this})},setsyncmodel:function(){}}),interaction_view.view.TextLabel=interaction_view.view.Base.extend({events:{},render:function(e){var t=this.model.get("iDetail")}})}),define("interaction_view/model/gallery",["interaction_view/model/SubContainer"],function(){interaction_view.model.Gallery=interaction_view.model.SubContainer.extend({defaults:{iType:"Gallery",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSlideNumber:!0,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setiview:function(){this.iview=new interaction_view.view.Gallery({model:this})},getSubOverlays:function(){var e=this.get("iDetail"),t=this.get("iCommon"),n=[],r=this.get("suboverlays"),s=r[0],o=e.iRows,u=e.iCols;e.iMode||(e.iSlidetype?o=100:u=100);if(this.GridReverse()){var a=o;o=u,u=a}var f=0,l=0;if(e.iImg&&e.iImg.length){for(i=0;;i++){if(f>=e.iImg.length)break;i==o&&(i=0,l+=1);for(j=0;j<u;j++){if(f>=e.iImg.length)break;overlay=$.extend(!0,{},s),overlay.id=overlay.id+i+j+f,overlay.parent_index=l,overlay.suboverlays[0].iDetail.iText=interaction_view.formatLabel({text:_g.string.getUrlNameWithOutExt(e.iImg[f].title),font_size:overlay.suboverlays[0].iDetail.font_size,text_color:overlay.suboverlays[0].iDetail.text_color,iPosition:overlay.suboverlays[0].iDetail.iPosition}),e.show_title!=undefined&&!e.show_title&&overlay.suboverlays.shift();var c=this.createImageSubOverlay({iImg:[e.iImg[f]],iFullview:e.iFullscreen,iWidth:s.iCommon[iPageDirection].iWidth,iHeight:s.iCommon[iPageDirection].iHeight,iStartx:0,iStarty:0,iDisplay:Number(e.iDisplay),index:e.iSlipable?f:null});overlay.suboverlays.unshift(c),overlay.iCommon[iPageDirection].iStartx=this.getOverlayPositionX(overlay,e.iColspace,i,j),overlay.iCommon[iPageDirection].iStarty=this.getOverlayPositionY(overlay,e.iRowspace,i,j),overlay.iCommon[iPageDirection].iStartx>t[iPageDirection].iWidth&&(e.overflow_x=!0),overlay.iCommon[iPageDirection].iStarty>t[iPageDirection].iHeight&&(e.overflow_y=!0),n.push(overlay),f+=1}e.overflow_length=i+1}e.overflow_x&&(e.overflow_x=s.iCommon[iPageDirection].iWidth*e.overflow_length+e.iColspace*(e.overflow_length+1)),e.overflow_y&&(e.overflow_y=s.iCommon[iPageDirection].iHeight*e.overflow_length+e.iRowspace*(e.overflow_length+1)),l+=1}return e.slidelength=l,this.set("iDetail",e),n},patchGridSize:function(){if(!this.GridPatch)return;var e=this.get("iCommon"),t=this.get("iDetail"),n=this.get("suboverlays");if(t.iMode||!t.iMode&&t.iSlidetype)e[iPageDirection].iWidth=(t.iCols+1)*t.iColspace+n[0].iCommon[iPageDirection].iWidth*t.iCols;if(t.iMode||!t.iMode&&!t.iSlidetype)e[iPageDirection].iHeight=(t.iRows+1)*t.iRowspace+n[0].iCommon[iPageDirection].iHeight*t.iRows;this.set("iCommon",e)}}),interaction_view.view.Gallery=interaction_view.view.SubContainer.extend({otherAfterSubOverlayPreload:function(){var e=this.getSlideLength(),t=this.getdetail(),n=t.iCols*t.iRows;t.iMode||(n=t.iImg?t.iImg.length:0);if(e){var r=this.$el.children(".Element").children().detach(),s=0;for(i=0;i<e;i++){this.$el.children(".Element").append('<div class="gallery-content" data-index="'+i+'"></div>');for(j=0;j<n;j++){var o=this.$el.children(".Element").children().eq(i);o.append(r[s]),s+=1}}this.setSlidePosition()}},getSlideLength:function(){var e=this.getdetail();return e.slidelength||0},setSlidePosition:function(){var e=this.getdetail(),t=this.getcommon();e.iMode?(this.$el.children(".Element").addClass("hasSlide"),this.$el.children(".Element").css({overflow:"hidden"}),this.$el.children(".Element").children().each(function(){var e=$(this).index();$(this).css({position:"absolute",width:"100%",height:"100%"})}),this.playAnimation()):e.iSlidetype?(this.$el.children(".Element").css({overflow:"hidden"}),this.$el.children(".Element").children().each(function(){var e=$(this).index();$(this).css({position:"absolute",left:0,top:e*t.iHeight,width:"100%",height:"100%"})}),this.galleryFlow().y&&(this.$el.children(".Element").addClass("iMouseWheel disableMouseWheelY disableDragY"),this.scrollview=new IScroll(this.$el.children(".Element")[0],{mouseWheel:!0,probeType:3,scrollX:!1,scrollY:!0,click:!0,wrapperWidth:t.iWidth,wrapperHeight:t.iHeight,scrollerWidth:t.iWidth,scrollerHeight:e.overflow_y}))):(this.$el.children(".Element").css({overflow:"hidden"}),this.$el.children(".Element").children().each(function(){var e=$(this).index();$(this).css({position:"absolute",left:e*t.iWidth,top:0,width:"100%",height:"100%"})}),this.galleryFlow().x&&(this.$el.children(".Element").addClass("iMouseWheel disableMouseWheelX disableDragX"),this.scrollview=new IScroll(this.$el.children(".Element")[0],{mouseWheel:!0,probeType:3,scrollX:!0,scrollY:!1,click:!0,wrapperWidth:t.iWidth,wrapperHeight:t.iHeight,scrollerWidth:e.overflow_x,scrollerHeight:t.iHeight})))},playAnimation:function(){var e=this,t=0,n=this.getdetail(),r=n.iSlidetype;this.delay=Number(n.iInterval)||2,this.autoplay=n.iAutoplay,this.iFade="Slip";var i=0;this.timeline=new TimelineMax({paused:!0,repeat:i,onComplete:this.setRewind}),this.slideel=e.$el.children(".Element").first(),this.slidelength=this.getSlideLength(),this.repeat=i,this.iRewind=n.iRewind,this.slipable=!0,this.setTimeline(),this.autoplay?this.$el.children(".Element").is(":hidden")||this.timeline.play(0):this.setSlideDisplay(0),this.onChangeSlideTo(0),this.slipable&&(this.control(),this.autoplay||this.$el.attr("data-iSlipable",!0))},setTimeline:function(){if(this.iFade=="Fade"||0)this.setFade();else if(this.iFade=="Slip")this.setSlip();else{if(this.iFade!="None")return;this.setNone()}this.slideel.children().first().css({opacity:1,left:0,top:0}).nextAll().css("opacity",0)},testControl:function(){return!0},preview_left:function(e){e>0&&this.model.iOverlaylist.at(e-1).iOverlaylist.at(0).iview.$el.children(".Element").trigger("click")},preview_right:function(e){e<this.model.iOverlaylist.length-1&&this.model.iOverlaylist.at(e+1).iOverlaylist.at(0).iview.$el.children(".Element").trigger("click")},galleryFlow:function(){var e={x:!1,y:!1},t=this.getcommon(),n=this.getdetail();return n.overflow_x&&(e.x=!0),n.overflow_y&&(e.y=!0),e},resetOtherStatus:function(){var e=this;if(!this.allowScroll)return!1;this.$el.children(".Element").removeClass("is_exceededX"),this.$el.children(".Element").removeClass("is_exceededY"),typeof wx_permissions!="undefined"&&wx_permissions.previewImage&&e.$el.find(".iImage.Element").click(function(t){var n=e.$el.find(".iImage.Element").index($(this));e.fullviewIndex(n)})}})}),define("text!interaction_view/template/offline_info.js",[],function(){return'<div class="offline-shadow" style="background: rgba(218,218,218,0.7);left:0;top:0;width:100%;height:100%;position:absolute;display: block;">\n <div class="offline-text" style="line-height:<%=iCommon[iPageDirection].iHeight%>px;text-align: center;">\n   <i class="icon-warning-sign icon-4x" style="display: inline-block;">\n    <br>\n    <span style="background: #444444;color: #FFFFFF;padding: 8px;font-size: 14px;">è¯·å¨èç½çç¶æä¸ä½¿ç¨</span>\n   </i>\n </div>\n</div>\n '}),define("interaction_view/model/webcontent",["interaction_view/model/base","text!interaction_view/template/offline_info.js"],function(){var e=require("text!interaction_view/template/offline_info.js");interaction_view.model.WebContent=interaction_view.model.Base.extend({defaults:{iType:"WebContent",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.WebContent({model:this})},setsyncmodel:function(){}}),interaction_view.view.WebContent=interaction_view.view.Base.extend({events:{},render:function(){this.model.renderWebContent=!0},renderWebContent:function(e){var t=this,n=this.detail;if(!this.result){var r=this.result||interaction_view.getWebContentSrc(n);this.result=r}if(!this.result)return;if(!this.result.src&&!this.result.content)return;this.iframeStyle?(this.$el.children(".Element").html("<iframe></iframe>"),this.$el.children(".Element").children("iframe").attr("style",this.iframeStyle)):this.iframeStyle=this.$el.children(".Element").children("iframe").attr("style"),r=this.result,r&&r.src?this.$el.children(".Element").children("iframe")[0].src=r.src:r&&r.content&&(this.hasContent=r.content,this.$el.children(".Element").children("iframe")[0].contentWindow.document.write(r.content)),n.iOnline&&(interaction_view.isOnline||(interaction_view.isOnline==null?_g.device.online("http://www.epub360.com/staticfs/diazo/img/favicon.png",function(){interaction_view.isOnline=!0},function(){interaction_view.isOnline=!1,t.renderOfflineInfo()}):t.renderOfflineInfo()))},renderOfflineInfo:function(){this.$el.children(".Element").append(_.template(e,this.model.toJSON()))},clearWebContent:function(){this.$el.children(".Element").children("iframe").remove()}})}),define("interaction_view/model/shape",["interaction_view/model/base"],function(){interaction_view.model.Shape=interaction_view.model.Base.extend({setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.Shape({model:this})},setsyncmodel:function(){}}),interaction_view.view.Shape=interaction_view.view.Base.extend({events:{},render:function(e){var t=this;this.rotateShape(),this.isRotated=!0,this.$el.find("svg").attr("height","100%")},resetOtherStatus:function(){this.isRotated||this.rotateShape(),this.isRotated=!1},otherOnShow:function(){this.resetOtherStatus()},rotateShape:function(){if(typeof TweenMax=="undefined")return;TweenMax.set(this.$el.find(".iShape.Element"),{rotation:parseInt(this.getdetail().rotate)})}})}),define("text!interaction_view/template/prompt.js",[],function(){return'<div class="<%=class_name%>" style="display:none;">\n	<div class="modalArea" style="position: fixed;top: 50%;left: 50%;z-index: 10003;background: white;box-shadow: 0 0 60px rgba(0, 0, 0, .25); width: 480px;height: 235px; margin-left: -240px;margin-top: -120px;text-align: center;">\n		<div class="alert" style="text-align:left; margin-bottom: 0px;">è¾å¥æå­ :</div>\n		<div style="padding: 10px 10px 10px;">\n			<textarea style="resize: none; width: 96%;height: 120px;border: 0px;" autofocus="autofocus"></textarea>\n			<div style="margin: 10px;">\n				<button type="button" style="margin-right: 40px;border-radius: 18px 18px;padding: 7px 28px;" class="btn btn-default cancel">åæ¶</button>\n				<button type="button" style="border-radius: 18px 18px;padding: 7px 28px;" class="btn btn-danger ok">ç¡®è®¤</button>\n			</div>\n		</div>\n	</div>\n	<div class="modal-backdrop fade in" style="z-index: 10002;"></div>\n</div>'}),define("interaction_view/model/paragraph",["interaction_view/model/base","text!interaction_view/template/prompt.js"],function(){var e=require("text!interaction_view/template/prompt.js");interaction_view.model.Paragraph=interaction_view.model.Base.extend({defaults:{iType:"Paragraph",iLock:!0,iVisibility:!0,iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.Paragraph({model:this})},setsyncmodel:function(){}}),interaction_view.view.Paragraph=interaction_view.view.Base.extend({events:{},render:function(e){this.scrollEl=this.$el.children(".Element"),this.textel=this.$el.find(".iText"),this.originContent=this.model.attributes.iDetail.iText,typeof this.userContent=="undefined"&&(this.userContent=this.originContent),typeof message_link=="undefined"&&(message_link=location.href,interaction_view.weixin.share());var t=this.model.attributes.iDetail.iEditable?message_link:data_link,n=_g.getUrlParameterByName(this.model.id,t);if(n)this.updateText(n,addtourl=0);else{var r=_g.getHashParameterByName(this.model.id);r&&this.updateText(r,addtourl=0)}this.renderEdit(),this.model.attributes.iDetail.iEditable&&this.$el.find(".iParagraph").addClass("editable"),this.renderlink&&this.renderlink(),this.model._reset=!0},resetOtherStatus:function(){var e=this;if(this.$el.children(".Element").find(".paragraph").length){if(this.$el.children(".Element").find(".paragraph").first().children("div").length&&_g.ui.isOverflowed(this.$el.children(".Element").find(".paragraph").first().children("div")).y){if(!this.$el.children(".Element").hasClass("disableDragY")){var t=this.$el.find(".paragraph").first().children("div"),n=t.height();t.wrapInner('<div class="iContent" style="font-size: inherit;color: inherit;font-family: inherit;font-weight:inherit;"></div>');var r=_g.ui.isOverflowed(t).y-n;this.scrollView=new IScroll(t[0],{mouseWheel:!0,click:!0,probeType:3,wrapperHeight:n,HWCompositing:!1}),this.scrollView.on("scroll",function(){console.log(this.y),r&&r>0&&(this.y>0?this.y>30&&e.scrollEl.addClass("is_exceededY"):Math.abs(this.y)-r>30&&e.scrollEl.addClass("is_exceededY"))}),this.scrollEl=this.$el.children(".Element"),this.$el.children(".Element").addClass("disableDragY iMouseWheel disableMouseWheelY")}this.$el.children(".Element").removeClass("is_exceededX"),this.$el.children(".Element").removeClass("is_exceededY")}}else if(_g.ui.isOverflowed(this.$el.children(".Element")).y){if(!this.$el.children(".Element").hasClass("disableDragY")){var n=this.$el.children(".Element").height();this.$el.children(".Element").wrapInner('<div class="iContent"></div>');var r=_g.ui.isOverflowed(this.$el.children(".Element")).y-n;this.scrollView=new IScroll(this.$el.children(".Element")[0],{mouseWheel:!0,click:!0,probeType:3}),this.scrollView.on("scroll",function(){console.log(this.y),r&&r>0&&(this.y>0?this.y>30&&e.scrollEl.addClass("is_exceededY"):Math.abs(this.y)-r>30&&e.scrollEl.addClass("is_exceededY"))}),this.scrollEl=this.$el.children(".Element"),this.$el.children(".Element").addClass("disableDragY iMouseWheel disableMouseWheelY")}this.$el.children(".Element").removeClass("is_exceededX"),this.$el.children(".Element").removeClass("is_exceededY")}},otherOnShow:function(){this.resetOtherStatus()},renderEdit:function(){var t=this,n=this.getdetail();if(n.iStaticImage||!n.iEditable)return;var r="ParagraphInput",i=_.template(e,{class_name:r});t.activeEdit=function(e){if(!interaction_view.environment.Paragraph.state()&&!e)return;var n=$("."+r);n.length||(n=$(i).appendTo("body")),n.show().attr("paragraph-id",t.model.id);var s=n.find(".modalArea");interaction_view.ismobile&&s.width($(document).width()),_g.ui.center({Item:s}),n.find("button.cancel").one("click",function(){n.remove()}),n.find("button.ok").one("click",function(){if(n.attr("paragraph-id")!=t.model.id)return;n.remove(),t.updateText("<div>"+n.find("textarea").val().replace(/\n/g,"</div><div>")+"</div>",addtourl=1)}),n.find("textarea").val(t.userContent.replace(/<br>/g,"\n").replace(/<\/div><div>/g,"\n").replace("<div>","").replace("</div>",""));var o=function(){n.find("textarea").focus().click(function(){$(this).focus()})};setTimeout(o,300)},t.$el.on("click",function(){t.activeEdit()})},updateText:function(e,t){this.userContent=e;var n=e.replace(/<div>/g,"(div)").replace(/<\/div>/g,"(/div)");n=_g.util.htmlspecialchars(n);var r=n.replace(/\(div\)/g,"<div>").replace(/\(\/div\)/g,"</div>");this.textel.html(r);var i=!1;t&&(this.addToUrl(e),i=!0),this.model.attributes.iDetail.iText=r,this.resetOtherStatus(),i&&interaction_view.events.onParagraphChanged(this)},addToUrl:function(e){var t=this.model.id+"="+encodeURI(e),n=this.model.attributes.iDetail.iEditable?message_link:data_link,r=_g.getUrlParameterByName(this.model.id,n),i=0;if(!r){var s="?";n.indexOf("?")>=0&&(s="&"),n+=s+t}else encodeURI(r)!=encodeURI(e)?n=_g.replaceUrlParameterByName(this.model.id,t,n):i=1;i||(this.model.attributes.iDetail.iEditable?(message_link=n,interaction_view.weixin.share()):data_link=n);if(!interaction_view.forpreview&&!interaction_view.weixin.shareable()&&this.model.attributes.iDetail.iEditable){var o=_g.getHashParameterByName(this.model.id);o?encodeURI(o)!=encodeURI(e)?window.history.replaceState({},"",_g.replaceHashParameterByName(this.model.id,t)):i=1:window.history&&(document.location.hash?window.history.replaceState({},"",document.location.hash+="&"+t):window.history.replaceState({},"","#"+t))}return i?!1:!0}})}),define("interaction_view/model/input",["interaction_view/model/base"],function(){interaction_view.model.Input=interaction_view.model.Base.extend({defaults:{iType:"Input",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.Input({model:this})},setsyncmodel:function(){}}),interaction_view.view.Input=interaction_view.view.Base.extend({events:{},render:function(e){var t=this;this.$el.find("input").on("input",function(){console.log($(this).val()),interaction_view.events.onFormEvent(t.model,$(this).val())});var n=interaction_view.events.onFormButtonRender(this.model);n.value&&this.$el.find("input").val(n.value),this.setFormFieldType(n.field)},resetOtherStatus:function(){var e=interaction_view.events.onFormButtonRender(this.model);e.value&&this.$el.find("input").val(e.value)},setFormFieldType:function(e){if(!e||!interaction_view.ismobile)return;var t="text";console.log(e);var n=e.i.field_type;n=="number"&&(t="number"),n=="email"&&(t="email"),n=="url"&&(t="url"),t!="text"&&this.$el.find("input")[0].setAttribute("type",t)}})}),define("interaction_view/model/textarea",["interaction_view/model/base"],function(){interaction_view.model.Textarea=interaction_view.model.Base.extend({defaults:{iType:"Textarea",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.Textarea({model:this})},setsyncmodel:function(){}}),interaction_view.view.Textarea=interaction_view.view.Base.extend({events:{},render:function(e){var t=this;this.$el.find("textarea").on("input",function(){console.log($(this).val()),interaction_view.events.onFormEvent(t.model,$(this).val())});var n=interaction_view.events.onFormButtonRender(this.model);n.value&&this.$el.find("textarea").html(n),this.model._reset=!0},resetOtherStatus:function(){var e=interaction_view.events.onFormButtonRender(this.model);e.value&&this.$el.find("textarea").html(e)}})}),define("interaction_view/model/selectbutton",["interaction_view/model/button"],function(){interaction_view.model.SelectButton=interaction_view.model.Button.extend({defaults:{iType:"SelectButton",iVisibility:!0,iCommon:null,iDetail:null,iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0},setview:function(e){var t=this.get("iDetail");t.isSwitch&&(this.isSwitch=!0),this.iview=new interaction_view.view.SelectButton({model:this})}}),interaction_view.view.SelectButton=interaction_view.view.Button.extend({events:{},render:function(e){var t=interaction_view.events.onFormButtonRender(this.model);t.value&&this.setActiveStatus()},afterpreload:function(e){if(e&&this.preloaded)return;e&&!this.preloaded&&(this.preloaded=this.checkImgload(e)),this.preloaded&&(this.setZindex(),this.setElementDisplay(),this.setOtherDisplay(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".iElement").attr("style"))},setOtherDisplay:function(){this.active=!1,this.buttonon=!1;var e=this;this.$el.css("cursor","pointer");var t=this.getdetail();if(t.isSwitch)this.$el.on("click",function(t){e.changeStatus()});else{if(interaction_view.ismobile)var n="touchstart",r="touchend";else var n="mousedown",r="mouseup";this.$el.on(n,function(t){e.buttonon=!0,e.changeStatus()}),this.$el.on(r,function(t){e.buttonon&&(e.buttonon=!1,e.changeStatus())})}},changeStatus:function(){var e=this.getdetail(),t=this;if(!t.active)t.$el.find("img.iconActive").show(),t.$el.find("img.iconNormal").hide(),t.active=!0,e.isSwitch&&interaction_view.events.onFormEvent(t.model,t.active);else{if(t.groupcontrol&&e.isSwitch)return;if(interaction_view.application.isBindingButton(t.model))return;if(t.model.get("isTabBarSelectButton"))return;t.$el.find("img.iconActive").hide(),t.$el.find("img.iconNormal").show(),t.active=!1,interaction_view.events.onFormEvent(t.model,t.active)}},resetOtherStatus:function(){this.resetButtonStatus()},resetButtonStatus:function(){this.$el.find("img.iconActive").hide(),this.$el.find("img.iconNormal").show(),this.active=!1;var e=interaction_view.events.onFormButtonRender(this.model);e.value&&this.setActiveStatus()}})}),define("interaction_view/model/submitbutton",["interaction_view/model/button"],function(){interaction_view.model.SubmitButton=interaction_view.model.Button.extend({defaults:{iType:"SubmitButton",iVisibility:!0,iCommon:null,iDetail:null,iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0},setview:function(e){var t=this.get("iDetail");t.isSwitch&&(this.isSwitch=!0),this.iview=new interaction_view.view.SubmitButton({model:this})}}),interaction_view.view.SubmitButton=interaction_view.view.Button.extend({events:{},render:function(e){},afterpreload:function(e){if(e&&this.preloaded)return;e&&!this.preloaded&&(this.preloaded=this.checkImgload(e)),this.preloaded&&(this.setZindex(),this.setElementDisplay(),this.setOtherDisplay(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".iElement").attr("style"))},setOtherDisplay:function(){this.active=!1,this.buttonon=!1;var e=this;this.$el.css("cursor","pointer");var t=this.getdetail();if(t.isSwitch)this.$el.on("click",function(t){e.changeStatus(),interaction_view.events.onFormEvent(e.model)});else{if(interaction_view.ismobile)var n="touchstart",r="touchend";else var n="mousedown",r="mouseup";this.$el.on(n,function(t){e.buttonon=!0,e.changeStatus()}),this.$el.on(r,function(t){e.buttonon&&(e.buttonon=!1,e.changeStatus(),window.setTimeout(function(){interaction_view.events.onFormEvent(e.model)},500))})}},changeStatus:function(){var e=this.getdetail(),t=this;if(!t.active)t.$el.find("img.iconActive").show(),t.$el.find("img.iconNormal").hide(),t.active=!0;else{if(t.groupcontrol&&e.isSwitch)return;if(t.model.get("isTabBarSubmitButton"))return;t.$el.find("img.iconActive").hide(),t.$el.find("img.iconNormal").show(),t.active=!1}},resetOtherStatus:function(){this.resetSubmitButtonStatus()},resetSubmitButtonStatus:function(){this.$el.find("img.iconActive").hide(),this.$el.find("img.iconNormal").show(),this.active=!1}})}),define("interaction_view/model/selectbox",["interaction_view/model/base"],function(){interaction_view.model.SelectBox=interaction_view.model.Base.extend({defaults:{iType:"SelectBox",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.SelectBox({model:this})},setsyncmodel:function(){}}),interaction_view.view.SelectBox=interaction_view.view.Base.extend({events:{},render:function(e){var t=this;this.$el.find("input").on("change",function(){var e=$(this).is(":checked");interaction_view.events.onFormEvent(t.model,e);if($(this).closest(".layer-mask").length){var n=this;setTimeout(function(){e?$(n).attr("checked","checked"):$(n).removeAttr("checked")},100)}});var n=interaction_view.events.onFormButtonRender(this.model);n.value&&this.$el.find("input").attr("checked","checked"),n.field!=null&&n.field.i.field_type=="radio"&&this.$el.find("input")[0].setAttribute("type","radio")},resetOtherStatus:function(){this.resetButtonStatus()},resetButtonStatus:function(){interaction_view.application.isBindingButton(this.model)&&(this.isRadio=!0,this.$el.find("input")[0].setAttribute("type","radio"));var e=interaction_view.events.onFormButtonRender(this.model);e.value?this.$el.find("input").attr("checked","checked"):this.$el.find("input").removeAttr("checked")}})}),define("interaction_view/model/imageblock",["interaction_view/model/image"],function(){interaction_view.model.ImageBlock=interaction_view.model.Base.extend({setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.ImageBlock({model:this})},setsyncmodel:function(){}}),interaction_view.view.ImageBlock=interaction_view.view.Base.extend({render:function(){this.renderMask(),this.renderDraggable(),this.firstRender=!0,this.isEraserSet=!1,this.renderEdit();var e=this.$el.find(".Element");e.css("-moz-border-radius-topleft",e.css("border-top-left-radius")),e.css("-moz-border-radius-topright",e.css("border-top-right-radius")),e.css("-moz-border-radius-bottomleft",e.css("border-bottom-left-radius")),e.css("-moz-border-radius-bottomright",e.css("border-bottom-right-radius")),e.css("-webkit-border-top-left-radius",e.css("border-top-left-radius")),e.css("-webkit-border-top-right-radius",e.css("border-top-right-radius")),e.css("-webkit-border-bottom-left-radius",e.css("border-bottom-left-radius")),e.css("-webkit-border-bottom-right-radius",e.css("border-bottom-right-radius"));var t=this.getdetail();t.linktype!=undefined&&e.on("click",function(e){interaction_view.renderLink(t.linktype,t)})},getArgs:function(){var e=this,t=this.getdetail();if(t.iEditable){var n=e.getFromUrl().split(",");if(n.length<5)return;t.iImg[0].picture=n[0]||t.iImg[0].picture,e.args=n,e.model._rotate=n[4],e.model._scale=n[3],e.model._x=n[1],e.model._y=n[2]}},preload:function(){this.getArgs()},setOtherDisplay:function(){var e=this.getdetail(),t=this.$el.children(".Element").find("img").first();if(this.args){var n=this.args[4],r=this.args[3],i=this.args[1],s=this.args[2],o="rotate("+n+"deg) scale("+r+") skew(0deg) translate("+i+"px ,"+s+"px)";t.css({"-webkit-transform":o,width:"100%",height:"auto"}),t.parent().css({overflow:"hidden"});return}var e=this.getdetail();e.iImg&&e.iImg.length>0&&e.iMask&&e.iMask_data.iSlipable&&(this.renderMask(),this.setMaskSlipable({items:this.$el.children(".Element").find("img").first(),containment:this.$el.children(".Element").children(),contentel:this.$el.children(".Element").find("img").first(),content_x:e.iMask_data.x,content_y:e.iMask_data.y})),e.iDisplay&&e.iImg&&e.iImg.length>0&&(this.$el.children(".Element").find("img").length?_g.ui.fitImage({fit:Number(e.iDisplay),width:e.iImg[0].width,height:e.iImg[0].height,items:this.$el.children(".Element").find("img"),parentHeight:parseInt(this.$el.children(".Element").css("height")),parentWidth:parseInt(this.$el.children(".Element").css("width"))}):_g.ui.fitImage({fit:Number(e.iDisplay),containment:this.$el.children(".Element").find(".image_wrap").first()})),e.iFullview&&this.fullview(),e.iEraser&&(this.model._reset=!0,this.el_str=this.$el.children(".Element").html(),this.setEraser())},getFromUrl:function(){var e=_g.getUrlParameterByName(this.model.id,message_link);return e||(e=_g.getHashParameterByName(this.model.id)),decodeURI(e||"")},removeFromUrl:function(){var e=_g.getUrlParameterByName(this.model.id,message_link);e&&(message_link=_g.replaceUrlParameterByName(this.model.id,"",message_link),message_link=message_link.replace("&&","&").replace("?&","?"),interaction_view.weixin.share());var t=_g.getHashParameterByName(this.model.id);if(t){var n=_g.replaceHashParameterByName(this.model.id,"");window.history.replaceState({},"",n.replace("#&","#").replace("&&","&"))}return!e&&!t?!1:!0},addToUrl:function(e,t,n,r,i){var s=this,o=this.getdetail(),u=(e==o.iImg[0].origin?"":e)+","+t+","+n+","+r+","+i,a=this.model.id+"="+encodeURI(u),f=_g.getUrlParameterByName(this.model.id,message_link),l=0;if(!f){var c="?";message_link.indexOf("?")>=0&&(c="&"),message_link+=c+a,interaction_view.weixin.share()}else encodeURI(f)!=encodeURI(a)?(message_link=_g.replaceUrlParameterByName(this.model.id,a,message_link),interaction_view.weixin.share()):l=1;if(!interaction_view.forpreview){var h=_g.getHashParameterByName(this.model.id);h?encodeURI(h)!=encodeURI(a)?window.history.replaceState({},"",_g.replaceHashParameterByName(this.model.id,a)):l=1:window.history&&(document.location.hash?window.history.replaceState({},"",document.location.hash+="&"+a):window.history.replaceState({},"","#"+a))}return l?!1:!0},renderMask:function(){var e=this.getdetail();e.iMask&&(this.$el.children(".Element").find("img").first().css({translate:[e.iMask_data.x,e.iMask_data.y]}),this.iScrollview&&this.iScrollview.scrollTo(e.iMask_data.x,e.iMask_data.y))},renderEdit:function(){var e=this,t=this.getdetail();if(!t.iEditable)return;e.activeEdit=function(t){if(!interaction_view.environment.Paragraph.state()&&!t)return;typeof wx_permissions!="undefined"&&wx_permissions.chooseImage&&(interaction_view.localIds?setTimeout(function(){e.setweixinimage(interaction_view.localIds[0])},100):interaction_view.weixin.chooseimage(function(t){t&&(interaction_view.localIds=t,e.setweixinimage(t[0]))}))},e.$el.children(".Element").on("click",function(){e.activeEdit(!0)})},setweixinimage:function(e){var t=this,n=e;this.$el.find("img").attr("src",n);var r=this.getcommon(),i=r.iWidth,s=r.iHeight,o=this.model;interaction_view.imageEditor(this.model,i,s,n,function(e,r,i,s){var u=t.$el.children(".Element").find("img").first();o._x=e,o._y=r,o._scale=i,o._rotate=s;if(t.model.localId&&t.model.localId==n){t.addToUrl(t.model.pic,e,r,i,s);return}_g.device.ios()&&u.attr("src",n),interaction_view.imageUploader(n,function(o){_g.device.android()&&u.attr("src",o),t.model.localId=n,t.model.pic=o;var a=t.getdetail();a.iImg[0].picture=o,t.addToUrl(o,e,r,i,s)})},t.setweixinimage)},resetOtherStatus:interaction_view.view.Image.prototype.resetOtherStatus,fullview:interaction_view.view.Image.prototype.fullview,getLayerContentSize:interaction_view.view.Image.prototype.getLayerContentSize,setEraser:interaction_view.view.Image.prototype.setEraser,resetEraser:interaction_view.view.Image.prototype.resetEraser,isFullSwitch:interaction_view.view.Image.prototype.isFullSwitch,getGalleryModel:interaction_view.view.Image.prototype.getGalleryModel,repaint:interaction_view.view.Image.prototype.repaint,onShow:interaction_view.view.Image.prototype.onShow,getDragCopy:interaction_view.view.Image.prototype.getDragCopy,getClientXY:interaction_view.view.Image.prototype.getClientXY,resetDragDrop:interaction_view.view.Image.prototype.resetDragDrop,setDraggable:interaction_view.view.Image.prototype.setDraggable,activeDragDrop:interaction_view.view.Image.prototype.activeDragDrop,getDropXY:interaction_view.view.Image.prototype.getDropXY,resetDragDropStatus:interaction_view.view.Image.prototype.resetDragDropStatus,renderDraggable:interaction_view.view.Image.prototype.renderDraggable,drag_dragend:interaction_view.view.Image.prototype.drag_dragend,drag_dragin:interaction_view.view.Image.prototype.drag_dragin,renderCopyDraggable:interaction_view.view.Image.prototype.renderCopyDraggable,copy_dragend:interaction_view.view.Image.prototype.copy_dragend,old_transit_back:interaction_view.view.Image.prototype.old_transit_back,trigger_dragin_event:interaction_view.view.Image.prototype.trigger_dragin_event,trigger_drop_event:interaction_view.view.Image.prototype.trigger_drop_event})}),define("interaction_view/model/weixincamera",["interaction_view/model/button"],function(){interaction_view.model.WeixinCamera=interaction_view.model.Button.extend({defaults:{iType:"WeixinCamera",iVisibility:!0,iCommon:null,iDetail:null,iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null},setview:function(e){var t=this.get("iDetail");t.isSwitch&&(this.isSwitch=!0),this.iview=new interaction_view.view.WeixinCamera({model:this})}}),interaction_view.view.WeixinCamera=interaction_view.view.Button.extend({events:{},render:function(e){},afterpreload:function(e){if(e&&this.preloaded)return;e&&!this.preloaded&&(this.preloaded=this.checkImgload(e)),this.preloaded&&(this.setZindex(),this.setElementDisplay(),this.setOtherDisplay(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".iElement").attr("style"))},setOtherDisplay:function(){this.active=!1,this.buttonon=!1;var e=this;this.$el.css("cursor","pointer");var t=this.getdetail();if(interaction_view.ismobile)var n="touchstart",r="touchend";else var n="mousedown",r="mouseup";this.$el.on(n,function(t){e.buttonon=!0,e.changeStatus()}),this.$el.on(r,function(t){e.buttonon&&(e.buttonon=!1,e.changeStatus(),_g.device.isWeixin()?window.setTimeout(function(){interaction_view.weixin.chooseimage(function(t){t?(interaction_view.localIds=t,interaction_view.events.onWeixinEvent(e,71)):interaction_view.events.onWeixinEvent(e,72)})},500):interaction_view.errorAlert("è¯·å¨å¾®ä¿¡ä¸­æä½"))})},changeStatus:function(){var e=this.getdetail(),t=this;t.active?(t.$el.find("img.iconActive").hide(),t.$el.find("img.iconNormal").show(),t.active=!1):(t.$el.find("img.iconActive").show(),t.$el.find("img.iconNormal").hide(),t.active=!0)},resetOtherStatus:function(){this.resetWeixinCameraStatus()},resetWeixinCameraStatus:function(){this.$el.find("img.iconActive").hide(),this.$el.find("img.iconNormal").show(),this.active=!1}})}),define("interaction_view/model/weixinvoice",["interaction_view/model/button"],function(){interaction_view.model.WeixinVoice=interaction_view.model.Button.extend({defaults:{iType:"WeixinVoice",iVisibility:!0,iCommon:null,iDetail:null,iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null},setview:function(e){var t=this.get("iDetail");t.isSwitch&&(this.isSwitch=!0),this.iview=new interaction_view.view.WeixinVoice({model:this})}}),interaction_view.view.WeixinVoice=interaction_view.view.Button.extend({events:{},render:function(e){},afterpreload:function(e){if(e&&this.preloaded)return;e&&!this.preloaded&&(this.preloaded=this.checkImgload(e)),this.preloaded&&(this.setZindex(),this.setElementDisplay(),this.setOtherDisplay(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".iElement").attr("style"))},setOtherDisplay:function(){this.active=!1,this.buttonon=!1;var e=this;this.$el.css("cursor","pointer");var t=this.getdetail();if(interaction_view.ismobile)var n="touchstart",r="touchend";else var n="mousedown",r="mouseup";this.$el.on(n,function(t){e.buttonon=!0,e.changeStatus()}),this.$el.on(r,function(t){e.buttonon&&(e.buttonon=!1,e.changeStatus(),_g.device.isWeixin()?window.setTimeout(function(){interaction_view.voiceEditor(function(t){t?(interaction_view.voicelocalId=t,interaction_view.events.onWeixinEvent(e,71)):interaction_view.events.onWeixinEvent(e,72)})},500):interaction_view.errorAlert("è¯·å¨å¾®ä¿¡ä¸­æä½"))})},changeStatus:function(){var e=this.getdetail(),t=this;t.active?(t.$el.find("img.iconActive").hide(),t.$el.find("img.iconNormal").show(),t.active=!1):(t.$el.find("img.iconActive").show(),t.$el.find("img.iconNormal").hide(),t.active=!0)},resetOtherStatus:function(){this.resetWeixinVoiceStatus()},resetWeixinVoiceStatus:function(){this.$el.find("img.iconActive").hide(),this.$el.find("img.iconNormal").show(),this.active=!1}})}),define("interaction_view/model/textbutton",["interaction_view/model/paragraph"],function(){interaction_view.model.TextButton=interaction_view.model.Paragraph.extend({defaults:{iType:"TextButton",iSync:!1},setview:function(){this.iview=new interaction_view.view.TextButton({model:this})}}),interaction_view.view.TextButton=interaction_view.view.Paragraph.extend({renderlink:function(){var e=this;if(interaction_view.forpreview)return!1;var t=this.model.get("iDetail");this.$el.children(".Element").on("click",function(){t.linktype!=undefined&&interaction_view.renderLink(t.linktype,t)})}})}),define("interaction_view/model/usersvg",["interaction_view/model/base"],function(){interaction_view.model.UserSVG=interaction_view.model.Base.extend({defaults:{},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.UserSVG({model:this})},setsyncmodel:function(){}}),interaction_view.view.UserSVG=interaction_view.view.Base.extend({resetOtherStatus:function(){},render:function(){var e=this.model.page.iAnimationlist.where({overlay_id:this.model.id,iType:702});if(e.length>0){if(typeof TweenMax=="undefined")return;TweenMax.set(this.$el.find("svg").find("path"),{display:"none"});var t=e[0].attributes.iDetail.pathIndex;if(t.length>0){if(t.find)var n=t.find(function(e){return e.selected!=null});else var n=_.find(t,function(e){return e.selected!=null});if(n){var r=n.id;TweenMax.set(this.$el.find("svg").find("path#"+n.id),{display:"block"})}}}}})}),define("interaction_view/model/select",["interaction_view/model/base"],function(){interaction_view.model.Select=interaction_view.model.Base.extend({defaults:{iType:"Select",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(e){this.iview=new interaction_view.view.Select({model:this})},setsyncmodel:function(){}}),interaction_view.view.Select=interaction_view.view.Base.extend({events:{},render:function(e){var t=this,n=this.getdetail();this.$el.find("select").on("change",function(){console.log($(this).val()),interaction_view.events.onFormEvent(t.model,$(this).val())});var r=interaction_view.events.onFormButtonRender(this.model);console.log(r),this.$el.find("select").empty(),n.placeholder&&this.$el.find("select").append("<option>"+n.placeholder+"</option>");if(r.field){var i=r.field.i.field_options.options;for(var s=0;s<i.length;s++)this.$el.find("select").append("<option value="+i[s].label+">"+i[s].label+"</option>");r.value&&this.$el.find("select").val(r.value)}},resetOtherStatus:function(){var e=interaction_view.events.onFormButtonRender(this.model);e.value&&this.$el.find("select").val(e.value)}})}),define("interaction_view/model/qqvideo",["interaction_view/model/video"],function(){interaction_view.model.QQVideo=interaction_view.model.Video.extend({defaults:{iType:"QQVideo",iLock:!0,iVisibility:!0,iCommon:{},iDetail:{},iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,callback:null},setview:function(e){this.iview=new interaction_view.view.QQVideo({model:this})}}),interaction_view.view.QQVideo=interaction_view.view.Video.extend({events:{},render:function(e){this.file,this.model._reset=!0},setOtherDisplay:function(){this.model.media&&interaction_view.media.pause(this.model)},preload:function(){var e,t=this.getdetail();t.vid&&(this.preloadmodel=this.sendToPreload({vid:t.vid}))},resetOtherStatus:function(){this.model.hided||this.model.media&&(interaction_view.media.video.reset(this.model),this.model.get("iDetail").iControl&&this.$el.find(".jwdisplayIcon").css({opacity:1}))}})}),define("_e/wx_components",["interaction_view/model/action","interaction_view/model/animation_view","interaction_view/model/audio","interaction_view/model/cycleimage","interaction_view/model/image","interaction_view/model/page","interaction_view/model/doc","interaction_view/model/preload","interaction_view/model/richtext","interaction_view/model/slide","interaction_view/model/video","interaction_view/model/button","interaction_view/model/map","interaction_view/model/link","interaction_view/model/Cell","interaction_view/model/TextLabel","interaction_view/model/gallery","interaction_view/model/webcontent","interaction_view/model/shape","interaction_view/model/paragraph","interaction_view/model/input","interaction_view/model/textarea","interaction_view/model/selectbutton","interaction_view/model/submitbutton","interaction_view/model/selectbox","interaction_view/model/imageblock","interaction_view/model/weixincamera","interaction_view/model/weixinvoice","interaction_view/model/textbutton","interaction_view/model/usersvg","interaction_view/model/select","interaction_view/model/qqvideo"],function(){}),define("text!interaction_view/template/alertbox.js",[],function(){return'<div class="alert-box"><div class="alert-msg"><%=text%></div><div class="alert-title"><a class="alert-confirm" href="#">ç¡®å®</a></div></div>'}),define("interaction_view/ui/main",["jquery","backbone","text!interaction_view/template/message.js","text!interaction_view/template/alertbox.js"],function(){var e=require("text!interaction_view/template/message.js"),t=require("text!interaction_view/template/alertbox.js");return window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelnimationFrame,{message:function(t,n,r){$("body").find(".msg").length==0&&$("body").append('<div class="msg"></div>'),r||(r=3e3),$(".msg").html(_.template(e,{type:t,msg:n})),$(".msg").fadeIn(),setTimeout(function(){$(".msg").fadeOut("slow"),$(".msg").remove()},r)},getRequest:function(e){var t=location.search,n={};if(t.indexOf("?")!=-1){var r=t.substr(1);strs=r.split("&");for(var i=0;i<strs.length;i++)n[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1])}return e?n[e]:n},deviceType:function(){return navigator.userAgent.match(/iPad/i)=="iPad"?"iPad":navigator.userAgent.match(/iPhone/i)=="iPhone"?"iPhone":navigator.userAgent.match(/Android/i)=="Android"?"Android":navigator.userAgent.match(/BlackBerry/i)=="BlackBerry"?"BlackBerry":"null"},getModelById:function(e,t){var n=null;return e.icollection.each(function(e){e.id==t&&(n=e);var r=interaction_view.getModelById(e,t);r&&(n=r)}),n},model2collection:function(e,t){e.has(t)&&e.icollection.add(e.get(t))},model2tree:function(e,t,n){e.has(t)&&(e.icollection.add(e.get(t)),e.icollection.each(function(e){e.has(n)&&interaction_view.model2tree(e,n,n)}))},getPageIds:function(){var e=[];return $(".reveal").find("section").each(function(){e.push($(this).attr("id"))}),e},createPath:function(e){var t=[];return e.isSubOverlay?t=$.extend(!0,[],e.path):t.push({type:"page",id:e.page_id}),t.push({type:e.model.get("iType"),id:e.model.id}),e.layer_id&&t.push({type:"layer",id:e.layer_id}),t},hashPath:function(e){return _.pluck(e,"id").join("")},getContainerDivByPath:function(e){var t=$(".interaction-view");if(!e)return $(".interaction-view");for(i=0;i<e.length;i++)if(e[i].type=="page"){if(interaction_view.ipagelist.getPage(e[i].id))t=$('.Presentation[id="'+e[i].id+'"]').find(".interaction-view").first();else if(interaction_view.imasterlist.get(e[i].id)||interaction_view.ibackgroundlist.get(e[i].id))t=$('.Presentation[id="'+interaction_view.currentPage+'"]').find(".interaction-view").first()}else e[i].type=="layer"?t=t.find('div.layer-item[data-id="'+e[i].id+'"]').first():t=t.find('div.iView[id="'+e[i].id+'"]').first().children(".Element");return t},getContainerModelByPath:function(e){var t=null;for(i=0;i<e.length;i++){e[i].type=="page"?t=interaction_view.getParentpage(e[i].id):e[i].type=="layer"?t=t.layer[e[i].id]:t=t.iOverlaylist.get(e[i].id);if(!t)return null}return t},formatLabel:function(e){var t,n="",r="",i="";e.iPosition||(t="left"),e.iPosition==1&&(t="center"),e.iPosition==2&&(t="right"),e.radius!=undefined&&(n="border-top-left-radius:"+e.radius+"px; border-top-right-radius:"+e.radius+"px; border-bottom-right-radius:"+e.radius+"px; border-bottom-left-radius:"+e.radius+"px;"),e.border_color!=undefined&&e.border_size&&(r="border:"+e.border_size+"px solid "+e.border_color+";"),e.bg_color!=undefined&&(i="background-color:"+e.bg_color+";");if(!e.el)return'<p style="text-align:'+t+";font-size:"+e.font_size+"px;color:"+e.text_color+";"+n+r+i+'">'+e.text+"</p>";$(e.el).css({"font-size":e.font_size,color:e.text_color,"text-align":t}),n&&$(e.el).css("border-radius",e.radius+"px")},getWebContentSrc:function(e){var t=null;switch(e.contentType){case 0:if(e.iUrl){var n=e.iUrl.indexOf("http://")!=-1?e.iUrl:e.iUrl.indexOf("/")==0?e.iUrl:"http://"+e.iUrl;return{src:n,content:null}}return null;case 1:if(e.iFile&&e.iFile[0]&&e.iFile[0].file){if(typeof cbt_data=="undefined"||interaction_view.forpreview)var n=e.iFile[0].file.replace(".zip","/");else var n=e.iFile[0].file.replace(".zip","/index.html");return{src:n,content:null}}return null;case 2:return e.iSource?{src:null,content:e.iSource}:null}},getAnimationPage:function(e,t){return interaction_view.getParentpage(e)?interaction_view.getParentpage(e):t},filterAnimations:function(e,t,n,r){var i=_.filter(e,function(e){var t=e.toJSON();return t.iTiming&&t.iTiming.waitaction&&!interaction_view.SinglePreview&&!r?!1:t.iKind==0&&t.iGroup_id&&!n?!1:t.isH5?!1:!0});return i},preloadImg:function(e){var t=new Image;t.onload=function(){},t.src=e},drawImg:function(e,t,n,r){console.log(n);try{r.clearRect(0,0,e.canvas_width,e.canvas_height),r.drawImage(e.model.iImgs[n],0,0,e.canvas_width,e.canvas_height),this.onload=null}catch(i){console.log(i)}},getOverlays:function(e,t){var n=[];interaction_view.imasterlist.length==0?n=iMasterlist.at(0).overlaylist.models:n=interaction_view.imasterlist.at(0).iOverlaylist.models;if(interaction_view.currentPage==t)n=_.union(n,interaction_view.getAnimationPage(interaction_view.currentPage).iOverlaylist.models);else if(interaction_view.ilayerlist.get(t)){var r=interaction_view.getAnimationPage(interaction_view.currentPage).iOverlaylist.models.filter(function(e){return e.attributes.iType=="LayerRef"&&e.layer[t]});r&&r.length&&(n=_.union(n,r[0].layer[t].iOverlaylist.models))}return _.filter(n,function(t){return t.attributes.iType==e})},getVarsOp:function(e,t,n){if(typeof t=="undefined"||!t||!t.length)t=[0,1,2];_.each(t,function(e,n){t[n]=String(e)});var r=_.filter(interaction_view.getOverlays("Variable",e),function(e){return _.include(t,String(e.attributes.iDetail.iKind))});r=_.union(r,interaction_view.getOverlays("Paragraph",e)),n&&(r=_.union(r,n));var i="@",s=/@/g,o=/\@[^\@]+\@/g,u=function(e){if(!f(e))return e;if(e=="@å¾®ä¿¡_ç¨æ·æµç§°@")return typeof epub360_userinfo!="undefined"&&epub360_userinfo.nickname?epub360_userinfo.nickname:"@å¾®ä¿¡_ç¨æ·ææ_æªå¯ç¨@";if(e=="@å©å_ç¨æ·èº«ä»½@")return typeof epub360_userinfo!="undefined"&&epub360_userinfo.nickname?interaction_view.environment.Shareapp.usertype():"@å©å_ç¨æ·ææ_æªå¯ç¨@";if(e=="@å©å_å©åæ°@")return typeof epub360_userinfo!="undefined"&&epub360_userinfo.nickname?interaction_view.environment.Shareapp.total():"@å©å_ç¨æ·ææ_æªå¯ç¨@";if(e=="@å©å_æ¯å¦åèµ·@")return interaction_view.environment.Shareapp.status==2?1:0;var t;e=e.replace(s,"");var n=interaction_view.application.getFormFieldValue(e);if(n!=null)return n;ids=e.split("_"),ext=ids.length>1?ids[1]:"",ids.length>1&&["position","voted"].indexOf(ext)>-1?e=ids[0]:ext="",t=_.filter(r,function(t){return t.id==e});if(t.length){var i=t[0],o=t[0].attributes.iDetail;if(i.get("iType")=="Vote"){var u=parseInt(o.initial);return ext==""?u=i.get("value")||parseInt(o.initial):ext=="position"?u=i.get("position")||0:ext=="voted"&&(u=i.get("voted")||0),u}if(typeof o.initial!="undefined")return String(o.initial);if(typeof o.iText!="undefined"){var a=String(t[0].iview.userContent||o.iText),l=a.replace(/<br>/g,"\n").replace(/<\/div><div>/g,"\n").replace("<div>","").replace("</div>","");return l}return String(t[0].get("suboverlays")[0].iDetail.iValue)}return"0"},a=function(e){var t=String(e),n=t.match(o);return _.each(n,function(e){t=t.replace(e,u(e))}),t},f=function(e){return e&&e[0]==i},l=function(e){var t=String(e),n=t.match(o);return n&&n.length?!0:!1};return{vars:r,var2val:function(e,t){var n=String(e),i=n.match(o);if(!r||!r.length)if(!i)return e;return t?a(e):Number(u(e))||0},beginWithAT:f,hasAT:l}},getParentpage:function(e){return interaction_view.ipagelist.getPage(e)||interaction_view.imasterlist.get(e)||interaction_view.ibackgroundlist.get(e)},getPageType:function(e){return interaction_view.imasterlist.length&&e.model.page.id==interaction_view.imasterlist.at(0).id?"master":interaction_view.ibackgroundlist.length&&e.model.page.id==interaction_view.ibackgroundlist.at(0).id?"background":"page"},getPageType2:function(e){return e.isMasterOverlay?"master":e.isBackgroundOverlay?"background":"page"},imageEditor:function(e,t,n,r,i,s){$(".reveal").addClass("noevents");var o,u;o=$.zoom?t*$.zoom:t,u=$.zoom?n*$.zoom:n;var a=e.iview.$el.children(".Element").offset(),f=$.zoom?a.left*$.zoom:a.left,l=$.zoom?a.top*$.zoom:a.top,c=_.isNaN(Number(e._rotate))?0:Number(e._rotate),h=_.isNaN(Number(e._scale))?1:Number(e._scale),p=_.isNaN(Number(e._x))?0:Number(e._x),d=_.isNaN(Number(e._y))?0:Number(e._y),v="rotate("+c+"deg) scale("+h+") skew(0deg) translate("+p+"px ,"+d+"px)";e.iview.$el.find("img").css({"-webkit-transform":v,width:"100%",height:"auto"}),interaction_view.imageEditorClear(),interaction_view.containment.append('<div class="editor_mask" style="opacity:0;"></div>'),interaction_view.containment.append('<div class="imageeditorcontainer"><div class="imageeditor" style="position:absolute;left:'+f+"px;top:"+l+"px;width:"+o+"px;height:"+u+'px;z-index:999999999;"><img src="'+r+'" style="width:100%;opacity:0;"></div></div>'),typeof epub360!="undefined"&&epub360.settings&&["USER_FREE","USER_BASIC"].indexOf(epub360.settings.billing_type)>=0&&interaction_view.containment.append('<div style=" padding-bottom: 3px;display: inline-block;z-index: 999999999;position: absolute; bottom: 10px;  text-align: center; width: 100%;"><a href="http://www.epub360.com/?utm_source=epub360&amp;utm_medium=player&amp;utm_content=%E5%85%8D%E8%B4%B9%E6%8A%80%E6%9C%AF%E6%94%AF%E6%8C%81&amp;utm_campaign=loading" target="_blank" style="color: #c9c9c9;font-size: 14px;padding: 8px 14px;background: #a1a1a1;border-radius: 15px; -moz-border-radius: 15px;" class="advertise">Epub360.com ææ¯æ¯æ</a></div>'),interaction_view.containment.append('<div class="imageeditorbuttons"><button class="weixinbutton chooseimage"></button><button class="weixinbutton imageconfirm"></button></div>'),interaction_view.bindImageEditor($(".imageeditor").children("img"),c,h,p,d,e),$(".imageconfirm").on("click",function(){var e=$(".imageeditor").children("img").data();return i&&i(e.x||0,e.y||0,e.scale||1,e.rotate||0),interaction_view.imageEditorClear(),$(".reveal").removeClass("noevents"),!1}),$(".chooseimage").on("click",function(){return interaction_view.weixin.chooseimage(function(e){e&&(interaction_view.localIds=e,s(e[0]))}),!1}),setTimeout(function(){$(".imageeditorcontainer").on("click",function(e){if($(e.target).is(e.currentTarget)){var t=$(".imageeditor").children("img").data();i&&i(t.x||0,t.y||0,t.scale||1,t.rotate||0),interaction_view.imageEditorClear(),$(".reveal").removeClass("noevents")}})},500)},imageEditorClear:function(){$(".editor_mask").remove(),$(".imageeditorcontainer").remove(),$(".voiceeditor").remove(),$(".imageeditor-confirm").remove(),$(".weixinbutton").remove(),$(".advertise").remove(),$(".imageeditorbuttons").remove()},bindImageEditor:function(e,t,n,r,i,s){var o=!1,u=0,a=1;e.data({rotate:t,scale:n,x:r,y:i}),e.hammer().on("drag",function(e){if(o)return;var u=r+e.gesture.deltaX,a=i+e.gesture.deltaY,f="rotate("+t+"deg) scale("+n+") skew(0deg) translate("+u+"px, "+a+"px)";s.iview.$el.find("img").css({transform:f,"-webkit-transform":f}),$(".imageeditorbuttons").hide(),e.gesture.preventDefault()}),e.hammer().on("rotate",function(f){o=!0,a=f.gesture.scale;var l=n+(a-1);u=f.gesture.rotation;var c=t+u;e.data({scale:l,rotate:c,x:r,y:i});var h="rotate("+c+"deg) scale("+l+") skew(0deg) translate("+r+"px ,"+i+"px)";s.iview.$el.find("img").css({transform:h,"-webkit-transform":h}),$(".imageeditorbuttons").hide(),f.gesture.preventDefault()}),e.hammer().on("pinch",function(f){o=!0,a=f.gesture.scale;var l=n+(a-1);u=f.gesture.rotation;var c=t+u;e.data({scale:l,rotate:c,x:r,y:i}),$(".imageeditorbuttons").hide();var h="rotate("+c+"deg) scale("+l+") skew(0deg) translate("+r+"px ,"+i+"px)";s.iview.$el.find("img").css({transform:h,"-webkit-transform":h}),f.gesture.preventDefault()}),e.hammer().on("dragend",function(s){var f=s.gesture.deltaX,l=s.gesture.deltaY;o?(t+=u,n+=a-1,e.data({rotate:t,scale:n,x:r,y:i})):(r+=f,i+=l,e.data({rotate:t,scale:n,x:r,y:i})),u=0,a=1,o=!1,$(".imageeditorbuttons").show()})},imageUploader:function(e,t){wx.uploadImage({localId:e,success:function(e){var n=context_url+"uploadimage";_g.ajax.post({url:n,data:{serverid:e.serverId},callback:function(e){e.code==200?t&&t(e.data.results[0]):interaction_view.errorAlert(e.msg)}})},fail:function(e){interaction_view.errorAlert("å¾çä¸ä¼ éè¯¯")}})},voiceEditor:function(e){$(".reveal").addClass("noevents"),interaction_view.weixin.voiceauth(),interaction_view.imageEditorClear(),interaction_view.containment.append('<div class="editor_mask" style="opacity:0;"></div>'),typeof epub360!="undefined"&&epub360.settings&&["USER_FREE","USER_BASIC"].indexOf(epub360.settings.billing_type)>=0&&interaction_view.containment.append('<div style=" padding-bottom: 3px;display: inline-block;z-index: 999999999;position: absolute; bottom: 10px;  text-align: center; width: 100%;"><a href="http://www.epub360.com/?utm_source=epub360&amp;utm_medium=player&amp;utm_content=%E5%85%8D%E8%B4%B9%E6%8A%80%E6%9C%AF%E6%94%AF%E6%8C%81&amp;utm_campaign=loading" target="_blank" style="color: #c9c9c9;font-size: 14px;padding: 8px 14px;background: #a1a1a1;border-radius: 15px; -moz-border-radius: 15px;" class="advertise">Epub360.com ææ¯æ¯æ</a></div>'),interaction_view.containment.append('<div class="voiceeditor absolutecenter weixin-record">    <div class="voiceeditor-control">         <button class="voicebutton" id="playVoice" style="opacity:0;"></button>         <button class="voicebutton" id="startRecord"></button>         <div class="voicetext">æä½å½é³</div>         <button class="weixincancel"></button>         <button class="weixinconfirm"></button>    </div></div>'),interaction_view.bindVoiceEditor(),$(".weixinconfirm").on("click",function(){return interaction_view.imageEditorClear(),$(".reveal").removeClass("noevents"),e&&e(interaction_view.voicelocalId),!1}),$(".weixincancel").on("click",function(){return wx.stopRecord({success:function(e){},fail:function(e){}}),interaction_view.imageEditorClear(),$(".reveal").removeClass("noevents"),!1})},bindVoiceEditor:function(e){var t=!1,n=function(){if(!interaction_view.voicelocalId){interaction_view.errorAlert("ä½ è¿æ²¡æå½é³å¢ï¼");return}wx.playVoice({localId:interaction_view.voicelocalId}),window.setTimeout(function(){$("#playVoice").attr("id","stopVoice")},500)};$(".weixin-record").on("touchstart","#startRecord",function(e){return t=!0,wx.startRecord({success:function(){t?$("div.voicetext").html("æ­£å¨å½é³...."):wx.stopRecord({})},cancel:function(){interaction_view.errorAlert("å¼å¯å¾®ä¿¡åè½å¤±è´¥")}}),window.setTimeout(function(){$("#startRecord").attr("id","stopRecord")},100),!1}),$(".weixin-record").on("touchend","#stopRecord",function(e){return wx.stopRecord({success:function(e){interaction_view.voicelocalId=e.localId,$("#playVoice").css("opacity",1),n()},fail:function(e){interaction_view.errorAlert("å¾®ä¿¡å½é³å¤±è´¥")}}),window.setTimeout(function(){$("#stopRecord").attr("id","startRecord")},100),t=!1,$("div.voicetext").html("æä½å½é³"),!1}),$(".weixin-record").on("touchcancel","#stopRecord",function(e){return wx.stopRecord({success:function(e){interaction_view.voicelocalId=e.localId,$("#playVoice").css("opacity",1),n()},fail:function(e){interaction_view.errorAlert("å¾®ä¿¡å½é³å¤±è´¥")}}),window.setTimeout(function(){$("#stopRecord").attr("id","startRecord")},100),t=!1,!1}),$(".weixin-record").on("click","#playVoice",function(e){return n(),!1}),$(".weixin-record").on("click","#stopVoice",function(e){if(!interaction_view.voicelocalId){interaction_view.errorAlert("ä½ è¿æ²¡æå½é³å¢ï¼");return}return wx.stopVoice({localId:interaction_view.voicelocalId}),window.setTimeout(function(){$("#stopVoice").attr("id","playVoice")},500),!1}),wx.onVoicePlayEnd({complete:function(e){$("#stopVoice").attr("id","playVoice")}}),wx.onVoiceRecordEnd({complete:function(e){interaction_view.voicelocalId=e.localId,$("#playVoice").css("opacity",1),n(),$("#stopRecord").attr("id","startRecord")}})},voiceUploader:function(e,t){wx.uploadVoice({localId:e,isShowProgressTips:1,success:function(e){var n=e.serverId,r=context_url+"uploadvoice";_g.ajax.post({url:r,data:{serverid:e.serverId},callback:function(e){e.code==200?t&&t(e.data.results[0]):interaction_view.errorAlert(e.msg)}})}})},errorAlert:function(e){if(interaction_view.foredit){interaction.message("warning","è¯·å¨å¾®ä¿¡ä¸­é¢è§è¯¥åè½!");return}if(!interaction_view.containment.children(".alert_mask").length){interaction_view.containment.append('<div class="alert_mask"></div>');var n=_.template(t,{text:e});interaction_view.containment.append(n),interaction_view.containment.find(".alert-confirm").on("click",function(){return interaction_view.containment.find(".alert_mask").remove(),interaction_view.containment.find(".alert-box").remove(),!1})}},playbgsound:function(){if(!interaction_view.bgsound)return;var e=interaction_view.bgsound;if(e.hasPlayed)return;var t=e.iview.getdetail();e.media=audio,e.iview.$el.find(".status-play").addClass("status-pause").removeClass("status-play"),e.media.paused||(e.hasPlayed=!0),$("audio#bgsound").on("loadstart",function(e){}).on("error",function(e){}).on("timeupdate",function(t){if(e.iview.slider){var n=e.media.currentTime,r=e.media.duration,i=_g.number.decimal(n/r,2)*100;e.iview.onSliderChange(i)}}),$("audio#bgsound").on("ended",function(n){if(!t.iRepeat){e.iview.slider&&e.iview.sliderstop();if(e.media.seekable.length==0)return;try{e.media.currentTime=0,interaction_view.media.pause(e)}catch(r){}e.onAnimationStart&&(interaction_view.events.onAnimationEnd(e.onAnimationStart),e.onAnimationStart=null)}else _g.device.android()&&e.media.play()})},createLoop:function(e){var t=e.delay*1e3,n=17,r=0,i={};i.paused=!0,i._int=null;var s=0;return i.duration=function(){return e.duration},i.play=function(){i.paused=!1;var o=function(){if(!i)return;i._int=requestAnimationFrame(o),r*n>=t?(console.log("play"),e.callback&&e.callback(),r=1,s=s+e.delay<=e.duration?s+e.delay:0):r+=1};o()},i.pause=function(){i._int&&window.cancelAnimationFrame(i._int)},i.kill=function(){i._int&&(window.cancelAnimationFrame(i._int),i.paused=!0),i=null},i.time=function(){return s},i},renderLink:function(e,t){if(interaction_view.foredit){global.message("warning","è¯·ä½¿ç¨é¢è§å¨é¨æ¨¡å¼é¢è§è¯¥åè½");return}if(e==0&&t.page_id)interaction_view.ipagelist.getPage(t.page_id)&&presentation.gotopage(t.page_id,0);else if(e==1&&t.url){if(!t.url)return;var n=t.url;if(n.indexOf("@")==0){window.open(n,"_blank");return}n.indexOf("://")==-1&&(n="http://"+n),window.location.href.indexOf("query_string")>0&&(n+=n.indexOf("?")>=0&&"&"+window.location.search.replace("?","")||window.location.search);var r=n.match(/\w+:\/\//);if(r&&["https://","http://"].indexOf(n.match(/\w+:\/\//)[0])==-1){window.location.href=n;return}window.open(n,"_blank")}else if(e==2&&t.url){if(!interaction_view.ismobile)return;window.location="tel:"+t.url}},setPos:function(e,t){var n=t.x,r=t.y,i=t.scale;if(!interaction_view.ismobile||typeof TweenMax!="undefined")n!=undefined&&TweenMax.set(e,{x:n,y:r}),i!=undefined&&TweenMax.set(e,{scale:i});else{var s="transform";"transform"in document.documentElement.style||(s="webkitTransform"),n!=undefined&&(e.style[s]="matrix(1, 0, 0, 1, "+n+", "+r+")"),i!=undefined&&typeof TweenMax!="undefined"&&TweenMax.set(e,{scale:i})}}}}),define("interaction_view/ui/control",[],function(){var e={bindArrowControls:function(){Reveal.setNavigateFuncs({navigateLeft:e.slideLeft,navigateRight:e.slideRight})},slideUp:function(){Reveal.up()},slideDown:function(){Reveal.down()},slideLeft:function(){var t=Reveal.getCurrentSlide().id,n=e.getLeft(t);n&&e.slideTo(n.id)},slideRight:function(){var t=Reveal.getCurrentSlide().id,n=e.getRight(t);n&&e.slideTo(n.id)},getGroupLeft:function(e){if(Reveal.slideType!=3)return null;var t=interaction_view.ipagelist.getPage(e);if(!t)return null;var n=t.get("group"),r=t.collection.parent,i=interaction_view.ipagelist.at(interaction_view.ipagelist.indexOf(r)-1);if(i){var s=i.icollection.at(0);return s}return null},getGroupRight:function(e){if(Reveal.slideType!=3)return null;var t=interaction_view.ipagelist.getPage(e);if(!t)return null;var n=t.get("group"),r=t.collection.parent,i=interaction_view.ipagelist.at(interaction_view.ipagelist.indexOf(r)+1);if(i){var s=i.icollection.at(0);return s}return null},getGroupLeftId:function(e){var t=interaction_view.control.getGroupLeft(e);return t?t.id:null},getGroupRightId:function(e){var t=interaction_view.control.getGroupRight(e);return t?t.id:null},getRight:function(e){var t=interaction_view.ipagelist.getPage(e),n=t.get("group"),r=t.collection.parent,i=interaction_view.ipagelist.at(interaction_view.ipagelist.indexOf(r)+1);if(i){var s=i.icollection.at(0),o=s.get("group");return n!=o?!1:s}return!1},getLeft:function(e){var t=interaction_view.ipagelist.getPage(e),n=t.get("group"),r=t.collection.parent,i=interaction_view.ipagelist.at(interaction_view.ipagelist.indexOf(r)-1);if(i){var s=i.icollection.at(0),o=s.get("group");return n!=o?!1:s}return!1},getCurrent:function(){},slideTo:function(e){var t=interaction_view.ipagelist.getPage(e);indexh=t.collection.parent.collection.indexOf(t.collection.parent),indexv=t.collection.indexOf(t),Reveal.slide(indexh,indexv)}};return e}),function(){var e={addEvent:function(e,t,n,r){e.addEventListener?e.addEventListener(t,n,!!r):$(e).on(t,n)},removeEvent:function(e,t,n,r){e.removeEventListener?e.removeEventListener(t,n,!!r):$(e).off(t,n)},document:{disable_contextmenu:function(e){e||(e=document),e.oncontextmenu=function(e){return e&&e.preventDefault(),!1}},enable_contextmenu:function(e){e||(e=document),e.oncontextmenu=function(e){}},onCopy:function(e,t){$(document).on("copy",function(e){console.log(e)})},disable_paste:function(){document.disable_paste=!0},enable_paste:function(){document.disable_paste=!1}}};typeof require=="undefined"?(window._g||(window._g={}),window._g.event=e):define("_g/event",["_g/base"],function(){return window._g.event=e,window._g.event})}(window),function(){var e=1,t={init:function(){_g.orientation.orientationSupport&&window.addEventListener("deviceorientation",_g.orientation.onDeviceOrientation),_g.orientation.deltaX=0,_g.orientation.deltaY=0},orientationSupport:function(){return!!window.DeviceOrientationEvent},onDeviceOrientation:function(){var t,n,r,i;if(event.beta!==null&&event.gamma!==null){this.orientationStatus=1;var s=(event.beta-30||0)/e,o=(event.gamma-30||0)/e,u=window.innerHeight>window.innerWidth;u?(t=o+30,n=s,r=180,i=90):(t=-(s+30),n=o,r=90,i=180),_.each(_g.orientation.orientationEvents,function(e){var s=t,o=n;e.scrollX||(s=0),e.scrollY||(o=0),e.func&&e.func(-s*e.speed,-o*e.speed,r,i)})}},orientationEvents:[]};typeof require=="undefined"?(window._g||(window._g={}),window._g.orientation=t):define("_g/orientation",["_g/base"],function(){return window._g.orientation=t,window._g.orientation})}(window),define("interaction_view/ui/event",["_g/ui","_g/event","_g/orientation"],function(){var events={pageStartEvents:[],pageClickEvents:[],pageDblClickEvents:[],pageWXShareSuccessEvents:[],pageSwipeEvents:[],elementChangeToEvents:[],slideClickEvents:[],slideDblClickEvents:[],animationStartEvents:[],animationEndEvents:[],animationUpdateEvents:[],bindingEvents:[],mediaEvents:[],controllerEvents:[],dragStartEvents:[],dragEndEvents:[],draggingEvents:[],dragDropEvents:[],dragDropGroupEvents:[],timerEvents:[],variableEvents:[],voteEvents:[],paragraphEvents:[],pageShakeEvents:[],formEvents:[],eraserEvents:[],formSubmitEvents:[],WeixinCameraEvents:[],collisionEvents:[],userListEvents:[],contactFormEvents:[],systemVariableEvents:[],videoAutoPlayControlPatch:[],preloadPageEvents:[],init:function(){target=$(".slides"),target.on("click",function(e){events.testControl(e)&&events.onClickEvent()}),target.on("dblclick",function(e){events.testDblControl(e)&&(events.onDblClickEvent(),e.preventDefault()),_g.ui.clearSelection()}),interaction_view.touchview&&target.hammer&&target.hammer().on("doubletap",function(e){events.testDblControl(e)&&(events.onDblClickEvent(),e.preventDefault()),_g.ui.clearSelection()}),interaction_view.ismobile||events.initWheelEvent(),interaction_view.ismobile&&_g.orientation.init(),_g.getUrlParameterByName("-build")!="1"&&_g.event.document.disable_contextmenu(),events.initShakeEvent()},initWXEvent:function(){function e(e){WeixinJSBridge.invoke("sendAppMessage",{appid:appid,img_url:imgUrl,img_width:"640",img_height:"640",link:message_link,desc:descContent,title:shareTitle},function(t){e&&e(t)})}function t(e){WeixinJSBridge.invoke("shareTimeline",{img_url:imgUrl,img_width:"640",img_height:"640",link:message_link,desc:descContent,title:shareTitle},function(t){e&&e(t)})}function n(e){WeixinJSBridge.invoke("shareWeibo",{content:descContent,url:message_link},function(t){e&&e(t)})}function r(){function r(){var e=_.filter(interaction_view.events.pageWXShareSuccessEvents,function(e){return e.page_id==interaction_view.currentPage});_.each(e,function(e){e.func()})}WeixinJSBridge.on("menu:share:appmessage",function(t){e(function(e){switch(e.err_msg){case"send_app_msg:cancel":break;case"send_app_msg:fail":break;case"send_app_msg:confirm":case"send_app_msg:ok":r(),_gaq.push(["_trackSocial","Wechat","appmessage",ga_opt_target,ga_opt_pagePath])}})}),WeixinJSBridge.on("menu:share:timeline",function(e){t(function(e){switch(e.err_msg){case"share_timeline:cancel":break;case"share_timeline:fail":break;case"share_timeline:confirm":case"share_timeline:ok":r(),_gaq.push(["_trackSocial","Wechat","timeline",ga_opt_target,ga_opt_pagePath])}})}),WeixinJSBridge.on("menu:share:weibo",function(e){n(function(e){switch(e.err_msg){case"share_weibo:cancel":break;case"share_weibo:fail":break;case"share_weibo:confirm":case"share_weibo:ok":r(),_gaq.push(["_trackSocial","Wechat","weibo",ga_opt_target,ga_opt_pagePath])}})}),typeof interaction_view!="undefined"&&(interaction_view.iswechat=1)}typeof WeixinJSBridge=="undefined"?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",r,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",r),document.attachEvent("onWeixinJSBridgeReady",r)):r()},wheelEvents:[],initWheelEvent:function(){_g.mousewheel.init()},initShakeEvent:function(){if(!_g.device.mobile())return;if(typeof Shake=="undefined")return;var e=new Shake({threshold:_g_device.iphone()?11:25});e.start(),window.addEventListener("shake",function(){interaction_view.events.onPageShakeEvent()},!1)},testControl:function(e){var t=$(e.target).closest(".iView");if($(e.target).closest(".iView").hasClass("hasaction"))return!1;if(t){var n=t.attr("data-type");if(n=="Slide"||n=="CycleImage")if(t.attr("data-iSlipable"))return!1}return $(e.target).closest(".iLayerRef").length>0&&$(e.target).closest(".iLayerRef").parent(".iView").hasClass("hascontrols")?!1:!0},testDblControl:function(e){var t=$(e.target).closest(".iView");return $(e.target).closest(".iView").hasClass("hasDblClick")?!1:!0},onPageStart:function(e,t){interaction_view.ipagelist.getPage(e)&&epub360.settings.pems.has_analytics_src&&interaction_view.analytics.set(e);var n=_.filter(interaction_view.events.pageStartEvents,function(n){return n.page_id==e&&(t?n.layer_id==t:!0)});n.length>0&&_.each(n,function(e){e.func()})},onPageSwipeEvent:function(e,t,n){var r=_.filter(interaction_view.events.pageSwipeEvents,function(r){return r.page_id==t&&(n?r.layer_id==n:!0)&&e==r.swipeType});return r.length>0?(_.each(r,function(e){e.func()}),events.clearAnimationWaitSwipe(),!0):!1},onPageShakeEvent:function(){var e=_.filter(interaction_view.events.pageShakeEvents,function(e){return e.page_id==interaction_view.currentPage||e.page_id==interaction_view.imasterlist.at(0).id});return e.length>0?(_.each(e,function(e){e.func()}),events.clearAnimationWaitShake(),!0):!1},onChangeTo:function(e,t,n){var r=_.filter(interaction_view.events.elementChangeToEvents,function(r){return r.page_id==e&&r.overlay_id==t&&r.index==n});r.length>0&&_.each(r,function(e){e.func()})},onClickEvent:function(){if(interaction_view.events.pageClickEvents.length>0){var e=_.filter(interaction_view.events.pageClickEvents,function(e){return e.type=="waitaction"});if(e.length>0)_.each(e,function(e){e.func()});else{var t=_.filter(interaction_view.events.pageClickEvents,function(e){return e.page_id==interaction_view.currentPage&&e.type=="page"});if(t.length>0)_.each(t,function(e){e.func()});else{var n=_.filter(interaction_view.events.pageClickEvents,function(e){return e.type=="master"});if(n.length>0)interaction_view.show_master&&_.each(n,function(e){e.func()});else{var r=_.filter(interaction_view.events.pageClickEvents,function(e){return e.type=="background"});interaction_view.show_background&&_.each(r,function(e){e.func()})}}}events.clearWaitClick()}},onDblClickEvent:function(){if(interaction_view.events.pageDblClickEvents.length>0){var e=_.filter(interaction_view.events.pageDblClickEvents,function(e){return e.page_id==interaction_view.currentPage&&e.type=="page"});if(e.length>0)_.each(e,function(e){e.func()});else{var t=_.filter(interaction_view.events.pageDblClickEvents,function(e){return e.type=="master"});if(t.length>0)interaction_view.show_master&&_.each(t,function(e){e.func()});else{var n=_.filter(interaction_view.events.pageDblClickEvents,function(e){return e.type=="background"});interaction_view.show_background&&_.each(n,function(e){e.func()})}}}},onSlideClickEvent:function(e,t,n,r,i){},onSlideDblClickEvent:function(e,t,n,r,i){},onControllerEvent:function(e){},onBingChangeTo:function(e){var t=_.filter(interaction_view.events.bindingEvents,function(t){return t.id==e.id&&t.page_id==e.page_id});_.each(t,function(t){e.direction=t.direction,t.func(e)})},onAnimationStart:function(e){var t=_.filter(interaction_view.events.animationStartEvents,function(t){return e.layer_id?e.overlay_id?t.overlay_id==e.overlay_id&&t.animation_id==e.animation_id&&t.layer_id==e.layer_id:t.animation_id==e.animation_id&&t.layer_id==e.layer_id:e.overlay_id?t.overlay_id==e.overlay_id&&t.animation_id==e.animation_id&&t.page_id==e.page_id:t.animation_id==e.animation_id&&t.page_id==e.page_id});_.each(t,function(e){e.func()})},onAnimationEnd:function(e){var t=_.filter(interaction_view.events.animationEndEvents,function(t){return e.layer_id?e.overlay_id?t.overlay_id==e.overlay_id&&t.animation_id==e.animation_id&&t.layer_id==e.layer_id:t.animation_id==e.animation_id&&t.layer_id==e.layer_id:e.overlay_id?t.overlay_id==e.overlay_id&&t.animation_id==e.animation_id&&t.page_id==e.page_id:t.animation_id==e.animation_id&&t.page_id==e.page_id});_.each(t,function(e){e.func()})},onAnimationUpdate:function(e){var t=_.filter(interaction_view.events.animationUpdateEvents,function(t){return e.layer_id?e.overlay_id?t.overlay_id==e.overlay_id&&t.animation_id==e.animation_id&&t.layer_id==e.layer_id:t.animation_id==e.animation_id&&t.layer_id==e.layer_id:e.overlay_id?t.overlay_id==e.overlay_id&&t.animation_id==e.animation_id&&t.page_id==e.page_id:t.animation_id==e.animation_id&&t.page_id==e.page_id});_.each(t,function(e){e.func()})},onDragStart:function(e){var t=_.filter(interaction_view.events.dragStartEvents,function(t){return e.layer_id?t.overlay_id==e.overlay_id&&t.layer_id==e.layer_id:t.overlay_id==e.overlay_id&&t.page_id==e.page_id});_.each(t,function(e){e.func()})},onDragEnd:function(e){var t=_.filter(interaction_view.events.dragEndEvents,function(t){return e.layer_id?t.overlay_id==e.overlay_id&&t.layer_id==e.layer_id:t.overlay_id==e.overlay_id&&t.page_id==e.page_id});_.each(t,function(e){e.func()})},onDragging:function(e){var t=_.filter(interaction_view.events.draggingEvents,function(t){return e.layer_id?t.overlay_id==e.overlay_id&&t.layer_id==e.layer_id:t.overlay_id==e.overlay_id&&t.page_id==e.page_id});_.each(t,function(e){e.func()})},onDragDrop:function(e,t,n){function i(t,n){return t.overlay_id!=e.id||t.drop_type!=n?!1:e.page.isLayer?t.layer_id==e.page.iOverlaylist.layerid:t.page_id==e.page.id}var r;if(n==0){r=_.filter(interaction_view.events.dragDropEvents,function(e){return i(e,8)}),_.each(r,function(e){e.func()});return}e.iview.Status=2,_.include(e.iview.getdetail().element_ids,t.id)?(e.iview.Status=1,r=_.filter(interaction_view.events.dragDropEvents,function(e){return i(e,9)})):r=_.filter(interaction_view.events.dragDropEvents,function(e){return i(e,10)}),_.each(r,function(e){e.func()})},onDragDropGroup:function(e){function t(e,t,n){return e.overlay_id!=n.id||e.drop_type!=t?!1:n.page.isLayer?e.layer_id==n.page.iOverlaylist.layerid:e.page_id==n.page.id}$.each(e.iview.DragDropGroups,function(e,n){var r=n.iview.getdetail().element_ids,i=0,s=!0;$.each(r,function(e,t){var r=n.page.iOverlaylist.where({id:t})[0];if(r&&r.iview){r=r.iview;if(r.Status==0)return s=!1,!1;r.Status==1&&i++}});if(!s)return;var o;i==r.length?o=_.filter(interaction_view.events.dragDropGroupEvents,function(e){return t(e,11,n)}):o=_.filter(interaction_view.events.dragDropGroupEvents,function(e){return t(e,12,n)}),_.each(o,function(e){e.func()})})},onTimerStart:function(e){_.each(e.Actions_19,function(e){e.func()})},onTimerStop:function(e){_.each(e.Actions_17,function(e){e.func()})},onTimerInterval:function(e){_.each(e.Actions_18,function(t){var n=Number(t.condition);n>0&&Number(e.currentTime.toFixed(2))*100%(Number(n.toFixed(2))*100)==0&&t.func()})},onTimerCountTo:function(e){_.each(e.Actions_16,function(t){Math.abs(Number(e.currentTime.toFixed(2))*100-Number(Number(t.condition).toFixed(2))*100)<5&&t.func()})},onVariableChanged:function(view){var detail=view.getdetail(),initial=detail.iKind=="0"&&Number(detail.initial)||detail.initial,actions=_.filter(interaction_view.events.variableEvents,function(e){return interaction_view.events.filterType(view,e,22)}),VarOPobj=interaction_view.getVarsOp(interaction_view.currentPage,null,interaction_view.environment.Votes.get());_.each(actions,function(v){var cond;cond=v.condition.replace(/%@/g,"initial"),cond=VarOPobj.var2val(cond,!0),eval(cond)&&v.func()})},onSystemVariableChanged:function(e){var t=_.filter(interaction_view.events.systemVariableEvents,function(t){return interaction_view.events.filterTypeByView(e,t)});t.length&&(console.log(t),_.each(t,function(e){e.type==100&&interaction_view.isWeixin&&e.func(),e.type==101&&!interaction_view.isWeixin&&e.func(),e.type==102&&interaction_view.isAndroid&&e.func(),e.type==103&&interaction_view.isIos&&e.func(),e.type==104&&interaction_view.isWin&&e.func(),e.type==105&&interaction_view.isMac&&e.func();if(typeof epub360_userinfo!="undefined"&&epub360_userinfo.is_subscribe!=undefined){if(interaction_view.foredit){global.message("warning","è¯·ä½¿ç¨é¢è§å¨é¨æ¨¡å¼é¢è§è¯¥åè½");return}e.type==110&&epub360_userinfo.is_subscribe&&e.func(),e.type==111&&!epub360_userinfo.is_subscribe&&e.func()}}))},onVoted:function(e){var t=_.filter(interaction_view.events.voteEvents,function(t){return interaction_view.events.filterType(e,t,23)});_.each(t,function(e){e.func()})},onParagraphChanged:function(e){var t=_.filter(interaction_view.events.paragraphEvents,function(t){return interaction_view.events.filterType(e,t,54)});_.each(t,function(e){e.func()})},onFormEvent:function(e,t){var n=e.createPath(),r=_.filter(interaction_view.events.formEvents,function(e){return e.overlay&&interaction_view.hashPath(n)==interaction_view.hashPath(e.overlay.path)+e.overlay.id});e.get("iType")=="Select"?_.each(r,function(e){e.key==t&&e.func(t)}):_.each(r,function(e){e.func(t)})},onFormSubmitEvent:function(e,t){var n=_.filter(interaction_view.events.formSubmitEvents,function(e){return e.id==t});_.each(n,function(e){e.func(status)})},onFormButtonRender:function(e){var t=e.createPath(),n=null,r=null,i=_.filter(interaction_view.events.formEvents,function(e){return e.overlay&&interaction_view.hashPath(t)==interaction_view.hashPath(e.overlay.path)+e.overlay.id});return _.each(i,function(t){r=t,n=interaction_view.application.getValue(t.id,t.cid,t.key),t.bindSwitch&&interaction_view.application.sendOverlayToButtonGroup(e)}),{field:r,value:n}},onEraserEvent:function(e){var t=_.filter(interaction_view.events.eraserEvents,function(t){return interaction_view.events.filterType(e,t,41)});_.each(t,function(e){e.func()})},onWeixinEvent:function(e,t){var n=_.filter(interaction_view.events.WeixinCameraEvents,function(n){return interaction_view.events.filterType(e,n,t)});_.each(n,function(e){e.func()})},onCollision:function(e){var t=_.filter(interaction_view.events.collisionEvents,function(t){return interaction_view.events.filterType(e,t,73)});_.each(t,function(e){e.func()})},onUserList:function(e,t){var n=_.filter(interaction_view.events.userListEvents,function(n){return interaction_view.events.filterType(e,n,t)});_.each(n,function(e){e.func()})},onContactFormSubmit:function(e,t){var n=_.filter(interaction_view.events.contactFormEvents,function(n){return interaction_view.events.filterType(e,n,t)});_.each(n,function(e){e.func()})},clearWaitClick:function(){interaction_view.events.pageClickEvents=_.reject(interaction_view.events.pageClickEvents,function(e){return e.type=="waitaction"})},clearAnimationWaitSwipe:function(){interaction_view.events.pageSwipeEvents=_.reject(interaction_view.events.pageSwipeEvents,function(e){return e.type=="waitaction"})},clearAnimationWaitShake:function(){interaction_view.events.pageShakeEvents=_.reject(interaction_view.events.pageShakeEvents,function(e){return e.type=="waitaction"})},clearRelatedEvents:function(e){interaction_view.events.animationStartEvents=_.reject(interaction_view.events.animationStartEvents,function(t){return t.page_id==e}),interaction_view.events.animationEndEvents=_.reject(interaction_view.events.animationEndEvents,function(t){return t.page_id==e}),interaction_view.events.animationUpdateEvents=_.reject(interaction_view.events.animationUpdateEvents,function(t){return t._label=="collision"&&t.page_id==e}),interaction_view.events.draggingEvents=_.reject(interaction_view.events.draggingEvents,function(t){return t._label=="collision"&&t.page_id==e})},clearAll:function(){interaction_view.events.pageClickEvents=[],interaction_view.events.pageDblClickEvents=[],interaction_view.events.pageStartEvents=[],interaction_view.events.pageWXShareSuccessEvents=[],interaction_view.events.bindingEvents=[],interaction_view.events.elementChangeToEvents=[],interaction_view.events.animationStartEvents=[],interaction_view.events.animationEndEvents=[],interaction_view.events.animationUpdateEvents=[],interaction_view.events.slideClickEvents=[],interaction_view.events.slideDblClickEvents=[],interaction_view.events.controllerEvents=[],interaction_view.events.dragDropEvents=[],interaction_view.events.dragDropGroupEvents=[],interaction_view.events.timerEvents=[],interaction_view.events.variableEvents=[],interaction_view.events.voteEvents=[],interaction_view.events.paragraphEvents=[],interaction_view.events.pageSwipeEvents=[],interaction_view.events.pageShakeEvents=[],interaction_view.events.formEvents=[],interaction_view.events.formSubmitEvents=[],interaction_view.events.eraserEvents=[],interaction_view.events.WeixinCameraEvents=[],interaction_view.events.collisionEvents=[],interaction_view.events.dragStartEvents=[],interaction_view.events.draggingEvents=[],interaction_view.events.dragEndEvents=[],interaction_view.events.userListEvents=[],interaction_view.events.contactFormEvents=[],interaction_view.events.systemVariableEvents=[],interaction_view.events.preloadPageEvents=[],typeof Reveal!="undefined"&&(Reveal.wheelLock=!1,Reveal.dragLock=!1,Reveal.wheelEventLock=!1)},filterType:function(e,t,n){return t.overlay_id!=e.model.id||t.type!=n?!1:e.model.page.isLayer?t.layer_id==e.model.page.iOverlaylist.layerid:t.page_id==e.model.page.id},filterTypeByView:function(e,t){return t.overlay_id!=e.model.id?!1:e.model.page.isLayer?t.layer_id==e.model.page.iOverlaylist.layerid:t.page_id==e.model.page.id}};return events}),define("interaction_view/ui/environment",["underscore"],function(){var e={Shareapp:{id:"",slug:"",shareinfo:{},helperinfo:{},appinfo:{},status:0,collection:{},init:function(){if(interaction_view.shareapp["id"]=="")return!1;e.Shareapp.slug=interaction_view.shareapp.id;var t=_g.getUrlParameterByName("shareid",message_link);return t==null?!1:interaction_view.shareapp["id"]==""?!1:(e.Shareapp.id=t,e.Shareapp.get(),!0)},get:function(t){e.Shareapp.status=1,_g.ajax.get({dataType:"JSON",url:"/share/"+e.Shareapp.slug+"/info?id="+e.Shareapp.id,callback:function(n){n.code==200?(e.Shareapp.shareinfo=n.data.results[0].shareinfo,e.Shareapp.helperinfo=n.data.results[0].helperinfo,e.Shareapp.appinfo=n.data.results[0].appinfo,e.Shareapp.status==1&&(e.Shareapp.status=2,e.Shareapp.waitpage&&e.Shareapp.waitpage==interaction_view.currentPage?interaction_view.play(interaction_view.currentPage):(console.info("env.Shareapp.get"),$.each(e.Shareapp.collection,function(e,t){var n=t;n.model.get("pageid")==interaction_view.currentPage&&n.status!=2&&n.resetOtherStatus()}))),t&&t()):e.Shareapp.status=0},onError:function(){interaction_view.environment.Shareapp.status=0}})},usertype:function(){return e.Shareapp.slug==""?"@å©å_æªå¯ç¨@":e.Shareapp.id==""?0:e.Shareapp.status<2?0:e.Shareapp.shareinfo.openid==epub360_userinfo.openid?1:interaction_view.environment.Shareapp.helperinfo.help_num>0?2:0},total:function(){return e.Shareapp.slug==""?"@å©å_æªå¯ç¨@":e.Shareapp.id==""?0:e.Shareapp.status<2?0:interaction_view.environment.Shareapp.shareinfo.total},help:function(e){e&&e()},create:function(){},add:function(t){var n=t.model;e.Shareapp.collection[n.id]||e.Shareapp.update(t)},update:function(t){var n=t.model;e.Shareapp.collection[n.id]=t},getList:function(){return _.toArray(e.Shareapp.collection)}},Votes:{collection:{},add:function(t){e.Votes.collection[t.id]||e.Votes.update(t)},update:function(t){e.Votes.collection[t.id]=t},get:function(){return _.toArray(e.Votes.collection)}},Paragraph:{editable:!1,stateChanged:function(e){_.each(interaction_view.getOverlays("Slide",interaction_view.currentPage),function(t){t.iview.setControl(e)})},enable:function(){e.Paragraph.editable=!0,$("body").addClass("ParagraghEditable"),e.Paragraph.stateChanged(!0)},disable:function(){e.Paragraph.editable=!1,$("body").removeClass("ParagraghEditable"),e.Paragraph.stateChanged(!1)},state:function(){return e.Paragraph.editable}}};return e}),define("interaction_view/ui/mobilemedia",[],function(){var e={statusclear:function(e){e.loaded=!1,e.played=!1,e.reseted=!1,e.completed=!1},play:function(t,n){n||(n={}),(t.get("iType")=="Video"||t.get("iType")=="QQVideo")&&e.video.play(t,n),t.get("iType")=="Audio"&&e.audio.play(t)},pause:function(e){if(!e.media||e.media.paused)return!1;try{e.media.pause()}catch(t){}e.iview.slider&&e.iview.sliderstop()},seek:function(t,n,r){r&&(n=e.getTimeByPercent(t,r));try{t.media.currentTime=n}catch(i){}},changeSrc:function(e,t){try{e.media.src=t}catch(n){}},video:{render:function(e,t,n){},init:function(e,t,n){function l(n){t.loaded=n,e.set("loaded",!0),e.page.ipreloadlist.preloadcheck(e.toJSON().file,n,t)}var r=n;if(_g.string.getUrlExt(r)==".m3u8"||_g.string.getUrlExt(r)==".M3U8")return;var i=t.iview.getdetail(),s=t.iview.getcommon(),o=i.iFullscreen?"":'webkit-playsinline="true"',u=$("<video "+o+' x-webkit-airplay="true" preload="auto" style="position:absolute; display:none;width:100%;height:100%;top:0;left:0;" src="'+r+'" poster="'+i.iFile[0].picture+'"></video>'),a=$('<img style="position:absolute;left:0;top:0;" src="'+i.iFile[0].picture+'" width="100%" height="100%"/>'),f=$('<span class="video-control status-play absolutecenter" style="cursor: pointer;margin: auto;"></span>');t.iview.$el.removeClass("hide").children(".Element").append(u).append(a),interaction_view.isAndroid&&t.iview.$el.removeClass("hide").children(".Element").append(f),f.hide(),i.iControl&&(u.attr("controls","controls"),interaction_view.isIos&&a.addClass("hide noevents"),f.show(),f.one("click",function(){f.hide(),interaction_view.media.play(t)})),i.iRepeat&&u.attr("loop","loop"),t.media=u[0],t.poster=a,t.control_btn=f,t.autoplay=i.iAutoplay||!1,t.fullscreen=i.iFullscreen||!1,t.control=i.iControl||!1,u.on("play",function(e){t.fullscreen&&interaction_view.media.video._fullScreen(t)}).on("loadstart",function(e){l(!0)}).on("error",function(e){l(!1)}).on("canplay",function(e){t.autoplay&&!interaction_view.isAndroid&&a.hide(),u.show()}),u.on("ended",function(e){i.iAutohide&&(t.iview.$el.addClass("hide"),t.hided=!0),t.onAnimationStart&&(interaction_view.events.onAnimationEnd(t.onAnimationStart),t.onAnimationStart=null)})},play:function(e,t){if(!e.loaded||!e.media||!e.media.paused)return e.iview.slider&&e.media&&e.iview.sliderplay(),!1;e.reseted=!1;if(e.get("iType")=="Video"||e.get("iType")=="QQVideo")e.poster&&(e.poster.hide(),e.control_btn.hide()),e.fullscreen&&interaction_view.media.video._fullScreen(e),e.iview.$el.removeClass("hide"),e.hided=!1;e.get("iType")=="Audio"?e.media.play():e.media.play(),e.iview.slider&&e.iview.sliderplay()},reset:function(e){if(!e.media||e.reseted)return!1;try{e.media.currentTime=0,e.media.pause()}catch(t){}e.reseted=!0},getDuration:function(e){return e.duration},_testfullscreen:function(e){var t="webkit";return e[t+"RequestFullScreen"]?t+"RequestFullScreen":e[t+"EnterFullScreen"]?t+"EnterFullScreen":!1},_fullScreen:function(e){if(interaction_view.isIos)return;var t=e.media,n=interaction_view.media.video._testfullscreen(t);if(!n){console.log("ä¸æ¯æå¨å±æ¨¡å¼");return}if(document.webkitIsFullScreen)return;var r=function(n){t.removeEventListener(webkitfullscreenchange,r,!1),interaction_view.isAndroid&&e.onAnimationStart&&(interaction_view.events.onAnimationEnd(e.onAnimationStart),e.onAnimationStart=null)};t.addEventListener("webkitfullscreenchange",r,!1),t[n]()}},audio:{init:function(t,n,r){var i=t.toJSON().file,s="Audio_"+t.id+n.id;n.src=i,n.audioid=s;if(_g.string.getUrlExt(i)==".m3u8"||_g.string.getUrlExt(i)==".M3U8")return;var o=n.iview.getdetail(),u=n.iview.getcommon();if(r&&typeof bgsound_id!="undefined"&&typeof bgsound_src!="undefined"&&bgsound_id==n.id){n.media=audio,interaction_view.bgsound=n,n.isBgsound=!0;if(!audio){audioelement=n,n.loaded=!0,t.set("loaded",!0),t.page.ipreloadlist.preloadcheck(t.toJSON().file,!0,n);return}a=$("audio#bgsound"),o.iAutoplay&&(n.autoplay=!0,n.media.play(),n.iview.sliderplay&&n.iview.sliderplay()),n.media.paused||(n.hasPlayed=!0)}else{var a=$('<audio id="'+s+'" style="position:absolute;"> <source src="'+i+'" /> </audio>');n.iview.$el.removeClass("hide").children(".Element").append(a),!_g.device.android()&&o.iRepeat&&a.attr("loop",""),n.media=a[0],n.autoplay=o.iAutoplay||!1,o.iAutoplay&&r&&(interaction_view.bgsound||(n.isBgsound=!0,interaction_view.bgsound=n))}n.loaded=!0,t.set("loaded",!0),t.page.ipreloadlist.preloadcheck(t.toJSON().file,!0,n),a.on("loadstart",function(e){}).on("error",function(e){}).on("timeupdate",function(e){if(n.iview.slider){var t=n.media.currentTime,r=n.media.duration,i=_g.number.decimal(t/r,2)*100;n.iview.onSliderChange(i)}}),a.on("ended",function(t){if(!o.iRepeat){n.iview.slider&&n.iview.sliderstop();if(n.media.seekable.length==0)return;try{n.media.currentTime=0,e.pause(n)}catch(r){}n.onAnimationStart&&(interaction_view.events.onAnimationEnd(n.onAnimationStart),n.onAnimationStart=null)}else _g.device.android()&&n.media.play()})},getDuration:function(e){return e.duration},play:function(t){e.video.play(t)},reset:function(t){if(t.isBgsound)return;e.video.reset(t)}},getTimeByPercent:function(e,t){if(!e.media)return null;var n=e.media.duration;return t/100*n}};return e}),define("interaction_view/ui/adapt",[],function(){var e={elements:[],size:{x:0,y:0},adjustSize:function(){},adjustPosition:function(){},adjustElement:function(e){var t=e.view.getcommon(),n=Reveal._getScreenScale();e.view.x=t.iStartx+t.iWidth/2,e.view.y=t.iStarty+t.iHeight/2,e.view.staticX=t.iStartx,e.view.staticY=t.iStarty;if(!e.adapt||e.adapt==5){var r=t.iStartx+t.iWidth/2,i=t.iStarty+t.iHeight/2;Reveal.slideScreenWidth>Reveal.slideWidth?(e.view.x=r+(Reveal.slideScreenWidth-Reveal.slideWidth)/2,e.view.staticX=e.view.x-t.iWidth/2):e.view.x=r,Reveal.slideScreenHeight>Reveal.slideHeight?(e.view.y=i+(Reveal.slideScreenHeight-Reveal.slideHeight)/2,e.view.staticY=e.view.y-t.iHeight/2):e.view.y=i}else{console.log(e.adapt);switch(e.adapt){case 1:e.view.sizeLeft=!0,e.view.sizeTop=!0;break;case 2:var r=t.iStartx+t.iWidth/2;Reveal.slideScreenWidth>Reveal.slideWidth?(e.view.x=r+(Reveal.slideScreenWidth-Reveal.slideWidth)/2,e.view.staticX=e.view.x-t.iWidth/2):e.view.x=r;break;case 3:e.view.sizeTop=!0,e.view.sizeRight=!0;var r=t.iStartx+t.iWidth/2,s=interaction_view.size.x-r;e.view.x=Reveal.slideScreenWidth-s,e.view.staticX=e.view.x-t.iWidth/2;break;case 4:e.view.sizeLeft=!0;var i=t.iStarty+t.iHeight/2;Reveal.slideScreenHeight>Reveal.slideHeight?e.view.y=i+(Reveal.slideScreenHeight-Reveal.slideHeight)/2:e.view.y=i,e.view.staticY=e.view.y-t.iHeight/2;break;case 5:break;case 6:e.view.sizeRight=!0;var r=t.iStartx+t.iWidth/2,s=interaction_view.size.x-r;e.view.x=Reveal.slideScreenWidth-s;var i=t.iStarty+t.iHeight/2;Reveal.slideScreenHeight>Reveal.slideHeight?e.view.y=i+(Reveal.slideScreenHeight-Reveal.slideHeight)/2:e.view.y=i,e.view.staticX=e.view.x-t.iWidth/2,e.view.staticY=e.view.y-t.iHeight/2;break;case 7:e.view.sizeLeft=!0,e.view.sizeBottom=!0;var i=t.iStarty+t.iHeight/2,o=interaction_view.size.y-i;e.view.y=Reveal.slideScreenHeight-o,e.view.staticY=e.view.y-t.iHeight/2;break;case 8:e.view.sizeBottom=!0;var r=t.iStartx+t.iWidth/2;Reveal.slideScreenWidth>Reveal.slideWidth?(e.view.x=r+(Reveal.slideScreenWidth-Reveal.slideWidth)/2,e.view.x=e.view.x):e.view.x=r;var i=t.iStarty+t.iHeight/2,o=interaction_view.size.y-i;e.view.y=Reveal.slideScreenHeight-o,e.view.staticX=e.view.x-t.iWidth/2,e.view.staticY=e.view.y-t.iHeight/2;break;case 9:e.view.sizeBottom=!0,e.view.sizeRight=!0;var r=t.iStartx+t.iWidth/2,s=interaction_view.size.x-r;e.view.x=Reveal.slideScreenWidth-s;var i=t.iStarty+t.iHeight/2,o=interaction_view.size.y-i;e.view.y=Reveal.slideScreenHeight-o,e.view.staticX=e.view.x-t.iWidth/2,e.view.staticY=e.view.y-t.iHeight/2;break;case 10:e.view.sizeLeft=!0,e.view.sizeRight=!0;var u=interaction_view.currentScreenSize?interaction_view.currentScreenSize.x:Reveal.slideScreenWidth,a=u-t.iStartx-(interaction_view.size.x-t.iStartx-t.iWidth);e.view.width=a;var i=t.iStarty+t.iHeight/2;Reveal.slideScreenHeight>Reveal.slideHeight?e.view.y=i+(Reveal.slideScreenHeight-Reveal.slideHeight)/2:e.view.y=i,e.view.x=e.view.staticX+e.view.width/2,e.view.staticY=e.view.y-e.view.originHeight/2;break;case 11:e.view.sizeTop=!0,e.view.sizeBottom=!0;var r=t.iStartx+t.iWidth/2;Reveal.slideScreenWidth>Reveal.slideWidth?(e.view.x=r+(Reveal.slideScreenWidth-Reveal.slideWidth)/2,e.view.staticX=e.view.x-e.view.originWidth/2):e.view.x=r;var f=interaction_view.currentScreenSize?interaction_view.currentScreenSize.y:Reveal.slideScreenHeight,l=f-t.iStarty-(interaction_view.size.y-t.iStarty-t.iHeight);e.view.height=l,e.view.y=e.view.staticY+e.view.height/2;break;case 12:e.view.sizeLeft=!0,e.view.sizeRight=!0,e.view.sizeTop=!0,e.view.sizeBottom=!0;var u=interaction_view.currentScreenSize?interaction_view.currentScreenSize.x:Reveal.slideScreenWidth,a=u-t.iStartx-(interaction_view.size.x-t.iStartx-t.iWidth);e.view.width=a;var f=interaction_view.currentScreenSize?interaction_view.currentScreenSize.y:Reveal.slideScreenHeight,l=f-t.iStarty-(interaction_view.size.y-t.iStarty-t.iHeight);e.view.height=l,e.view.staticX=t.iStartx,e.view.staticY=t.iStarty,e.view.x=t.iStartx+e.view.width/2,e.view.y=t.iStarty+e.view.height/2;break;case 13:e.view.sizeLeft=!0,e.view.sizeRight=!0,e.view.sizeTop=!0;var u=interaction_view.currentScreenSize?interaction_view.currentScreenSize.x:Reveal.slideScreenWidth,a=u-t.iStartx-(interaction_view.size.x-t.iStartx-t.iWidth);e.view.width=a,e.view.x=e.view.staticX+e.view.width/2;var i=t.iStarty+t.iHeight/2;if(Reveal.slideScreenHeight>Reveal.slideHeight)var c=Reveal.slideScreenHeight-Reveal.slideHeight;else var c=0;e.view.staticY=e.view.y-t.iHeight/2;var f=interaction_view.currentScreenSize?interaction_view.currentScreenSize.y:Reveal.slideScreenHeight,l=f-t.iStarty-(interaction_view.size.y-t.iStarty-t.iHeight)-c;e.view.height=l;break;case 14:e.view.sizeLeft=!0,e.view.sizeRight=!0,e.view.sizeBottom=!0;var u=interaction_view.currentScreenSize?interaction_view.currentScreenSize.x:Reveal.slideScreenWidth,a=u-t.iStartx-(interaction_view.size.x-t.iStartx-t.iWidth);e.view.width=a,e.view.x=e.view.staticX+e.view.width/2;var i=t.iStarty+t.iHeight/2;Reveal.slideScreenHeight>Reveal.slideHeight?e.view.y=i+(Reveal.slideScreenHeight-Reveal.slideHeight)/2:e.view.y=i,e.view.staticY=e.view.y-t.iHeight/2;var f=interaction_view.currentScreenSize?interaction_view.currentScreenSize.y:Reveal.slideScreenHeight,l=f-t.iStarty-(interaction_view.size.y-t.iStarty-t.iHeight);e.view.height=l;break;case 15:e.view.sizeLeft=!0,e.view.sizeTop=!0,e.view.sizeBottom=!0;if(Reveal.slideScreenWidth>Reveal.slideWidth)var c=Reveal.slideScreenWidth-Reveal.slideWidth;else var c=0;var u=interaction_view.currentScreenSize?interaction_view.currentScreenSize.x:Reveal.slideScreenWidth,a=u-t.iStartx-(interaction_view.size.x-t.iStartx-t.iWidth)-c;e.view.width=a;var f=interaction_view.currentScreenSize?interaction_view.currentScreenSize.y:Reveal.slideScreenHeight,l=f-t.iStarty-(interaction_view.size.y-t.iStarty-t.iHeight);e.view.height=l,e.view.x=e.view.staticX+e.view.width/2,e.view.y=e.view.staticY+e.view.height/2;break;case 16:e.view.sizeRight=!0,e.view.sizeTop=!0,e.view.sizeBottom=!0;var r=t.iStartx+t.iWidth/2;Reveal.slideScreenWidth>Reveal.slideWidth?(e.view.x=r+(Reveal.slideScreenWidth-Reveal.slideWidth)/2,e.view.staticX=e.view.x-t.iWidth/2):e.view.x=r;var u=interaction_view.currentScreenSize?interaction_view.currentScreenSize.x:Reveal.slideScreenWidth,a=u-t.iStartx-(interaction_view.size.x-t.iStartx-t.iWidth);e.view.width=a;var f=interaction_view.currentScreenSize?interaction_view.currentScreenSize.y:Reveal.slideScreenHeight,l=f-t.iStarty-(interaction_view.size.y-t.iStarty-t.iHeight);e.view.height=l,e.view.y=e.view.staticY+e.view.height/2;break;case 17:e.view.sizeTop=!0;var r=t.iStartx+t.iWidth/2;Reveal.slideScreenWidth>Reveal.slideWidth?(e.view.x=r+(Reveal.slideScreenWidth-Reveal.slideWidth)/2,e.view.staticX=e.view.x-t.iWidth/2):e.view.x=r;if(Reveal.slideScreenHeight>Reveal.slideHeight)var c=Reveal.slideScreenHeight-Reveal.slideHeight;else var c=0;e.view.staticY=e.view.y-t.iHeight/2;var f=interaction_view.currentScreenSize?interaction_view.currentScreenSize.y:Reveal.slideScreenHeight,l=f-t.iStarty-(interaction_view.size.y-t.iStarty-t.iHeight)-c;e.view.height=l,e.view.width=t.iWdith;break;case 18:e.view.sizeRight=!0;var i=t.iStarty+t.iHeight/2;Reveal.slideScreenHeight>Reveal.slideHeight?e.view.y=i+(Reveal.slideScreenHeight-Reveal.slideHeight)/2:e.view.y=i,e.view.staticY=e.view.y-t.iHeight/2;var r=t.iStartx+t.iWidth/2;Reveal.slideScreenWidth>Reveal.slideWidth?(e.view.x=r+(Reveal.slideScreenWidth-Reveal.slideWidth)/2,e.view.staticX=e.view.x-t.iWidth/2):e.view.x=r;var u=interaction_view.currentScreenSize?interaction_view.currentScreenSize.x:Reveal.slideScreenWidth,a=u-t.iStartx-(interaction_view.size.x-t.iStartx-t.iWidth);e.view.width=a;break;case 19:e.view.sizeBottom=!0;var r=t.iStartx+t.iWidth/2;Reveal.slideScreenWidth>Reveal.slideWidth?(e.view.x=r+(Reveal.slideScreenWidth-Reveal.slideWidth)/2,e.view.staticX=e.view.x-t.iWidth/2):e.view.x=r;var i=t.iStarty+t.iHeight/2;Reveal.slideScreenHeight>Reveal.slideHeight?e.view.y=i+(Reveal.slideScreenHeight-Reveal.slideHeight)/2:e.view.y=i,e.view.staticY=e.view.y-t.iHeight/2;var f=interaction_view.currentScreenSize?interaction_view.currentScreenSize.y:Reveal.slideScreenHeight,l=f-t.iStarty-(interaction_view.size.y-t.iStarty-t.iHeight);e.view.height=l;break;case 20:e.view.sizeLeft=!0;var i=t.iStarty+t.iHeight/2;Reveal.slideScreenHeight>Reveal.slideHeight?e.view.y=i+(Reveal.slideScreenHeight-Reveal.slideHeight)/2:e.view.y=i,e.view.staticY=e.view.y-t.iHeight/2;if(Reveal.slideScreenWidth>Reveal.slideWidth)var c=Reveal.slideScreenWidth-Reveal.slideWidth;else var c=0;var u=interaction_view.currentScreenSize?interaction_view.currentScreenSize.x:Reveal.slideScreenWidth,a=u-t.iStartx-(interaction_view.size.x-t.iStartx-t.iWidth)-c;e.view.width=a}e.view.width&&($.zoom&&$.zoom!=1?e.view.width=e.view.width/$.zoom:e.view.width=e.view.width),e.view.height&&($.zoom&&$.zoom!=1?e.view.height=e.view.height/$.zoom:e.view.height=e.view.height);if(_g.device.ios()){if(e.view.model.isMasterOverlay||e.view.model.isBackgroundOverlay)var h=$(Reveal.options.containment).offset();else var h=e.view.$el.closest(".interaction-area").offset();if(h){e.view.x=e.view.x-h.left,e.view.y=e.view.y-h.top,e.view.staticX=e.view.staticX-h.left,e.view.staticY=e.view.staticY-h.top;if(e.view.model.get("iType")=="LayerRef"||e.view.model.get("iType")=="ComponentRef")e.view.width&&(e.view.width=e.view.width+Math.abs(h.left)),e.view.height&&(e.view.height=e.view.height+Math.abs(h.top))}}}},change:function(){_.each(interaction_view.adapt.elements,function(e){interaction_view.adapt.excute(e)})},excute:function(e){interaction_view.adapt.adjustElement(e);var t=!1;e.view.model.get("isStatic")?(e.view.width&&(t=!0,e.view.originWidth=e.view.width,e.view.$el.width(e.view.width),e.view.$el.children(".Element").width(e.view.width)),e.view.height&&(t=!0,e.view.originHeight=e.view.height,e.view.$el.height(e.view.height),e.view.$el.children(".Element").height(e.view.height)),e.view.$el.css({left:e.view.staticX,top:e.view.staticY})):(interaction_view.setPos(e.view.$el[0],{x:e.view.x,y:e.view.y}),e.view.width&&(t=!0,e.view.originWidth=e.view.width,e.view.$el.children(".Element").width(e.view.width)),e.view.height&&(t=!0,e.view.originHeight=e.view.height,e.view.$el.children(".Element").height(e.view.height))),t&&e.view.onSizeAdaptChange&&e.view.onSizeAdaptChange()}};return e}),define("text!interaction_view/template/analytics.js",[],function(){return'<iframe src="<%=data.src%>" style="border:none;width:0;height:0;" class="analytics_frame"></iframe>'}),define("interaction_view/ui/analytics",["text!interaction_view/template/analytics.js"],function(){var e=require("text!interaction_view/template/analytics.js"),t={set:function(t){var n="./analytics/"+t+".html";$("body").find(".analytics_frame").length?$("body").find(".analytics_frame").attr("src",n):$("body").append(_.template(e,{data:{src:n}}))}};return t}),define("interaction_view/ui/weixin",[],function(){var e={chooseimage:function(e){if(interaction_view.foredit){global.message("warning","è¯·å¨å¾®ä¿¡æ¨¡å¼é¢è§è¯¥åè½");return}typeof wx_permissions!="undefined"&&wx_permissions.chooseImage?wx.chooseImage({success:function(t){t.localIds&&t.localIds.length?e&&e(t.localIds):e&&e(null)}}):interaction_view.weixin.error()},voiceauth:function(){if(interaction_view.foredit){global.message("warning","è¯·å¨å¾®ä¿¡æ¨¡å¼é¢è§è¯¥åè½");return}if(typeof wx_permissions!="undefined"&&wx_permissions.startRecord){if(interaction_view.weixinvoiceauth)return;wx.startRecord({success:function(){wx.stopRecord({})},cancel:function(){interaction_view.errorAlert("å¼å¯å¾®ä¿¡åè½å¤±è´¥")}}),interaction_view.weixinvoiceauth=!0}},shareable:function(){return typeof wx_permissions!="undefined"&&wx_permissions.onMenuShareTimeline?!0:!1},eventStatistic:function(e){var t="system",n=e,r="weixin",i="www.epub360.com";current_host=window.location.host,current_host.indexOf("tu960")!=-1&&(i=current_host);var s="http://"+i+"/manage/book/"+interaction_view.book_id+"/event.gif?opt_category="+t+"&opt_action="+r+"&opt_label="+n+"&t="+_g.uuid(),o=document.createElement("img");o.src=s,o.onload=function(){}},share:function(){if(typeof wx_permissions!="undefined"&&wx_permissions.onMenuShareTimeline){var e=message_link,t="";interaction_view.share_page_id=="current"?(e=_g.changeURLPar(e,"disableHistoryStart","0"),e=_g.changeURLPar(e,"pageid",interaction_view.currentPage)):interaction_view.share_page_id!="first"?(e=_g.changeURLPar(e,"disableHistoryStart","0"),e=_g.changeURLPar(e,"pageid",interaction_view.share_page_id)):interaction_view.share_page_id=="first"&&message_link.indexOf("pageid")>0&&(e=_g.changeURLPar(e,"disableHistoryStart","1"),e=_g.changeURLPar(e,"pageid",""));var n=shareTitle==bookTitle?descContent:shareTitle;wx.onMenuShareAppMessage({title:bookTitle,desc:n,link:e,imgUrl:imgUrl,trigger:function(e){_gaq.push(["_trackEvent","weixin","share","appmessage","click"])},success:function(e){shareSuccess(),interaction_view.weixin.eventStatistic("åéç»æå"),_gaq.push(["_trackSocial","Wechat","appmessage",ga_opt_target,ga_opt_pagePath]),_paq.push(["trackEvent","weixin","share","appmessage"])},cancel:function(e){_gaq.push(["_trackEvent","weixin","share","appmessage","cancel"])},fail:function(e){_gaq.push(["_trackEvent","error","weixinjsapi","appmessage",JSON.stringify(e)])}}),wx.onMenuShareTimeline({title:shareTitle,link:e,imgUrl:imgUrl,trigger:function(e){_gaq.push(["_trackEvent","weixin","share","timeline","click"])},success:function(e){shareSuccess(),interaction_view.weixin.eventStatistic("åäº«å°æåå"),_gaq.push(["_trackSocial","Wechat","timeline",ga_opt_target,ga_opt_pagePath]),_paq.push(["trackEvent","weixin","share","timeline"])},cancel:function(e){_gaq.push(["_trackEvent","weixin","share","timeline","cancel"])},fail:function(e){_gaq.push(["_trackEvent","error","weixinjsapi","timeline",JSON.stringify(e)])}}),wx.onMenuShareQQ({title:bookTitle,desc:n,link:e,imgUrl:imgUrl,trigger:function(e){_gaq.push(["_trackEvent","weixin","share","QQ","click"])},complete:function(e){_gaq.push(["_trackEvent","weixin","share","QQ","complete"])},success:function(e){shareSuccess(),interaction_view.weixin.eventStatistic("åäº«å°QQ"),_gaq.push(["_trackSocial","Wechat","QQ",ga_opt_target,ga_opt_pagePath]),_paq.push(["trackEvent","weixin","share","QQ"])},cancel:function(e){_gaq.push(["_trackEvent","weixin","share","QQ","cancel"])},fail:function(e){_gaq.push(["_trackEvent","error","weixinjsapi","QQ",JSON.stringify(e)])}}),wx.onMenuShareWeibo({title:shareTitle,desc:descContent,link:message_link,imgUrl:imgUrl,trigger:function(e){_paq.push(["trackEvent","weixin","share","Weibo","click"])},complete:function(e){_paq.push(["trackEvent","weixin","share","Weibo","complete"])},success:function(e){shareSuccess(),interaction_view.weixin.eventStatistic("åäº«å°å¾®å"),_gaq.push(["_trackSocial","Wechat","Weibo",ga_opt_target,ga_opt_pagePath]),_paq.push(["trackEvent","weixin","share","Weibo"])},cancel:function(e){_gaq.push(["_trackEvent","weixin","share","Weibo","cancel"])},fail:function(e){_gaq.push(["_trackEvent","error","weixinjsapi","Weibo",JSON.stringify(e)])}})}},error:function(e){interaction_view.errorAlert("å¼å¯å¾®ä¿¡åè½å¤±è´¥")}};return e}),function(){var e,t,n,r,i,s,o,u,a,f,l={};n=window.document.documentElement,f=window.navigator.userAgent.toLowerCase(),l.ios=function(){return l.iphone()||l.ipod()||l.ipad()},l.iphone=function(){return r("iphone")},l.ipod=function(){return r("ipod")},l.ipad=function(){return r("ipad")},l.android=function(){return r("android")},l.androidPhone=function(){return l.android()&&r("mobile")},l.androidTablet=function(){return l.android()&&!r("mobile")},l.blackberry=function(){return r("blackberry")||r("bb10")||r("rim")},l.blackberryPhone=function(){return l.blackberry()&&!r("tablet")},l.blackberryTablet=function(){return l.blackberry()&&r("tablet")},l.windows=function(){return r("windows")},l.mac=function(){return r("mac")},l.linux=function(){return r("linux")},l.windowsPhone=function(){return l.windows()&&r("phone")},l.windowsTablet=function(){return l.windows()&&r("touch")},l.fxos=function(){return(r("(mobile;")||r("(tablet;"))&&r("; rv:")},l.fxosPhone=function(){return l.fxos()&&r("mobile")},l.fxosTablet=function(){return l.fxos()&&r("tablet")},l.meego=function(){return r("meego")},l.mobile=function(){return l.androidPhone()||l.iphone()||l.ipod()||l.windowsPhone()||l.blackberryPhone()||l.fxosPhone()||l.meego()},l.tablet=function(){return l.ipad()||l.androidTablet()||l.blackberryTablet()||l.windowsTablet()||l.fxosTablet()},l.msie=function(){return $.browser.msie||!!navigator.userAgent.match(/Trident\/7\./)},l.portrait=function(){return Math.abs(window.orientation)!==90},l.landscape=function(){return Math.abs(window.orientation)===90},l.noConflict=function(){return this},l.svg=function(){return document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Shape","1.1")},l.online=function(e,t,n){var r=new Image;r.onload=function(){console.log("online"),t&&t.constructor==Function&&t()},r.onerror=function(){console.log("offline"),n&&n.constructor==Function&&n()},r.src=e+"?t="+_g.uuid()},l.screenSize=function(){var e=window,t=document,n=t.documentElement,r=t.getElementsByTagName("body")[0],i=e.innerWidth||n.clientWidth||r.clientWidth,s=e.innerHeight||n.clientHeight||r.clientHeight;return{x:i,y:s}},l.isWeixin=function(){var e=navigator.userAgent.toLowerCase();return/micromessenger/.test(e)?!0:!1},r=function(e){return f.indexOf(e)!==-1},s=function(e){var t;return t=new RegExp(e,"i"),n.className.match(t)},t=function(e){if(!s(e))return n.className+=" "+e},u=function(e){if(s(e))return n.className=n.className.replace(e,"")};var c=function(){l.ios()?l.ipad()?t("ios ipad tablet"):l.iphone()?t("ios iphone mobile"):l.ipod()&&t("ios ipod mobile"):l.android()?l.androidTablet()?t("android tablet"):t("android mobile"):l.blackberry()?l.blackberryTablet()?t("blackberry tablet"):t("blackberry mobile"):l.windows()?l.windowsTablet()?t("windows tablet"):l.windowsPhone()?t("windows mobile"):t("desktop"):l.fxos()?l.fxosTablet()?t("fxos tablet"):t("fxos mobile"):l.meego()?t("meego mobile"):t("desktop")};i=function(){return l.landscape()?(u("portrait"),t("landscape")):(u("landscape"),t("portrait"))},a="onorientationchange"in window,o=a?"orientationchange":"resize",window.addEventListener?window.addEventListener(o,i,!1):window.attachEvent?window.attachEvent(o,i):window[o]=i,i(),l.initDom=c,window._g_device=l,typeof require=="undefined"?(window._g||(window._g={}),window._g.device=_g_device):define("_g/device",["_g/base"],function(){return window._g.device=_g_device,window._g.device})}(window),define("interaction_view/ui/touchinit",[],function(){var e={init:function(){interaction_view.iImgs={},interaction_view.share_page_id="first",interaction_view.share_app_data={},window.shareSuccess=function(){$("#epub360-ad").addClass("show");var e=!1;["www.epub360.com","m.creatby.com"].indexOf(window.location.host)>=0&&(e=!0);if(window.location.pathname.indexOf("uaqjq")>0||window.location.pathname.indexOf("glh1i4")>0)e=!1;if(e)return;var t=_.filter(interaction_view.events.pageWXShareSuccessEvents,function(e){return e.page_id==interaction_view.currentPage});_.each(t,function(e){e.func()}),typeof epub360ShareEvent=="function"&&epub360ShareEvent()},interaction_view.wait=function(){$("#jswait-loading").hide(),$("body").append('<div class="mejs-overlay-button player-control-button" style="cursor:pointer;margin-top: -35px;position: absolute;top: 50%;left: 50%;width: 100px;height: 100px;margin: -50px 0 0 -50px;z-index: 1000001;background: url(http://qn.static.epub360.com/thirdparty/mediaelementjs/bigplay.svg);"></div>'),$(".player-control-button").on("click",function(){$("#jswait-loading").show(),$("div#epub360player-cover").remove(),$(".player-control-button").remove(),loading_progress_timer=setInterval(function(){compute_loadding_progress(),set_loading_progress()},200),interaction_view.start()})},interaction_view.start=function(){workEnd("-------- 1. touchinit 3 interaction_view.start start --------");var e=!1;_g.getUrlParameterByName("disableHistoryStart")==1&&(e=!0),workEnd("-------- 1. touchinit 3 add style 1 --------"),interaction_view.ismobile&&$("body").addClass("ios"),workEnd("-------- 1. touchinit 3 add style 1 --------");var t=interaction_view.doc.get("play_mode");interaction_view.book_id=interaction_view.doc.get("id"),interaction_view.play_mode=t,interaction_view.screen_mode=interaction_view.doc.get("screen_mode"),interaction_view.events.init(),interaction_view.screenset.init(),interaction_view.screenset.render();var n=interaction_view.doc.toJSON();workEnd("-------- 1. touchinit 3 interaction_view.start 1 --------"),new _g.touchslide({body:interaction_view.forpreview?".interaction-preview":"window",width:interaction_view.size.x,height:interaction_view.size.y,containment:".reveal",keyboard:!interaction_view.ismobile,controls:!interaction_view.ismobile,mouseWheel:!interaction_view.ismobile&&n.desktop_mousewheel,progress:!interaction_view.ismobile,adapt:n.adapt,history:interaction_view.forpreview?!1:!0,disableHistoryStart:e,show_excontent:n.show_excontent,screen_mode:n.screen_mode,transition:n.switch_mode,overview:interaction_view.forpreview?!1:n.controlbar_settings.overview,show_overview:interaction_view.ismobile?!1:interaction_view.forpreview?!1:!0,show_controlbar:n.show_controlbar,continuous:n.continuous,smooth:n.smooth,onReady:function(e,t){workEnd("-------- 1. touchinit 3 interaction_view.start  _g.touchslide.onReady  start ------------"),interaction_view.screenset.patchForWeiXin(),window.Reveal=e,interaction_view.forpreview||adjust_screen(),interaction_view.playstatus="wait",interaction_view.currentPage=t;var n=require("interaction_view/view/master");interaction_view.imasterlist.length&&interaction_view.imasterlist.at(0).addView("iview",n),workEnd("-------- 1. touchinit 3 interaction_view.start  masterview ------------");var r=require("interaction_view/view/background");interaction_view.ibackgroundlist.length&&interaction_view.ibackgroundlist.at(0).addView("iview",r),presentation.startLoad(),interaction_view.ismobile&&(presentation.isFirstPageLoading=interaction_view.currentPage),presentation.pageLoad(interaction_view.currentPage)},onSlideChangeStart:function(e){interaction_view.ismobile&&!interaction_view.isWeixin&&presentation.preloadpageAudio(e)},onStopPlay:function(e){interaction_view.pausePlay(e)},onContinuePlay:function(e){interaction_view.continuePlay(e)},onSlideChange:function(e,t){var n=e;interaction_view.currentPage=e,pre_id=t,interaction_view.ismobile||interaction_view.moveMaster(pre_id,n),interaction_view.stopPlay(pre_id);var r=interaction_view.ipagelist.getPage(interaction_view.currentPage);r.get("loaded")&&interaction_view.imasterlist.at(0).get("loaded")&&interaction_view.ibackgroundlist.at(0).get("loaded")?(interaction_view.playstatus="play",interaction_view.containment.find("#jswait-loading").remove(),interaction_view.android?window.setTimeout(function(){interaction_view.play(n)},100):interaction_view.play(n)):(!interaction_view.containment.has("#jswait-loading").length>0&&interaction_view.containment.jswait&&interaction_view.containment.jswait(),interaction_view.playstatus="wait",r.isStartLoad||interaction_view.ipagelist.getPage(r.id)&&presentation.pageLoad(r.id)),interaction_view.ismobile&&(_g.device.android()?window.setTimeout(function(){workEnd("preload"),presentation.preloadFourDirections(),presentation.clearPreloadPages()},0):(presentation.preloadFourDirections(),presentation.clearPreloadPages()))},onKeyboard:function(){interaction_view.transitionPagePreLoad=null},onWheel:function(){interaction_view.transitionPagePreLoad=null},canDrag:function(e){return $(e.target).closest(".disableDragX").length!=0&&$(e.target).closest(".disableDragY").length!=0?!1:!0},canDragX:function(e){return $(e.target).closest(".disableDragX").length!=0?$(e.target).closest(".disableDragX").hasClass("is_exceededX")?!0:!1:!0},canDragY:function(e){return $(e.target).closest(".disableDragY").length!=0?$(e.target).closest(".disableDragY").hasClass("is_exceededY")?!0:!1:!0},checkSlidePermission:function(e,t,n,r,i){if(n=="left"){var s=e.getCurrentSlideId();return interaction_view.control.getLeft(s)?!0:!1}if(n=="right"){var s=e.getCurrentSlideId();return interaction_view.control.getRight(s)?!0:!1}return!0},getOverview:function(e){return interaction_view.ipagelist.getPage(e)?interaction_view.ipagelist.getPage(e).toJSON().nav?interaction_view.ipagelist.getPage(e).toJSON().nav.thumbnail:null:null}}),interaction_view.ismobile||(interaction_view.presentate=new $.presentate(!0))},interaction_view.init=function(){interaction_view.forpreview?interaction_view.containment=$(".interaction-preview"):interaction_view.containment=$("body"),presentation.forpreview(),presentation.screencontrol(),_e.preloadpage&&_e.preloadpage.init(),window.iPageDirection="landscape";var e=require("interaction_view/model/doc");interaction_view.doc=new e({id:"doc"});if(typeof cbt_data!="undefined"||typeof epub360_book_data!="undefined"){interaction_view.forpreview||(interaction_view.isPack=!0);var t;workEnd("-------- 1. touchinit 1 page list start --------"),typeof epub360_book_data!="undefined"?(t=interaction_view.doc.parse(epub360_book_data),workEnd("-------- 1.1 touchinit 1 page parse --------")):t=interaction_view.doc.parse(cbt_data),interaction_view.doc.set(t),workEnd("-------- 1. touchinit 2 page list ready --------"),_g.getUrlParameterByName("autoplay")=="false"?interaction_view.wait():interaction_view.start(),workEnd("-------- 1. touchinit 3 interaction_view.start end --------")}else interaction_view.doc.fetch({success:function(e,t){_g.getUrlParameterByName("autoplay")=="false"?interaction_view.wait():interaction_view.start()}})}}};return e}),define("interaction_view/ui/application",["text!interaction_view/template/alertbox.js"],function(){var e=require("text!interaction_view/template/alertbox.js"),t={buttons:[],buttonGroups:[],initForm:function(e){_.each(e.data,function(t){if(t.binding)if(_.include(["radio","checkboxes","dropdown"],t.field_type)){var n=[];_.each(t.binding,function(r,s){if(!r)return;interaction_view.events.formEvents.push({overlay:r,func:function(n){interaction_view.application.setValue(e.id,t.cid,s,n),t.field_type!="checkboxes"&&interaction_view.application.execBindingButton(r)},i:t,cid:t.cid,key:s,id:e.id,bindSwitch:t.field_type!="checkboxes"}),n.push(r)}),t.field_type!="checkboxes"&&n.length>1&&interaction_view.application.buttonGroups.push({overlays:n})}else interaction_view.events.formEvents.push({overlay:t.binding,func:function(n){if(n&&t.field_type=="number"){n=Number(n);var r=interaction_view.application.validateNumber(n,t.field_options.min,t.field_options.max);r&&interaction_view.application.errorAlert(r)}interaction_view.application.setValue(e.id,t.cid,null,n)},i:t,cid:t.cid,id:e.id})})},getValue:function(e,t,n){var r=_.find(interaction_view.applications,function(t){return t.id==e}),i=_.find(r.data,function(e){return e.cid==t});return _.include(["radio","dropdown"],i.field_type)?n?n==i.value?1:0:i.value:_.include(["checkboxes"],i.field_type)?n&&i.value&&i.value.length?_.include(i.value,n):!1:i.value},setValue:function(e,t,n,r){var i=_.find(interaction_view.applications,function(t){return t.id==e});if(t=="submit")return interaction_view.application.submitForm(e),!1;i.data=_.map(i.data,function(e){return e.cid==t&&(_.include(["radio","dropdown"],e.field_type)?e.value=n:_.include(["checkboxes"],e.field_type)?(e.value||(e.value=[]),r?e.value=_.union(e.value,[n]):e.value=_.without(e.value,n)):e.value=r),e})},sendOverlayToButtonGroup:function(e){var t=e.createPath(),n=interaction_view.hashPath(t);_.include(_.pluck(interaction_view.application.buttons,"hash"),n)?interaction_view.application.buttons=_.map(interaction_view.application.buttons,function(t){return t.hash==n&&(t.overlay=e),t}):interaction_view.application.buttons.push({hash:n,overlay:e})},getHashs:function(e){var t=[];return _.each(e,function(e){t.push(interaction_view.hashPath(e.path)+e.id)}),t},execBindingButton:function(e){var t=interaction_view.hashPath(e.path)+e.id,n=[],r=_.find(interaction_view.application.buttonGroups,function(e){_.include(interaction_view.application.getHashs(e.overlays),t)&&_.each(e.overlays,function(e){interaction_view.hashPath(e.path)+e.id!=t&&n.push(e)})});n.length&&_.each(n,function(e){var t=interaction_view.hashPath(e.path)+e.id,n=_.find(interaction_view.application.buttons,function(e){return e.hash==t});n&&n.overlay.iview.resetButtonStatus()})},isBindingButton:function(e){var t=!1;return _.each(interaction_view.application.buttonGroups,function(n){_.include(interaction_view.application.getHashs(n.overlays),interaction_view.hashPath(e.createPath()))&&(t=!0)}),t},errorMsg:function(e,t,n,r){var i=_.find(interaction_view.applications,function(t){return t.id==e}),s=_.find(i.data,function(e){return e.cid==t});return n?s.label+(r||"ä¸­å¡«åçæ°å¼ä¸æ­£ç¡®"):_.include(["radio","dropdown","checkboxes"],s.field_type)?"è¯·éæ©"+s.label:s.label+(r||"ä¸è½ä¸ºç©º")},errorAlert:function(t){if(!interaction_view.containment.children(".alert_mask").length){interaction_view.containment.append('<div class="alert_mask"></div>');var n=_.template(e,{text:t});interaction_view.containment.append(n),interaction_view.containment.find(".alert-confirm").on("click",function(){interaction_view.containment.find(".alert_mask").remove(),interaction_view.containment.find(".alert-box").remove()})}},submitForm:function(e){var t=_.find(interaction_view.applications,function(t){return t.id==e});if(!t)return!1;var n={},r=!0,i;_.each(t.data,function(t){n[t.cid]=t.value;if(t.field_type=="number"){var s=!1;if(n[t.cid]||_.isNumber(n[t.cid]))s=!0;t.field_options.integer_only&&_.isNumber(n[t.cid])&&(n[t.cid]=Math.round(n[t.cid]));if(!_.isNumber(n[t.cid])||_.isNaN(n[t.cid])){if(t.required||s)i||(i=interaction_view.application.errorMsg(e,t.cid,s?!0:!1)),r=!1}else{var o=interaction_view.application.validateNumber(n[t.cid],t.field_options.min,t.field_options.max);o&&(i=interaction_view.application.errorMsg(e,t.cid,!0,o),r=!1)}}else t.required&&!n[t.cid]&&(i||(i=interaction_view.application.errorMsg(e,t.cid)),r=!1)});if(!r){i&&interaction_view.application.errorAlert(i);return}var s="/form/"+t.app_id+"/?format=json";_g.ajax.post({traditional:!0,url:s,data:n,callback:function(n){var r=null;if(n.code==200)interaction_view.events.onFormSubmitEvent(70,t.id);else{var i=n.msg;if(_.keys(i).length){var s=_.keys(i)[0];r=interaction_view.application.errorMsg(e,s),interaction_view.application.errorAlert(r)}}}})},setFormData:function(e,t,n,r){var i=_.find(interaction_view.applications,function(t){return t.id==e});if(!i)return!1;n==3&&(r=null);var s={};_.each(i.data,function(e){if(e.cid==t){if(n==1||n==2){r=Number(r),e.value=Number(e.value);if(_.isNaN(r)||!_.isNumber(r))return!1;if(_.isNaN(e.value)||!_.isNumber(e.value))e.value=0}n==1?e.value+=r:n==2?e.value-=r:e.field_type=="number"?e.value=Number(r):e.value=r}})},validateNumber:function(e,t,n){if(_.isNaN(e)||!_.isNumber(e))return"è¯·è¾å¥æ°å­";var r=!1,i="åå¼èå´:";t!=undefined&&(i=i+"å¤§äº"+t,e<=t&&(r=!0)),n!=undefined&&(i=i+"å°äº"+n,e>=n&&(r=!0));if(r)return i},getFormFieldValue:function(e){if(e.split("_").length!=2)return null;var t=e.split("_")[0],n=e.split("_")[1],r=_.find(interaction_view.applications,function(e){return e.app_id==t});if(!r)return null;var i=null;for(var s=0;s<r.data.length;s++)if(r.data[s].cid==n){typeof r.data[s].value!="undefined"&&(i=r.data[s].value);break}return i}};return t}),define("interaction_view/ui/timeline",["interaction_view/model/base"],function(){interaction_view.timeline={render:function(e){if(!epub360.isV2&&!epub360.variable.isV2)return;e.timelines=[],e.iOverlaylist.each(function(t){var n=t.get("iAnis");if(n.length&&!t.iAnimationlist){t.iAnimationlist=new interaction_view.collection.Animation,t.iAnimationlist.pageid=e.id;var r=[];for(var t=0;t<n.length;t++){var i=$.extend(!0,{},n[t]);i.id=_g.uuid(4),i.iKind||(i.iKind=0),i.pageid=e.id,r.push(i)}t.iAnimationlist.reset(r),e.timelines.push(t.iAnimationlist)}})},setPlay:function(e){e.timelines&&e.timelines.length&&_.each(e.timelines,function(e){e.setParams(),e.setPlay()})},play:function(e){e.timelines&&e.timelines.length&&_.each(e.timelines,function(e){e.timeline.play(0,!1)})}}}),function(){function t(e){this.options={};if(typeof e=="object")for(var t in e)e.hasOwnProperty(t)&&(this.options[t]=e[t]);this.init()}var e={1:"bounce",2:"flash",3:"pulse",4:"rubberBand",5:"shake",6:"swing",7:"tada",8:"wobble",9:"jello",12:"rotate",20:"bounceIn",21:"bounceInDown",22:"bounceInLeft",23:"bounceInRight",24:"bounceInUp",61:"bounceOut",62:"bounceOutDown",63:"bounceOutLeft",64:"bounceOutRight",65:"bounceOutUp",25:"fadeIn",26:"fadeInDown",27:"fadeInDownBig",28:"fadeInLeft",29:"fadeInLeftBig",30:"fadeInRight",31:"fadeInRightBig",32:"fadeInUp",33:"fadeInUpBig",67:"fadeOut",68:"fadeOutDown",69:"fadeOutDownBig",70:"fadeOutLeft",71:"fadeOutLeftBig",72:"fadeOutRight",73:"fadeOutRightBig",74:"fadeOutUp",75:"fadeOutUpBig",11:"flip",34:"flipInX",35:"flipInY",76:"flipOutX",77:"flipOutY",36:"lightSpeedIn",78:"lightSpeedOut",37:"rotateIn",38:"rotateInDownLeft",39:"rotateInDownRight",40:"rotateInUpLeft",41:"rotateInUpRight",79:"rotateOut",80:"rotateOutDownLeft",81:"rotateOutDownRight",82:"rotateOutUpLeft",83:"rotateOutUpRight",10:"hinge",42:"rollIn",93:"rollOut",44:"zoomIn",45:"zoomInDown",46:"zoomInLeft",47:"zoomInRight",48:"zoomInUp",84:"zoomOut",85:"zoomOutDown",86:"zoomOutLeft",87:"zoomOutRight",88:"zoomOutUp",49:"slideInDown",50:"slideInLeft",51:"slideInRight",52:"slideInUp",89:"slideOutDown",90:"slideOutLeft",91:"slideOutRight",92:"slideOutUp"};t.prototype.init=function(){for(var e=0;e<this.options.items.length;e++){var t=this.options.items[e];this.options.items[e].origin_el=t.el,t.el.wrapInner('<div class="child_Element" style="position:absolute;top:0;left:0;width:100%;height:100%;"></div>'),this.options.items[e].originClass="child_Element",this.options.items[e].el=t.el.children("div"),this.options.items[e].child=!0}},t.prototype.play=function(){for(var t=0;t<this.options.items.length;t++){var n=this.options.items[t],r=n.repeat;r?r==-1?r="infinite":r=r:r="1";var i=n.el,s=e[n.type],o=n.originClass.replace("hide","")+" "+s+" animated";i[0].style.animationDuration=n.duration+"s",i[0].style.animationDelay=n.delay+"s",i[0].style.animationIterationCount=r,i[0].style.webkitAnimationDuration=n.duration+"s",i[0].style.webkitAnimationDelay=n.delay+"s",i[0].style.webkitAnimationIterationCount=r,n.type>=20&&n.type<=60&&(i.closest(".iView").hasClass("hide")&&(i[0].initHide=!0,i.closest(".iView").removeClass("hide")),n.onShow&&n.onShow()),i[0].className=o,i.data("anitype",n.type),i.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){var e=$(this).data("anitype");e>=20&&e<=60?$(this).closest(".iView").removeClass("noevents"):e>60&&e<100&&$(this).closest(".iView").addClass("noevents")})}},t.prototype.stop=function(){for(var e=0;e<this.options.items.length;e++){var t=this.options.items[e];t.el[0].className="child_Element",t.el[0].style.animationDuration="",t.el[0].style.animationDelay="",t.el[0].style.animationIterationCount="",t.el[0].style.webkitAnimationDuration="",t.el[0].style.webkitAnimationDelay="",t.el[0].style.webkitAnimationIterationCount="",t.el[0].initHide&&t.el.closest(".iView").addClass("hide")}},window.Animate=t,window.ANIMATE_TYPE_VALUE=e}(window),define("_e/cssanimate",function(){}),function(){var e=function(e){this.init(e)};e.prototype={init:function(e){var t={slidesclass:".slides",disableHistoryStart:!1,groupclass:".group",itemclass:".Presentation"};this.options=e?$.extend(!0,{},t,e):t,_.bindAll(this),this._initVaribles(),this._initSlide(),this._initScreenSet(),this._initSlideItems();if(this.options.onReady){var n=this,r=this.slideType==3?this.indexes[0][0]:this.indexes[0];this.options.onReady(this,r)}return this},_bindRoute:function(){var e=this,t=Backbone.Router.extend({routes:{"page/:query":"page"}});this.Router=new t,this.Router.on("route:page",function(t,n){var r=e.getSlidePositionById(t);r&&e.slide(r.h,r.v)});var n=!1;e.options.disableHistoryStart&&(n=!0),e.options.disableHistoryStart||(Backbone.history.start({silent:n}),this.Router.navigate("page/"+this.getCurrentSlideId()))},_initVaribles:function(){this.indexv=0,this.indexh=0,this.currentSlideDirection=null,this.dragstart=!1,this.dragging=!1,this.sliding=!1},_initScreenSet:function(){this.slideScreenWidth=this.options.width,this.slideScreenHeight=this.options.height,this.slideWidth=this.options.width,this.slideHeight=this.options.height,this.slideContainment=$(this.options.containment),this.slideContent=$(this.options.containment).find(this.options.slidesclass).first()},_initSlideItems:function(){var e=0,t=0,n=this,r=[];this.slideItems=[],r[t]=[],n.slideItems[t]=[],this.slideContent.children(n.options.itemclass).each(function(){r[t][e]=$(this).attr("id")||1,n.slideItems[t][e]=this,e+=1}),t+=1,e=0,this.slideType=3,this.indexes=r},_initSlide:function(){},isLast:function(){return this.slideType==3?this.indexh==this.slideItems.length-1&&this.indexv==this.slideItems[this.indexh].length-1:this.indexh==this.slideItems.length-1},isFirst:function(){return this.slideType==3?this.indexh==0&&this.indexv==0:this.indexh==0},getSlideDirections:function(){var e={left:!1,right:!1,up:!1,down:!1};return this.slideType==1?(this.indexh>0&&(e.left=!0),this.indexh<this.indexes.length-1&&(e.right=!0)):(this.indexh>0&&(this.options.checkSlidePermission?this.options.checkSlidePermission(this,this.slideType,"left",this.indexh,this.indexv)&&(e.left=!0):e.left=!0),this.indexh<this.indexes.length-1&&(this.options.checkSlidePermission?this.options.checkSlidePermission(this,this.slideType,"right",this.indexh,this.indexv)&&(e.right=!0):e.right=!0),this.indexv>0&&(e.up=!0),this.indexv<this.indexes[this.indexh].length-1&&(e.down=!0)),e},_getCurrentPosition:function(){var e=-this.indexh*this.slideScreenWidth,t=-this.indexv*this.slideScreenHeight;return{x:e,y:t}},isOverview:function(){return!1},getSlideItem:function(e,t){return this.slideType==3?this.slideItems[e][t]:this.slideItems[e]},getSlideItemById:function(e){var t=this.getSlidePositionById(e);return t?this.slideType==3?this.slideItems[t.h][t.v]:this.slideItems[t.h]:null},getCurrentSlide:function(){return this.slideType==3?this.slideItems[this.indexh][this.indexv]:this.slideItems[this.indexh]},getCurrentSlideId:function(){return this.slideType==3?this.indexes[this.indexh][this.indexv]:this.indexes[this.indexh]},getIndices:function(){return{h:this.indexh,v:this.indexv}},getAllSlideIds:function(){var e=[];if(this.slideType==3){for(i=0;i<this.indexes.length;i++)for(j=0;j<this.indexes[i].length;j++)e.push(this.indexes[i][j]);return e}return this.indexes},getFirst:function(){var e=this.getAllSlideIds();return e?e[0]:null},getLast:function(){var e=this.getAllSlideIds();return e?e[e.length-1]:null},getRight:function(){return this.getSlideDirections().right?this.slideType==3?this.indexes[this.indexh+1][0]:this.indexes[this.indexh+1]:null},getLeft:function(){return this.getSlideDirections().left?this.slideType==3?this.indexes[this.indexh-1][0]:this.indexes[this.indexh-1]:null},getUp:function(){return this.getSlideDirections().up?this.slideType==3?this.indexes[this.indexh][this.indexv-1]:null:null},getDown:function(){return this.getSlideDirections().down?this.slideType==3?this.indexes[this.indexh][this.indexv+1]:null:null},getPrev:function(){return this.getSlideDirections().up?this.getUp():typeof this.indexes[this.indexh-1]=="object"&&this.indexes[this.indexh-1][0]?_.last(this.indexes[this.indexh-1]):this.indexes[this.indexh-1]},getNext:function(){var e;return this.getSlideDirections().down?e=this.getDown():e=this.getRight(),!e&&Reveal.indexes.length>this.indexh+1&&(e=this.indexes[this.indexh+1][0]),e},getSlidePositionById:function(e){var t=null;if(this.slideType==3){for(i=0;i<this.indexes.length;i++)for(j=0;j<this.indexes[i].length;j++)if(this.indexes[i][j]==e)return{h:i,v:j};return t}return this.indexes.indexOf(e)!=-1?{h:this.indexes.indexOf(e),v:null}:null},getVerticalLength:function(){return this.slideType==3?this.indexes[this.indexh].length:1},getHorizontalLength:function(){return this.indexes.length},slide:function(e,t){if(e==undefined)return;if(e==this.indexh&&t==this.indexv)return;var n=this.getCurrentSlideId();this.indexh=e,this.indexv=t?t:0;var r=e*this.slideScreenWidth,i=t?t*this.slideScreenHeight:0,s=this.getCurrentSlideId();this.onSlideChange(s,n)},prev:function(){if(this.indexh==0||this.indexes.length<2)return;this.slide(this.indexh-1)},next:function(){if(this.indexh==this.indexes.length-1||this.indexes.length<2)return;this.slide(this.indexh+1)},up:function(){if(this.slideType!=3)return;this.indexes[this.indexh][this.indexv-1]&&this.slide(this.indexh,this.indexv-1)},down:function(){if(this.slideType!=3)return;this.indexes[this.indexh][this.indexv+1]&&this.slide(this.indexh,this.indexv+1)},setAdaptScreen:function(){},_initSlideStyle:function(){},onSlideChange:function(e,t){var n=this;this.previousSlide=t,this.currentSlide=e,this.indexv=$(".Presentation.c-transition-wx").index(),n.options.onSlideChange&&n.options.onSlideChange(n.currentSlide,n.previousSlide)}},typeof require=="undefined"?(window._g||(window._g={}),window._g.touchslide=e):define("_e/wx_touchslide",["_g/base"],function(){return window._g.touchslide=e,window._g.touchslide})}(window),define("text!interaction_view/template/pagenumber.js",[],function(){return'<%if(presentation.getPageNumber().horizontal_count>1){ %>\n<nav class="iView master nav-horizen pagenumber" style="position:absolute;left:<%=pageno_horizontal.x%>px;top:<%=pageno_horizontal.y%>px;<%=pageno_horizontal.show?"":"display:none;"%>">\n    <%for(i=0;i<presentation.getPageNumber().horizontal_count;i++){%><li class="<%=Reveal.getIndices().h==i?"active":""%>"><a href="#" data-index="<%=i%>"></a></li><% } %>\n</nav>\n<% } %>\n<%if(presentation.getPageNumber().vertical_count>1){ %>\n<nav class="iView master nav-vertical pagenumber" style="position:absolute;left:<%=pageno_vertical.x%>px;top:<%=pageno_vertical.y%>px;<%=pageno_vertical.show?"":"display:none;"%>">\n    <%for(i=0;i<presentation.getPageNumber().vertical_count;i++){%><li class="<%=Reveal.getIndices().v==i?"active":""%>"><a href="#" data-index="<%=i%>"></a></li><% } %>\n</nav>\n<% } %>'}),define("_e/wx_presentation",["_g/ui","text!interaction_view/template/pagenumber.js"],function(){var e=require("text!interaction_view/template/pagenumber.js"),t={init:function(){},masterPageReset:function(){interaction_view.imasterlist.length&&interaction_view.imasterlist.at(0).iOverlaylist.each(function(e){_.include(["Grid","PageIndex","Gallery"],e.get("iType"))&&e.iview.resetOtherStatus()})},preloadpageAudio:function(e){interaction_view.ismobile&&interaction_view.imasterlist.at(0).iOverlaylist.each(function(e){e.get("iType")=="Audio"&&e.media&&(e.hasPlayed||e.autoplay&&(interaction_view.media.play(e),e.hasPlayed=!0))})},play:function(e){var n=null;typeof e=="string"?n=interaction_view.getParentpage(e):n=e;if(!n.isLayer&&n.get("type")=="page"&&interaction_view.environment.Shareapp.status==1)return;if(interaction_view.mode=="Page"&&!n.isLayer&&interaction_view.ipagelist.getPage(n.id)){t.setBackgroundDisplay(n);var r=n.get("share_page_id")||"first";if(r=="current"||interaction_view.share_page_id!=r)interaction_view.share_page_id=r,interaction_view.weixin.share();typeof ScrollPage!="undefined"&&ScrollPage.bindScrollPage(interaction_view.currentPage)}n.playFinished==1&&(n.iOverlaylist.resetViewStatus(),n.iOverlaylist.resetBindings(),n.iAnimationlist.resetAnimationStatus(),n.playFinished=!1),n.iOverlaylist.each(function(e){n.playFinished||e._reset&&e.iview.resetStatus(),e.media&&(e.autoplay?interaction_view.ismobile&&e.get("isBgsound")?typeof bgsound_id=="undefined"&&(interaction_view.media.play(e),e.media.paused||(e.hasPlayed=!0)):(interaction_view.media.play(e),e.media.paused||(e.hasPlayed=!0)):e.get("iType")=="Video"&&(e.get("iDetail").iHidden||(e.notallowed=!0,e.iview.$el.removeClass("hide"),e.iview.$el.css("opacity",1),e.control&&e.iview.$el.find("video").css("display","block"),e.hided=!1))),e.renderWebContent&&e.iview.renderWebContent()}),n.played=!1,interaction_view.events.clearWaitClick(),interaction_view.events.clearAnimationWaitSwipe(),n.iAnimationlist.setParams(),n.iAnimationlist.css_timeline&&n.iAnimationlist.css_timeline.play(),n.iAnimationlist.setPlay(),n.playFinished=!0,interaction_view.mode=="Page"&&!interaction_view.masterplayed&&!n.isLayer&&(interaction_view.masterplayed=!0,interaction_view.imasterlist.length&&interaction_view.play(interaction_view.imasterlist.at(0))),interaction_view.mode=="Page"&&!interaction_view.backgroundplayed&&!n.isLayer&&(interaction_view.backgroundplayed=!0,interaction_view.ibackgroundlist.length&&interaction_view.play(interaction_view.ibackgroundlist.at(0))),n.isLayer?interaction_view.events.onPageStart(n.iOverlaylist.pageid,n.iOverlaylist.layerid):interaction_view.events.onPageStart(n.id),interaction_view.events.onControllerEvent(n.id),interaction_view.mode=="Page"&&!n.isLayer&&interaction_view.ipagelist.getPage(n.id)&&t.setMasterDisplay(n),n.iAnimationlist.timeline&&n.iAnimationlist.timeline.play(0,!1),n.iOverlaylist.each(function(e){switch(e.get("iType")){case"LayerRef":case"LayerSlide":case"ComponentRef":e.iview.playLayer();break;case"Timer":e.iview.resetTimer();break;case"Vote":e.iview.triggerVoted();break;case"Variable":case"SystemVariable":e.iview.triggerVarChange()}e._autoplay&&e.iview._autoplay()})},pause:function(e){var t;typeof e=="string"?t=interaction_view.ipagelist.getPage(e):t=e,t.playFinished&&t.iAnimationlist.timeline&&t.iAnimationlist.timeline.pause()},continuePlay:function(e){var t;typeof e=="string"?t=interaction_view.ipagelist.getPage(e):t=e,t.playFinished&&t.iAnimationlist.timeline&&t.iAnimationlist.timeline.play()},stop:function(e){var t;typeof e=="string"?t=interaction_view.ipagelist.getPage(e):t=e,t.playFinished&&(t.iAnimationlist.timeline&&(t.iAnimationlist.timeline.pause(0),t.iOverlaylist.resetViewStatus(),typeof e=="string"&&$(".interaction-view").css("cursor","auto"),interaction_view.bezierPatch(e)),t.iAnimationlist.css_timeline&&t.iAnimationlist.css_timeline.stop(),t.iActionlist.each(function(e){e.iview.timeline&&e.iview.timeline.pause(1e-5)}),t.iOverlaylist.each(function(e){e.media&&(e.iview.resetOtherStatus(),e.iview.iType=="Video"&&e.iview.$el.addClass("hide")),(e.iview.iType=="LayerRef"||e.iview.iType=="LayerSlide"||e.iview.iType=="ComponentRef")&&e.iview.stoplayer(),(e.iview.iType=="LayerRef"||e.iview.iType=="Image"||e.iview.iType=="ImageBlock")&&e.iview.renderMask(),(e.iview.iType=="Slide"||e.iview.iType=="LayerSlide"||e.iview.iType=="CycleImage")&&e.iview.timeline&&e.iview.timeline.pause(1e-5),e.iview.iType=="Timer"&&e.iview.stopTimerSimple(),e.renderWebContent&&e.iview.clearWebContent()}))},getPageNumber:function(){var e=Reveal.getVerticalLength(),t=Reveal.getHorizontalLength();return{vertical_count:e,horizontal_count:t}},setMasterDisplay:function(e){t.setPageNumber(e),interaction_view.show_master=e.get("show_master")?!0:!1;var n=$('.Presentation[id="'+e.id+'"]').find(".interaction-view");interaction_view.touchview&&(n=$(".reveal")),interaction_view.show_master||interaction_view.mode=="Master"?n.children(".iView.master").removeClass("masterhide"):n.children(".iView.master").addClass("masterhide"),t.masterPageReset(e)},setBackgroundDisplay:function(e){interaction_view.show_background=e.get("show_background")?!0:!1;var t=$('.Presentation[id="'+e.id+'"]').find(".interaction-view");interaction_view.touchview&&(t=$(".reveal")),interaction_view.show_background||interaction_view.mode=="Background"?t.children(".iView.background").removeClass("backgroundhide"):t.children(".iView.background").addClass("backgroundhide")},setPageNumber:function(e){return},setPageNumberPosition:function(){return},bezierPatch:function(e){},startLoad:function(){t.pagesForLoad=[],interaction_view.imasterlist&&interaction_view.imasterlist.length&&t.pagesForLoad.push(interaction_view.imasterlist.at(0).id),interaction_view.ibackgroundlist&&interaction_view.ibackgroundlist.length&&t.pagesForLoad.push(interaction_view.ibackgroundlist.at(0).id),_.each(interaction_view.ipagelist.getPages(),function(e){t.pagesForLoad.push(e.id)}),t.pagelength=t.pagesForLoad.length;var e;if(!interaction_view.forpreview||interaction.doc.mode!="Layer"&&interaction.doc.mode!="Background")if(interaction_view.imasterlist&&interaction_view.imasterlist.length||interaction_view.ibackgroundlist&&interaction_view.ibackgroundlist.length){interaction_view.imasterlist&&interaction_view.imasterlist.length&&(e=interaction_view.imasterlist.at(0));if(interaction_view.ibackgroundlist&&interaction_view.ibackgroundlist.length){var n=interaction_view.ibackgroundlist.at(0);n.iview.prepareLoad(),n.iview.startLoad(),n.isStartLoad=!0}}else e=interaction_view.ipagelist.at(0);else interaction_view.imasterlist&&interaction_view.imasterlist.length?e=interaction_view.imasterlist.at(0):e=interaction_view.ipagelist.at(0);e.iview.prepareLoad(),e.iview.startLoad(),e.isStartLoad=!0},pagesForLoad:[],pageLoadEvent:function(e){},pageLoad:function(e){var n=interaction_view.ipagelist.getPage(e);!n.isStartLoad&&!n.get("loaded")?(n.iview.prepareLoad(),n.iview.startLoad(),n.isStartLoad=!0):interaction_view.ismobile&&t.pagePreloadCenter(e)},bookStatus:0,foredit:function(){},forpreview:function(){interaction_view.mode="Page",interaction_view.events.clearAll(),$("body").children("preloader").remove(),$("body").append('<div id="preloader"></div>'),interaction_view.forpreview||$("body").prepend('<div class="loading progress progress-striped active"><div class="bar" style="width: 0%;"></div></div>'),interaction_view.finishPagePreload=function(e,n){t.pagesForLoad=_.reject(t.pagesForLoad,function(t){return t==e}),n||(n=interaction_view.ipagelist.getPage(e)||interaction_view.imasterlist.get(e)||interaction_view.ibackgroundlist.get(e)),interaction_view.donext(n),n.set("loaded",!0,{silent:!0});if(t.pagesForLoad.length==0||t.pagelength-t.pagesForLoad.length>=1)if(interaction_view.imasterlist.length==0||interaction_view.imasterlist.at(0).get("loaded"))if(interaction_view.ibackgroundlist.length==0||interaction_view.ibackgroundlist.at(0).get("loaded"))interaction_view.preloadended||(interaction_view.preloadended=!0);if(interaction_view.playstatus=="wait"&&interaction_view.preloadended){var r=interaction_view.ipagelist.getPage(interaction_view.currentPage);r.get("loaded")&&(interaction_view.playstatus="play",interaction_view.containment.children(".prejsloading").length?loading_progress_percent<60?(loading_progress_percent=71,window.loading_progress_timer1=setInterval(function(){compute_loadding_progress(),set_loading_progress()},100)):(loading_progress_percent=100,set_loading_progress(),workEnd("-------- 3. presentation : start clear loading 1 --------"),window.setTimeout(function(){interaction_view.containment.children(".prejsloading").remove(),interaction_view.play(interaction_view.currentPage),workEnd("-------- 3. presentation : start clear loading 1 --------"),window.loadAnalytics&&loadAnalytics()},500)):(interaction_view.containment.children("#jswait-loading").remove(),interaction_view.play(interaction_view.currentPage)))}else if(interaction_view.preloadended&&interaction_view.transitionPagePreLoad&&e==interaction_view.transitionPagePreLoad.page_id){var i=interaction_view.transitionPagePreLoad.transition;interaction_view.transitionPagePreLoad=null,t.gotopage(e,i)}t.pagesForLoad.length==0?$(".loading").remove():interaction_view.ismobile||interaction_view.ipagelist.getPage(t.pagesForLoad[0])&&t.pageLoad(t.pagesForLoad[0]);if(interaction_view.ismobile)if(t.isFirstPageLoading){e==t.isFirstPageLoading&&(t.firstpageloaded=!0);if(t.firstpageloaded&&interaction_view.imasterlist.at(0).get("loaded")&&interaction_view.ibackgroundlist.at(0).get("loaded")){var s=t.isFirstPageLoading;t.isFirstPageLoading=null,t.preloadFourDirections(),t.pagePreloadCenter(s)}}else t.pagePreloadCenter(e)},interaction_view.setPreloadStatus=function(){var e=0,t=0;_.each(interaction_view.ipagelist.getPages(),function(n){t+=n.ipreloadlist.length,n.ipreloadlist.length>0&&(e+=n.ipreloadlist.where({loaded:!0}).length)}),interaction_view.imasterlist.length&&(t+=interaction_view.imasterlist.at(0).ipreloadlist.length,interaction_view.imasterlist.at(0).ipreloadlist.length>0&&(e+=interaction_view.imasterlist.at(0).ipreloadlist.where({loaded:!0}).length)),interaction_view.ibackgroundlist.length&&(t+=interaction_view.ibackgroundlist.at(0).ipreloadlist.length,interaction_view.ibackgroundlist.at(0).ipreloadlist.length>0&&(e+=interaction_view.ibackgroundlist.at(0).ipreloadlist.where({loaded:!0}).length)),$(".loading").children("div").css("width",String(e/t*100)+"%")},interaction_view.donext=function(e){e.iview.afterpreload()},interaction_view.play=t.play,interaction_view.stopPlay=t.stop,interaction_view.pausePlay=t.pause,interaction_view.continuePlay=t.continuePlay,interaction_view.moveMaster=function(e,t){if(!interaction_view.touchview){var n=$('.Presentation[id="'+e+'"]').find(".interaction-view").children(".iView.master").detach();$('.Presentation[id="'+t+'"]').find(".interaction-view").append(n)}},interaction_view.bezierPatch=t.bezierPatch,interaction_view.slideChange=function(e){if(!Reveal)return;typeof e=="number"&&Reveal.slide(e);if(typeof e=="string"){var t=interaction_view.getModelById(interaction_view.iChapter,e);Reveal.slide(t.get("index"))}},interaction_view.firstPlay=!0},screencontrol:function(){window.isFullscreen=!1,window.screenLock=!1,window.screenAutoAdapt=function(){if(window.screenLock)return;if(screenfull.isFullscreen){isFullscreen=!0;var e=window.screen.width/window.screen.height>=interaction_view.size.x/interaction_view.size.y?window.screen.height/interaction_view.size.y:window.screen.width/interaction_view.size.x;_g.ui.scale(".reveal",e)}else isFullscreen=!1,_g.ui.scale(".reveal",1)},!interaction_view.ismobile&&(screenfull.onchange=screenAutoAdapt)},gotopage:function(e,n){interaction_view.transitionPagePreLoad=null;var r=null,i,s,o,u;if(e==interaction_view.currentPage)return;switch(n){case 0:o=0,s="y",i="up",u=1;break;case 1:o=0,s="x",i="right",u=-1;break;case 2:o=0,s="y",i="down",u=-1;break;case 3:o=0,s="x",i="left",u=1;break;case 4:o=1,s="y",i="up",u=1;break;case 5:o=1,s="x",i="right",u=-1;break;case 6:o=1,s="y",i="down",u=-1;break;case 7:o=1,s="x",i="left",u=1;break;case 8:o=2,s="x",i="left",u=1;break;case 10:o=3,s="y",i="up",u=1;break;case 11:o=3,s="x",i="right",u=-1;break;case 12:o=3,s="y",i="down",u=-1;break;case 13:o=3,s="x",i="left",u=1;break;case 14:o=4,s="y",i="up",u=1;break;case 15:o=4,s="x",i="right",u=-1;break;case 16:o=4,s="y",i="down",u=-1;break;case 17:o=4,s="x",i="left",u=1;break;case 18:o=5,s="y",i="up",u=1;break;case 19:o=5,s="x",i="right",u=-1;break;case 20:o=5,s="y",i="down",u=-1;break;case 21:o=5,s="x",i="left",u=1}if(interaction_view.ipagelist.getPage(e)){var a=interaction_view.ipagelist.getPage(e);interaction_view.doc.toJSON().play_mode==0?indexh=interaction_view.ipagelist.indexOf(a):(a.icollection.length&&(a=a.icollection.at(0)),indexh=a.collection.parent.collection.indexOf(a.collection.parent),r=a.collection.indexOf(a));if(!a.get("loaded")){interaction_view.transitionPagePreLoad={page_id:e,transition:n},t.pageLoad(e);return}if(n==9){Reveal.slide(indexh,r);return}Reveal.setSingleSlideItem(indexh,r,i),Reveal.originh=Reveal.indexh,Reveal.originv=Reveal.indexv,Reveal.indexh=indexh,r!=null&&(Reveal.indexv=r),Reveal.transition.autostart(o,s,u)}},preloadFourDirections:function(){t.touchPreloadPageList=[];var e=Reveal.getSlideDirections();e.left?t.touchPreloadPageList.push(Reveal.getLeft()):interaction_view.control.getGroupLeft(Reveal.getCurrentSlideId())&&t.touchPreloadPageList.push(interaction_view.control.getGroupLeftId(Reveal.getCurrentSlideId())),e.right?t.touchPreloadPageList.push(Reveal.getRight()):interaction_view.control.getGroupRight(Reveal.getCurrentSlideId())&&t.touchPreloadPageList.push(interaction_view.control.getGroupRightId(Reveal.getCurrentSlideId())),Reveal.slideType==3&&(e.up&&t.touchPreloadPageList.push(Reveal.getUp()),e.down&&t.touchPreloadPageList.push(Reveal.getDown())),t.touchPreloadPageList.length&&t.pagePreloadCenter()},clearPreloadPages:function(){t.touchClearPageList=[];var e=Reveal.getAllSlideIds();_.each(e,function(e){e!=Reveal.getLeft()&&e!=Reveal.getRight()&&e!=Reveal.getUp()&&e!=Reveal.getDown()&&e!=Reveal.getCurrentSlideId()&&e!=interaction_view.control.getGroupRightId(Reveal.getCurrentSlideId())&&e!=interaction_view.control.getGroupLeftId(Reveal.getCurrentSlideId())&&t.touchClearPageList.push(e)}),t.touchClearPageList.length&&t.pageClearCenter()},pagePreloadCenter:function(e){e&&(t.touchPreloadPageList=_.reject(t.touchPreloadPageList,function(t){return t==e}));if(t.touchPreloadPageList.length){var n=t.touchPreloadPageList[0];t.pageLoad(n)}},pageClearCenter:function(e){e&&(t.touchClearPageList=_.reject(t.touchClearPageList,function(t){return t==e}));if(t.touchClearPageList.length){var n=interaction_view.ipagelist.getPage(t.touchClearPageList[0]);n.iview.clearPageLoad()}},touchPreloadPageList:[],touchClearPageList:[]};window.presentation=t}),function(){var e={init:function(e){var t=interaction_view.size,n=1,r=!0;$(".reveal").css({width:"100%",height:"100%"}),$(".slides").width("100%"),$(".slides").height("100%"),$("section.Presentation").eq(0).addClass("c-transition-wx-current");var i=t.x,s=t.y,o=new WxMoment.PageSlider({pages:$("section.Presentation"),direction:"vertical",currentClass:"c-transition-wx",onchange:function(e){console.log(e);var t=$("section.Presentation.c-transition-wx-current").attr("id"),n=$("section.Presentation.c-transition-wx").attr("id");console.log(t+" "+n),$("section.Presentation").removeClass("c-transition-wx-current"),$("section.Presentation.c-transition-wx").addClass("c-transition-wx-current"),Reveal.onSlideChange(n,t)}});new WxMoment.OrientationTip,window.get_window_size=function(){return{x:$(window).width(),y:$(window).height()}},window.adjustRevealPosition=function(e){},window.adjust_screen=function(){var e=1,t=get_window_size(),o=t.x,u=t.y;$("body").height($("html").height()-0),i>=s?n==2?e=window.screenScale?window.screenScale:o/u>=i/s?o/i:u/s:e=window.screenScale?window.screenScale:o/u>=i/s?u/s:o/i:n==2?e=window.screenScale?window.screenScale:u/o>=s/i?u/s:o/i:e=window.screenScale?window.screenScale:u/o>=s/i?o/i:u/s;var a=document.querySelectorAll(".interaction-area");for(var f=0;f<a.length;f++)a[f].style.zoom=e;$.zoom=e,r,adjustRevealPosition(e)},window.onresize=function(e){console.log("window resize"),adjust_screen()},adjust_screen()},render:function(){},patchForWeiXin:function(){}};typeof require=="undefined"?(window._e||(window._e={}),window._e.screenset=e):define("_e/wx_screenset",["jquery"],function(){return window._e||(window._e={}),window._e.screenset=e,window._e.screenset})}(window),function(e,t,n){function s(e,n){this.wrapper=typeof e=="string"?t.querySelector(e):e,this.scroller=this.wrapper.children[0],this.scrollerStyle=this.scroller.style,this.options={startX:0,startY:0,scrollY:!0,directionLockThreshold:5,momentum:!0,bounce:!0,bounceTime:600,bounceEasing:"",preventDefault:!0,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/},HWCompositing:!0,useTransition:!0,useTransform:!0};for(var r in n)this.options[r]=n[r];this.translateZ=this.options.HWCompositing&&i.hasPerspective?" translateZ(0)":"",this.options.useTransition=i.hasTransition&&this.options.useTransition,this.options.useTransform=i.hasTransform&&this.options.useTransform,this.options.eventPassthrough=this.options.eventPassthrough===!0?"vertical":this.options.eventPassthrough,this.options.preventDefault=!this.options.eventPassthrough&&this.options.preventDefault,this.options.scrollY=this.options.eventPassthrough=="vertical"?!1:this.options.scrollY,this.options.scrollX=this.options.eventPassthrough=="horizontal"?!1:this.options.scrollX,this.options.freeScroll=this.options.freeScroll&&!this.options.eventPassthrough,this.options.directionLockThreshold=this.options.eventPassthrough?0:this.options.directionLockThreshold,this.options.bounceEasing=typeof this.options.bounceEasing=="string"?i.ease[this.options.bounceEasing]||i.ease.circular:this.options.bounceEasing,this.options.resizePolling=this.options.resizePolling===undefined?60:this.options.resizePolling,this.options.tap===!0&&(this.options.tap="tap"),this.x=0,this.y=0,this.directionX=0,this.directionY=0,this._events={},this._init(),this.refresh(),this.scrollTo(this.options.startX,this.options.startY),this.enable()}var r=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(t){e.setTimeout(t,1e3/60)},i=function(){function o(e){return s===!1?!1:s===""?e:s+e.charAt(0).toUpperCase()+e.substr(1)}var r={},i=t.createElement("div").style,s=function(){var e=["t","webkitT","MozT","msT","OT"],t,n=0,r=e.length;for(;n<r;n++){t=e[n]+"ransform";if(t in i)return e[n].substr(0,e[n].length-1)}return!1}();r.getTime=Date.now||function(){return(new Date).getTime()},r.extend=function(e,t){for(var n in t)e[n]=t[n]},r.addEvent=function(e,t,n,r){e.addEventListener(t,n,!!r)},r.removeEvent=function(e,t,n,r){e.removeEventListener(t,n,!!r)},r.prefixPointerEvent=function(t){return e.MSPointerEvent?"MSPointer"+t.charAt(9).toUpperCase()+t.substr(10):t},r.momentum=function(e,t,r,i,s,o){var u=e-t,a=n.abs(u)/r,f,l;return o=o===undefined?6e-4:o,f=e+a*a/(2*o)*(u<0?-1:1),l=a/o,f<i?(f=s?i-s/2.5*(a/8):i,u=n.abs(f-e),l=u/a):f>0&&(f=s?s/2.5*(a/8):0,u=n.abs(e)+f,l=u/a),{destination:n.round(f),duration:l}};var u=o("transform");return r.extend(r,{hasTransform:u!==!1,hasPerspective:o("perspective")in i,hasTouch:"ontouchstart"in e,hasPointer:e.PointerEvent||e.MSPointerEvent,hasTransition:o("transition")in i}),r.isBadAndroid=/Android /.test(e.navigator.appVersion)&&!/Chrome\/\d/.test(e.navigator.appVersion),r.extend(r.style={},{transform:u,transitionTimingFunction:o("transitionTimingFunction"),transitionDuration:o("transitionDuration"),transitionDelay:o("transitionDelay"),transformOrigin:o("transformOrigin")}),r.hasClass=function(e,t){var n=new RegExp("(^|\\s)"+t+"(\\s|$)");return n.test(e.className)},r.addClass=function(e,t){if(r.hasClass(e,t))return;var n=e.className.split(" ");n.push(t),e.className=n.join(" ")},r.removeClass=function(e,t){if(!r.hasClass(e,t))return;var n=new RegExp("(^|\\s)"+t+"(\\s|$)","g");e.className=e.className.replace(n," ")},r.offset=function(e){var t=-e.offsetLeft,n=-e.offsetTop;while(e=e.offsetParent)t-=e.offsetLeft,n-=e.offsetTop;return{left:t,top:n}},r.preventDefaultException=function(e,t){for(var n in t)if(t[n].test(e[n]))return!0;return!1},r.extend(r.eventType={},{touchstart:1,touchmove:1,touchend:1,mousedown:2,mousemove:2,mouseup:2,pointerdown:3,pointermove:3,pointerup:3,MSPointerDown:3,MSPointerMove:3,MSPointerUp:3}),r.extend(r.ease={},{quadratic:{style:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",fn:function(e){return e*(2-e)}},circular:{style:"cubic-bezier(0.1, 0.57, 0.1, 1)",fn:function(e){return n.sqrt(1- --e*e)}},back:{style:"cubic-bezier(0.175, 0.885, 0.32, 1.275)",fn:function(e){var t=4;return(e-=1)*e*((t+1)*e+t)+1}},bounce:{style:"",fn:function(e){return(e/=1)<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}},elastic:{style:"",fn:function(e){var t=.22,r=.4;return e===0?0:e==1?1:r*n.pow(2,-10*e)*n.sin((e-t/4)*2*n.PI/t)+1}}}),r.tap=function(e,n){var r=t.createEvent("Event");r.initEvent(n,!0,!0),r.pageX=e.pageX,r.pageY=e.pageY,e.target.dispatchEvent(r)},r.click=function(e){var n=e.target,r;/(SELECT|INPUT|TEXTAREA)/i.test(n.tagName)||(r=t.createEvent("MouseEvents"),r.initMouseEvent("click",!0,!0,e.view,1,n.screenX,n.screenY,n.clientX,n.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,null),r._constructed=!0,n.dispatchEvent(r))},r}();s.prototype={version:"5.1.3",_init:function(){this._initEvents()},destroy:function(){this._initEvents(!0),this._execEvent("destroy")},_transitionEnd:function(e){if(e.target!=this.scroller||!this.isInTransition)return;this._transitionTime(),this.resetPosition(this.options.bounceTime)||(this.isInTransition=!1,this._execEvent("scrollEnd"))},_start:function(e){if(i.eventType[e.type]!=1&&e.button!==0)return;if(!this.enabled||this.initiated&&i.eventType[e.type]!==this.initiated)return;this.options.preventDefault&&!i.isBadAndroid&&!i.preventDefaultException(e.target,this.options.preventDefaultException)&&e.preventDefault();var t=e.touches?e.touches[0]:e,r;this.initiated=i.eventType[e.type],this.moved=!1,this.distX=0,this.distY=0,this.directionX=0,this.directionY=0,this.directionLocked=0,this._transitionTime(),this.startTime=i.getTime(),this.options.useTransition&&this.isInTransition?(this.isInTransition=!1,r=this.getComputedPosition(),this._translate(n.round(r.x),n.round(r.y)),this._execEvent("scrollEnd")):!this.options.useTransition&&this.isAnimating&&(this.isAnimating=!1,this._execEvent("scrollEnd")),this.startX=this.x,this.startY=this.y,this.absStartX=this.x,this.absStartY=this.y,this.pointX=t.pageX,this.pointY=t.pageY,this._execEvent("beforeScrollStart")},_move:function(e){if(!this.enabled||i.eventType[e.type]!==this.initiated)return;this.options.preventDefault&&e.preventDefault();var t=e.touches?e.touches[0]:e,r=t.pageX-this.pointX,s=t.pageY-this.pointY,o=i.getTime(),u,a,f,l;this.pointX=t.pageX,this.pointY=t.pageY,this.distX+=r,this.distY+=s,f=n.abs(this.distX),l=n.abs(this.distY);if(o-this.endTime>300&&f<10&&l<10)return;!this.directionLocked&&!this.options.freeScroll&&(f>l+this.options.directionLockThreshold?this.directionLocked="h":l>=f+this.options.directionLockThreshold?this.directionLocked="v":this.directionLocked="n");if(this.directionLocked=="h"){if(this.options.eventPassthrough=="vertical")e.preventDefault();else if(this.options.eventPassthrough=="horizontal"){this.initiated=!1;return}s=0}else if(this.directionLocked=="v"){if(this.options.eventPassthrough=="horizontal")e.preventDefault();else if(this.options.eventPassthrough=="vertical"){this.initiated=!1;return}r=0}r=this.hasHorizontalScroll?r:0,s=this.hasVerticalScroll?s:0,u=this.x+r,a=this.y+s;if(u>0||u<this.maxScrollX)u=this.options.bounce?this.x+r/3:u>0?0:this.maxScrollX;if(a>0||a<this.maxScrollY)a=this.options.bounce?this.y+s/3:a>0?0:this.maxScrollY;this.directionX=r>0?-1:r<0?1:0,this.directionY=s>0?-1:s<0?1:0,this.moved||this._execEvent("scrollStart"),this.moved=!0,this._translate(u,a),o-this.startTime>300&&(this.startTime=o,this.startX=this.x,this.startY=this.y)},_end:function(e){if(!this.enabled||i.eventType[e.type]!==this.initiated)return;this.options.preventDefault&&!i.preventDefaultException(e.target,this.options.preventDefaultException)&&e.preventDefault();var t=e.changedTouches?e.changedTouches[0]:e,r,s,o=i.getTime()-this.startTime,u=n.round(this.x),a=n.round(this.y),f=n.abs(u-this.startX),l=n.abs(a-this.startY),c=0,h="";this.isInTransition=0,this.initiated=0,this.endTime=i.getTime();if(this.resetPosition(this.options.bounceTime))return;this.scrollTo(u,a);if(!this.moved){this.options.tap&&i.tap(e,this.options.tap),this.options.click&&i.click(e),this._execEvent("scrollCancel");return}if(this._events.flick&&o<200&&f<100&&l<100){this._execEvent("flick");return}this.options.momentum&&o<300&&(r=this.hasHorizontalScroll?i.momentum(this.x,this.startX,o,this.maxScrollX,this.options.bounce?this.wrapperWidth:0,this.options.deceleration):{destination:u,duration:0},s=this.hasVerticalScroll?i.momentum(this.y,this.startY,o,this.maxScrollY,this.options.bounce?this.wrapperHeight:0,this.options.deceleration):{destination:a,duration:0},u=r.destination,a=s.destination,c=n.max(r.duration,s.duration),this.isInTransition=1);if(u!=this.x||a!=this.y){if(u>0||u<this.maxScrollX||a>0||a<this.maxScrollY)h=i.ease.quadratic;this.scrollTo(u,a,c,h);return}this._execEvent("scrollEnd")},_resize:function(){var e=this;clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){e.refresh()},this.options.resizePolling)},resetPosition:function(e){var t=this.x,n=this.y;return e=e||0,!this.hasHorizontalScroll||this.x>0?t=0:this.x<this.maxScrollX&&(t=this.maxScrollX),!this.hasVerticalScroll||this.y>0?n=0:this.y<this.maxScrollY&&(n=this.maxScrollY),t==this.x&&n==this.y?!1:(this.scrollTo(t,n,e,this.options.bounceEasing),!0)},disable:function(){this.enabled=!1},enable:function(){this.enabled=!0},refresh:function(){var e=this.wrapper.offsetHeight;this.wrapperWidth=this.wrapper.clientWidth,this.wrapperHeight=this.wrapper.clientHeight,this.scrollerWidth=this.scroller.offsetWidth,this.scrollerHeight=this.scroller.offsetHeight,this.maxScrollX=this.wrapperWidth-this.scrollerWidth,this.maxScrollY=this.wrapperHeight-this.scrollerHeight,this.hasHorizontalScroll=this.options.scrollX&&this.maxScrollX<0,this.hasVerticalScroll=this.options.scrollY&&this.maxScrollY<0,this.hasHorizontalScroll||(this.maxScrollX=0,this.scrollerWidth=this.wrapperWidth),this.hasVerticalScroll||(this.maxScrollY=0,this.scrollerHeight=this.wrapperHeight),this.endTime=0,this.directionX=0,this.directionY=0,this.wrapperOffset=i.offset(this.wrapper),this._execEvent("refresh"),this.resetPosition()},on:function(e,t){this._events[e]||(this._events[e]=[]),this._events[e].push(t)},off:function(e,t){if(!this._events[e])return;var n=this._events[e].indexOf(t);n>-1&&this._events[e].splice(n,1)},_execEvent:function(e){if(!this._events[e])return;var t=0,n=this._events[e].length;if(!n)return;for(;t<n;t++)this._events[e][t].apply(this,[].slice.call(arguments,1))},scrollBy:function(e,t,n,r){e=this.x+e,t=this.y+t,n=n||0,this.scrollTo(e,t,n,r)},scrollTo:function(e,t,n,r){r=r||i.ease.circular,this.isInTransition=this.options.useTransition&&n>0,!n||this.options.useTransition&&r.style?(this._transitionTimingFunction(r.style),this._transitionTime(n),this._translate(e,t)):this._animate(e,t,n,r.fn)},scrollToElement:function(e,t,r,s,o){e=e.nodeType?e:this.scroller.querySelector(e);if(!e)return;var u=i.offset(e);u.left-=this.wrapperOffset.left,u.top-=this.wrapperOffset.top,r===!0&&(r=n.round(e.offsetWidth/2-this.wrapper.offsetWidth/2)),s===!0&&(s=n.round(e.offsetHeight/2-this.wrapper.offsetHeight/2)),u.left-=r||0,u.top-=s||0,u.left=u.left>0?0:u.left<this.maxScrollX?this.maxScrollX:u.left,u.top=u.top>0?0:u.top<this.maxScrollY?this.maxScrollY:u.top,t=t===undefined||t===null||t==="auto"?n.max(n.abs(this.x-u.left),n.abs(this.y-u.top)):t,this.scrollTo(u.left,u.top,t,o)},_transitionTime:function(e){e=e||0,this.scrollerStyle[i.style.transitionDuration]=e+"ms",!e&&i.isBadAndroid&&(this.scrollerStyle[i.style.transitionDuration]="0.001s")},_transitionTimingFunction:function(e){this.scrollerStyle[i.style.transitionTimingFunction]=e},_translate:function(e,t){this.options.useTransform?this.scrollerStyle[i.style.transform]="translate("+e+"px,"+t+"px)"+this.translateZ:(e=n.round(e),t=n.round(t),this.scrollerStyle.left=e+"px",this.scrollerStyle.top=t+"px"),this.x=e,this.y=t},_initEvents:function(t){var n=t?i.removeEvent:i.addEvent,r=this.options.bindToWrapper?this.wrapper:e;n(e,"orientationchange",this),n(e,"resize",this),this.options.click&&n(this.wrapper,"click",this,!0),this.options.disableMouse||(n(this.wrapper,"mousedown",this),n(r,"mousemove",this),n(r,"mousecancel",this),n(r,"mouseup",this)),i.hasPointer&&!this.options.disablePointer&&(n(this.wrapper,i.prefixPointerEvent("pointerdown"),this),n(r,i.prefixPointerEvent("pointermove"),this),n(r,i.prefixPointerEvent("pointercancel"),this),n(r,i.prefixPointerEvent("pointerup"),this)),i.hasTouch&&!this.options.disableTouch&&(n(this.wrapper,"touchstart",this),n(r,"touchmove",this),n(r,"touchcancel",this),n(r,"touchend",this)),n(this.scroller,"transitionend",this),n(this.scroller,"webkitTransitionEnd",this),n(this.scroller,"oTransitionEnd",this),n(this.scroller,"MSTransitionEnd",this)},getComputedPosition:function(){var t=e.getComputedStyle(this.scroller,null),n,r;return this.options.useTransform?(t=t[i.style.transform].split(")")[0].split(", "),n=+(t[12]||t[4]),r=+(t[13]||t[5])):(n=+t.left.replace(/[^-\d.]/g,""),r=+t.top.replace(/[^-\d.]/g,"")),{x:n,y:r}},_animate:function(e,t,n,s){function c(){var h=i.getTime(),p,d,v;if(h>=l){o.isAnimating=!1,o._translate(e,t),o.resetPosition(o.options.bounceTime)||o._execEvent("scrollEnd");return}h=(h-f)/n,v=s(h),p=(e-u)*v+u,d=(t-a)*v+a,o._translate(p,d),o.isAnimating&&r(c)}var o=this,u=this.x,a=this.y,f=i.getTime(),l=f+n;this.isAnimating=!0,c()},handleEvent:function(e){switch(e.type){case"touchstart":case"pointerdown":case"MSPointerDown":case"mousedown":this._start(e);break;case"touchmove":case"pointermove":case"MSPointerMove":case"mousemove":this._move(e);break;case"touchend":case"pointerup":case"MSPointerUp":case"mouseup":case"touchcancel":case"pointercancel":case"MSPointerCancel":case"mousecancel":this._end(e);break;case"orientationchange":case"resize":this._resize();break;case"transitionend":case"webkitTransitionEnd":case"oTransitionEnd":case"MSTransitionEnd":this._transitionEnd(e);break;case"wheel":case"DOMMouseScroll":case"mousewheel":this._wheel(e);break;case"keydown":this._key(e);break;case"click":e._constructed||(e.preventDefault(),e.stopPropagation())}}},s.utils=i,typeof module!="undefined"&&module.exports?module.exports=s:e.IScroll=s}(window,document,Math),define("thirdparty/iscroll/iscroll-lite",function(){}),require(["_e/wx_components","interaction_view/ui/main","interaction_view/ui/control","interaction_view/ui/event","interaction_view/ui/environment","interaction_view/ui/mobilemedia","interaction_view/ui/adapt","interaction_view/ui/analytics","interaction_view/ui/weixin","_g/device","interaction_view/ui/touchinit","interaction_view/ui/application","interaction_view/ui/timeline","_e/cssanimate","_e/wx_touchslide","_e/wx_presentation","_e/wx_screenset","thirdparty/iscroll/iscroll-lite"],function(){typeof _e=="undefined"&&(_e={});var e=require("interaction_view/ui/main");interaction_view.force3D=!1,interaction_view=$.extend({},interaction_view,e),typeof _e==undefined&&(_e={}),interaction_view.weixin=require("interaction_view/ui/weixin"),interaction_view.control=require("interaction_view/ui/control"),interaction_view.events=require("interaction_view/ui/event"),interaction_view.environment=require("interaction_view/ui/environment"),interaction_view.media=require("interaction_view/ui/mobilemedia"),interaction_view.screenset=_e.screenset,interaction_view.adapt=require("interaction_view/ui/adapt"),interaction_view.analytics=require("interaction_view/ui/analytics"),interaction_view.application=require("interaction_view/ui/application");if(_g.device.mobile()||_g.device.tablet())interaction_view.ismobile=!0;interaction_view.touchview=!0,interaction_view.isAndroid=interaction_view.android=_g.device.android(),interaction_view.isWeixin=_g.device.isWeixin(),interaction_view.isIos=_g.device.ios(),interaction_view.isWin=!1,interaction_view.isMac=!1,interaction_view.touchinit=require("interaction_view/ui/touchinit"),interaction_view.wxmoment=!0,workEnd("--------0 mobilemain touchinit.init --------"),interaction_view.touchinit.init(),window.start_player=function(){interaction_view.init()}}),define("common/js/interaction_view/wx/h5",function(){});